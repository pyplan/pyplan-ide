/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[117,278],{1248:function(t,e,n){"use strict";(function(a,l){var i,o,s,r=n(18),u=(s=n(1539))&&s.__esModule?s:{default:s};i=[n(765),n(865),n(852),n(2333),n(2334),n(2335),n(2336)],void 0===(o=function(t,e,i,o,s,d,c){return a.View.extend({el:l("#main"),diagram:void 0,nodeFinder:void 0,diagramClipboard:void 0,editor:null,render:function(){var e=this;this._uId=l.uuid();var n={id:this._uId};this.inputModuleModel=new t,this.inputModuleController=new i;var a=o(n);this.$el.append(a),this.listEntities(),this.addHandlers(),this.addTableHandlers(),this.getBase().on("beforeRemoveView",(function(t,n){e.onBeforeRemoveView(t,n)})),l(window).resize((function(){e.updateSizes()}))},onBeforeRemoveView:function(){l("#entityDefinition").length},updateSizes:function(){var t=this.getBase().find(".groupsInput").height(),e=l("#left .navigation").height();l("#entityDefinition").css("height",e-(325+t))},getBase:function(){return l("div[data-id='"+this._uId+"']")},listEntities:function(){var t=this,e=l(".entityList");e.empty(),this.inputModuleModel.list((function(a){var i=s({data:a});e.append(i);t.getBase().find("table").cubeTable(null,{iDisplayLength:50},"inputForms"),t.getBase().find(".dataTables_scrollBody").css("height",t.h+"px"),n.e(315).then((function(){var e=[n(1088)];(function(e){var n={items:[]};l.each(e,(function(t,e){n.items.push(e)}));var a=c(n);t.getBase().find("div.data-table-options").append(a)}).apply(null,e)})).catch(n.oe)}))},addHandlers:function(){var t=this;this.getBase().on("click","div.data-table-options a.btn-addEntity",(function(){return t.addEntity(null),!1})),this.getBase().on("click","div.data-table-options a.btn-addInputTemplate",(function(){var e=l(this).attr("tmpl");return t.addEntity(e),!1})),this.getBase().on("click",".form-actions button.btn-cancel",(function(){return t.close(),!1})),this.getBase().on("click",".form-actions button.btn-save",(function(){return t.save(),!1}))},addTableHandlers:function(){var t=this;this.getBase().on("click","table button.btn-edit",(function(){var e=l(this).attr("data-id");return t.editEntity(e),!1})),this.getBase().on("click","table button.btn-delete",(function(){var e=l(this).attr("data-id");n.e(6).then((function(){var a=[n(674)];(function(n){(new n).show({title:(0,r.translate)("remove_entity"),text:(0,r.translate)("confirm_remove_entity"),buttons:[{title:(0,r.translate)("yes"),css:"primary",code:"yes"},{title:(0,r.translate)("no"),code:"no"}],callback:function(n){"yes"==n&&t.deleteEntity(e)}})}).apply(null,a)})).catch(n.oe)})),this.getBase().on("click","table button.btn-generate",(function(){var e=l(this).attr("data-id");return t.generateEntity(l(this),e),!1})),this.getBase().on("click","table button.btn-input-data",(function(){var e=l(this).attr("data-id"),n=l(this).attr("data-name"),a=l(this).attr("data-code");return t.openForm({templateId:e,templateName:n,templateCode:a}),!1}))},close:function(){this.listEntities()},addEntity:function(t){var a=this,i=l(".entityList");i.empty();var o=d();i.append(o),this.updateSizes();var s=new e;t&&Promise.all([n.e(15),n.e(29),n.e(102)]).then((function(){var e=[n(2646)("./"+t)];(function(t){a.editor.set(t)}).apply(null,e)})).catch(n.oe),s.List(__currentSession.companyId,(function(t){if(t.length>0){for(var e=[{value:"",text:""}],n=0;n<t.length;n++)e[n]={value:t[n].groupId,text:t[n].name};var i=a.getBase().find("div.form-groups a");i.editable({pk:1,value:null,source:e,placement:"right",success:function(t,e){l(this).attr("data-value",e)}}),i.on("shown",(function(){var t=l(this).data("editable").input.$input.closest("form"),e=t.parents("form").eq(0);t.data("validator",e.data("validator"))}))}})),this.createEditor()},deleteEntity:function(t){var e=this;this.inputModuleModel.delete(t,(function(t){e.listEntities()}))},generateEntity:function(t,e){var n=this,a=t;l(".entityList").empty(),this.inputModuleModel.generate(e,(function(t){(0,r.showMessage)((0,r.translate)("entity_created"),(0,r.translate)("success"),"success",!0),n.listEntities(),a.enable(!1)}))},editEntity:function(t){var n=this,a=l(".entityList");a.empty();var i=new e;this.inputModuleModel.get(t,(function(t){var e=t.groups;i.List(__currentSession.companyId,(function(t){if(t.length>0){for(var a=[{value:"",text:""}],i=0;i<t.length;i++)a[i]={value:t[i].groupId,text:t[i].name};var o=[];for(i=0;i<e.length;i++)o[i]=e[i].groupId;var s=n.getBase().find("div.form-groups a");s.attr("data-value",o.toString()),s.editable({pk:1,value:o,source:a,placement:"right",success:function(t,e){l(this).attr("data-value",e)}}),s.on("shown",(function(){var t=l(this).data("editable").input.$input.closest("form"),e=t.parents("form").eq(0);t.data("validator",e.data("validator"))}))}}));var o={templateId:t.InputTemplateId,code:t.code,name:t.name,definition:t.definition},s=d(o);a.append(s),setTimeout((function(){n.createEditor(t.definition),n.updateSizes()}),100)}))},save:function(){var t=this,e=this.getBase().find(".txtId").val(),n=this.getBase().find(".txtCode").val(),a=this.getBase().find(".txtName").val(),l=this.getBase().find(".form-groups a.editable").attr("data-value"),i=t.editor.get(),o=[];if(void 0!==l)for(var s=0;s<l.length;s++)o.push({groupId:l[s]});var r={code:n,name:a,groups:o,definition:JSON.stringify(i,null,"\t")};""!==e&&void 0!==e?(r.InputTemplateId=e,this.inputModuleModel.update(r,(function(e){t.listEntities()}))):this.inputModuleModel.create(r,(function(e){t.listEntities()}))},openForm:function(t){this.inputModuleController.openViewer(t)},createEditor:function(t){var e=document.getElementById("entityDefinition");this.editor=new u.default(e,{mode:"tree",modes:["code","form","text","tree","view"]});var n=void 0===t?"":t;""!==(n=(n=n.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,""))&&this.editor.set(JSON.parse(n))}})}.apply(e,i))||(t.exports=o)}).call(this,n(220),n(1))},2333:function(t,e,n){var a=n(681);t.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(t,e,n,a,l){var i,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div data-id="'+t.escapeExpression("function"==typeof(i=null!=(i=o(n,"id")||(null!=e?o(e,"id"):e))?i:t.hooks.helperMissing)?i.call(null!=e?e:t.nullContext||{},{name:"id",hash:{},data:l,loc:{start:{line:1,column:14},end:{line:1,column:20}}}):i)+'" class="container-fluid mainTask full-horizontal inputModuleTask" data-rel="input-module" data-type="tab-content" >\n\n    <div class="box">\n      <div class="box-content entityList">\n\n      </div>\n    </div>\n\n</div>'},useData:!0})},2334:function(t,e,n){var a=n(681);t.exports=(a.default||a).template({1:function(t,e,a,l,i){var o,s,r=t.lambda,u=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'      <tr>\n        <td class="templateId">'+u(r(null!=e?d(e,"InputTemplateId"):e,e))+"</td>\n        <td >"+u(r(null!=e?d(e,"code"):e,e))+"</td>\n        <td >"+u(r(null!=e?d(e,"name"):e,e))+'</td>\n        <td>\n            <button class="btn btn-small btn-green btn-edit" data-original-title="Edit" data-id="'+u(r(null!=e?d(e,"InputTemplateId"):e,e))+'">\n            <i class="fa fa-pencil-square-o"></i></button>\n            <button class="btn btn-small btn-red btn-delete" data-original-title="Delete" data-id="'+u(r(null!=e?d(e,"InputTemplateId"):e,e))+'">\n            <i class="fa fa-trash"></i></button>\n'+(null!=(o=(s=n(680),s&&(s.__esModule?s.default:s)).call(null!=e?e:t.nullContext||{},null!=e?d(e,"generated"):e,"==",!1,{name:"ifCond",hash:{},fn:t.program(2,i,0),inverse:t.program(4,i,0),data:i,loc:{start:{line:21,column:12},end:{line:27,column:23}}}))?o:"")+"        </td>\n      </tr>\n"},2:function(t,e,n,a,l){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <button class="btn btn-small btn btn-orange btn-generate" data-original-title="Generate table" data-id="'+t.escapeExpression(t.lambda(null!=e?i(e,"InputTemplateId"):e,e))+'">\n            <i class="fa fa-asterisk"></i></button>\n'},4:function(t,e,n,a,l){var i=t.lambda,o=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <button class="btn btn-small btn btn-primary btn-input-data" data-original-title="Input data" data-id="'+o(i(null!=e?s(e,"InputTemplateId"):e,e))+'" data-name="'+o(i(null!=e?s(e,"name"):e,e))+'" data-code="'+o(i(null!=e?s(e,"code"):e,e))+'">\n            <i class="fa fa-table"></i></button>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,a,l){var i,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<table id="'+t.escapeExpression(t.lambda(null!=e?o(e,"id"):e,e))+'" class="table table-hover table-nomargin table-bordered dataTable dataTable-nosort">\n  <thead>\n    <tr>\n      <th>Id</th>\n      <th>Code</th>\n      <th>Name</th>\n      <th>Actions</th>\n    </tr>\n  </thead>\n  <tbody>\n'+(null!=(i=o(n,"each").call(null!=e?e:t.nullContext||{},null!=e?o(e,"data"):e,{name:"each",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l,loc:{start:{line:11,column:4},end:{line:30,column:13}}}))?i:"")+"  </tbody>\n</table>\n"},useData:!0})},2335:function(t,e,n){var a=n(681);function l(t){return t&&(t.__esModule?t.default:t)}t.exports=(a.default||a).template({1:function(t,e,n,a,l){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\n    <div class="form-group">\n      <label for="textfield" class="control-label col-sm-2">Id</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control txtId" value="'+t.escapeExpression(t.lambda(null!=e?i(e,"templateId"):e,e))+'">\n      </div>\n    </div>\n\n'},3:function(t,e,n,a,l){var i=t.lambda,o=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <div data-value="'+o(i(null!=e?s(e,"groupId"):e,e))+'">'+o(i(null!=e?s(e,"name"):e,e))+"</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,a,i,o){var s,r=null!=e?e:t.nullContext||{},u=t.lambda,d=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<div class='form-horizontal form-bordered form-validate'>\n\n"+(null!=(s=c(a,"if").call(r,null!=e?c(e,"templateId"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:2},end:{line:12,column:9}}}))?s:"")+'\n    <div class="form-group">\n      <label for="textfield" class="control-label col-sm-2">Code</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control txtCode" value="'+d(u(null!=e?c(e,"code"):e,e))+'">\n      </div>\n    </div>\n\n    <div class="form-group">\n      <label for="textfield" class="control-label col-sm-2">Name</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control txtName" value="'+d(u(null!=e?c(e,"name"):e,e))+'">\n      </div>\n    </div>\n\n    <div class="form-group groupsInput">\n      <label for="textfield" class="control-label col-sm-2">User groups</label>\n      <div class="col-sm-10 form-groups">\n        <a href="#" class="editable editable-click" data-type="checklist" data-original-title=\''+d(l(n(679)).call(r,"_groups",{name:"L",hash:{},data:o,loc:{start:{line:31,column:95},end:{line:31,column:110}}}))+"'>\n"+(null!=(s=c(a,"each").call(r,null!=e?c(e,"groups"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:32,column:12},end:{line:34,column:21}}}))?s:"")+'        </a>\n      </div>\n    </div>\n\n    <div class="form-group groupsInput">\n      <label for="textfield" class="control-label col-sm-2">Workflow groups</label>\n      <div class="col-sm-10 workflow-groups">\n        <a href="#" class="editable editable-click" data-type="checklist" data-original-title=\''+d(l(n(679)).call(r,"_groups",{name:"L",hash:{},data:o,loc:{start:{line:42,column:95},end:{line:42,column:110}}}))+"'>\n"+(null!=(s=c(a,"each").call(r,null!=e?c(e,"groups"):e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:43,column:12},end:{line:45,column:21}}}))?s:"")+'        </a>\n      </div>\n    </div>\n\n    \x3c!--div class="form-group">\n      <label for="textfield" class="control-label col-sm-2">Template Type</label>\n      <div class="col-sm-10">\n        <input type="text" class="form-control txtTemplateType">\n      </div>\n    </div--\x3e\n\n    <div class="form-group">\n      <label for="textfield" class="control-label col-sm-2">Definition</label>\n      <div class="col-sm-10">\n        <div id="entityDefinition" style="width: 100%;"></div>\n      </div>\n    </div>\n\n    <div class="form-actions col-sm-offset-2 col-sm-10">\n      <button type="submit" class="btn btn-primary btn-save">Save</button>\n      <button type="button" class="btn btn-cancel">Cancel</button>\n    </div>\n\n</div>'},useData:!0})},2336:function(t,e,n){var a=n(681);t.exports=(a.default||a).template({1:function(t,e,n,a,l){var i,o=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,r=t.escapeExpression,u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <li>\n                <a href="#" class="btn-addInputTemplate" tmpl="'+r("function"==typeof(i=null!=(i=u(n,"file")||(null!=e?u(e,"file"):e))?i:s)?i.call(o,{name:"file",hash:{},data:l,loc:{start:{line:9,column:63},end:{line:9,column:71}}}):i)+'">'+r("function"==typeof(i=null!=(i=u(n,"name")||(null!=e?u(e,"name"):e))?i:s)?i.call(o,{name:"name",hash:{},data:l,loc:{start:{line:9,column:73},end:{line:9,column:81}}}):i)+"</a>\n            </li>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,a,l){var i,o=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="btn-group newEntityOpts">\n    <a href="#" class="btn btn-addEntity" style="margin-right: 0px;">Add entity</a>\n    <a href="#" data-toggle="dropdown" class="btn dropdown-toggle">\n        <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu">\n'+(null!=(i=o(n,"each").call(null!=e?e:t.nullContext||{},null!=e?o(e,"items"):e,{name:"each",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l,loc:{start:{line:7,column:8},end:{line:11,column:17}}}))?i:"")+"    </ul>\n</div>"},useData:!0})},765:function(t,e,n){"use strict";(function(a){var l,i=n(689);void 0===(l=function(){return a.Model.extend({url:"inputModule",defaults:{formsViewList:[]},get:function(t,e){(0,i.send)("inputModule/get/"+t,null,{type:"GET"},e)},list:function(t,e){(0,i.send)("inputTemplates/list/",null,{type:"GET"},t,e)},create:function(t,e){(0,i.send)("inputModule/create",t,{type:"POST"},e)},update:function(t,e){(0,i.send)("inputModule/update",t,{type:"PUT"},e)},delete:function(t,e){(0,i.send)("inputModule/delete/"+t,null,{type:"DELETE"},e)},getMetadata:function(t,e){(0,i.send)("inputTemplates/getMetadata/",{id:t},{type:"GET"},e)},generate:function(t,e){(0,i.send)("inputModule/generate/"+t,null,{type:"GET"},e)},getData:function(t,e){(0,i.send)("inputTemplates/getData/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8"},e)},setData:function(t,e,n){(0,i.send)("inputTemplates/setData/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8"},e,n)},getHistoryChanges:function(t,e){(0,i.send)("inputModule/getHistoryChanges",t,{type:"POST"},e)},addItemToModel:function(t){this.get("formsViewList").push(t)},getItemsModel:function(){return this.get("formsViewList")},getItemModel:function(t){var e,n=this.getItemsModel();for(e=0;e<n.length;e++)if(n[e].tagId==t)return n[e]},removeItemModel:function(t){var e,n=this.getItemsModel();for(e=0;e<n.length;e++)if(n[e].tagId==t.tagId){n.splice(e,1);break}this.set({formsViewList:n})},removeAllItemsModel:function(){this.set("formsViewList",[])},changeItemModel:function(t,e){this.removeItemModel(t),this.addItemToModel(e)},onClick:function(t,e,n,a){(0,i.send)("inputModule/onClick",{param1:t,param2:e},{type:"POST"},n,a)}})}.apply(e,[]))||(t.exports=l)}).call(this,n(220))},865:function(t,e,n){"use strict";(function(a){var l,i=n(689);void 0===(l=function(){return a.Model.extend({list:function(t,e){var n=null!=t?"?company_id=".concat(t):"";(0,i.send)("groups/".concat(n),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},e)},get:function(t,e){(0,i.send)("groups/".concat(t,"/"),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},e)},update:function(t,e,n){(0,i.send)("groups/".concat(t,"/"),JSON.stringify(e),{type:"PUT",contentType:"application/json;charset=utf-8",dataType:"text"},n)},create:function(t,e){(0,i.send)("groups/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},e)},delete:function(t,e){(0,i.send)("groups/".concat(t,"/"),null,{type:"DELETE"},e)},listPermissions:function(t){(0,i.send)("permissions/",null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},t)},updateGroupPermissions:function(t,e){(0,i.send)("groups/update_groups_permissions/",JSON.stringify(t),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},e)}})}.apply(e,[]))||(t.exports=l)}).call(this,n(220))}}]);