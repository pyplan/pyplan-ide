/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[127,6],{1296:function(n,e,a){var t=a(669);n.exports=(t.default||t).template({compiler:[8,">= 4.3.0"],main:function(n,e,a,t,l){return'<div class="row" style="margin-top: 15px;">\n    <form class="form-vertical">\n        <div class="col-sm-12">\n            <div class="form-group">\n                <label class="control-label">Share as:</label>\n                <select class="form-control shareType">\n                    <option value="link">Link</option>\n                    <option value="embed">Embed code</option>\n                </select>\n            </div>\n\n            <div class="form-group">\n                <textarea rows="4" class="form-control txtShareCode"></textarea>\n            </div>\n        </div>\n    </form>\n</div>'},useData:!0})},2648:function(n,e,a){"use strict";(function(t,l){var o,r,i=a(18);function c(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var a=[],t=!0,l=!1,o=void 0;try{for(var r,i=n[Symbol.iterator]();!(t=(r=i.next()).done)&&(a.push(r.value),!e||a.length!==e);t=!0);}catch(n){l=!0,o=n}finally{try{t||null==i.return||i.return()}finally{if(l)throw o}}return a}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(n){return function(n){if(Array.isArray(n)){for(var e=0,a=new Array(n.length);e<n.length;e++)a[e]=n[e];return a}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}o=[a(662),a(864),a(2649),a(1296)],void 0===(r=function(n,e,a,o){return t.View.extend({el:l("#main"),embedCode:"",linkCode:"",getUsersByGroup:function(n){var e=n.departments,a=void 0===e?[]:e,t=n.usercompanies_shares,l=void 0===t?[]:t,o=n.departments_shares,r=void 0===o?[]:o,i=[],c=l.flatMap((function(n){return n.id})),s=r.flatMap((function(n){return n.id})),d=0;return a.forEach((function(n){i.push({group:n.name,department_id:n.id,tabId:d++,selected:s.includes(n.id),userList:n.usercompanies.map((function(n){return{userId:n.id,userName:"".concat(n.user.first_name," ").concat(n.user.last_name),mode:null,selected:c.includes(n.id)}}))})})),i},render:function(t,r,u,p){var h=this;h.dashboardId=t;var f=function(f){f.accessList=h.getUsersByGroup(f);var v=a(function(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},t=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(a).filter((function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})))),t.forEach((function(e){d(n,e,a[e])}))}return n}({},f,{canShareDashboard:(0,i.haveAccess)("share_dashboard")}));(new n).show({title:(0,i.translate)("share_dashboard"),html:v,buttons:[{title:(0,i.translate)("cancel"),code:"close"},{title:(0,i.translate)("share"),css:"primary",code:"yes"}],callback:function(n,e){if("yes"==n){var a=l("div[data-id='"+t+"']").find("span").text(),o={dashboardId:t,id:t,noShared:!1,sharedToEveryone:!1,shareTo:!1,name:a,departments_ids:[],usercompanies_ids:[]},i=e.find("input[name='sharerSelector']:checked");return"1"==i.val()?o.noShared=!0:"2"==i.val()?o.sharedToEveryone=!0:(o.departments_ids=l.makeArray(e.find(".accessList .panel-heading input[type='checkbox']:checked")).map((function(n){return parseInt(l(n).closest(".panel-heading").attr("data-id"))})),o.usercompanies_ids=s(new Set(l.makeArray(e.find(".itemList input[type='checkbox']:checked")).map((function(n){return parseInt(l(n).attr("data-id"))})))),o.departments_ids.length>0||o.usercompanies_ids.length>0?o.shareTo=!0:o.noShared=!0),u?m.setSharedDashboard(o,(function(){e.modal("hide"),null!=r&&r(o.shareTo||o.sharedToEveryone)})):m.setSharedReport(o,(function(){e.modal("hide"),null!=r&&r(o.shareTo||o.sharedToEveryone)})),!1}},onLoad:function(n){(0,i.postRender)(n),n.find('input[type="radio"]').on("ifToggled",(function(){l(this).hasClass("to")?(n.find(".accessList").removeClass("disabled"),n.find("input[name='userFilter']").attr("disabled",!1)):(n.find(".accessList").addClass("disabled"),n.find("input[name='userFilter']").attr("disabled",!0))})),n.find("input[type='checkbox']").on("ifToggled",(function(){n.find("input.to").click(),n.find("input.to").iCheck("check")})),n.on("change","select.shareType",(function(){"link"===l(this).val()?n.find("textarea.txtShareCode").text(h.linkCode):n.find("textarea.txtShareCode").text(h.embedCode)})),n.find('a[data-toggle="tab"]').on("shown.bs.tab",(function(a){if("external"===l(a.target).attr("data-rel")){n.find(".modal-footer .btn.btn-primary").hide();var t=new e,r=function(e){h.externalLinkId=e.id,n.find(".chkCommonInstance").attr("checked",e.common_instance);var a=h.getUIUrl();n.find(".sharedCode").html("");var t=o(f);n.find(".sharedCode").append(t),h.embedCode='<div id="'+e.id+'"></div><script src="http://cubeplat.com/cubeplanmilanobeta/embeddable_v1.js?dashboardId='+e.id+"&host="+encodeURIComponent(a)+'" async><\/script>',h.linkCode="1"==p?"".concat(a,"/#shared/").concat(e.id):"".concat(a,"/#dash/").concat(e.id),n.find("textarea.txtShareCode").text(h.linkCode),n.find("button.generateSharedBtn").enable(!0)};t.getExternalLinkByReportId(h.dashboardId,(function(n){var e=c(n.results,1)[0];e?r(e):t.createReportExternalLink(h.dashboardId,(function(n){r(n)}))}))}else n.find(".modal-footer .btn.btn-primary").show()})),n.find(".panel-body input[type='checkbox']").on("click",(function(){var e=l(this).prop("checked"),a=(l(this).attr("tab-id"),l(this).attr("data-id"));n.find(".panel-group input[data-id='"+a+"']").each((function(){l(this).prop("checked",e)}))})),n.find("input[name='userFilter']").on("keyup",(function(){l(this).val().length>=1&&n.find(".panel").each((function(){l(this).find(".panel-collapse.collapse").hasClass("in")||l(this).find(".panel-title a").click()})),0===l(this).val().length&&n.find(".panel-group .panel-title a").click();var e=l(this).val().toUpperCase();n.find(".accessList .itemList").each((function(n,a){l(a).find("label").html().toUpperCase().indexOf(e)<0?l(a).hide():l(a).show()})),n.find(".panel-group").each((function(n,e){0===l(e).find(".itemList[style='display: block;']").length?l(e).hide():l(e).show()}))})),n.find(".chkCommonInstance, .chkNavigateReport").on("click",(function(){var a=new e,t=n.find(".chkCommonInstance").is(":checked"),l={externalLinkId:h.externalLinkId,common_instance:t,modelPath:__currentSession.modelInfo.uri,active:!0,dashboard_id:h.dashboardId};a.updateReportExternalLink(l,(function(n){}))})),(0,i.haveAccess)("share_dashboard")||n.find('a[data-rel="external"]').trigger("click")}})},m=new e;u?m.getSharedDashboard(t,f):m.getSharedReport(t,f)},getUIUrl:function(){return __uiURL}})}.apply(e,o))||(n.exports=r)}).call(this,a(219),a(1))},2649:function(n,e,a){var t=a(669);function l(n){return n&&(n.__esModule?n.default:n)}n.exports=(t.default||t).template({1:function(n,e,a,t,l){return'      <li class="active">\n        <a href="#internalShareTab" data-rel="internal" data-toggle="tab">\n          <i class="fa fa-share"></i>Share internal</a>\n      </li>\n'},3:function(n,e,a,t,l){return'      <li class="">\n        <a href="#externalShareTab" data-rel="external" data-toggle="tab">\n          <i class="fa fa-link"></i>Share external</a>\n      </li>\n'},5:function(n,e,t,o,r,i,c){var s,d=null!=e?e:n.nullContext||{},u=n.escapeExpression,p=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'      <div class="tab-pane active" id="internalShareTab">\n        <div class="controls">\n          <div class="check-demo-col">\n            <div class="check-line">\n              <input type="radio" class=\'icheck-me none\' name="sharerSelector" value="1" data-skin="square"\n                data-color="blue" '+(null!=(s=l(a(668)).call(d,null!=e?p(e,"noShared"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(6,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:28,column:34},end:{line:28,column:89}}}))?s:"")+"> <label\n                class='inline'>"+u(l(a(667)).call(d,"no_share",{name:"L",hash:{},data:r,loc:{start:{line:29,column:31},end:{line:29,column:47}}}))+'</label>\n            </div>\n            <div class="check-line">\n              <input type="radio" class=\'icheck-me all\' name="sharerSelector" value="2" data-skin="square"\n                data-color="blue" '+(null!=(s=l(a(668)).call(d,null!=e?p(e,"sharedToEveryone"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(6,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:33,column:34},end:{line:33,column:97}}}))?s:"")+"> <label\n                class='inline'>"+u(l(a(667)).call(d,"share_to_everyone",{name:"L",hash:{},data:r,loc:{start:{line:34,column:31},end:{line:34,column:56}}}))+'</label>\n            </div>\n            <div class="check-line">\n              <div class="row">\n                <div class="col-sm-3">\n                  <div class="check-line">\n                    <input type="radio" class=\'icheck-me to\' name="sharerSelector" value="3" data-skin="square"\n                      data-color="blue" '+(null!=(s=l(a(668)).call(d,null!=e?p(e,"sharedTo"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(6,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:41,column:40},end:{line:41,column:95}}}))?s:"")+"> <label\n                      class='inline'>"+u(l(a(667)).call(d,"share_only_to",{name:"L",hash:{},data:r,loc:{start:{line:42,column:37},end:{line:42,column:58}}}))+'</label>\n                  </div>\n                </div>\n                <div class="col-sm-6 nopadding">\n                  <input type="text" name="userFilter" class="form-control" placeholder="Filter users"\n                    '+(null!=(s=l(a(668)).call(d,null!=e?p(e,"sharedTo"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(8,r,0,i,c),inverse:n.program(10,r,0,i,c),data:r,loc:{start:{line:47,column:20},end:{line:47,column:96}}}))?s:"")+' />\n                </div>\n              </div>\n              <div class="row" style="margin-top: 10px;">\n                <div class="col-sm-3">\n                </div>\n                <div class="col-sm-9 nopadding" style="overflow-y: scroll; height: 220px;">\n                  <div class="accessList '+(null!=(s=l(a(668)).call(d,null!=e?p(e,"sharedTo"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(8,r,0,i,c),inverse:n.program(12,r,0,i,c),data:r,loc:{start:{line:54,column:41},end:{line:54,column:106}}}))?s:"")+'">\n                    <div class="panel-group novix-accordion small">\n'+(null!=(s=p(t,"each").call(d,null!=e?p(e,"accessList"):e,{name:"each",hash:{},fn:n.program(14,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:56,column:22},end:{line:93,column:31}}}))?s:"")+"                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div> \x3c!-- END TAB 1 --\x3e\n"},6:function(n,e,a,t,l){return" checked "},8:function(n,e,a,t,l){return" "},10:function(n,e,a,t,l){return' disabled="disabled" '},12:function(n,e,a,t,l){return" disabled "},14:function(n,e,t,o,r,i,c){var s,d=n.lambda,u=n.escapeExpression,p=null!=e?e:n.nullContext||{},h=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'                      <div class="panel panel-default panel-group">\n                        <div class="panel-heading" data-id="'+u(d(null!=e?h(e,"department_id"):e,e))+'">\n                          <div style="float:left; width:30px; height: 30px;">\n                            <label class="control control--checkbox">\n                              <input type="checkbox" class="chkAll" tab-id="'+u(d(null!=e?h(e,"tabId"):e,e))+'" '+(null!=(s=l(a(668)).call(p,null!=e?h(e,"selected"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(15,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:61,column:87},end:{line:62,column:51}}}))?s:"")+' />\n                              <div class="control__indicator"></div>\n                            </label>\n                          </div>\n                          <div style="float:left; width:90%;">\n                            <h4 class="panel-title">\n                              <a href="#'+u(d(null!=e?h(e,"tabId"):e,e))+'" data-toggle="collapse" data-parent="#ac4" class="collapsed">\n                                '+u(d(null!=e?h(e,"group"):e,e))+'\n                              </a>\n                            </h4>\n                          </div>\n                          <div style="clear:both;"></div>\n                          \x3c!-- /.panel-title --\x3e\n                        </div>\n                        \x3c!-- /.panel-heading --\x3e\n                        <div id="'+u(d(null!=e?h(e,"tabId"):e,e))+'" class="panel-collapse collapse" style="height: 0px;">\n                          <div class="panel-body" tab-id="'+u(d(null!=c[1]?h(c[1],"tabId"):c[1],e))+'">\n'+(null!=(s=h(t,"each").call(p,null!=e?h(e,"userList"):e,{name:"each",hash:{},fn:n.program(17,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:79,column:28},end:{line:87,column:37}}}))?s:"")+"                          </div>\n                          \x3c!-- /.panel-body --\x3e\n                        </div>\n                        \x3c!-- /#c1.panel-collapse collapse in --\x3e\n                      </div>\n"},15:function(n,e,a,t,l){return"\n                                checked "},17:function(n,e,t,o,r,i,c){var s,d=n.lambda,u=n.escapeExpression,p=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'                            <div class="itemList" style="display: block;">\n                              <label class="control control--checkbox">'+u(d(null!=e?p(e,"userName"):e,e))+'\n                                <input type="checkbox" tab-id="'+u(d(null!=c[1]?p(c[1],"tabId"):c[1],e))+'" data-id="'+u(d(null!=e?p(e,"userId"):e,e))+'"\n                                  '+(null!=(s=l(a(668)).call(null!=e?e:n.nullContext||{},null!=e?p(e,"selected"):e,"==",!0,{name:"ifCond",hash:{},fn:n.program(6,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:83,column:34},end:{line:83,column:84}}}))?s:"")+'>\n                                <div class="control__indicator"></div>\n                              </label>\n                            </div>\n'},19:function(n,e,t,o,r){return'      <div class="tab-pane" id="externalShareTab">\n        <label class="control control--checkbox">'+n.escapeExpression(l(a(667)).call(null!=e?e:n.nullContext||{},"Common instance",{name:"L",hash:{},data:r,loc:{start:{line:105,column:49},end:{line:105,column:72}}}))+'\n          <input type="checkbox" class="chkCommonInstance" />\n          <div class="control__indicator"></div>\n        </label>\n\n        \x3c!--button class="btn btn-primary generateSharedBtn">Generate share source</button--\x3e\n\n        <div class="sharedCode">\n\n        </div>\n      </div> \x3c!-- END TAB 2 --\x3e\n'},compiler:[8,">= 4.3.0"],main:function(n,e,t,o,r,i,c){var s,d=null!=e?e:n.nullContext||{},u=n.escapeExpression,p=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<div class="box">\n\n  <span>'+u(l(a(667)).call(d,"select_dashboard_share_mode",{name:"L",hash:{},data:r,loc:{start:{line:3,column:8},end:{line:3,column:43}}}))+": "+u(n.lambda(null!=e?p(e,"dashboardName"):e,e))+'</span>\n\n  <div class="box-content">\n\n    <ul class="tabs tabs-inline tabs-top">\n'+(null!=(s=l(a(680)).call(d,"share_dashboard",{name:"haveAccess",hash:{},fn:n.program(1,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:8,column:6},end:{line:13,column:21}}}))?s:"")+(null!=(s=l(a(680)).call(d,"generate_external_link",{name:"haveAccess",hash:{},fn:n.program(3,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:14,column:6},end:{line:19,column:21}}}))?s:"")+'    </ul>\n    <div class="tab-content padding tab-content-inline tab-content-bottom">\n'+(null!=(s=p(t,"if").call(d,null!=e?p(e,"canShareDashboard"):e,{name:"if",hash:{},fn:n.program(5,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:22,column:6},end:{line:102,column:13}}}))?s:"")+(null!=(s=l(a(680)).call(d,"generate_external_link",{name:"haveAccess",hash:{},fn:n.program(19,r,0,i,c),inverse:n.noop,data:r,loc:{start:{line:103,column:6},end:{line:116,column:21}}}))?s:"")+"    </div> \x3c!-- END TABS CONTAINER --\x3e\n  </div>\n</div>\n"},useData:!0,useDepths:!0})},662:function(n,e,a){"use strict";(function(t){var l;void 0===(l=function(){return t.Controller.extend({name:"showModal",show:function(n){Promise.all([a.e(2),a.e(229)]).then((function(){var e=[a(685)];(function(e){(new e).render(n)}).apply(null,e)})).catch(a.oe)}})}.apply(e,[]))||(n.exports=l)}).call(this,a(676))},864:function(n,e,a){"use strict";(function(t){var l,o=a(18),r=a(678);void 0===(l=function(){return t.Model.extend({getSharedDashboard:function(n,e){(0,r.send)("dashboardManager/".concat(n,"/shares/"),null,{type:"GET"},(function(n){n&&e(n)}))},setSharedDashboard:function(n,e){(0,r.send)("dashboardManager/".concat(n.id,"/setShares/"),JSON.stringify(n),{type:"POST",contentType:"application/json;charset=utf-8"},(function(n){(0,o.triggerNodeJsEvent)("DashboardShareAfterSave"),n&&e&&e(n)}))},getSharedReport:function(n,e){(0,r.send)("reportManager/".concat(n,"/shares/"),null,null,(function(n){n&&e(n)}))},setSharedReport:function(n,e){(0,r.send)("reportManager/".concat(n.id,"/setShares/"),JSON.stringify(n),{type:"POST",contentType:"application/json;charset=utf-8"},(function(n){(0,o.triggerNodeJsEvent)("DashboardShareAfterSave"),n&&e&&e(n)}))},listExternalLink:function(n){(0,r.send)("ExternalLink/List",null,{type:"GET"},(function(e){e&&n&&n(e)}))},getExternalLinkByDashboardId:function(n,e){(0,r.send)("dashboardExternalLink/?dashboard_id=".concat(n),null,{type:"GET"},(function(n){n&&e&&e(n)}))},getExternalLinkByReportId:function(n,e){(0,r.send)("reportExternalLink/?report_id=".concat(n),null,{type:"GET"},(function(n){n&&e&&e(n)}))},createDashboardExternalLink:function(n,e){(0,r.send)("dashboardExternalLink/?dashboard_id=".concat(n),null,{type:"POST"},(function(n){n&&e&&e(n)}))},createReportExternalLink:function(n,e){(0,r.send)("reportExternalLink/?report_id=".concat(n),null,{type:"POST"},(function(n){n&&e&&e(n)}))},updateReportExternalLink:function(n,e){(0,r.send)("reportExternalLink/".concat(n.externalLinkId,"/"),JSON.stringify(n),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},(function(n){n&&e&&e(n)}))},updateDashboardExternalLink:function(n,e){(0,r.send)("dashboardExternalLink/".concat(n.externalLinkId,"/"),JSON.stringify(n),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},(function(n){n&&e&&e(n)}))}})}.apply(e,[]))||(n.exports=l)}).call(this,a(219))}}]);