/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[141],{2327:function(n,t,e){"use strict";(function(o,a){var l,s,c=e(18);l=[e(860),e(703),e(751),e(2328)],void 0===(s=function(n,t,l,s){return o.View.extend({el:a("#main"),_uId:"",groupPermissions:[],processLength:null,render:function(){var o=this;a('div[data-rel="abm-permissions-group"]').remove();var i=new n;this._uId=a.uuid();var r=this.options.companyId,p=new Promise((function(n,t){i.listPermissions((function(t){o.processLength=t.length,i.list(r,(function(e){n({groupList:e,permissions:t})}))}))})),u=new Promise((function(n,t){e.e(26).then((function(){var t=[e(721)];(function(t){(new t).list((function(t){n(t.results)}))}).apply(null,t)})).catch(e.oe)}));Promise.all([p,u]).then((function(n){var e=n[0].groupList,i=n[0].permissions,r=n[1],p={id:o._uId,dataRel:"abm-permissions-group",tmpClass:"rol-edit",title:(0,c.translate)("permissionsByGroup")},u={groups:o.prepareProcess(i),rolList:e,companyList:r,isSuper:__currentSession.userIsSuperUser},d=t(p),m=l(),h=s(u);o.$el.append(d);var f=a("div[data-id='".concat(o._uId,"']"));f.find("div.abm-content").append(m),f.find("div.form-content").append(h),f.find("form").removeClass("form-bordered"),f.find(".submit.form-actions").remove(),(0,c.postRender)(f),o.initCheckboxes(f,e),o.addHandlers(f),__currentSession.userIsSuperUser&&o.options.companyId&&f.find(".selCompany").select2("val",o.options.companyId)}))},prepareProcess:function(n){var t=[],e={};for(var o in n.forEach((function(n){var t=n.content_type.model;e[t]||(e[t]={code:n.content_type.model,name:n.content_type.model,process:[]}),e[t].process.push(n)})),e)t.push(e[o]);return t},save:function(){this.groupPermissions.length>0&&(new n).updateGroupPermissions(this.groupPermissions,(function(){}))},cancel:function(){var n=a("#currentTask").attr("data-rel");Promise.resolve().then((function(){var t=[e(664)];(function(t){(new t).removeTask(n)}).apply(null,t)})).catch(e.oe)},addHandlers:function(t){t.find("form").on("submit",a.proxy((function(){return this.save(),!1}),this)),t.find("div.submit button.btn-cancel").on("click",a.proxy((function(){return this.cancel(),!1}),this)),t.find("div.abm-top-options a.btn-close").on("click",this.cancel);var o=this;t.find(".selCompany").on("change",(function(){var n=a(this).select2("val");Promise.resolve().then((function(){var t=[e(801)];(function(t){(new t).showPermisionsByGroup(n)}).apply(null,t)})).catch(e.oe)})),t.find('input[class!="chkAll"].permission').on("click",(function(){var t=a(this).attr("data-rolId"),e=a(this).closest("tr").attr("data-processId");o.groupPermissions={group_id:t,permissions:[e]},(new n).updateGroupPermissions(o.groupPermissions,(function(){o.groupPermissions={}}))})),t.find('input[class="permission"]').on("click",(function(){var n=a(this).attr("data-groupcode"),t=a(this).attr("data-rolid"),e=a("input[data-rolId='".concat(t,"'][data-groupcode='").concat(n,"'].permission:checked")).length===a("input[data-rolId='".concat(t,"'][data-groupcode='").concat(n,"'].permission")).length;a("input[class='chkAll'][data-groupcode='".concat(n,"'][data-rolId='").concat(t,"']")).prop("checked",e)})),t.find('input[class="chkAll"]').on("click",(function(){var e,l=a(this).prop("checked"),s=a(this).attr("data-rolId"),c=a(this).attr("data-groupCode");t.find("tbody input[class!='chkAll'][data-groupCode='".concat(c,"'][data-rolId='").concat(s,"']")).each((function(n,t){l?a(this).prop("checked")||a(this).prop("checked","checked"):a(this).prop("checked")&&a(this).prop("checked","")})),o.groupPermissions={group_id:s,permissions:[],check_all:l},a.each(a("input[class!='chkAll'][data-groupcode='".concat(c,"'][data-rolId='").concat(s,"']")),(function(n,t){e=a(t).closest("tr").attr("data-processId"),o.groupPermissions.permissions.push(e)})),(new n).updateGroupPermissions(o.groupPermissions,(function(){o.groupPermissions={}}))}))},initCheckboxes:function(n,t){t.forEach((function(t){var e=t.id;t.permissions.forEach((function(t){var o=t.codename;n.find("tr[data-processCode='".concat(o,"'] input[data-rolId='").concat(e,"']")).prop("checked","checked");var l=t.content_type.model;a("input[data-rolId='".concat(e,"'][data-groupcode='").concat(l,"'].permission:checked")).length===a("input[data-rolId='".concat(e,"'][data-groupcode='").concat(l,"'].permission")).length&&a("input[class='chkAll'][data-groupcode='".concat(l,"'][data-rolId='").concat(e,"']")).prop("checked",!0)}))}))}})}.apply(t,l))||(n.exports=s)}).call(this,e(219),e(1))},2328:function(n,t,e){var o=e(670);n.exports=(o.default||o).template({1:function(n,t,o,a,l){var s,c,i=null!=t?t:n.nullContext||{},r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="row" style="margin-top: 15px; margin-bottom: 15px;">\n  <div class="col-sm-10">\n    <span style="float: left; padding-top: 5px; font-weight: bold;">'+n.escapeExpression((c=e(668),c&&(c.__esModule?c.default:c)).call(i,"_company",{name:"L",hash:{},data:l,loc:{start:{line:4,column:68},end:{line:4,column:84}}}))+'</span>\n    <div class="col-sm-10">\n      <div class="col-sm-4">\n        <select class="select2-me selCompany" style="width: 100%;">\n'+(null!=(s=r(o,"each").call(i,null!=t?r(t,"companyList"):t,{name:"each",hash:{},fn:n.program(2,l,0),inverse:n.noop,data:l,loc:{start:{line:8,column:10},end:{line:10,column:19}}}))?s:"")+"        </select>\n      </div>\n    </div>\n  </div>\n</div>\n"},2:function(n,t,e,o,a){var l=n.lambda,s=n.escapeExpression,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'          <option value="'+s(l(null!=t?c(t,"id"):t,t))+'">'+s(l(null!=t?c(t,"name"):t,t))+"</option>\n"},4:function(n,t,e,o,a,l,s){var c,i=n.lambda,r=n.escapeExpression,p=null!=t?t:n.nullContext||{},u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'  <div class="panel panel-default">\n    <div class="panel-heading">\n      <h4 class="panel-title">\n        <a href="#'+r(i(null!=t?u(t,"code"):t,t))+'" data-toggle="collapse" data-parent="#ac4" class="collapsed">\n          '+r(i(null!=t?u(t,"name"):t,t))+'\n        </a>\n      </h4>\n      \x3c!-- /.panel-title --\x3e\n    </div>\n    \x3c!-- /.panel-heading --\x3e\n    <div id="'+r(i(null!=t?u(t,"code"):t,t))+'" class="panel-collapse collapse" style="height: 0px;">\n      <div class="panel-body">\n\n\n        <table class="table table-hover table-condensed processByRol">\n          <tbody>\n            <tr data-groupCode="'+r(i(null!=t?u(t,"code"):t,t))+'" class="group">\n              <td>\n                <strong></strong>\n              </td>\n'+(null!=(c=u(e,"each").call(p,null!=s[1]?u(s[1],"rolList"):s[1],{name:"each",hash:{},fn:n.program(5,a,0,l,s),inverse:n.noop,data:a,loc:{start:{line:39,column:14},end:{line:48,column:23}}}))?c:"")+"            </tr>\n\n"+(null!=(c=u(e,"each").call(p,null!=t?u(t,"process"):t,{name:"each",hash:{},fn:n.program(7,a,0,l,s),inverse:n.noop,data:a,loc:{start:{line:51,column:12},end:{line:63,column:21}}}))?c:"")+"          </tbody>\n        </table>\n\n\n      </div>\n      \x3c!-- /.panel-body --\x3e\n    </div>\n    \x3c!-- /#c1.panel-collapse collapse in --\x3e\n  </div>\n"},5:function(n,t,e,o,a,l,s){var c=n.lambda,i=n.escapeExpression,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'              <td class="group text-center">\n                '+i(c(null!=t?r(t,"name"):t,t))+' <br />\n\n                <label class="control centered control--checkbox">\n                  <input type="checkbox" class="chkAll" data-groupCode="'+i(c(null!=s[1]?r(s[1],"code"):s[1],t))+'" data-rolId="'+i(c(null!=t?r(t,"id"):t,t))+'" />\n                  <div class="control__indicator"></div>\n                </label>\n              </td>\n'},7:function(n,t,e,o,a,l,s){var c,i=n.lambda,r=n.escapeExpression,p=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'            <tr data-processCode="'+r(i(null!=t?p(t,"codename"):t,t))+'" data-processId="'+r(i(null!=t?p(t,"id"):t,t))+'" class="process">\n              <td style="width: 280px;"> ... '+r(i(null!=t?p(t,"name"):t,t))+"</td>\n"+(null!=(c=p(e,"each").call(null!=t?t:n.nullContext||{},null!=s[2]?p(s[2],"rolList"):s[2],{name:"each",hash:{},fn:n.program(8,a,0,l,s),inverse:n.noop,data:a,loc:{start:{line:54,column:14},end:{line:61,column:23}}}))?c:"")+"            </tr>\n"},8:function(n,t,e,o,a,l,s){var c=n.lambda,i=n.escapeExpression,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'              <td class="process">\n                <label class="control nolabel control--checkbox">\n                  <input type="checkbox" class="permission" data-rolId="'+i(c(null!=t?r(t,"id"):t,t))+'" data-groupCode="'+i(c(null!=s[2]?r(s[2],"code"):s[2],t))+'" />\n                  <div class="control__indicator"></div>\n                </label>\n              </td>\n'},compiler:[8,">= 4.3.0"],main:function(n,t,e,o,a,l,s){var c,i=null!=t?t:n.nullContext||{},r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return(null!=(c=r(e,"if").call(i,null!=t?r(t,"isSuper"):t,{name:"if",hash:{},fn:n.program(1,a,0,l,s),inverse:n.noop,data:a,loc:{start:{line:1,column:0},end:{line:16,column:7}}}))?c:"")+'<div class="panel-group novix-accordion">\n'+(null!=(c=r(e,"each").call(i,null!=t?r(t,"groups"):t,{name:"each",hash:{},fn:n.program(4,a,0,l,s),inverse:n.noop,data:a,loc:{start:{line:18,column:2},end:{line:73,column:11}}}))?c:"")+"</div>"},useData:!0,useDepths:!0})},703:function(n,t,e){var o=e(670);n.exports=(o.default||o).template({compiler:[8,">= 4.3.0"],main:function(n,t,e,o,a){var l,s=null!=t?t:n.nullContext||{},c=n.hooks.helperMissing,i=n.escapeExpression,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="abm-base-tmp '+i("function"==typeof(l=null!=(l=r(e,"tmpClass")||(null!=t?r(t,"tmpClass"):t))?l:c)?l.call(s,{name:"tmpClass",hash:{},data:a,loc:{start:{line:1,column:25},end:{line:1,column:37}}}):l)+' container-fluid mainTask" data-id="'+i("function"==typeof(l=null!=(l=r(e,"id")||(null!=t?r(t,"id"):t))?l:c)?l.call(s,{name:"id",hash:{},data:a,loc:{start:{line:1,column:73},end:{line:1,column:79}}}):l)+'" data-rel="'+i("function"==typeof(l=null!=(l=r(e,"dataRel")||(null!=t?r(t,"dataRel"):t))?l:c)?l.call(s,{name:"dataRel",hash:{},data:a,loc:{start:{line:1,column:91},end:{line:1,column:102}}}):l)+'" data-type="tab-content">\n    <div class="row">\n        <div class="col-sm-12">\n            <div class="box">\n                <div class="box-title">\n                    <h3><i class="fa fa-th-list"></i>'+i("function"==typeof(l=null!=(l=r(e,"title")||(null!=t?r(t,"title"):t))?l:c)?l.call(s,{name:"title",hash:{},data:a,loc:{start:{line:6,column:53},end:{line:6,column:62}}}):l)+'</h3>\n                    <div class="actions abm-top-options">\n                        <a href="#" class="btn btn-close"><i class="fa fa-times"></i></a>\n                    </div>\n                </div>\n        <div class="box-content nopadding abm-content">\n\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'},useData:!0})},751:function(n,t,e){var o=e(670);function a(n){return n&&(n.__esModule?n.default:n)}n.exports=(o.default||o).template({compiler:[8,">= 4.3.0"],main:function(n,t,o,l,s){var c=null!=t?t:n.nullContext||{},i=n.escapeExpression;return'<form action="#" id="baseForm" method="POST" class=\'form-horizontal form-bordered form-validate\' novalidate="novalidate">\n    <div class="form-content">\n\n    </div>\n    <div class="submit form-actions col-sm-12">\n        <button type="submit" class="btn btn-primary btn-save">'+i(a(e(668)).call(c,"_save",{name:"L",hash:{},data:s,loc:{start:{line:6,column:63},end:{line:6,column:76}}}))+'</button>\n        <button type="button" class="btn btn-cancel">'+i(a(e(668)).call(c,"cancel",{name:"L",hash:{},data:s,loc:{start:{line:7,column:53},end:{line:7,column:67}}}))+"</button>\n    </div>\n</form>\n"},useData:!0})},860:function(n,t,e){"use strict";(function(o){var a,l=e(679);void 0===(a=function(){return o.Model.extend({list:function(n,t){var e=null!=n?"?company_id=".concat(n):"";(0,l.send)("groups/".concat(e),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},t)},get:function(n,t){(0,l.send)("groups/".concat(n,"/"),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},t)},update:function(n,t,e){(0,l.send)("groups/".concat(n,"/"),JSON.stringify(t),{type:"PUT",contentType:"application/json;charset=utf-8",dataType:"text"},e)},create:function(n,t){(0,l.send)("groups/",JSON.stringify(n),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},t)},delete:function(n,t){(0,l.send)("groups/".concat(n,"/"),null,{type:"DELETE"},t)},listPermissions:function(n){(0,l.send)("permissions/",null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},n)},updateGroupPermissions:function(n,t){(0,l.send)("groups/update_groups_permissions/",JSON.stringify(n),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},t)}})}.apply(t,[]))||(n.exports=a)}).call(this,e(219))}}]);