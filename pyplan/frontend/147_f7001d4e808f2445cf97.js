/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{1457:function(e,t,r){"use strict";(function(i,o){var s,a,n=r(18);r(848),r(1140),r(1141),r(882),r(1142),r(1143),r(1144),L.Icon.Default.imagePath="leaflet",s=[r(728),r(1458),r(1459),r(707),r(1145),r(1146)],void 0===(a=function(e,t,s,a,l,c){return e.extend({el:i("#n_o_n_e"),map:void 0,workLayer:void 0,normalLayer:void 0,clusterLayer:void 0,colorControl:void 0,sizeControl:void 0,iconControl:void 0,clusterControl:void 0,detailDraggable:!1,generalToolbarInitiated:!1,loadGeoFromCache:!1,geoCache:void 0,render:function(e){this.baseRender(e),i(this.tagId).find("div.detail-area").remove(),this.drawItem()},updateSize:function(e,t,r){if(this.map){var o=i(this.tagId).find(".item-area");o.height()>205&&o.width()>260?(this.colorControl&&this.colorControl.show(),this.sizeControl&&this.sizeControl.show(),this.iconControl&&this.iconControl.show(),this.clusterControl&&this.clusterControl.show()):(this.colorControl&&this.colorControl.hide(),this.sizeControl&&this.sizeControl.hide(),this.iconControl&&this.iconControl.hide(),this.clusterControl&&this.clusterControl.hide()),this.map.invalidateSize()}},updateValues:function(e){for(var t={dic:{},columns:e.columns.categories},r=0;r<e.series.length;r++)t.dic[e.series[r].name]=e.series[r].data;this.currentResult.nodeResult=t,this.redrawMap()},preEvaluateNode:function(e,t,r,i){if(this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.drawIndexes&&this.currentResult.itemProperties.map.drawIndexes.length>0){var o=this.currentResult.itemProperties.map.drawIndexes[0],s="-*asd32f3";this.currentResult.itemProperties.map.attrByDim&&"-1"!=this.currentResult.itemProperties.map.attrByDim&&(s=this.currentResult.itemProperties.map.attrByDim);for(var a=r.length-1;a>=0;a--)t.push(r[a]),r.splice(a,1);for(a=i.length-1;a>=0;a--)t.push(i[a]),i.splice(a,1);for(a=t.length-1;a>=0;a--)t[a].field==o?(r.push(t[a]),t.splice(a,1)):t[a].field==s&&(i.push(t[a]),t.splice(a,1))}},onRemoveItemView:function(){this.map&&(this.colorControl&&this.colorControl.removeFrom(this.map),this.sizeControl&&this.sizeControl.removeFrom(this.map),this.iconControl&&this.iconControl.removeFrom(this.map),this.clusterControl&&this.clusterControl.removeFrom(this.map),this.map.remove()),this.workLayer=null,this.colorControl=null,this.sizeControl=null,this.iconControl=null,this.clusterControl=null,this.map=null,this.currentResult=null,this.geoCache=null},editModeChanged:function(){this.colorControl&&this.colorControl.setEnabled(!this.editMode),this.sizeControl&&this.sizeControl.setEnabled(!this.editMode),this.iconControl&&this.iconControl.setEnabled(!this.editMode),this.clusterControl&&this.clusterControl.setEnabled(!this.editMode)},getOptionsMenu:function(){var e=this,t={callback:function(t){switch(t){case"_full":e.fullScreen();break;case"_view_in_diagram":e.viewInDiagram()}},items:{_full:{type:"icon_text",name:(0,n.translate)("fullscreen"),iconClass:"fa fa-expand"}}};return(0,n.haveAccess)("view_influence_diagram")&&(t.items._view_in_diagram={type:"icon_text",name:(0,n.translate)("view_in_diagram"),iconClass:"fa fa-sitemap"}),e.fromEmbedded&&delete t.items._view_in_diagram,t},drawItem:function(){this.currentResult&&this.currentResult.dims&&(this.currentResult.dims=this.currentResult.dims.concat(this.currentResult.rows).concat(this.currentResult.columns),this.currentResult.rows=[],this.currentResult.columns=[]);var e=a();i(this.tagId).find(".item-area").html(e),i(this.tagId).find(".item-toolbar-view").hide(),this.drawMap(i(this.tagId).find(".item-area")),this.updateSize()},drawMap:function(e){var t=this,r=this.tagId.substr(1)+"_map",i=l({mapElementId:r});e.html(i);var o=[];o.push(new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{styleId:997,attribution:""})),o.push(new L.Google("ROADMAP")),o.push(new L.Google("SATELLITE")),o.push(new L.Google("HYBRID"));var s=0;t.currentResult&&t.currentResult.itemProperties&&t.currentResult.itemProperties.map&&t.currentResult.itemProperties.map.baseMap&&(s=this.currentResult.itemProperties.map.baseMap),5===s&&(s=4),this.map=new L.Map(r,{center:new L.LatLng(-23.557772,-46.645203),zoom:5,layers:[o[s]],contextmenu:!0});var a=L.control.layers({"Open Street Map":o[0],"Google roadmap":o[1],"Google satellite":o[2],"Google hybrid":o[3]}).addTo(this.map);this.normalLayer=new L.FeatureGroup,this.clusterLayer=this.createClusterLayer(),this.workLayer=this.clusterLayer,a.addOverlay(this.workLayer,"Work Layer"),this.normalLayer.on("click",function(e){t.layerClick(e)}),this.map.on("baselayerchange",function(e){if(t.editMode)for(var r=0;r<o.length;r++)o[r]==e.layer&&(t.currentResult.itemProperties.map.baseMap=r)}),this.map.on("contextmenu.hide",function(e){t.map.contextmenu.removeAllItems()}),this.addControls(),this.currentResult&&this.currentResult.nodeResult&&setTimeout(function(){t.redrawMap()},500)},redrawMap:function(){if(this.workLayer&&(this.workLayer.clearLayers(),this.map.hasLayer(this.workLayer)&&this.map.removeLayer(this.workLayer)),this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.clusterMap?this.workLayer=this.clusterLayer:this.workLayer=this.normalLayer,this.workLayer){this.map.addLayer(this.workLayer),this.setDefaultOptions();var e=this,t=e.getStyleOptions(),r=function(r,o){var s=!e.isCluster(),a=0,n=o.length,l=(new Date).getTime();!function c(){for(var u=(new Date).getTime(),h=[];a<o.length&&!(s&&(a+1)%200==0&&(new Date).getTime()-u>200);a++){var p=o[a];if(p.geoDef&&""!=p.geoDef&&e.isInFilter(r,p.value)){var m=i.parseJSON(p.geoDef);h.push(e.addLayer(m,p.value,t,!s))}}e.isCluster()?e.workLayer.addLayers(h):(e.updateClusterLoading(a+1,n,(new Date).getTime()-l),a+1>=n?e.workLayer.getLayers().length>0&&e.map.fitBounds(e.workLayer.getBounds()):setTimeout(c,50))}()};this.currentResult.itemProperties.map.drawIndexes&&this.currentResult.itemProperties.map.drawIndexes.length>0?this.loadGeoFromCache&&void 0!=this.geoCache?(r(this.currentResult.itemProperties.map.drawIndexes[0],this.geoCache),this.loadGeoFromCache=!1,setTimeout(function(){e.isReady=!0},1e3)):i.each(this.currentResult.itemProperties.map.drawIndexes,function(t,i){e.showLoading(),e.model.getGeoDef(i,function(t){e.hideLoading(),e.geoCache=t,r(i,t),setTimeout(function(){e.isReady=!0},1e3)})}):this.isReady=!0,this.showControls()}},isCluster:function(){return this.workLayer===this.clusterLayer},isInFilter:function(e,t){if(this.currentResult&&this.currentResult.dims)for(var r=this.currentResult.dims.concat(this.currentResult.rows).concat(this.currentResult.columns),i=0;i<r.length;i++)if(r[i].field==e){if(0==r[i].values.length)return!0;for(var o=!1,s=0;s<r[i].values.length;s++)if(r[i].values[s].selected){o=!0;break}if(!o)return!0;for(s=0;s<r[i].values.length;s++)if(r[i].values[s].value==t)return!0;return!1}return!0},addLayer:function(e,t,r,i){var o;switch(e.type){case"polyline":var s={opacity:.5,color:e.color||"#222299",_extraData:t,_info:e.info||{content:t}};o=L.polyline(e.latlngs,s),i||this.workLayer.addLayer(o);break;case"geopolyline":s={opacity:.5,color:e.color||"#222299",steps:12,_extraData:t,_info:e.info||{content:t}};o=L.geodesic([],s),i||this.workLayer.addLayer(o);for(var a=[],n=0;n<e.latlngs.length;n++)a.push(new L.LatLng(e.latlngs[n][0],e.latlngs[n][1]));o.setLatLngs([a]);break;case"multipolyline":s={opacity:.5,color:e.color||"#222299",_extraData:t,_info:e.info||{content:t}};o=L.multiPolyline(e.latlngs,s),i||this.workLayer.addLayer(o);break;case"marker":s={opacity:1,_extraData:t,_info:e.info||{content:t},draggable:!1,zIndexOffset:1e4,alt:"alt"};e.icon&&(s.icon=L.icon({iconUrl:e.icon.iconUrl,iconSize:e.icon.iconSize,iconAnchor:e.icon.iconAnchor})),o=new L.marker(e.latlng,s),i||this.workLayer.addLayer(o),o.bindLabel(t,{direction:"right",noHide:!0});break;case"circlemarker":s={opacity:.5,_extraData:t,_info:e.info||{content:t},ratio:e.ratio||10,color:e.color||"#222299"};o=new L.circleMarker(e.latlng,s),i||this.workLayer.addLayer(o)}return this.applyLayerStyle(o,t,r),o},setDrawIndexes:function(e){this.setDrawMapOption("drawIndexes",e),this.redrawMap()},setAttrByDim:function(e){this.setDrawMapOption("attrByDim",e),i(this.tagId).trigger("evaluateNodeFromCurrentResult")},setClusterMap:function(e){this.setDrawMapOption("clusterMap",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapFn:function(e){this.setDrawMapOption("clusterMapFn",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapByValue:function(e){e||(e=-1),this.setDrawMapOption("clusterMapByValue",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapFnColor:function(e){this.setDrawMapOption("clusterMapFnColor",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapByValueColor:function(e){e||(e=-1),this.setDrawMapOption("clusterMapByValueColor",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapFnSize:function(e){this.setDrawMapOption("clusterMapFnSize",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapByValueSize:function(e){e||(e=-1),this.setDrawMapOption("clusterMapByValueSize",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setClusterMapRadius:function(e){e||(e=60),this.setDrawMapOption("clusterMapRadius",e),this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap()},setLabelByValue:function(e){e||(e=-1),this.setDrawMapOption("labelByValue",e),this.refreshLayerStyles()},setColorByValue:function(e){e||(e=-1),this.setDrawMapOption("colorByValue",e),this.refreshLayerStyles()},setColorScheme:function(e){this.setDrawMapOption("colorSchema",e),e.indexOf("#")>=0?this.setDrawMapOption("automaticColor",!0):this.setDrawMapOption("automaticColor",!1),this.resetLayerColors(),this.refreshLayerStyles()},setSizeByValue:function(e){e||(e=-1),this.setDrawMapOption("sizeByValue",e),this.refreshLayerStyles()},setIconByValue:function(e){e||(e=-1),this.setDrawMapOption("iconByValue",e),this.refreshLayerStyles()},setIconScheme:function(e){this.setDrawMapOption("iconSchema",e),this.refreshLayerStyles()},setInfoByValue:function(e){e||(e=-1),this.setDrawMapOption("infoByValue",e)},setHideControl:function(e,t){this.setDrawMapOption(e,t),this.showControls()},setMapEventType:function(e){this.setDefaultOptions(),this.currentResult.itemProperties.map.event||(this.currentResult.itemProperties.map.event={type:"none",eventData:{}}),this.currentResult.itemProperties.map.event.type=e},setMapEventData:function(e){this.setDefaultOptions(),this.currentResult.itemProperties.map.event||(this.currentResult.itemProperties.map.event={type:"none",eventData:{}}),this.currentResult.itemProperties.map.event.eventData=e},setDefaultOptions:function(){this.currentResult.itemProperties.map||(this.currentResult.itemProperties.map={baseMap:0,drawIndexes:[],attrByDim:-1,labelByValue:-1,colorByValue:-1,sizeByValue:-1,colorRange:[],sizeRange:[],automaticColor:!0,colorSchema:"#ff0000,#00ff00",event:{type:"none",eventData:{}},clusterMap:!0,clusterMapFn:"count",clusterMapFnColor:"-1",clusterMapFnSize:"-1",clusterMapRadius:60,hideColorControl:!1,hideSizeControl:!1,hideIconControl:!1})},setDrawMapOption:function(e,t){this.setDefaultOptions(),this.currentResult.itemProperties.map[e]=t,this.addControls()},displayColorRange:function(){var e=i(".left-menu[data-rel='"+this.tagId+"']");e.find("div.range-container[data-rel='color']").html(""),this.currentResult.itemProperties.map.colorRange&&this.currentResult.itemProperties.map.colorRange.length>0&&i(this.currentResult.itemProperties.map.colorRange).each(function(){var t=c(this);e.find("div.range-container[data-rel='color']").append(t)})},paintLayer:function(e,t,r){if(t){var i=function(e,t){(e instanceof L.Polyline||e instanceof L.CircleMarker)&&("string"==typeof t?e.setStyle({color:t}):e.setStyle({color:t.hex()}))};e instanceof L.MultiPolyline?e.eachLayer(function(e){i(e,t)}):i(e,t)}},sizeLayer:function(e,t,r){if(t){var i=function(e,t){var r=t.rgb()[0];e instanceof L.Polyline?e.setStyle({weight:3+2*r}):e instanceof L.CircleMarker&&e.setRadius(8+4*r)};if(e instanceof L.MultiPolyline)e.eachLayer(function(e){e.options;i(e,t)});else{e.options;i(e,t),null}}},iconLayer:function(e,t,r){if(t){e.options._iconValue=r;var i=L.icon({iconSize:[32,32],iconAnchor:[16,32]});e.setIcon(i)}},resetLayerColors:function(){this.workLayer.eachLayer(function(e){(e instanceof L.Polyline||e instanceof L.CircleMarker)&&e.setStyle({color:"#222299"})})},layerClick:function(e){if(e.layer&&e.layer.options){var t=this,o="",s=!1;if(this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.event)switch(this.currentResult.itemProperties.map.event.type){case"link_dashboard":var a=this.currentResult.itemProperties.map.event.eventData;o="<br/><a href='#' class='linkedDashboard'>"+a.dashboardName+"</a>";break;case"relatednode":s=!0;var l=this.currentResult.itemProperties.map.event.eventData.relatedNode,c=this.currentResult.itemProperties.map.drawIndexes[0],u=[{field:c,values:[{value:e.layer.options._extraData,selected:!0}]}];this.model.evaluateNode(l,[],[],u,function(r){if(r&&r.series&&r.series.length>0&&r.series[0].data.length>0){var o=r.series[0].data[0];if("select"==o.cellType){t.map.contextmenu.removeAllItems(),i.each(o.values,function(r,i){if(-1==i.value.indexOf("||")||i.value.indexOf("||")>=0&&i.value.substring(0,i.value.indexOf("||"))==e.layer.options._extraData){var s=i.value;i.value.indexOf("||")>=0&&(s=i.value.substr(i.value.indexOf("||")+2));var a={text:s,disabled:i.selected,iconCls:i.selected?"fa fa-check-square-o":"far fa-square",callback:function(){!function(r){var i=[{key:c,value:e.layer.options._extraData}];t.updateChoiceDefinition(l,i,o.def,r,function(){t.model.reevaluateNodesNeeded(t.tagId),t.refreshLayerStyles()})}(r)}};t.map.contextmenu.addItem(a)}}),t.map.contextmenu.showAt(e.latlng)}}},!0)}if(!s&&e.layer.options._info){var h,p=e.layer.options._info.content;if(this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.drawIndexes&&this.currentResult.itemProperties.map.infoByValue&&-1!=this.currentResult.itemProperties.map.infoByValue){p+="<span class='info-loading'>"+(0,n.translate)("loading")+"</span>";var m=e.layer.options._extraData;this.queryForPopup(m,function(s){var a,n=e.layer.options._info.content;if(s&&s.columns&&s.columns.categories&&s.series&&s.series.length>0&&(i.each(t.currentResult.itemProperties.map.infoByValue,function(e,t){var r=s.columns.categories.indexOf(t);if(r>=0){var o=s.series[0].data[r];o=o?i.isNumeric(o)?parseFloat(o).toFixed(2):o:"-",n+="<br/><b>"+t+": </b>"+o}}),t.currentResult.itemProperties.map&&t.currentResult.itemProperties.map.event&&"link_dashboard"==t.currentResult.itemProperties.map.event.type)){a=t.currentResult.itemProperties.map.event.eventData;var l=[];i.each(a.params,function(e,t){var r=s.columns.categories.indexOf(t.attribute);if(r>=0){var o=s.series[0].data[r];null!=o&&void 0!=o&&(i.isNumeric(o)||(o="'"+o+"'"),l.push({node:t.node,properties:[{name:"definition",value:o}]}))}})}n+=o,e.layer.options._info.loadedContent=n,h&&(h.setContent(n),a&&i(h._container).find("a.linkedDashboard").on("click",function(){var e=function(){var e=a.dashboardId,t=a.dashboardName;Promise.resolve().then(function(){var i=[r(702)];(function(r){(new r).showDashboard(e,-1,t,!0)}).apply(null,i)}).catch(r.oe)};l?Promise.resolve().then(function(){var t=[r(219)];(function(t){(new t).setNodesProperties(l,function(){e()})}).apply(null,t)}).catch(r.oe):e()}))})}h=L.popup({closeOnClick:!0}).setLatLng(e.latlng).setContent(p).openOn(this.map)}}},queryForPopup:function(e,t){var r=this.currentResult.itemProperties.map.attrByDim,o=[],s=[],a=[];o.push({field:this.currentResult.itemProperties.map.drawIndexes[0],name:this.currentResult.itemProperties.map.drawIndexes[0],values:[{value:e,selected:!0}]}),s.push({field:r,name:r,values:[]}),i.each(this.currentResult.dims,function(e,t){t.field!=o[0].field&&t.field!=r&&a.push(t)}),this.model.evaluateNode(this.currentNodeId,a,o,s,function(e){t(e)})},addControls:function(){var e=this;if(this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&(this.colorControl||(this.colorControl=L.control.colorsizeby({isCluster:this.currentResult.itemProperties.map.clusterMap&&this.currentResult.itemProperties.map.drawIndexes.length>0,textBy:(0,n.translate)("color_by"),model:this.model,disabled:this.editMode,callback:function(t,r,i){if(i){e.resetLayerColors(),e.currentResult.itemProperties.map.colorSchema=i;i.indexOf("#")>=0&&!0,e.setDefaultOptions()}e.currentResult.itemProperties.map.clusterMap?(e.currentResult.itemProperties.map.clusterMapFnColor=t,e.currentResult.itemProperties.map.clusterMapByValueColor=r,e.loadGeoFromCache=!0,e.recreateClusterLayer(),e.redrawMap()):(e.currentResult.itemProperties.map.colorByValue=r,e.refreshLayerStyles())}}),this.map.addControl(this.colorControl)),this.sizeControl||(this.sizeControl=L.control.colorsizeby({isCluster:this.currentResult.itemProperties.map.clusterMap&&this.currentResult.itemProperties.map.drawIndexes.length>0,textBy:(0,n.translate)("size_by"),model:this.model,isSize:!0,callback:function(t,r,i){e.currentResult.itemProperties.map.clusterMap?(e.currentResult.itemProperties.map.clusterMapFnSize=t,e.currentResult.itemProperties.map.clusterMapByValueSize=r,e.loadGeoFromCache=!0,e.recreateClusterLayer(),e.redrawMap()):(e.currentResult.itemProperties.map.sizeByValue=r,e.refreshLayerStyles())}}),this.map.addControl(this.sizeControl)),this.iconControl||(this.iconControl=L.control.colorsizeby({isCluster:this.currentResult.itemProperties.map.clusterMap&&this.currentResult.itemProperties.map.drawIndexes.length>0,textBy:(0,n.translate)("icon_by"),model:this.model,isIcon:!0,callback:function(t,r,i){i&&(e.currentResult.itemProperties.map.iconSchema=i),e.currentResult.itemProperties.map.iconByValue=r,e.refreshLayerStyles()}}),this.map.addControl(this.iconControl)),this.currentResult.itemProperties.map.clusterMap&&this.currentResult.itemProperties.map.drawIndexes.length>0?this.clusterControl||(this.clusterControl=L.control.clustermap({model:this.model,callback:function(t,r,i,o){e.currentResult.itemProperties.map.clusterMapFn=t,e.currentResult.itemProperties.map.clusterMapByValue=r,e.currentResult.itemProperties.map.clusterMapRadius=i,o&&(e.resetLayerColors(),e.currentResult.itemProperties.map.colorSchema=o,o.indexOf("#")>=0?e.setDrawMapOption("automaticColor",!0):e.setDrawMapOption("automaticColor",!1)),e.loadGeoFromCache=!0,e.recreateClusterLayer(),e.redrawMap()}}),this.map.addControl(this.clusterControl)):this.clusterControl&&(this.clusterControl.removeFrom(this.map),this.clusterControl=void 0),this.showControls()),!this.generalToolbarInitiated){this.generalToolbarInitiated=!0;var t=L.control.mapitemToolbar({position:"left"});this.map.addControl(t)}},showControls:function(){if(this.currentResult&&this.currentResult.nodeResult&&this.currentResult.nodeResult.columns){var e=this.currentResult.nodeResult.columns;if(this.colorControl){var t=this.currentResult.itemProperties.map.colorByValue,r=this.currentResult.itemProperties.map.colorSchema;if(this.colorControl.show(),this.colorControl.updateCustomColorGroup(this.model.getStyleLibraries()),void 0!=this.clusterControl){var i=this.currentResult.itemProperties.map.clusterMapFnColor;t=this.currentResult.itemProperties.map.clusterMapByValueColor,this.colorControl.setData(t,e,r,!0,i)}else this.colorControl.setData(t,e,r,!1);this.colorControl.setFullContract(this.currentResult.itemProperties.map.hideColorControl)}if(this.sizeControl){this.sizeControl.show();t=this.currentResult.itemProperties.map.sizeByValue;if(void 0!=this.clusterControl){i=this.currentResult.itemProperties.map.clusterMapFnSize;t=this.currentResult.itemProperties.map.clusterMapByValueSize,this.sizeControl.setData(t,e,void 0,!0,i)}else this.sizeControl.setData(t,e,void 0,!1);this.sizeControl.setFullContract(this.currentResult.itemProperties.map.hideSizeControl)}if(this.iconControl){t=this.currentResult.itemProperties.map.iconByValue,r=this.currentResult.itemProperties.map.iconSchema;this.iconControl.show(),this.iconControl.updateCustomColorGroup(this.model.getStyleLibraries(),4),this.iconControl.setData(t,e,r,!1),this.iconControl.setFullContract(this.currentResult.itemProperties.map.hideIconControl)}if(this.clusterControl){t=this.currentResult.itemProperties.map.colorByValue,r=this.currentResult.itemProperties.map.colorSchema;this.clusterControl.show(),this.clusterControl.updateCustomColorGroup(this.model.getStyleLibraries()),this.clusterControl.setData(this.currentResult.itemProperties.map.clusterMapFn,this.currentResult.itemProperties.map.clusterMapByValue,this.currentResult.itemProperties.map.clusterMapRadius,e,r)}}},updateStyleLibraries:function(e){this.colorControl&&this.colorControl.updateCustomColorGroup(e),this.iconControl&&this.iconControl.updateCustomColorGroup(e),this.clusterControl&&this.clusterControl.updateCustomColorGroup(e),this.refreshLayerStyles()},hideLayers:function(){this.workLayer&&this.workLayer.eachLayer(function(e){e instanceof L.Polyline||e instanceof L.CircleMarker?e.setStyle({opacity:0}):e instanceof L.Marker&&e.setOpacity(0)})},showLayers:function(){this.workLayer&&this.workLayer.eachLayer(function(e){e instanceof L.Polyline||e instanceof L.MultiPolyline||e instanceof L.CircleMarker?e.setStyle({opacity:.5}):e instanceof L.Marker&&e.setOpacity(1)})},generateValuesForStyle:function(e){var t={};if(e.length>0){for(var r=0;r<e.length;r++)t[e[r]]={max:-1/0,min:1/0,values:[],isString:!1};for(var i in this.currentResult.nodeResult.dic){var o=this.currentResult.nodeResult.dic[i];for(r=0;r<e.length;r++){var s=o[e[r]];void 0!=s&&null!=s&&("string"==typeof s?(t[e[r]].isString=!0,-1==t[e[r]].values.indexOf(s)&&(t[e[r]].values.push(s),t[e[r]].max=t[e[r]].values.length-1),t[e[r]].min=0):(t[e[r]].min>s&&(t[e[r]].min=s),t[e[r]].max<s&&(t[e[r]].max=s)))}}}return t},getColumnPositionOfDic:function(e){var t=-1;try{for(var r=0;r<this.currentResult.nodeResult.columns.length;r++)if(this.currentResult.nodeResult.columns[r]==e){t=r;break}}catch(e){}return t},getStyleOptions:function(){var e={},t=this,r=-1,i=-1,s=-1,a=!1;this.currentResult.itemProperties.map.colorByValue&&-1!=this.currentResult.itemProperties.map.colorByValue&&(r=this.getColumnPositionOfDic(this.currentResult.itemProperties.map.colorByValue),a=this.currentResult.itemProperties.map.automaticColor),this.currentResult.itemProperties.map.sizeByValue&&-1!=this.currentResult.itemProperties.map.sizeByValue&&(i=this.getColumnPositionOfDic(this.currentResult.itemProperties.map.sizeByValue)),this.currentResult.itemProperties.map.iconByValue&&-1!=this.currentResult.itemProperties.map.iconByValue&&(s=this.getColumnPositionOfDic(this.currentResult.itemProperties.map.iconByValue));var n=[];r>=0&&a&&n.push(r),i>=0&&-1==n.indexOf(i)&&n.push(i);var l={};return n.length>0&&(l=this.generateValuesForStyle(n)),r>=0&&a&&(e.colorScale=o.scale(this.currentResult.itemProperties.map.colorSchema.split(",")).domain([l[r].min,l[r].max])),i>=0&&(e.sizeScale=o.scale(["#000000","#040000"]).domain([l[i].min,l[i].max])),r>=0&&!a&&(e.colorRange=t.model.getStyleLibrary(t.currentResult.itemProperties.map.colorSchema)),s>=0&&(e.iconRange=t.model.getStyleLibrary(t.currentResult.itemProperties.map.iconSchema),e.iconPos=s),r>=0?(e.colorPos=r,this.colorControl&&(a?this.colorControl.drawColor(e.colorScale):this.colorControl.drawColorRanges(e.colorRange))):this.colorControl&&this.colorControl.drawColor(!1),i>=0?(e.sizePos=i,this.sizeControl&&this.sizeControl.drawSize(e.sizeScale)):this.sizeControl&&this.sizeControl.drawSize(!1),s>=0?this.iconControl&&this.iconControl.drawIconRanges(e.iconRange):this.iconControl&&this.iconControl.drawIconRanges(!1),t=null,e},stringComparer:function(e,t){return!!t&&(e.from.toLowerCase()==t.toString().toLowerCase()||e.to.toLowerCase()==t.toString().toLowerCase())},numericComparer:function(e,t){return t>=parseFloat(e.from)&&t<parseFloat(e.to)||t==parseFloat(e.from)&&t==parseFloat(e.to)},getRangeByVal:function(e,t,r){var i;if(e)for(var o=0;o<e.length;o++)if((isNaN(parseInt(e[o].from))?this.stringComparer:this.numericComparer)(e[o],t)){i=e[o][r];break}return i},applyLayerStyle:function(e,t,r){if(this.currentResult&&this.currentResult.nodeResult&&this.currentResult.nodeResult.dic){var i=this.currentResult.nodeResult.dic[t];if(i){var o=this;(e instanceof L.CircleMarker||e instanceof L.Polyline||e instanceof L.MultiPolyline)&&(function(){if(void 0!=r.colorPos){var t=i[r.colorPos];if(r.colorScale)o.paintLayer(e,r.colorScale(t),t);else{var s=o.getRangeByVal(r.colorRange,t,"color");s&&o.paintLayer(e,s,t)}}}(),function(){if(void 0!=r.sizePos){var t=i[r.sizePos];r.sizeScale&&o.sizeLayer(e,r.sizeScale(t),t)}}()),e instanceof L.Marker&&function(){if(void 0!=r.iconPos){var t=i[r.iconPos],s=o.getRangeByVal(r.iconRange,t,"icon");s&&o.iconLayer(e,s,t)}}(),o=null}}},refreshLayerStyles:function(){if(this.isCluster())this.loadGeoFromCache=!0,this.recreateClusterLayer(),this.redrawMap();else if(this.workLayer){var e=this,t=this.getStyleOptions();this.workLayer.eachLayer(function(r){var i;(r instanceof L.Polyline||r instanceof L.CircleMarker||r instanceof L.MultiPolyline)&&r.setStyle({color:"#222299"}),r instanceof L.Polyline||r instanceof L.MultiPolyline?r.setStyle({weight:5}):r instanceof L.CircleMarker?r.setRadius(10):r instanceof L.Marker&&r.setIcon(new L.Icon.Default),r.options?i=r.options:r._options&&(i=r._options),e.applyLayerStyle(r,i._extraData,t)}),e=null}},updateClusterLoading:function(e,t,r){var o=i(this.tagId).find(".map-progress");r>1e3&&(o.show(),o.find(">div").css("width",Math.round(e/t*100)+"%")),e>=t&&(o.hide(),this.workLayer.getLayers().length>0&&this.map.fitBounds(this.workLayer.getBounds()))},createClusterLayer:function(){var e;this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.clusterMapRadius&&(e=this.currentResult.itemProperties.map.clusterMapRadius),e&&!isNaN(e)||(e=60);var t=void 0,r=this,i={maxClusterRadius:e,chunkedLoading:!0,chunkProgress:function(e,t,i,o){r.updateClusterLoading(e,t,i,o)},onDisplayIcons:function(e,i){t||(t=r.getStyleOptions()),r.onDisplayClusterIcons(e,i,t)}},o="count",s="-1",a="count",l="-1",c="count",u="-1";this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&(o=this.currentResult.itemProperties.map.clusterMapFn,s=this.currentResult.itemProperties.map.clusterMapByValue,a=this.currentResult.itemProperties.map.clusterMapFnColor,l=this.currentResult.itemProperties.map.clusterMapByValueColor,c=this.currentResult.itemProperties.map.clusterMapFnSize,u=this.currentResult.itemProperties.map.clusterMapByValueSize);r=this;i.iconCreateFunction=function(e){var t=e.getAllChildMarkers(),i=r.getClusterValue(t,o,s),h=0;h="count"==o?i.toFixed(0):(0,n.formatNumber)(i,{decimalPlaces:1}),"-1"!=a&&(e.options.clusterValueColor=a==o&&l==s?i:r.getClusterValue(t,a,l)),"-1"!=c&&(e.options.clusterValueSize=c==o&&u==s?i:c==a&&u==l?e.options.clusterValueColor:r.getClusterValue(t,c,u));var p={html:"<div><span>"+h+"</span></div>",iconSize:new L.Point(60,60),className:"marker-cluster"};return new L.DivIcon(p)};var h=L.markerClusterGroup(i);return h.on("click",function(e){r.layerClick(e)}),h},recreateClusterLayer:function(){this.workLayer&&(this.workLayer.clearLayers(),this.map.hasLayer(this.workLayer)&&this.map.removeLayer(this.workLayer)),this.clusterLayer=this.createClusterLayer(),this.map.addLayer(this.clusterLayer),this.workLayer=this.clusterLayer},getClusterValue:function(e,t,r){var i=0;try{switch(t){case"count":i=e.length;break;case"sum":var o,s;if((s=this.getColumnPositionOfDic(r))>=0)for(var a=0;a<e.length;a++)o=e[a].options._extraData,i+=this.currentResult.nodeResult.dic[o][s];break;case"avg":i=this.getClusterValue(e,"sum",r)/e.length}}catch(e){}return isNaN(i)&&(i=0),i},onDisplayClusterIcons:function(e,t,r){if(this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.colorSchema&&("-1"!=this.currentResult.itemProperties.map.clusterMapFnColor||"-1"!=this.currentResult.itemProperties.map.clusterMapFnSize)){r||(r={});var s,a,n=e.getLayers(),l=-1/0,c=1/0,u=-1/0,h=1/0;if(!r.colorPos||r.colorScale||"-1"!=this.currentResult.itemProperties.map.clusterMapFnSize||"-1"!=this.currentResult.itemProperties.map.clusterMapFnColor)for(var p=0;p<n.length;p++)(s=n[p])instanceof L.MarkerCluster&&(!t||t===s._zoom)&&(s.options.clusterValueColor>l&&(l=s.options.clusterValueColor),s.options.clusterValueColor<c&&(c=s.options.clusterValueColor),s.options.clusterValueSize>u&&(u=s.options.clusterValueSize),s.options.clusterValueSize<h&&(h=s.options.clusterValueSize));l==c&&(l+=1),u==h&&(u+=1),void 0!=r.colorPos?r.colorScale&&(a=o.scale(this.currentResult.itemProperties.map.colorSchema.split(",")).domain([c,l])):this.currentResult.itemProperties.map.colorSchema&&0!=this.currentResult.itemProperties.map.colorSchema.indexOf("#")?r.colorRange=this.model.getStyleLibrary(this.currentResult.itemProperties.map.colorSchema):a=o.scale(this.currentResult.itemProperties.map.colorSchema.split(",")).domain([c,l]);var m=!1,d=!1;for(p=0;p<n.length;p++)if((s=n[p])instanceof L.MarkerCluster&&(!t||t===s._zoom)){var f=s.options.clusterValueColor,v=s.options.clusterValueSize,y=i(s._icon),C=y.find(">div");if("-1"!=this.currentResult.itemProperties.map.clusterMapFnColor){var g;if(a)g=a(f).rgb();else if(r.colorRange){var R=this.getRangeByVal(r.colorRange,f,"color");R&&(g=o(R).rgb())}g&&(y.css("background-color","rgba("+parseInt(g[0])+","+parseInt(g[1])+","+parseInt(g[2])+", 0.4)"),g=o.rgb(g[0],g[1],g[2]).darken().rgb(),C.css("background-color","rgba("+parseInt(g[0])+","+parseInt(g[1])+","+parseInt(g[2])+", 0.4)"),m=!0)}if("-1"!=this.currentResult.itemProperties.map.clusterMapFnSize){d=!0;var _=(v-h)/(u-h)*30;isNaN(_)&&(_=0);var S=parseInt(50+_);y.width(S).height(S).css("border-radius",S/2+"px"),C.width(S-10).height(S-10).css("border-radius",(S-10)/2+"px").css("line-height",S-10+"px")}}if(d&&this.sizeControl){var P=o.scale(["#000000","#040000"]).domain([h,u]);this.sizeControl.drawSize(P)}m&&this.colorControl&&(a?this.colorControl.drawColor(a):r.colorRange&&this.colorControl.drawColorRanges(r.colorRange))}},getStylesUsed:function(){var e=[];return this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.colorSchema&&"-1"!=this.currentResult.itemProperties.map.colorSchema&&-1==this.currentResult.itemProperties.map.colorSchema.indexOf("#")&&e.push(this.currentResult.itemProperties.map.colorSchema),this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.map&&this.currentResult.itemProperties.map.iconSchema&&"-1"!=this.currentResult.itemProperties.map.iconSchema&&-1==this.currentResult.itemProperties.map.iconSchema.indexOf("#")&&e.push(this.currentResult.itemProperties.map.iconSchema),e}})}.apply(t,s))||(e.exports=a)}).call(this,r(1),r(750))},1458:function(e,t,r){"use strict";(function(e,t){var i=r(18);L.Control.ColorSizeBy=L.Control.extend({options:{position:"bottomleft",fitBounds:!0,layerOptions:{},addToMap:!0,textBy:"Color by",model:void 0,isSize:!1,isIcon:!1,callback:function(){},isCluster:!1,minSize:10,fullContract:!1,disabled:!1},initialize:function(e){L.Util.setOptions(this,e)},onAdd:function(e){return this._initContainer()},_initContainer:function(){var t=this,r=this._container=L.DomUtil.create("div","leaflet-control-zoom leaflet-control-colorsize-selector"),o=this._link=L.DomUtil.create("a","",r);o.href="#",this._detailArea=L.DomUtil.create("div","control-detail-area",r),this._fnSelector=L.DomUtil.create("select","",r);var s=[{value:"-1",name:(0,i.translate)("select_aggregation")},{value:"count",name:(0,i.translate)("by_count")},{value:"sum",name:(0,i.translate)("by_sum")},{value:"avg",name:(0,i.translate)("by_avg")}];if(e.each(s,function(e,r){var i=L.DomUtil.create("option","",t._fnSelector);i.innerHTML=r.name,i.value=r.value}),this.options.isCluster||e(this._fnSelector).hide(),this._valueSelector=L.DomUtil.create("select","",r),!this.options.isSize){if(this._colorSelector=L.DomUtil.create("select","",r),e(this._colorSelector).off("change"),e(this._colorSelector).on("change",function(){t.options.callback(e(t._fnSelector).val(),e(t._valueSelector).val(),e(t._colorSelector).val())}),!this.options.isIcon){var a=[{value:"#ff0000,#00ff00",name:(0,i.translate)("red_green")},{value:"#00ff00,#ff0000",name:(0,i.translate)("green_red")},{value:"#0000ff,#00ff00",name:(0,i.translate)("blue_green")},{value:"#00ff00,#0000ff",name:(0,i.translate)("green_blue")},{value:"#ff0000,#0000ff",name:(0,i.translate)("red_blue")},{value:"#0000ff,#ff0000",name:(0,i.translate)("blue_red")}],n=L.DomUtil.create("optgroup","",t._colorSelector);n.label=(0,i.translate)("automatic"),e.each(a,function(e,t){var r=L.DomUtil.create("option","",n);r.innerHTML=t.name,r.value=t.value})}this._customColorGroup=L.DomUtil.create("optgroup","",t._colorSelector),this._customColorGroup.label=(0,i.translate)("custom")}L.DomEvent.on(o,"click",function(e){t.isExpanded()?t.contract():t.expand(),e.preventDefault()});var l=L.DomEvent.stopPropagation;return L.DomEvent.on(r,"click",l).on(r,"mousedown",l).on(r,"touchstart",l).on(r,"dblclick",l).on(r,"mousewheel",l).on(r,"MozMousePixelScroll",l),this.hide(),r},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||L.DomUtil.addClass(this._container,"visible")},hide:function(e){this.isVisible()&&L.DomUtil.removeClass(this._container,"visible"),e&&L.DomEvent.stopPropagation(e)},setEnabled:function(e){this.options.disabled=!e,e||this.contract()},isExpanded:function(){return L.DomUtil.hasClass(this._container,"expanded")},expand:function(e){this.options.disabled||(L.DomUtil.addClass(this._container,"expanded"),e&&L.DomEvent.stopPropagation(e),this.refreshHeight())},contract:function(e){L.DomUtil.removeClass(this._container,"expanded"),e&&L.DomEvent.stopPropagation(e),this.refreshHeight()},refreshHeight:function(){if(e(this._container).hasClass("expanded"))e(this._container).height("auto");else{var t=this.options.minSize;this.options.fullContract||(t+=e(this._detailArea).height()+3),e(this._container).height(t)}},setFullContract:function(e){this.options.fullContract=e,1==e&&this.contract()},setData:function(t,r,o,s,a){this.options.isCluster=s,e(this._fnSelector).hide(),s&&(e(this._fnSelector).val(a),e(this._fnSelector).show());var n=this;if(e(this._valueSelector).find("option").remove(),e(n._valueSelector).empty(),!s){var l=L.DomUtil.create("option","",n._valueSelector);l.innerHTML=(0,i.translate)("select_attribute"),l.value="-1",e(n._valueSelector).val("-1")}e.each(r,function(e,t){var r=L.DomUtil.create("option","",n._valueSelector);r.innerHTML=t,r.value=t}),t&&e(n._valueSelector).val(t),e(this._fnSelector).off("change"),e(this._fnSelector).on("change",function(){n._colorSelector?n.options.callback(e(n._fnSelector).val(),e(n._valueSelector).val(),e(n._colorSelector).val()):n.options.callback(e(n._fnSelector).val(),e(n._valueSelector).val()),n.checkControls()}),e(this._valueSelector).off("change"),e(this._valueSelector).on("change",function(){n._link.innerHTML=n.options.textBy+" "+e(this).find("option:selected").text(),n._colorSelector?n.options.callback(e(n._fnSelector).val(),e(n._valueSelector).val(),e(n._colorSelector).val()):n.options.callback(e(n._fnSelector).val(),e(n._valueSelector).val())}),o&&this._colorSelector&&e(this._colorSelector).val(o),this.checkControls(),this.refreshHeight()},drawColor:function(r){if(e(this._detailArea).empty(),!1!==r){var i,o=L.DomUtil.create("div","colorsizebar",this._detailArea);this._minLabel=L.DomUtil.create("span","min",o),this._maxLabel=L.DomUtil.create("span","max",o);try{i=t.scale(r.colors()).domain(r.domain(),10).colors()}catch(e){}if(i){var s=this;e.each(i,function(t,r){var i=L.DomUtil.create("div","step",o);e(i).css("background-color",r)})}this._minLabel.innerHTML=r.domain()[0],isNaN(parseFloat(r.domain()[0]))||(this._minLabel.innerHTML=parseFloat(r.domain()[0]).toFixed(2)),this._maxLabel.innerHTML=r.domain()[1],isNaN(parseFloat(r.domain()[1]))||(this._maxLabel.innerHTML=parseFloat(r.domain()[1]).toFixed(2));s=this;setTimeout(function(){s.refreshHeight(),s=null},100)}},drawSize:function(t){if(e(this._detailArea).empty(),!1!==t){var r=L.DomUtil.create("div","colorsizebar",this._detailArea);this._minLabel=L.DomUtil.create("span","min",r),this._maxLabel=L.DomUtil.create("span","max",r);for(var i=this,o=0;o<5;o++){var s=L.DomUtil.create("div","step size",r),a=L.DomUtil.create("i","fa fa-circle",s);e(a).css("font-size",o+4+"px")}this._minLabel.innerHTML=t.domain()[0],this._maxLabel.innerHTML=t.domain()[1],isNaN(parseFloat(t.domain()[0]))||(this._minLabel.innerHTML=parseFloat(t.domain()[0]).toFixed(2)),isNaN(parseFloat(t.domain()[1]))||(this._maxLabel.innerHTML=parseFloat(t.domain()[1]).toFixed(2));i=this;setTimeout(function(){i.refreshHeight(),i=null},100)}},drawColorRanges:function(t){e(this._detailArea).empty();var r=this;e.each(t,function(t,i){var o=L.DomUtil.create("div","",r._detailArea),s=L.DomUtil.create("div","step",o);e(s).css("background-color",i.color);var a=L.DomUtil.create("span","rangeLabel",o);a.innerHTML=i.from,i.to!=i.from&&(a.innerHTML+=" to "+i.to)}),setTimeout(function(){r.refreshHeight(),r=null},100)},drawIconRanges:function(t){if(e(this._detailArea).empty(),!1!==t){var r=this;e.each(t,function(t,i){var o=L.DomUtil.create("div","",r._detailArea),s=(L.DomUtil.create("img","step",o),L.DomUtil.create("span","rangeLabel",o));s.innerHTML=i.from,e(s).css({top:"1px"}),i.to!=i.from&&(s.innerHTML+=" to "+i.to)}),setTimeout(function(){r.refreshHeight(),r=null},100)}},updateCustomColorGroup:function(t,r){r||(r=0);var i=e(this._colorSelector),o=i.val();e(this._customColorGroup).empty();var s=this;e.each(t,function(t,i){i.libraryType==r&&e(s._customColorGroup).append(e("<option />").val(i.styleLibraryId).text(this.name))}),i.val(o),s=null},checkControls:function(){var t=e(this._valueSelector).val(),r=!1;if(this.options.isCluster||t&&"-1"!=t)if(this.options.isCluster){var o=e(this._fnSelector).val();o&&"-1"!=o&&(this._link.innerHTML=this.options.textBy+" "+(0,i.translate)("by_"+o)+" "+("count"!=o&&t&&"-1"!=t?t:""),r=!0)}else this._link.innerHTML=this.options.textBy+" "+t,r=!0;r||(this.options.isSize?this._link.innerHTML=(0,i.translate)("click_to_set")+" "+(0,i.translate)("size"):this.options.isIcon?this._link.innerHTML=(0,i.translate)("click_to_set")+" "+(0,i.translate)("icon"):this._link.innerHTML=(0,i.translate)("click_to_set")+" "+(0,i.translate)("color")),!this.options.isCluster||"count"!=e(this._fnSelector).val()&&"-1"!=e(this._fnSelector).val()?e(this._valueSelector).removeAttr("disabled"):e(this._valueSelector).attr("disabled","disabled")}}),L.control.colorsizeby=function(e){return new L.Control.ColorSizeBy(e)}}).call(this,r(1),r(750))},1459:function(e,t,r){"use strict";(function(e){var t=r(18);L.Control.ClusterMap=L.Control.extend({options:{position:"bottomleft",fitBounds:!0,addToMap:!0,textBy:(0,t.translate)("cluster_by"),callback:function(){},minSize:10,disabled:!1},initialize:function(e){L.Util.setOptions(this,e)},onAdd:function(e){return this._initContainer()},_initContainer:function(){var r=this,i=this._container=L.DomUtil.create("div","leaflet-control-zoom leaflet-control-colorsize-selector"),o=this._link=L.DomUtil.create("a","",i);o.href="#",this._radiusSelector=L.DomUtil.create("select","",i),L.DomUtil.create("span","inline",i).innerHTML=(0,t.translate)("cluster_by"),this._fnSelector=L.DomUtil.create("select","half inline",i),this._byValueSelector=L.DomUtil.create("select","half",i);var s=function(){r.options.callback(e(r._fnSelector).val(),e(r._byValueSelector).val(),e(r._radiusSelector).val(),e(r._colorSelector).val())};e(this._fnSelector).on("change",function(){r.checkControls(),s()}),e(this._byValueSelector).on("change",function(){s()}),e(this._radiusSelector).on("change",function(){s()}),e(this._colorSelector).on("change",function(){s()});var a=[{value:"count",name:(0,t.translate)("by_count")},{value:"sum",name:(0,t.translate)("by_sum")},{value:"avg",name:(0,t.translate)("by_avg")}];e.each(a,function(e,t){var i=L.DomUtil.create("option","",r._fnSelector);i.innerHTML=t.name,i.value=t.value});e.each([30,40,50,60,70,80,90,100,150,200,250,500],function(e,i){var o=L.DomUtil.create("option","",r._radiusSelector);o.value=i,o.innerHTML=(0,t.translate)("radius")+" "+i});var n=[{value:"#ff0000,#00ff00",name:(0,t.translate)("red_green")},{value:"#00ff00,#ff0000",name:(0,t.translate)("green_red")},{value:"#0000ff,#00ff00",name:(0,t.translate)("blue_green")},{value:"#00ff00,#0000ff",name:(0,t.translate)("green_blue")},{value:"#ff0000,#0000ff",name:(0,t.translate)("red_blue")},{value:"#0000ff,#ff0000",name:(0,t.translate)("blue_red")}],l=L.DomUtil.create("optgroup","",r._colorSelector);l.label=(0,t.translate)("automatic"),e.each(n,function(e,t){var r=L.DomUtil.create("option","",l);r.innerHTML=t.name,r.value=t.value}),this._customColorGroup=L.DomUtil.create("optgroup","",r._colorSelector),this._customColorGroup.label=(0,t.translate)("custom"),L.DomEvent.on(o,"click",function(e){r.isExpanded()?r.contract():r.expand(),e.preventDefault()});var c=L.DomEvent.stopPropagation;return L.DomEvent.on(i,"click",c).on(i,"mousedown",c).on(i,"touchstart",c).on(i,"dblclick",c).on(i,"mousewheel",c).on(i,"MozMousePixelScroll",c),this.refreshHeight(),this.hide(),i},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||L.DomUtil.addClass(this._container,"visible")},hide:function(e){this.isVisible()&&L.DomUtil.removeClass(this._container,"visible"),e&&L.DomEvent.stopPropagation(e)},setEnabled:function(e){this.options.disabled=!e,e||this.contract()},isExpanded:function(){return L.DomUtil.hasClass(this._container,"expanded")},expand:function(e){this.options.disabled||(L.DomUtil.addClass(this._container,"expanded"),e&&L.DomEvent.stopPropagation(e),this.refreshHeight())},contract:function(e){L.DomUtil.removeClass(this._container,"expanded"),e&&L.DomEvent.stopPropagation(e),this.refreshHeight()},refreshHeight:function(){e(this._container).hasClass("expanded")?(e(this._container).find("select").show(),e(this._container).height("auto")):(e(this._container).find("select").hide(),e(this._container).height(this.options.minSize))},setData:function(r,i,o,s,a){var n=this;e(this._fnSelector).val(r),e(this._byValueSelector).find("option").remove(),e(this._byValueSelector).html(""),e.each(s,function(e,t){var r=L.DomUtil.create("option","",n._byValueSelector);r.innerHTML=t,r.value=t}),i&&e(n._byValueSelector).val(i),e(this._radiusSelector).val(o),e(this._colorSelector).val(a),this._link.innerHTML=this.options.textBy+" "+(0,t.translate)("by_"+r)+" "+("count"!=r&&i&&"-1"!=i?i:""),this.checkControls()},checkControls:function(){"count"==e(this._fnSelector).val()?e(this._byValueSelector).attr("disabled","disabled"):e(this._byValueSelector).removeAttr("disabled"),this.refreshHeight()},updateCustomColorGroup:function(t){var r=e(this._colorSelector),i=r.val();e(this._customColorGroup).empty();var o=this;e.each(t,function(t,r){0==r.libraryType&&e(o._customColorGroup).append(e("<option />").val(r.styleLibraryId).text(this.name))}),r.val(i),o=null}}),L.control.clustermap=function(e){return new L.Control.ClusterMap(e)}}).call(this,r(1))}}]);