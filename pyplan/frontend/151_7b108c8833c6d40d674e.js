/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{1628:function(e,t,n){"use strict";(function(a,r){var i,s=u(n(682)),o=u(n(717)),l=u(n(2592));function u(e){return e&&e.__esModule?e:{default:e}}void 0===(i=function(){return a.View.extend({el:r("#main"),render:function(){this.$el.append('<div id="wf-item-status-transition" class="container-fluid mainTask" data-rel="wf-item-status-transition" data-type="tab-content" />');var e=document.getElementById("wf-item-status-transition"),t=function(){o.default.render(s.default.createElement(l.default,null),e)};t(),r('#main div[data-rel="wf-item-status-transition"]').on("removeView",(function(){o.default.unmountComponentAtNode(e)}))}})}.apply(t,[]))||(e.exports=i)}).call(this,n(220),n(1))},2592:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.StatusTransitionsPage=void 0;var a=m(n(682)),r=n(18),i=n(726),s=m(n(953)),o=m(n(954)),l=m(n(2593)),u=n(1084),c=n(2594),f=n(764),d=n(712),p=n(957);function m(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function v(e,t,n,a,r,i,s){try{var o=e[i](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(a,r)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){v(i,a,r,s,o,"next",e)}function o(e){v(i,a,r,s,o,"throw",e)}s(void 0)}))}}function g(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function T(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=T(this,w(n).call(this,e))).state={departments:[],statuses:[],transitions:[],modifiedTransitions:[],changesToApply:[],selectedDepartments:[]},t}var m,h,v,E,_;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(n,t),m=n,(h=[{key:"componentDidMount",value:(_=b(regeneratorRuntime.mark((function e(){var t,n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.listByCurrentCompany)();case 2:return t=e.sent,e.next=5,(0,f.listTaskItemStatuses)();case 5:return n=e.sent,e.next=8,(0,f.listTaskItemStatusTransitions)();case 8:a=e.sent,this.setState({departments:t.map((function(e){return{id:e.id,label:e.name}})),statuses:n,transitions:a,modifiedTransitions:a});case 10:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"close",value:function(){e("#topMenuBar a.btn-remove").click()}},{key:"handleSimpleMultiSelectChange",value:function(e){this.setState({changesToApply:[],selectedDepartments:e.target.value,modifiedTransitions:this.state.transitions})}},{key:"handleSimpleCheckboxChange",value:function(e){var t=this,n=(0,u.cloneDeep)(this.state.changesToApply),a=(0,u.cloneDeep)(this.state.modifiedTransitions),r={id:e.target.id,change:1==e.target.value?"add":"remove"};-1!=n.findIndex((function(t){return t.id==e.target.id}))?n=n.filter((function(t){return t.id!==e.target.id})):n.push(r);var i,s=a.findIndex((function(e){return e.id==r.id}));"add"==r.change?(i=a[s].departments).push.apply(i,y(this.state.selectedDepartments)):a[s].departments=a[s].departments.filter((function(e){return 0==t.state.selectedDepartments.includes(e)})),this.setState({changesToApply:n,modifiedTransitions:a})}},{key:"handleSimpleSelectChange",value:function(e){var t=(0,u.cloneDeep)(this.state.changesToApply);if("boolean"==typeof e.target.value){var n={id:e.target.id,change:1==e.target.value?"add":"remove"},a=t.findIndex((function(t){return t.id==e.target.id}));-1!=a?t[a]=n:t.push(n)}else t=t.filter((function(t){return t.id!==e.target.id}));this.setState({changesToApply:t})}},{key:"handleApplyChanges",value:(E=b(regeneratorRuntime.mark((function e(t){var n,a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={departments_ids:this.state.selectedDepartments,transitions_to_change:this.state.changesToApply},e.next=3,(0,f.bulkPartialUpdateTaskItemStatusTransition)(n);case 3:a=(0,u.cloneDeep)(this.state.transitions),this.state.changesToApply.forEach((function(e){var t=a.findIndex((function(t){return t.id==e.id}));"add"==e.change?a[t].departments=i.state.selectedDepartments:a[t].departments=a[t].departments.filter((function(e){return 0==i.state.selectedDepartments.includes(e)}))})),this.setState({changesToApply:[],selectedDepartments:[],transitions:a}),(0,r.showMessage)((0,r.translate)("_WFTaskItemStatusTransitionsSuccessfullyEdited"),(0,r.translate)("_successfully_edited"),"success");case 7:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=this.state.selectedDepartments?this.state.statuses.map((function(t){var n=[t.label];return e.state.statuses.forEach((function(i){var s=e.state.modifiedTransitions.find((function(e){return e.from_status==t.id&&e.to_status==i.id})),u=s.departments.filter((function(t){return-1!==e.state.selectedDepartments.indexOf(t)}));0==u.length||u.length==e.state.selectedDepartments.length?n.push(a.default.createElement(o.default,{id:s.id,label:null,color:"primary",value:0!=u.length,onChange:function(t){return e.handleSimpleCheckboxChange(t)}})):n.push(a.default.createElement(l.default,{id:s.id,value:-1,onChange:function(t){return e.handleSimpleSelectChange(t)},options:[{id:-1,label:(0,r.translate)("_wfTaskItemStatusTransitionsDoNothig")},{id:!0,label:(0,r.translate)("_wfTaskItemStatusTransitionsEnableForAll")},{id:!1,label:(0,r.translate)("_wfTaskItemStatusTransitionsDisableForAll")}]}))})),n})):[];return a.default.createElement(d.ThemeProvider,{theme:p.pyplanTheme},a.default.createElement("div",{className:"row",style:{paddingTop:"20px"}},a.default.createElement("div",{className:"col-sm-12"},a.default.createElement("div",{className:"box"},a.default.createElement("div",{className:"box-title"},a.default.createElement("h3",null,a.default.createElement("i",{className:"fa fa-tasks"})," ",(0,r.translate)("_wfTaskItemStatusTransitions")),a.default.createElement("div",{className:"actions"},a.default.createElement("a",{href:"#",className:"btn btn-close",onClick:this.close},a.default.createElement("i",{className:"fa fa-times"})))),a.default.createElement("div",{className:"box-content nopadding"},a.default.createElement(i.Grid,{container:!0,spacing:3},a.default.createElement(i.Grid,{item:!0,xs:2},a.default.createElement(i.Paper,{style:{width:"100%"}},a.default.createElement(s.default,{id:"departments",label:(0,r.translate)("_wfTaskItemStatusTransitionsDepartments"),placeholder:(0,r.translate)("_wfTaskItemStatusTransitionsDepartmentsPlaceHolder"),fullWidth:!0,value:this.state.selectedDepartments,options:this.state.departments,onChange:function(t){return e.handleSimpleMultiSelectChange(t)}}))),a.default.createElement(i.Grid,{item:!0,xs:10},this.state.selectedDepartments.length>0?a.default.createElement(i.Paper,{style:{width:"100%"}},a.default.createElement(i.Toolbar,null,this.state.changesToApply.length>0?a.default.createElement(i.Button,{title:(0,r.translate)("_wfTaskItemStatusConfirmChanges"),color:"primary",onClick:function(t){return e.handleApplyChanges(t)},startIcon:a.default.createElement("i",{className:"fa fa-check"}),variant:"contained"},(0,r.translate)("_wfTaskItemStatusConfirmChanges")):a.default.createElement(i.Typography,null,(0,r.translate)("_wfTaskItemStatusTransitionsNoChangesToApply"))),a.default.createElement(i.TableContainer,null,a.default.createElement(i.Table,{style:{minWidth:"650px"},"aria-label":"status transitions table"},a.default.createElement(i.TableHead,null,a.default.createElement(i.TableRow,null,a.default.createElement(i.TableCell,null,(0,r.translate)("_wfTaskItemStatusTransitionsFromTo")),this.state.statuses.map((function(e,t){return a.default.createElement(i.TableCell,{key:t},e.label)})))),a.default.createElement(i.TableBody,null,t.map((function(e,t){return a.default.createElement(i.TableRow,{key:t},e.map((function(e,t){return a.default.createElement(i.TableCell,{key:t,component:"th",scope:"row"},e)})))})))))):null)))))))}}])&&g(m.prototype,h),v&&g(m,v),n}(a.default.PureComponent);t.StatusTransitionsPage=E;var _=E;t.default=_}).call(this,n(1))},2593:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.SimpleSingleSelect=void 0;var a,r=(a=n(682))&&a.__esModule?a:{default:a},i=n(726);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=l(this,u(t).call(this,e))).state={value:n.props.value},n}var n,a,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,e),n=t,(a=[{key:"onChange",value:function(e){this.setState({value:e.target.value});var t={target:{id:this.props.id,value:e.target.value}};this.props.onChange(t)}},{key:"render",value:function(){var e=this;return r.default.createElement(i.TextField,{name:"".concat(this.props.id),select:!0,value:this.state.value,onChange:function(t){return e.onChange(t)}},this.props.options.map((function(e){return r.default.createElement(i.MenuItem,{key:e.id,value:e.id},e.label)})))}}])&&o(n.prototype,a),s&&o(n,s),t}(r.default.Component);t.SimpleSingleSelect=f;var d=f;t.default=d},2594:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listByCurrentCompany=void 0;var a=n(749);t.listByCurrentCompany=function(){return(0,a.request)("/departments/by_current_company/",{method:"GET"})}}}]);