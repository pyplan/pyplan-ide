/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{833:function(e,t,i){"use strict";(function(o){var a,n;i(18);a=[i(730),i(987),i(219)],void 0===(n=function(e,t,a){return e.extend({el:o("#n_o_n_e"),diagram:void 0,nodeClickTimeout:-1,render:function(e){this.baseRender(e),this.drawItem()},isDiagramView:function(){return!0},needRefresh:function(){return!0},refreshItemDash:function(){this.fullRefresh(!0)},drawItem:function(){this.options.model=new a;var e=this;o(this.tagId).find(".item-area").addClass("extrafullSize"),o(this.tagId).find(".item-title").remove(),this.setDefaultOptions();var i={id:o.uuid(),contextMenu:!1,autoCenter:!1,listenMouseDown:!0,breadCrumb:this.currentResult.itemProperties.diagramOptions.showBreadcrumb,nodeClick:function(t,i){e.nodeClick(t,i)},nodeDoubleclick:function(t,i){e.nodeDoubleclick(t,i)},diagramClick:function(){e.diagramClick()},updateProperties:function(t){e.updateProperties(t)},executeButton:function(t){e.executeButton(t)},onUpdateDefinition:function(t){e.model.reevaluateNodesNeeded(e.tagId)},nodeMouseDown:function(t,i){if(e.editMode&&i&&t.data.originalEvent.shiftKey){t.stopPropagation();var a=o.extend({},t.data.originalEvent),n=o("<div class='nodeGhost'></div>").appendTo("body");i.originalId&&""!=i.originalId?n.attr("data-nodeId",i.originalId).attr("data-nodeClass",i.originalClass):n.attr("data-nodeId",i.id).attr("data-nodeClass",i.nodeClass),n.attr("data-source",e.tagId),n.css({left:a.pageX-40,top:a.pageY-22}),n.draggable({stop:function(e,t){setTimeout(function(){n.draggable("destroy"),n.remove()},10)}});var s=o.createMouseEvent(n[0],"mousedown",a);o.dispatchMouseEvent(n[0],"mousedown",s)}else{a=o.extend({},t.data.originalEvent),s=o.createMouseEvent(o("body")[0],"mousedown",a);o.dispatchMouseEvent(o("body")[0],"mousedown",s)}}};this.updateSize(),o(this.tagId).find(".item-area").empty(),this.diagram=new t(i),this.diagram.setElement(o(this.tagId).find(".item-area")),this.diagram.render(),this.fullRefresh()},fullRefresh:function(e){this.drawDiagram(e)},onRemoveItemView:function(){o(".left-menu[data-rel='"+this.tagId+"']").find("select[data-format-key='node.dashboard']").select2("destroy"),this.diagram&&(this.diagram.destroy(),this.diagram=null)},updateValues:function(e){},_evaluateNode:function(e,t,i,o,a){},baseUpdateSize:function(){o(this.tagId).find(".item-area").height(o(this.tagId).parent().height()),o(this.tagId).find(".item-area").css("top","0px")},updateSize:function(){o(this.tagId).find(".item-area").height(o(this.tagId).parent().height()-7),this.diagram&&this.diagram.onResize()},drawDiagram:function(e){this.diagram&&(e?this.diagram.navigateCurrentModule():this.diagram.navigateThisModule(this.getNodeId(),this.currentResult.itemProperties.diagramOptions)),this.isReady=!0},setDefaultOptions:function(){this.currentResult.itemProperties?this.currentResult.itemProperties.diagramOptions?void 0==this.currentResult.itemProperties.diagramOptions.showBreadcrumb&&(this.currentResult.itemProperties.diagramOptions.showBreadcrumb=!0):this.currentResult.itemProperties.diagramOptions={showBreadcrumb:!0}:this.currentResult.itemProperties={diagramOptions:{showBreadcrumb:!0}}},updateProperties:function(e){e&&this.currentResult&&(this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions=o.extend(!0,this.currentResult.itemProperties.diagramOptions,e))},setShowBreadcrumb:function(e){this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions.showBreadcrumb=e,this.diagram.options.breadCrumb=e,this.fullRefresh(!0)},setNodeEvent:function(e,t,i,a){this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions.nodeEventDic||(this.currentResult.itemProperties.diagramOptions.nodeEventDic={});var n=o(".left-menu[data-rel='"+this.tagId+"'] [data-rel='nodeId']").val();"-1"==e?delete this.currentResult.itemProperties.diagramOptions.nodeEventDic[n]:this.currentResult.itemProperties.diagramOptions.nodeEventDic[n]={action:e,value:t,extraValue:i,showIn:a}},getNodeId:function(){var e=this.currentResult.nodeId;return!e&&this.currentResult.itemProperties.diagramOptions&&this.currentResult.itemProperties.diagramOptions.currentModule&&(e=this.currentResult.itemProperties.diagramOptions.currentModule),e},nodeClick:function(e,t){this.editMode?this.showNodeProperties(t):this.showNodeDefinition(e,t)},nodeDoubleclick:function(e,t){if(!this.editMode&&"text"!=t.nodeClass&&"button"!=t.nodeClass){this.setDefaultOptions();var a=this.currentResult.itemProperties.diagramOptions.nodeEventDic;if(a&&a[t.id]){var n="oncontainer";if(a[t.id].showIn&&(n=a[t.id].showIn),this.fromEmbedded&&(n="oncontainer"),"opendashboard"==a[t.id].action){var s=a[t.id].value,r=a[t.id].extraValue;"oncontainer"==n&&o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").length>0?o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").first().trigger("showDashboardInContainer",[null,s]):this.fromEmbedded||Promise.resolve().then(function(){var e=[i(699)];(function(e){(new e).showDashboard(s,-1,r)}).apply(null,e)}).catch(i.oe)}else if("evaluatenode"==a[t.id].action||"-1"==a[t.id].action){var d=t.id;t.originalId&&(d=t.originalId),"oncontainer"==n&&o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").length>0?o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").first().trigger("showDashboardInContainer",[d]):this.fromEmbedded||this.options.model.evaluateNode(t.id,function(e){e&&Promise.resolve().then(function(){var t=[i(699)];(function(t){(new t).showDashboard(e.dashboardId,-1,e.name,!0)}).apply(null,t)}).catch(i.oe)})}}else!this.fromEmbedded&&o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").length>0?o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").first().trigger("showDashboardInContainer",[t.id]):this.options.model.evaluateNode(t.id,function(e){e&&Promise.resolve().then(function(){var t=[i(699)];(function(t){(new t).showDashboard(e.dashboardId,-1,e.name,!0)}).apply(null,t)}).catch(i.oe)})}},diagramClick:function(){this.showDiagramProperties()},showNodeDefinition:function(e,t){"text"!=t.nodeClass&&"button"!=t.nodeClass&&this.options.model.getNodeProperties(t.id,[{name:"shortdefinition"}],function(o){i.e(13).then(function(){var a=[i(737)];(function(i){var a=e.clientX||e.data.originalEvent.clientX,n=e.clientY||e.data.originalEvent.clientY,s={title:t.title+" ("+t.id+")",content:o.properties[0].value,left:a,top:n};(new i).show(s)}).apply(null,a)}).catch(i.oe)})},showNodeProperties:function(e){var t=o(".left-menu[data-rel='"+this.tagId+"']");t.find(".forDiagram").hide(),t.find(".forOpenDashboard").hide(),t.find(".forNode").show(),t.find("[data-rel='nodeId']").val(e.id),t.find("[data-rel='nodeTitle']").val(e.title);var i="mediumdefinition";if(("button"==e.nodeClass.toLowerCase()||e.originalClass&&"button"==e.originalClass.toLowerCase())&&(i="mediumscript"),("text"==e.nodeClass.toLowerCase()||e.originalClass&&"text"==e.originalClass.toLowerCase())&&(i="mediumdescription"),this.options.model.getNodeProperties(e.id,[{name:i}],function(e){t.find("[data-rel='nodeId']").val()==e.node&&t.find("[data-rel='nodeDefinition']").val(e.properties[0].value)}),"button"==e.nodeClass.toLowerCase()||e.originalClass&&"button"==e.originalClass.toLowerCase()||"text"==e.nodeClass.toLowerCase()||e.originalClass&&"text"==e.originalClass.toLowerCase())t.find(".clickEvent").hide(),t.trigger("closeAll");else{t.find(".clickEvent").show(),t.find("select[data-format-key='node.event']").val("-1"),t.find("div.forOpenDashboard").hide();var a=this.currentResult.itemProperties.diagramOptions.nodeEventDic;if(a&&a[e.id]){var n=a[e.id];t.find("select[data-format-key='node.event']").val(n.action),n.showIn?t.find("select[data-format-key='node.showin']").val(n.showIn):t.find("select[data-format-key='node.showin']").val("oncontainer"),"opendashboard"==n.action&&(t.find("div.forOpenDashboard").show(),t.find("select[data-format-key='node.dashboard']").select2("val",n.value))}}t.closest(".dock").trigger("updateTitle",[e.id])},showDiagramProperties:function(){var e=o(".left-menu[data-rel='"+this.tagId+"']");e.find(".forDiagram").show(),e.find(".forNode").hide(),e.trigger("closeAll")},executeButton:function(e){var t=this;this.editMode?t.showNodeProperties(e):this.options.model.executeButton(e.id,function(i){t.queryForFinishCalc(e.id)})},queryForFinishCalc:function(e){var t=this,i=0;setTimeout(function(){!function o(){i++,t.options.model.isInBackground(e,function(e){e?i<4?setTimeout(function(){o()},300):setTimeout(function(){o()},1e3):(t&&(t.fullRefresh(!0),t.options&&t.options.model&&t.model.reevaluateNodesNeeded()),t=null)})}()},200)}})}.apply(t,a))||(e.exports=n)}).call(this,i(1))}}]);