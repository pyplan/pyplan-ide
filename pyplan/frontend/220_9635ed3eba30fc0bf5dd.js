/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[220,277],{1978:function(n,e,t){"use strict";(function(a,o){var s,l,i=t(18);s=[t(747),t(724),t(710),t(725),t(1979)],void 0===(l=function(n,e,s,l,c){return a.View.extend({el:o("#main"),_uId:"",groupPermissions:[],processLength:null,render:function(){o("div[data-rel='abm-permissions-group']").remove();var e,a,d=new n,r=this;this._uId=o.uuid();var p=this.options.companyId;e=new Promise(function(n,e){d.listPermissions(function(e){r.processLength=e.length,d.list(p,function(t){n({groupList:t,permissions:e})})})}),a=new Promise(function(n,e){t.e(24).then(function(){var e=[t(726)];(function(e){(new e).list(function(e){n(e.results)})}).apply(null,e)}).catch(t.oe)}),Promise.all([e,a]).then(function(n){var e=n[0].groupList,t=n[0].permissions,a=n[1],d={id:r._uId,dataRel:"abm-permissions-group",tmpClass:"rol-edit",title:(0,i.translate)("permissionsByGroup")},p={groups:r.prepareProcess(t),rolList:e,companyList:a,isSuper:__currentSession.userIsSuperUser},u=s(d),m=l(),h=c(p);r.$el.append(u),o("div[data-id='"+r._uId+"']").find("div.abm-content").append(m),o("div[data-id='"+r._uId+"']").find("div.form-content").append(h),o("div[data-id='"+r._uId+"']").find("form").removeClass("form-bordered"),o("div[data-id='"+r._uId+"']").find(".submit.form-actions").remove(),(0,i.postRender)(r.$el.find("div[data-id='"+r._uId+"']")),r.initCheckboxes(o("div[data-id='"+r._uId+"']"),e),r.addHandlers(o("div[data-id='"+r._uId+"']")),__currentSession.userIsSuperUser&&r.options.companyId&&o("div[data-id='"+r._uId+"']").find(".selCompany").select2("val",r.options.companyId)})},prepareProcess:function(n){for(var e,t=[],a={},o=0;o<n.length;o++){e=n[o],a[s];var s=e.content_type.model;a[s]?a[s].process.push(e):(a[s]={code:e.content_type.model,name:e.content_type.model,process:[]},a[s].process.push(e))}for(var l in a)t.push(a[l]);return t},save:function(){this.groupPermissions.length>0&&(new n).updateGroupPermissions(this.groupPermissions,function(){})},cancel:function(){Promise.resolve().then(function(){var n=[t(763)];(function(n){(new n).show()}).apply(null,n)}).catch(t.oe)},addHandlers:function(e){o("div[data-id='"+this._uId+"']").find("form").on("submit",o.proxy(function(){return this.save(),!1},this)),o("div[data-id='"+this._uId+"']").find("div.submit button.btn-cancel").on("click",o.proxy(function(){return this.cancel(),!1},this)),o("div[data-id='"+this._uId+"']").find("div.abm-top-options a.btn-close").on("click",this.cancel);var a=this;o("div[data-id='"+this._uId+"']").find(".selCompany").on("change",function(){var n=o(this).select2("val");Promise.resolve().then(function(){var e=[t(763)];(function(e){(new e).showPermisionsByGroup(n)}).apply(null,e)}).catch(t.oe)}),o("div[data-id='"+this._uId+"']").find("input[class!='chkAll'].permission").on("click",function(){var e=o(this).attr("data-rolId"),t=o(this).closest("tr").attr("data-processId");a.groupPermissions={group_id:e,permissions:[t]},(new n).updateGroupPermissions(a.groupPermissions,function(){a.groupPermissions={}})}),e.find("input[class='permission']").on("click",function(){var n=o(this).attr("data-groupcode"),e=o(this).attr("data-rolid");o("input[data-rolId='"+e+"'][data-groupcode='"+n+"'].permission:checked").length===o("input[data-rolId='"+e+"'][data-groupcode='"+n+"'].permission").length?o("input[class='chkAll'][data-groupcode='"+n+"'][data-rolId='"+e+"']").prop("checked",!0):o("input[class='chkAll'][data-groupcode='"+n+"'][data-rolId='"+e+"']").prop("checked",!1)}),e.find("input[class='chkAll']").on("click",function(){var t,s=o(this).prop("checked"),l=o(this).attr("data-rolId"),i=o(this).attr("data-groupCode");e.find("tbody input[class!='chkAll'][data-groupCode='"+i+"'][data-rolId='"+l+"']").each(function(n,e){s?o(this).prop("checked")||o(this).prop("checked","checked"):o(this).prop("checked")&&o(this).prop("checked","")}),a.groupPermissions={group_id:l,permissions:[],check_all:s},o.each(o("input[class!='chkAll'][data-groupcode='"+i+"'][data-rolId='"+l+"']"),function(n,e){t=o(e).closest("tr").attr("data-processId"),a.groupPermissions.permissions.push(t)}),(new n).updateGroupPermissions(a.groupPermissions,function(){a.groupPermissions={}})})},initCheckboxes:function(n,e){for(var t=0;t<e.length;t++){for(var a,s=e[t].id,l=0;l<e[t].permissions.length;l++){var i=e[t].permissions[l].codename;n.find("tr[data-processCode='"+i+"'] input[data-rolId='"+s+"']").prop("checked","checked")}for(l=0;l<e[t].permissions.length;l++)a=e[t].permissions[l].content_type.model,o("input[data-rolId='"+s+"'][data-groupcode='"+a+"'].permission:checked").length===o("input[data-rolId='"+s+"'][data-groupcode='"+a+"'].permission").length&&o("input[class='chkAll'][data-groupcode='"+a+"'][data-rolId='"+s+"']").prop("checked",!0)}}})}.apply(e,s))||(n.exports=l)}).call(this,t(218),t(1))},1979:function(n,e,t){var a=t(690);n.exports=(a.default||a).template({1:function(n,e,a,o,s){var l,i=null!=e?e:n.nullContext||{};return'<div class="row" style="margin-top: 15px; margin-bottom: 15px;">\n  <div class="col-sm-10">\n    <span style="float: left; padding-top: 5px; font-weight: bold;">'+n.escapeExpression(function(n){return n&&(n.__esModule?n.default:n)}(t(688)).call(i,"_company",{name:"L",hash:{},data:s,loc:{start:{line:4,column:68},end:{line:4,column:84}}}))+'</span>\n    <div class="col-sm-10">\n      <div class="col-sm-4">\n        <select class="select2-me selCompany" style="width: 100%;">\n'+(null!=(l=a.each.call(i,null!=e?e.companyList:e,{name:"each",hash:{},fn:n.program(2,s,0),inverse:n.noop,data:s,loc:{start:{line:8,column:10},end:{line:10,column:19}}}))?l:"")+"        </select>\n      </div>\n    </div>\n  </div>\n</div>\n"},2:function(n,e,t,a,o){var s=n.lambda,l=n.escapeExpression;return'          <option value="'+l(s(null!=e?e.id:e,e))+'">'+l(s(null!=e?e.name:e,e))+"</option>\n"},4:function(n,e,t,a,o,s,l){var i,c=n.lambda,d=n.escapeExpression,r=null!=e?e:n.nullContext||{};return'  <div class="panel panel-default">\n    <div class="panel-heading">\n      <h4 class="panel-title">\n        <a href="#'+d(c(null!=e?e.code:e,e))+'" data-toggle="collapse" data-parent="#ac4" class="collapsed">\n          '+d(c(null!=e?e.name:e,e))+'\n        </a>\n      </h4>\n      \x3c!-- /.panel-title --\x3e\n    </div>\n    \x3c!-- /.panel-heading --\x3e\n    <div id="'+d(c(null!=e?e.code:e,e))+'" class="panel-collapse collapse" style="height: 0px;">\n      <div class="panel-body">\n\n\n        <table class="table table-hover table-condensed processByRol">\n          <tbody>\n            <tr data-groupCode="'+d(c(null!=e?e.code:e,e))+'" class="group">\n              <td>\n                <strong></strong>\n              </td>\n'+(null!=(i=t.each.call(r,null!=l[1]?l[1].rolList:l[1],{name:"each",hash:{},fn:n.program(5,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:39,column:14},end:{line:48,column:23}}}))?i:"")+"            </tr>\n\n"+(null!=(i=t.each.call(r,null!=e?e.process:e,{name:"each",hash:{},fn:n.program(7,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:51,column:12},end:{line:63,column:21}}}))?i:"")+"          </tbody>\n        </table>\n\n\n      </div>\n      \x3c!-- /.panel-body --\x3e\n    </div>\n    \x3c!-- /#c1.panel-collapse collapse in --\x3e\n  </div>\n"},5:function(n,e,t,a,o,s,l){var i=n.lambda,c=n.escapeExpression;return'              <td class="group text-center">\n                '+c(i(null!=e?e.name:e,e))+' <br />\n\n                <label class="control centered control--checkbox">\n                  <input type="checkbox" class="chkAll" data-groupCode="'+c(i(null!=l[1]?l[1].code:l[1],e))+'" data-rolId="'+c(i(null!=e?e.id:e,e))+'" />\n                  <div class="control__indicator"></div>\n                </label>\n              </td>\n'},7:function(n,e,t,a,o,s,l){var i,c=n.lambda,d=n.escapeExpression;return'            <tr data-processCode="'+d(c(null!=e?e.codename:e,e))+'" data-processId="'+d(c(null!=e?e.id:e,e))+'" class="process">\n              <td style="width: 280px;"> ... '+d(c(null!=e?e.name:e,e))+"</td>\n"+(null!=(i=t.each.call(null!=e?e:n.nullContext||{},null!=l[2]?l[2].rolList:l[2],{name:"each",hash:{},fn:n.program(8,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:54,column:14},end:{line:61,column:23}}}))?i:"")+"            </tr>\n"},8:function(n,e,t,a,o,s,l){var i=n.lambda,c=n.escapeExpression;return'              <td class="process">\n                <label class="control nolabel control--checkbox">\n                  <input type="checkbox" class="permission" data-rolId="'+c(i(null!=e?e.id:e,e))+'" data-groupCode="'+c(i(null!=l[2]?l[2].code:l[2],e))+'" />\n                  <div class="control__indicator"></div>\n                </label>\n              </td>\n'},compiler:[8,">= 4.3.0"],main:function(n,e,t,a,o,s,l){var i,c=null!=e?e:n.nullContext||{};return(null!=(i=t.if.call(c,null!=e?e.isSuper:e,{name:"if",hash:{},fn:n.program(1,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:1,column:0},end:{line:16,column:7}}}))?i:"")+'<div class="panel-group novix-accordion">\n'+(null!=(i=t.each.call(c,null!=e?e.groups:e,{name:"each",hash:{},fn:n.program(4,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:18,column:2},end:{line:73,column:11}}}))?i:"")+"</div>"},useData:!0,useDepths:!0})},710:function(n,e,t){var a=t(690);n.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(n,e,t,a,o){var s,l=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,c=n.escapeExpression;return'<div class="abm-base-tmp '+c("function"==typeof(s=null!=(s=t.tmpClass||(null!=e?e.tmpClass:e))?s:i)?s.call(l,{name:"tmpClass",hash:{},data:o,loc:{start:{line:1,column:25},end:{line:1,column:37}}}):s)+' container-fluid mainTask" data-id="'+c("function"==typeof(s=null!=(s=t.id||(null!=e?e.id:e))?s:i)?s.call(l,{name:"id",hash:{},data:o,loc:{start:{line:1,column:73},end:{line:1,column:79}}}):s)+'" data-rel="'+c("function"==typeof(s=null!=(s=t.dataRel||(null!=e?e.dataRel:e))?s:i)?s.call(l,{name:"dataRel",hash:{},data:o,loc:{start:{line:1,column:91},end:{line:1,column:102}}}):s)+'" data-type="tab-content">\n    <div class="row">\n        <div class="col-sm-12">\n            <div class="box">\n                <div class="box-title">\n                    <h3><i class="fa fa-th-list"></i>'+c("function"==typeof(s=null!=(s=t.title||(null!=e?e.title:e))?s:i)?s.call(l,{name:"title",hash:{},data:o,loc:{start:{line:6,column:53},end:{line:6,column:62}}}):s)+'</h3>\n                    <div class="actions abm-top-options">\n                        <a href="#" class="btn btn-close"><i class="fa fa-times"></i></a>\n                    </div>\n                </div>\n        <div class="box-content nopadding abm-content">\n\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'},useData:!0})},725:function(n,e,t){var a=t(690);function o(n){return n&&(n.__esModule?n.default:n)}n.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(n,e,a,s,l){var i=null!=e?e:n.nullContext||{},c=n.escapeExpression;return'<form action="#" id="baseForm" method="POST" class=\'form-horizontal form-bordered form-validate\' novalidate="novalidate">\n    <div class="form-content">\n\n    </div>\n    <div class="submit form-actions col-sm-12">\n        <button type="submit" class="btn btn-primary btn-save">'+c(o(t(688)).call(i,"_save",{name:"L",hash:{},data:l,loc:{start:{line:6,column:63},end:{line:6,column:76}}}))+'</button>\n        <button type="button" class="btn btn-cancel">'+c(o(t(688)).call(i,"cancel",{name:"L",hash:{},data:l,loc:{start:{line:7,column:53},end:{line:7,column:67}}}))+"</button>\n    </div>\n</form>\n"},useData:!0})},747:function(n,e,t){"use strict";(function(a){var o,s=t(693);void 0===(o=function(){return a.Model.extend({list:function(n,e){var t=null!=n?"?company_id=".concat(n):"";(0,s.send)("groups/".concat(t),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},e)},get:function(n,e){(0,s.send)("groups/".concat(n,"/"),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},e)},update:function(n,e,t){(0,s.send)("groups/".concat(n,"/"),JSON.stringify(e),{type:"PUT",contentType:"application/json;charset=utf-8",dataType:"text"},t)},create:function(n,e){(0,s.send)("groups/",JSON.stringify(n),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},e)},delete:function(n,e){(0,s.send)("groups/".concat(n,"/"),null,{type:"DELETE"},e)},listPermissions:function(n){(0,s.send)("permissions/",null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},n)},updateGroupPermissions:function(n,e){(0,s.send)("groups/update_groups_permissions/",JSON.stringify(n),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},e)}})}.apply(e,[]))||(n.exports=o)}).call(this,t(218))}}]);