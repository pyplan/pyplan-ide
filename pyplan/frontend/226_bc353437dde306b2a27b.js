/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[226,281],{1033:function(t,e,n){"use strict";(function(r){var i,s,o=n(18),a=n(742);function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){c(t,e,n[e])}))}return t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e,n,r,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void n(t)}a.done?e(u):Promise.resolve(u).then(r,i)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){f(s,r,i,o,a,"next",t)}function a(t){f(s,r,i,o,a,"throw",t)}o(void 0)}))}}i=[n(716),n(909),n(220)],void 0===(s=function(t,e,i){var s;return t.extend({el:r("#n_o_n_e"),diagram:void 0,render:function(t){var e=this;this.baseRender(t),this.drawItem(),r(this.tagId).find(".dashAddRow").on("click",(function(){e.form.addNewRow()})),this.form.$el.on("onUpdateMetadata",(function(t,n){r(e.tagId).find(".item-title span.title").attr("title",n.name),r(e.tagId).find(".item-title span.title").text(n.name),e.setTitle(n.name)})),r(this.tagId).on("onFiltersChange",(function(t,n){var i=[];r.each(n,(function(t,e){if(e&&e.nodeFilterId){var n={};n.field=e.nodeFilterId,n.values=[],r.each(e.idxValues,(function(t,e){"All"===e.text?n.values.push([]):n.values.push({value:r.trim(e.text),selected:!0})})),i.push(n)}})),e.model.onFiltersChange(i)})),this.addMouseOverTitleHandler(r(this.tagId))},addMouseOverTitleHandler:function(t){var e,n=this;t.find(".knowledge-arrow").hover((function(t){return e=setTimeout((function(){n.showWorkflow(t)}),1e3),!1}),(function(){clearTimeout(e)}))},showWorkflow:(s=d(regeneratorRuntime.mark((function t(e){var r,i,s,c,f,m,p,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this.form.templateMetadata.workflowGroups&&this.form.templateMetadata.workflowGroups.length>0)){t.next=17;break}return t.next=3,(0,a.listTasksByGroupsIds)({groups_ids:this.form.templateMetadata.workflowGroups});case 3:if(!((r=t.sent)&&r.length>0)){t.next=17;break}if(i=void 0!==__currentSession.fromEmbedded&&__currentSession.fromEmbedded,s=r.map((function(t){var e=t.owner.id==__currentSession.userCompanyId,n=t.responsible.id==__currentSession.userCompanyId,r=t.subscribers.some((function(t){return t.id==__currentSession.userCompanyId}));return l({},t,{canEdit:e||(n||r)&&(0,o.haveAccess)("change_assigned_wftask")||(0,o.haveAccess)("change_company_wftask"),items:t.items.filter((function(t){return new Date(t.start)<=Date.now()&&new Date(t.end)>=Date.now()}))})})),!((c=s.filter((function(t){return t.items.length>0}))).length>0)){t.next=17;break}return t.next=11,Promise.all(c.map(function(){var t=d(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.listPosibleByFromStatusId)({id:e.items[0].status.id});case 2:return n=t.sent,r=[l({},e.items[0],{start:"".concat(e.items[0].start.substring(0,10)),end:"".concat(e.items[0].end.substring(0,10)),possibleStatuses:[e.items[0].status].concat(u(n.map((function(t){return t.to_status}))))})],t.abrupt("return",l({},e,{items:r}));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()));case 11:f=t.sent,m={tasks:f},p=this,h={title:(0,o.translate)("workflow"),workflow:m,workflowData:!0,content:"",left:e.clientX,top:e.clientY,className:"popover_workflow",workflowEnabled:!0,fromEmbedded:i,fromImputTemplate:!0,inputFormView:this,onSaveCallback:function(){p.form.drawTemplate(!0)}},n.e(14).then((function(){var t=[n(732)];(function(t){(new t).show(h,(function(t){}))}).apply(null,t)})).catch(n.oe);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)}),isDiagramView:function(){return!0},needRefresh:function(){return!0},refreshItemDash:function(){this.form.getTemplateData(),this.form.refreshFiltersToIndex()},drawItem:function(){this.options.model=new i;var t=this;r(this.tagId).find(".item-area").addClass("extrafullSize"),this.setDefaultOptions(),r(this.tagId).find(".item-area").empty(),this.form=new e(this.currentResult.itemProperties),this.form.setElement(r(this.tagId).find(".item-area")),this.form.render(this.tagId),r(this.tagId).on("setAddButton",(function(e){r(t.tagId).find("i.dashAddRow").show()}))},onRemoveItemView:function(){this.form&&(this.form.onRemoveView(),this.form=null)},updateSize:function(){r(this.tagId).find(".item-area").height(r(this.tagId).parent().height()-7),this.form&&this.form.onBaseResize()},setDefaultOptions:function(){this.currentResult.itemProperties?this.currentResult.itemProperties.diagramOptions?null==this.currentResult.itemProperties.diagramOptions.showBreadcrumb&&(this.currentResult.itemProperties.diagramOptions.showBreadcrumb=!0):this.currentResult.itemProperties.diagramOptions={showBreadcrumb:!0}:this.currentResult.itemProperties={diagramOptions:{showBreadcrumb:!0}}},updateProperties:function(t){t&&this.currentResult&&(this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions=r.extend(!0,this.currentResult.itemProperties.diagramOptions,t))},setTitle:function(t){this.currentResult&&this.currentResult.itemProperties&&this.currentResult.itemProperties.title&&(this.currentResult.itemProperties.title.text=t,this.currentResult.itemProperties.title.isCustom=!0)},getOptionsMenu:function(){var t=this,e={callback:function(e){switch(e){case"_full":t.fullScreen();break;case"_toggle_filters":t.form.toggleFilters();break;case"_workflow":t.form.showWorkflow(event);break;case"_showHistory":t.form.includeHistory=!t.form.includeHistory,t.form.getTemplateData()}},items:{_full:{type:"icon_text",name:(0,o.translate)("fullscreen"),iconClass:"fa fa-expand"},_toggle_filters:{type:"icon_text",name:(0,o.translate)("toggle_filters"),iconClass:"fa fa-filter"},sep1:"---------"}};return t.form.templateMetadata.enableHistoryChanges&&(e.items._showHistory={type:"icon_text",name:(0,o.translate)("task_history_show"),iconClass:"fa fa-exclamation-triangle"}),(0,o.haveAnyAccess)("LISTASSIGNEDWORKFLOWTASKS,LISTALLWORKFLOWTASKS")&&(e.items._workflow={type:"icon_text",name:(0,o.translate)("workflow"),iconClass:"fa fa-tasks"}),t.fromEmbedded&&(delete e.items._export,delete e.items.sep2,delete e.items._splitBy,delete e.items._knowledge,delete e.items._workflow,delete e.items._view_in_diagram),e},getRelatedNoQuery:function(){var t=[];if(this.form&&this.form.templateMetadata&&this.form.templateMetadata.filters){for(var e=[],n=0;n<this.form.templateMetadata.filters.length;n++){var i=this.form.templateMetadata.filters[n];i.nodeFilterId&&-1==e.indexOf(i.nodeFilterId)&&e.push(i.nodeFilterId)}if(e.length>0){var s=this.form;r.each(this.model.getItemsModel(),(function(n,i){if(i.currentResult&&i.currentResult.dims&&i.form!=s){var o=!1;r.each(i.currentResult.dims,(function(t,n){e.indexOf(n.field.split(".")[0])>=0&&(o=!0)})),o||r.each(i.currentResult.rows,(function(t,n){e.indexOf(n.field.split(".")[0])>=0&&(o=!0)})),o||r.each(i.currentResult.columns,(function(t,n){e.indexOf(n.field.split(".")[0])>=0&&(o=!0)})),o&&t.push(i.currentResult.nodeId)}})),s=null}}return t}})}.apply(e,i))||(t.exports=s)}).call(this,n(1))},754:function(t,e,n){"use strict";(function(r){var i,s=n(678);void 0===(i=function(){return r.Model.extend({url:"inputModule",defaults:{formsViewList:[]},get:function(t,e){(0,s.send)("inputModule/get/"+t,null,{type:"GET"},e)},list:function(t,e){(0,s.send)("inputTemplates/list/",null,{type:"GET"},t,e)},create:function(t,e){(0,s.send)("inputModule/create",t,{type:"POST"},e)},update:function(t,e){(0,s.send)("inputModule/update",t,{type:"PUT"},e)},delete:function(t,e){(0,s.send)("inputModule/delete/"+t,null,{type:"DELETE"},e)},getMetadata:function(t,e){(0,s.send)("inputTemplates/getMetadata/",{id:t},{type:"GET"},e)},generate:function(t,e){(0,s.send)("inputModule/generate/"+t,null,{type:"GET"},e)},getData:function(t,e){(0,s.send)("inputTemplates/getData/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8"},e)},setData:function(t,e,n){(0,s.send)("inputTemplates/setData/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8"},e,n)},getHistoryChanges:function(t,e){(0,s.send)("inputModule/getHistoryChanges",t,{type:"POST"},e)},addItemToModel:function(t){this.get("formsViewList").push(t)},getItemsModel:function(){return this.get("formsViewList")},getItemModel:function(t){var e,n=this.getItemsModel();for(e=0;e<n.length;e++)if(n[e].tagId==t)return n[e]},removeItemModel:function(t){var e,n=this.getItemsModel();for(e=0;e<n.length;e++)if(n[e].tagId==t.tagId){n.splice(e,1);break}this.set({formsViewList:n})},removeAllItemsModel:function(){this.set("formsViewList",[])},changeItemModel:function(t,e){this.removeItemModel(t),this.addItemToModel(e)},onClick:function(t,e,n,r){(0,s.send)("inputModule/onClick",{param1:t,param2:e},{type:"POST"},n,r)}})}.apply(e,[]))||(t.exports=i)}).call(this,n(219))}}]);