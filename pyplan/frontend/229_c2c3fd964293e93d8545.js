/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[229],{1961:function(n,t,e){"use strict";(function(a,o){var s,l,c=e(18);s=[e(783),e(709),e(723),e(1962)],void 0===(l=function(n,t,s,l){return a.View.extend({el:o("#main"),_uId:"",groupPermissions:[],processLength:null,render:function(){var a=this;o('div[data-rel="abm-permissions-group"]').remove();var i=new n;this._uId=o.uuid();var r=this.options.companyId,d=new Promise(function(n,t){i.listPermissions(function(t){a.processLength=t.length,i.list(r,function(e){n({groupList:e,permissions:t})})})}),p=new Promise(function(n,t){e.e(24).then(function(){var t=[e(725)];(function(t){(new t).list(function(t){n(t.results)})}).apply(null,t)}).catch(e.oe)});Promise.all([d,p]).then(function(n){var e=n[0].groupList,i=n[0].permissions,r=n[1],d={id:a._uId,dataRel:"abm-permissions-group",tmpClass:"rol-edit",title:(0,c.translate)("permissionsByGroup")},p={groups:a.prepareProcess(i),rolList:e,companyList:r,isSuper:__currentSession.userIsSuperUser},u=t(d),m=s(),h=l(p);a.$el.append(u);var f=o("div[data-id='".concat(a._uId,"']"));f.find("div.abm-content").append(m),f.find("div.form-content").append(h),f.find("form").removeClass("form-bordered"),f.find(".submit.form-actions").remove(),(0,c.postRender)(f),a.initCheckboxes(f,e),a.addHandlers(f),__currentSession.userIsSuperUser&&a.options.companyId&&f.find(".selCompany").select2("val",a.options.companyId)})},prepareProcess:function(n){var t=[],e={};for(var a in n.forEach(function(n){var t=n.content_type.model;e[t]?e[t].process.push(n):(e[t]={code:n.content_type.model,name:n.content_type.model,process:[]},e[t].process.push(n))}),e)t.push(e[a]);return t},save:function(){this.groupPermissions.length>0&&(new n).updateGroupPermissions(this.groupPermissions,function(){})},cancel:function(){var n=o("#currentTask").attr("data-rel");Promise.resolve().then(function(){var t=[e(684)];(function(t){(new t).removeTask(n)}).apply(null,t)}).catch(e.oe)},addHandlers:function(t){t.find("form").on("submit",o.proxy(function(){return this.save(),!1},this)),t.find("div.submit button.btn-cancel").on("click",o.proxy(function(){return this.cancel(),!1},this)),t.find("div.abm-top-options a.btn-close").on("click",this.cancel);var a=this;t.find(".selCompany").on("change",function(){var n=o(this).select2("val");Promise.resolve().then(function(){var t=[e(776)];(function(t){(new t).showPermisionsByGroup(n)}).apply(null,t)}).catch(e.oe)}),t.find('input[class!="chkAll"].permission').on("click",function(){var t=o(this).attr("data-rolId"),e=o(this).closest("tr").attr("data-processId");a.groupPermissions={group_id:t,permissions:[e]},(new n).updateGroupPermissions(a.groupPermissions,function(){a.groupPermissions={}})}),t.find('input[class="permission"]').on("click",function(){var n=o(this).attr("data-groupcode"),t=o(this).attr("data-rolid"),e=o("input[data-rolId='".concat(t,"'][data-groupcode='").concat(n,"'].permission:checked")).length===o("input[data-rolId='".concat(t,"'][data-groupcode='").concat(n,"'].permission")).length;o("input[class='chkAll'][data-groupcode='".concat(n,"'][data-rolId='").concat(t,"']")).prop("checked",e)}),t.find('input[class="chkAll"]').on("click",function(){var e,s=o(this).prop("checked"),l=o(this).attr("data-rolId"),c=o(this).attr("data-groupCode");t.find("tbody input[class!='chkAll'][data-groupCode='".concat(c,"'][data-rolId='").concat(l,"']")).each(function(n,t){s?o(this).prop("checked")||o(this).prop("checked","checked"):o(this).prop("checked")&&o(this).prop("checked","")}),a.groupPermissions={group_id:l,permissions:[],check_all:s},o.each(o("input[class!='chkAll'][data-groupcode='".concat(c,"'][data-rolId='").concat(l,"']")),function(n,t){e=o(t).closest("tr").attr("data-processId"),a.groupPermissions.permissions.push(e)}),(new n).updateGroupPermissions(a.groupPermissions,function(){a.groupPermissions={}})})},initCheckboxes:function(n,t){t.forEach(function(t){var e=t.id;t.permissions.forEach(function(t){var a=t.codename;n.find("tr[data-processCode='".concat(a,"'] input[data-rolId='").concat(e,"']")).prop("checked","checked");var s=t.content_type.model;o("input[data-rolId='".concat(e,"'][data-groupcode='").concat(s,"'].permission:checked")).length===o("input[data-rolId='".concat(e,"'][data-groupcode='").concat(s,"'].permission")).length&&o("input[class='chkAll'][data-groupcode='".concat(s,"'][data-rolId='").concat(e,"']")).prop("checked",!0)})})}})}.apply(t,s))||(n.exports=l)}).call(this,e(218),e(1))},1962:function(n,t,e){var a=e(690);n.exports=(a.default||a).template({1:function(n,t,a,o,s){var l,c=null!=t?t:n.nullContext||{};return'<div class="row" style="margin-top: 15px; margin-bottom: 15px;">\n  <div class="col-sm-10">\n    <span style="float: left; padding-top: 5px; font-weight: bold;">'+n.escapeExpression(function(n){return n&&(n.__esModule?n.default:n)}(e(688)).call(c,"_company",{name:"L",hash:{},data:s,loc:{start:{line:4,column:68},end:{line:4,column:84}}}))+'</span>\n    <div class="col-sm-10">\n      <div class="col-sm-4">\n        <select class="select2-me selCompany" style="width: 100%;">\n'+(null!=(l=a.each.call(c,null!=t?t.companyList:t,{name:"each",hash:{},fn:n.program(2,s,0),inverse:n.noop,data:s,loc:{start:{line:8,column:10},end:{line:10,column:19}}}))?l:"")+"        </select>\n      </div>\n    </div>\n  </div>\n</div>\n"},2:function(n,t,e,a,o){var s=n.lambda,l=n.escapeExpression;return'          <option value="'+l(s(null!=t?t.id:t,t))+'">'+l(s(null!=t?t.name:t,t))+"</option>\n"},4:function(n,t,e,a,o,s,l){var c,i=n.lambda,r=n.escapeExpression,d=null!=t?t:n.nullContext||{};return'  <div class="panel panel-default">\n    <div class="panel-heading">\n      <h4 class="panel-title">\n        <a href="#'+r(i(null!=t?t.code:t,t))+'" data-toggle="collapse" data-parent="#ac4" class="collapsed">\n          '+r(i(null!=t?t.name:t,t))+'\n        </a>\n      </h4>\n      \x3c!-- /.panel-title --\x3e\n    </div>\n    \x3c!-- /.panel-heading --\x3e\n    <div id="'+r(i(null!=t?t.code:t,t))+'" class="panel-collapse collapse" style="height: 0px;">\n      <div class="panel-body">\n\n\n        <table class="table table-hover table-condensed processByRol">\n          <tbody>\n            <tr data-groupCode="'+r(i(null!=t?t.code:t,t))+'" class="group">\n              <td>\n                <strong></strong>\n              </td>\n'+(null!=(c=e.each.call(d,null!=l[1]?l[1].rolList:l[1],{name:"each",hash:{},fn:n.program(5,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:39,column:14},end:{line:48,column:23}}}))?c:"")+"            </tr>\n\n"+(null!=(c=e.each.call(d,null!=t?t.process:t,{name:"each",hash:{},fn:n.program(7,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:51,column:12},end:{line:63,column:21}}}))?c:"")+"          </tbody>\n        </table>\n\n\n      </div>\n      \x3c!-- /.panel-body --\x3e\n    </div>\n    \x3c!-- /#c1.panel-collapse collapse in --\x3e\n  </div>\n"},5:function(n,t,e,a,o,s,l){var c=n.lambda,i=n.escapeExpression;return'              <td class="group text-center">\n                '+i(c(null!=t?t.name:t,t))+' <br />\n\n                <label class="control centered control--checkbox">\n                  <input type="checkbox" class="chkAll" data-groupCode="'+i(c(null!=l[1]?l[1].code:l[1],t))+'" data-rolId="'+i(c(null!=t?t.id:t,t))+'" />\n                  <div class="control__indicator"></div>\n                </label>\n              </td>\n'},7:function(n,t,e,a,o,s,l){var c,i=n.lambda,r=n.escapeExpression;return'            <tr data-processCode="'+r(i(null!=t?t.codename:t,t))+'" data-processId="'+r(i(null!=t?t.id:t,t))+'" class="process">\n              <td style="width: 280px;"> ... '+r(i(null!=t?t.name:t,t))+"</td>\n"+(null!=(c=e.each.call(null!=t?t:n.nullContext||{},null!=l[2]?l[2].rolList:l[2],{name:"each",hash:{},fn:n.program(8,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:54,column:14},end:{line:61,column:23}}}))?c:"")+"            </tr>\n"},8:function(n,t,e,a,o,s,l){var c=n.lambda,i=n.escapeExpression;return'              <td class="process">\n                <label class="control nolabel control--checkbox">\n                  <input type="checkbox" class="permission" data-rolId="'+i(c(null!=t?t.id:t,t))+'" data-groupCode="'+i(c(null!=l[2]?l[2].code:l[2],t))+'" />\n                  <div class="control__indicator"></div>\n                </label>\n              </td>\n'},compiler:[8,">= 4.3.0"],main:function(n,t,e,a,o,s,l){var c,i=null!=t?t:n.nullContext||{};return(null!=(c=e.if.call(i,null!=t?t.isSuper:t,{name:"if",hash:{},fn:n.program(1,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:1,column:0},end:{line:16,column:7}}}))?c:"")+'<div class="panel-group novix-accordion">\n'+(null!=(c=e.each.call(i,null!=t?t.groups:t,{name:"each",hash:{},fn:n.program(4,o,0,s,l),inverse:n.noop,data:o,loc:{start:{line:18,column:2},end:{line:73,column:11}}}))?c:"")+"</div>"},useData:!0,useDepths:!0})},709:function(n,t,e){var a=e(690);n.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(n,t,e,a,o){var s,l=null!=t?t:n.nullContext||{},c=n.hooks.helperMissing,i=n.escapeExpression;return'<div class="abm-base-tmp '+i("function"==typeof(s=null!=(s=e.tmpClass||(null!=t?t.tmpClass:t))?s:c)?s.call(l,{name:"tmpClass",hash:{},data:o,loc:{start:{line:1,column:25},end:{line:1,column:37}}}):s)+' container-fluid mainTask" data-id="'+i("function"==typeof(s=null!=(s=e.id||(null!=t?t.id:t))?s:c)?s.call(l,{name:"id",hash:{},data:o,loc:{start:{line:1,column:73},end:{line:1,column:79}}}):s)+'" data-rel="'+i("function"==typeof(s=null!=(s=e.dataRel||(null!=t?t.dataRel:t))?s:c)?s.call(l,{name:"dataRel",hash:{},data:o,loc:{start:{line:1,column:91},end:{line:1,column:102}}}):s)+'" data-type="tab-content">\n    <div class="row">\n        <div class="col-sm-12">\n            <div class="box">\n                <div class="box-title">\n                    <h3><i class="fa fa-th-list"></i>'+i("function"==typeof(s=null!=(s=e.title||(null!=t?t.title:t))?s:c)?s.call(l,{name:"title",hash:{},data:o,loc:{start:{line:6,column:53},end:{line:6,column:62}}}):s)+'</h3>\n                    <div class="actions abm-top-options">\n                        <a href="#" class="btn btn-close"><i class="fa fa-times"></i></a>\n                    </div>\n                </div>\n        <div class="box-content nopadding abm-content">\n\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'},useData:!0})},723:function(n,t,e){var a=e(690);function o(n){return n&&(n.__esModule?n.default:n)}n.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(n,t,a,s,l){var c=null!=t?t:n.nullContext||{},i=n.escapeExpression;return'<form action="#" id="baseForm" method="POST" class=\'form-horizontal form-bordered form-validate\' novalidate="novalidate">\n    <div class="form-content">\n\n    </div>\n    <div class="submit form-actions col-sm-12">\n        <button type="submit" class="btn btn-primary btn-save">'+i(o(e(688)).call(c,"_save",{name:"L",hash:{},data:l,loc:{start:{line:6,column:63},end:{line:6,column:76}}}))+'</button>\n        <button type="button" class="btn btn-cancel">'+i(o(e(688)).call(c,"cancel",{name:"L",hash:{},data:l,loc:{start:{line:7,column:53},end:{line:7,column:67}}}))+"</button>\n    </div>\n</form>\n"},useData:!0})},783:function(n,t,e){"use strict";(function(a){var o,s=e(693);void 0===(o=function(){return a.Model.extend({list:function(n,t){var e=null!=n?"?company_id=".concat(n):"";(0,s.send)("groups/".concat(e),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},t)},get:function(n,t){(0,s.send)("groups/".concat(n,"/"),null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},t)},update:function(n,t,e){(0,s.send)("groups/".concat(n,"/"),JSON.stringify(t),{type:"PUT",contentType:"application/json;charset=utf-8",dataType:"text"},e)},create:function(n,t){(0,s.send)("groups/",JSON.stringify(n),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},t)},delete:function(n,t){(0,s.send)("groups/".concat(n,"/"),null,{type:"DELETE"},t)},listPermissions:function(n){(0,s.send)("permissions/",null,{type:"GET",contentType:"application/json;charset=utf-8",dataType:"text"},n)},updateGroupPermissions:function(n,t){(0,s.send)("groups/update_groups_permissions/",JSON.stringify(n),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},t)}})}.apply(t,[]))||(n.exports=o)}).call(this,e(218))}}]);