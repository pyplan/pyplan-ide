/*! Copyright Novix S.A. 2019. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[256,3,33],{1341:function(e,t,n){"use strict";(function(a,s){var l,o,r=n(18);l=[n(683),n(707),n(2073),n(2074)],void 0===(o=function(e,t,n,l){return a.View.extend({el:s("#main"),render:function(a){var o=this;o.fromDashboard=!1;var i=void 0,u=!1,d=void 0,c="New task";null!==a&&(o.fromDashboard=!!a.fromDashboard,a.id&&(u=!0,c=a.taskTitle));var p=function(){(new Date).add("d",1);var p=i;d&&(p.histories=d,p.hasHistory=!0);var f=n();(new e).show({title:c,html:f,modalClass:"mediumModal",buttons:[{title:(0,r.translate)("close"),code:"close"}],callback:function(e,t){if("yes"===e){if(!t.find("form").valid())return!1;i&&i.taskId,t.find("input[data-id='name']").val(),t.find("textarea[data-id='description']").val(),parseInt(t.find("select[data-id='code']").val()),t.find("input[data-id='start']").val(),t.find("input[data-id='end']").val(),t.find("input[data-id='progress']").val(),parseInt(t.find("select[data-id='user']").val()),t.find("select[data-id='status']").val(),t.find("textarea[data-id='comment']").val(),t.find("select[data-id='relatedUsers']").chosen().val()}},onLoad:function(e){setTimeout(function(){var n=l(p);e.find("ul.timeline").append(n),s(".ganttTaskEditorHistory").scrollTop(s(".ganttTaskEditorHistory").prop("scrollHeight"));var c=(0,r.haveAccess)("BYPASSWORKFLOWTASKTRANSITIONS");if(i){var f=s("form[id='taskForm']"),m=(0,r.haveAccess)("UPDATEALLWORKFLOWTASKS"),h=(0,r.haveAccess)("UPDATEMYWORKFLOWTASK"),v=(0,r.haveAccess)("UPDATEASSIGNEDWORKFLOWTASKS"),k=parseInt(i.ownerId)===__currentSession.loginId,y=i.userId===__currentSession.loginId;m||(k?h||y&&v||f.find('input, textarea, button[data-code="yes"], select').attr("disabled","disabled"):y&&v||f.find('input, textarea, button[data-code="yes"], select').attr("disabled","disabled"))}else c||e.find("select[data-id='status']").attr("disabled",!0);e.find(".txtComment").on("change, keyup",function(){""===s(this).val()?e.find(".btnSendComment").enable(!1):e.find(".btnSendComment").enable(!0)}),e.find(".btnSendComment").on("click",function(){var n=new t,r=e.find(".txtComment").val(),c={taskId:a.id,comment:r};u&&n.createComment(c,function(t){e.find(".txtComment").val(""),n.getTask(a.id,function(t){i=t,d=o.createHistory(t);var n=l({histories:d});e.find("ul.timeline").empty(),e.find("ul.timeline").append(n),s(".ganttTaskEditorHistory").scrollTop(s(".ganttTaskEditorHistory").prop("scrollHeight"))})})})},500),(0,r.postRender)(e)},onClose:function(e){o.destroy(e)}})};u?(new t).getTask(a.id,function(e){i=e,d=o.createHistory(e),p()}):p()},createHistory:function(e){var t;if(e&&e.history&&e.comments&&(e.history.length>0||e.comments.length>0)){t=[];for(var n=-1,a=0;a<e.history.length;a++){var s=e.history[a].date.substring(0,10),l=e.history[a].date,o={};if(0==a)o.historyDate=s,o.items=[{created:!0,userFullName:e.history[a].userFullName,taskUserFullName:e.history[a].taskUserFullName}],t.push(o),n=e.history[a].taskUserId;else{for(var r=!1,i=0;i<t.length;i++)if(t[i].historyDate==s){o=t[i],r=!0;break}r||(o.historyDate=s,o.items=[],t.push(o)),e.history[a].percent>0&&o.items.push({fullDate:l,userFullName:e.history[a].userFullName,changePercent:!0,percent:e.history[a].percent}),e.history[a].stateId>0&&o.items.push({fullDate:l,userFullName:e.history[a].userFullName,changeState:!0,stateName:e.history[a].stateName}),"0001-01-01"!=e.history[a].startDate.substring(0,10)&&o.items.push({fullDate:l,userFullName:e.history[a].userFullName,changeStartDate:!0,startDate:e.history[a].startDate}),"0001-01-01"!=e.history[a].endDate.substring(0,10)&&o.items.push({fullDate:l,userFullName:e.history[a].userFullName,changeEnbDate:!0,endDate:e.history[a].endDate}),n!=e.history[a].taskUserId&&(n=e.history[a].taskUserId,o.items.push({fullDate:l,userFullName:e.history[a].userFullName,changeResponsible:!0,taskUserFullName:e.history[a].taskUserFullName}))}}for(a=0;a<e.comments.length;a++){for(s=e.comments[a].date.substring(0,10),l=e.comments[a].date,r=!1,o={},i=0;i<t.length;i++)if(t[i].historyDate==s){o=t[i],r=!0;break}if(!r){o.historyDate=s,o.items=[];var u=0;for(i=0;i<t.length&&(u=i,!(s<t[i].historyDate));i++);t.splice(u,0,o)}var d={fullDate:l,addComment:!0,comment:e.comments[a].comment,userFullName:e.comments[a].userFullName},c=!1;for(i=0;i<o.items.length;i++){var p=o.items[i];if(d.fullDate<=p.fullDate){o.items.splice(i,0,d),c=!0;break}}c||o.items.push(d)}}return t},destroy:function(e){e.find("input[data-id='code']").select2("destroy"),e.find(".datepick").datepicker("remove")}})}.apply(t,l))||(e.exports=o)}).call(this,n(218),n(1))},2073:function(e,t,n){var a=n(690);e.exports=(a.default||a).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,a,s){return'<div class="box">\n\n  <div class="box-content nopadding">\n\n      <div class="tab-content padding tab-content-inline tab-content-bottom">\n\n\n          <div class="ganttTaskEditorHistory tab-pane active" id="workflowTaskHistoryTab" >\n            \n            <ul class="timeline">\n\n              \n                \n             </ul>\n\n        </div>\n\n      </div>\n\n      <div class="row">\n        <div class="col-sm-11">\n          <textarea class="form-control txtComment" placeholder="Add a comment here..."></textarea>\n        </div>\n        <div class="col-sm-1">\n          <button class="btn btn-primary btnSendComment" disabled="disabled">Send</button>\n        </div>\n      </div>\n  </div>\n</div>\n'},useData:!0})},2074:function(e,t,n){var a=n(690);function s(e){return e&&(e.__esModule?e.default:e)}e.exports=(a.default||a).template({1:function(e,t,a,l,o){var r,i=null!=t?t:e.nullContext||{};return'\n                    <li>\n\n                        <div class="timeline-content">\n                    \n                    <div class="left">\n                                <div class="date">'+e.escapeExpression(s(n(781)).call(i,null!=t?t.historyDate:t,{name:"formatDate",hash:{},data:o}))+'</div>\n                            </div>\n\n                            <div class="activity">\n\n'+(null!=(r=a.each.call(i,null!=t?t.items:t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o}))?r:"")+'                            </div>\n                        </div>\n\n                       <div class="line"></div>\n\n                  </li>\n\n'},2:function(e,t,n,a,s){var l,o=null!=t?t:e.nullContext||{};return'\n                                    <div class="user">\n\n                              <span class="user">'+e.escapeExpression(e.lambda(null!=t?t.userFullName:t,t))+"</span>\n"+(null!=(l=n.if.call(o,null!=t?t.created:t,{name:"if",hash:{},fn:e.program(3,s,0),inverse:e.noop,data:s}))?l:"")+(null!=(l=n.if.call(o,null!=t?t.addComment:t,{name:"if",hash:{},fn:e.program(5,s,0),inverse:e.noop,data:s}))?l:"")+(null!=(l=n.if.call(o,null!=t?t.changeState:t,{name:"if",hash:{},fn:e.program(7,s,0),inverse:e.noop,data:s}))?l:"")+(null!=(l=n.if.call(o,null!=t?t.changePercent:t,{name:"if",hash:{},fn:e.program(9,s,0),inverse:e.noop,data:s}))?l:"")+(null!=(l=n.if.call(o,null!=t?t.changeStartDate:t,{name:"if",hash:{},fn:e.program(11,s,0),inverse:e.noop,data:s}))?l:"")+(null!=(l=n.if.call(o,null!=t?t.changeEnbDate:t,{name:"if",hash:{},fn:e.program(13,s,0),inverse:e.noop,data:s}))?l:"")+(null!=(l=n.if.call(o,null!=t?t.changeResponsible:t,{name:"if",hash:{},fn:e.program(15,s,0),inverse:e.noop,data:s}))?l:"")+"                                    </div>\n\n                                      \x3c!--"+(null!=(l=n.if.call(o,null!=t?t.addComment:t,{name:"if",hash:{},fn:e.program(17,s,0),inverse:e.noop,data:s}))?l:"")+"--\x3e\n"},3:function(e,t,a,l,o){var r=e.escapeExpression;return"                                  <span>"+r(s(n(688)).call(null!=t?t:e.nullContext||{},"task_history_created",{name:"L",hash:{},data:o}))+'</span>\n                                  <span class="user">'+r(e.lambda(null!=t?t.taskUserFullName:t,t))+"</span>\n"},5:function(e,t,n,a,s){return'                                  : <span class="comment">'+e.escapeExpression(e.lambda(null!=t?t.comment:t,t))+"</span>\n"},7:function(e,t,a,l,o){var r=e.escapeExpression;return"                                  <span>"+r(s(n(688)).call(null!=t?t:e.nullContext||{},"task_history_change_state",{name:"L",hash:{},data:o}))+'</span><span class="data"> '+r(e.lambda(null!=t?t.stateName:t,t))+"</span>\n"},9:function(e,t,a,l,o){var r=e.escapeExpression;return"                                  <span>"+r(s(n(688)).call(null!=t?t:e.nullContext||{},"task_history_change_percent",{name:"L",hash:{},data:o}))+'</span><span class="data"> '+r(e.lambda(null!=t?t.percent:t,t))+"%</span>\n"},11:function(e,t,a,l,o){var r=null!=t?t:e.nullContext||{},i=e.escapeExpression;return"                                  <span>"+i(s(n(688)).call(r,"task_history_change_startdate",{name:"L",hash:{},data:o}))+'</span><span class="data"> '+i(s(n(781)).call(r,null!=t?t.startDate:t,{name:"formatDate",hash:{},data:o}))+"</span>\n"},13:function(e,t,a,l,o){var r=null!=t?t:e.nullContext||{},i=e.escapeExpression;return"                                  <span>"+i(s(n(688)).call(r,"task_history_change_enddate",{name:"L",hash:{},data:o}))+'</span><span class="data"> '+i(s(n(781)).call(r,null!=t?t.endDate:t,{name:"formatDate",hash:{},data:o}))+"</span>\n"},15:function(e,t,a,l,o){var r=e.escapeExpression;return"                                  <span>"+r(s(n(688)).call(null!=t?t:e.nullContext||{},"task_history_change_responsible",{name:"L",hash:{},data:o}))+'</span><span class="user"> '+r(e.lambda(null!=t?t.taskUserFullName:t,t))+"</span>\n"},17:function(e,t,n,a,s){return"\n                                           <p>"+e.escapeExpression(e.lambda(null!=t?t.comment:t,t))+"</p>\n                                      "},compiler:[7,">= 4.0.0"],main:function(e,t,n,a,s){var l;return null!=(l=n.each.call(null!=t?t:e.nullContext||{},null!=t?t.histories:t,{name:"each",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?l:""},useData:!0})},683:function(e,t,n){"use strict";(function(a){var s;void 0===(s=function(){return a.Controller.extend({name:"showModal",show:function(e){Promise.all([n.e(2),n.e(118)]).then(function(){var t=[n(701)];(function(t){(new t).render(e)}).apply(null,t)}).catch(n.oe)}})}.apply(t,[]))||(e.exports=s)}).call(this,n(694))},707:function(e,t,n){"use strict";(function(a){var s,l=n(693);void 0===(s=function(){return a.Model.extend({url:"myFileManager",getWorkflow:function(e,t){var n="Workflow/getWorkflow";e&&(n="Workflow/getWorkflow/"+e),(0,l.send)(n,null,{type:"GET"},t)},createTask:function(e,t){(0,l.send)("Workflow/createTask",e,{type:"POST"},t)},updateTask:function(e,t){(0,l.send)("Workflow/updateTask",e,{type:"PUT"},t)},updateTasksProperty:function(e,t){(0,l.send)("Workflow/updateTasksProperty",e,{type:"PUT"},t)},deleteTask:function(e,t){(0,l.send)("Workflow/deleteTask/"+e,null,{type:"DELETE"},t)},getTask:function(e,t){(0,l.send)("Workflow/getTask/"+e,null,null,t)},createState:function(e,t){(0,l.send)("Workflow/createState/",e,{type:"POST"},t)},listStates:function(e){(0,l.send)("Workflow/listStates",null,{type:"GET"},e)},getState:function(e,t){(0,l.send)("Workflow/getState/"+e,null,{type:"GET"},t)},updateState:function(e,t){(0,l.send)("Workflow/updateState",e,{type:"PUT"},t)},deleteState:function(e,t){(0,l.send)("Workflow/deleteState/"+e,null,{type:"DELETE"},t)},listTransitions:function(e){(0,l.send)("Workflow/listTransitions",null,{type:"GET"},e)},createTransition:function(e,t){(0,l.send)("Workflow/createTransition",e,{type:"POST"},t)},updateTransition:function(e,t){(0,l.send)("Workflow/updateTransition",e,{type:"PUT"},t)},deleteTransition:function(e,t){(0,l.send)("Workflow/deleteTransition/"+e,null,{type:"DELETE"},t)},listUsers:function(e){(0,l.send)("Workflow/listUsers",null,null,e)},getTaskGroup:function(e,t){(0,l.send)("Workflow/getTaskGroup/"+e,null,{type:"GET"},t)},listTaskGroups:function(e){(0,l.send)("Workflow/listTaskGroups",null,{type:"GET"},e)},createTaskGroup:function(e,t){(0,l.send)("Workflow/createTaskGroup",e,{type:"POST"},t)},updateTaskGroup:function(e,t){(0,l.send)("Workflow/updateTaskGroup",e,{type:"PUT"},t)},deleteTaskGroup:function(e,t){(0,l.send)("Workflow/DeleteTaskGroup/"+e,null,{type:"DELETE"},t)},updateOrder:function(e,t){(0,l.send)("Workflow/ChangeOrder",{values:e},{type:"PUT"},t)},updateRolTransitions:function(e,t){(0,l.send)("Workflow/updateRolTransitions",e,{type:"PUT"},t)},getWorkflowByGroups:function(e,t){(0,l.send)("Workflow/getWorkflowByGroups/",{values:e},{type:"POST"},t)},createComment:function(e,t){(0,l.send)("Workflow/createComment/",e,{type:"POST"},t)}})}.apply(t,[]))||(e.exports=s)}).call(this,n(218))},781:function(e,t,n){"use strict";var a=n(18);e.exports=function(e){return(0,a.formatDate)(e)}}}]);