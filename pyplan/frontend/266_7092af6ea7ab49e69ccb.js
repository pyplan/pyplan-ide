/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[266,307],{2056:function(t,a,n){"use strict";(function(s,e,i){var l,o,r=n(18);function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}l=[n(684),n(746),n(739),n(2057),n(2058)],void 0===(o=function(t,a,l,o,u){return s.View.extend({el:e("#main"),_uId:"",autorefreshTimeout:-1,autorefreshStateTimeout:-1,permisions:[],processLength:null,taskSchedulerModel:new l,taskSchedulerController:new a,currentSession:0,render:function(){e("div[data-rel='tasks-log']").remove();var a=new t;a.addTask("tasks-log",(0,r.translate)("Tasks Log"));var n=this;this._uId=e.uuid(),this.taskSchedulerModel.getTask(n.options.taskQuery.periodic_task_id,function(t){a.hideAllTasks(),a.selectTask("tasks-log"),n.options.taskName=t.name,n.options.taskQuery&&t.params&&t.params.length>0&&(n.options.taskQuery.hasParam="true");var s=t.name,l=4===t.scheduleRunType?(0,r.translate)("_manual"):(0,r.translate)("_planned"),d=t.next_execution?i(t.next_execution).format("MM/DD/YYYY h:mm:ss a"):"N/A",u={id:n._uId,dataRel:"tasks-log",tmpClass:"tasks-log",title:n.options.title,taskName:s,createdBy:t.created_by,runPolicy:l,nextExecution:d,statusInfo:n.getStatusInfo(t,!1),browserTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone},c=o(u);function p(){var t=e(window).height();n.h=t-300,e("div[data-id='"+n._uId+"']").find(".dataTables_scrollBody").css("height",n.h+"px"),e("div[data-id='"+n._uId+"']").find(".dataTables_scrollBody").css("max-height",n.h+"px")}n.$el.append(c),n.searching=!0,n.pageSize=99999999,n.negativePageSize=-100,n.currentFrom=1,n.listLog(),n.updateStatus(),e(window).resize(p),p(),n.addHandlers(e("div[data-id='"+n._uId+"']")),e("div[data-id='"+n._uId+"']").find(".dataTables_paginate .paginate_button").on("click",function(t){var a=n.pageSize;a=e(this).hasClass("next")?n.pageSize:n.negativePageSize,n.currentFrom+=a,n.listLog(),n.updateStatus()}),e("div[data-id='"+n._uId+"']").find(".btnAutoRefresh").on("click",function(){e(this).toggleClass("checkbox-active"),e(this).find("i").toggleClass("fa-square"),e(this).hasClass("checkbox-active")&&(n.listLog(),n.updateStatus())}),e("div[data-id='"+n._uId+"']").on("removeView",function(){n.onRemoveView()})})},onRemoveView:function(){clearTimeout(this.autorefreshTimeout),clearTimeout(this.autorefreshStateTimeout),this.permisions=null,this.taskSchedulerModel=null,this.taskSchedulerController=null},listLog:function(){var t=this,a=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1&&void 0!==arguments[1]?arguments[1]:null);clearTimeout(this.autorefreshTimeout);var n=e(".mainTask[data-rel='tasks-log']"),s=e("div[data-id='"+this._uId+"'] .btnAutoRefresh");if(n.is(":visible")&&s.hasClass("checkbox-active")){e("div[data-id='"+this._uId+"']").find(".dataTables_paginate").find(".paginate_button").prop("disabled","disabled"),this.currentFrom<this.pageSize&&(this.currentFrom=1);var i=e("div[data-id='"+this._uId+"']").find("table");if(this.options.taskQuery.from=this.currentFrom,this.options.taskQuery.to=this.currentFrom+(this.pageSize-1),this.options.taskQuery.scheduleTaskSessionId=this.currentSession,this.options.taskQuery.scheduleStateType=this.currentStatusFilter,null!==a){var l=i.DataTable();l.clear(),l.destroy(),i.find("tbody").empty();var o=this.formatLog(a);this.searching=!1,this.renderItems(o)}else this.taskSchedulerModel.getTaskLog(this.options.taskQuery,function(a){var n=i.DataTable();n.clear(),n.destroy(),i.find("tbody").empty();var s=t.formatLog(a);t.searching=!1,t.renderItems(s),a&&(a[0].is_running?t.autorefreshTimeout=setTimeout(function(){t.listLog(!0),t.updateStatus()},7e3):t.updateStatus())})}},renderItems:function(t){var a=u({data:t}),n=e("div[data-id='"+this._uId+"']").find("table");n.find("tbody").append(a),this.instanceTable();var s=e("div[data-id='"+this._uId+"']").find(".dataTables_paginate");s.hide(),t&&t.total&&t.total>this.pageSize&&(t.from>1?s.find(".previous").removeAttr("disabled").removeClass("disabled"):s.find(".previous").prop("disabled","disabled").addClass("disabled"),t.to<t.total?s.find(".next").removeAttr("disabled").removeClass("disabled"):(t.to=t.total,s.find(".next").prop("disabled","disabled").addClass("disabled")),s.find("span[data-key='from']").text(t.from),s.find("span[data-key='to']").text(t.to),s.find("span[data-key='of']").text(t.total),s.show());var i=n.find("tr:last").position();e("div[data-id='"+this._uId+"']").find(".logTableWrapper .dataTables_scrollBody").scrollTop(i.top)},instanceTable:function(){var t=e("div[data-id='"+this._uId+"']").find("table"),a=e(window).height();a-=300,e("div[data-id='"+this._uId+"']").find(".dataTables_scrollBody").css("height",a+"px"),e("div[data-id='"+this._uId+"']").find(".dataTables_scrollBody").css("max-height",a+"px"),t.DataTable({searching:!1,paging:!1,ordering:!1,info:!1,scrollY:a,scrollCollapse:!0})},run:function(t,a){var s=(a=a).options.taskQuery.periodic_task_id,i=a.options.taskQuery.hasParam,o=new l;"true"===i?n.e(89).then(function(){var t=[n(1343)];(function(t){(new t).render(s,a,a.onRunWithParams)}).apply(null,t)}).catch(n.oe):o.runTask({periodic_task_id:s},function(t){if(t){var n=e("div[data-id='"+a._uId+"'] .currentTaskStatus");n.html("Running"),n.attr("class","currentTaskStatus label label-warning"),e("div[data-id='"+a._uId+"'] .lastDescription").text(""),a.listLog(!0)}})},stop:function(t,a){var n=(a=a).options.taskQuery.periodic_task_id;a=this;(new l).stopTask(n,function(t){t&&(e("div[data-id='"+a._uId+"'] .currentTaskStatus").html("please_wait"),e("div[data-id='"+a._uId+"'] .btn-run-task").hide(),e("div[data-id='"+a._uId+"'] .btn-stop-task").hide(),a.updateStatus())})},onRunWithParams:function(t,a){a=a;var n=t.id;(new l).runTask({periodic_task_id:n},function(t){if(t){var n=e("div[data-id='"+a._uId+"'] .currentTaskStatus");n.html("Running"),n.attr("class","currentTaskStatus label label-warning"),a.listLog(!0)}})},downloadLog:function(t,a){var n=this.options.taskQuery.periodic_task_id;(new l).exportTaskLog(n,function(t){if(""===t)(0,r.showMessage)((0,r.translate)("_no_log_to_show"),(0,r.translate)("_without_log"),"info",!0);else JSON.stringify([t]),a.options.taskName})},formatLog:function(t){var a=this;return t&&t.forEach(function(t){t.status=t.state;var n=a.getStatusInfo(t,!1);"MDY"==(0,r.getLocaleDateSetting)()?t.logDate=i(t.created_at).format("MM/DD/YYYY h:mm:ss a"):t.logDate=i(t.created_at).format("DD/MM/YYYY h:mm:ss a"),t.statusStr=n.statusStr,t.statusClass=n.statusClass,t.logDetail=t.info&&Object.entries(t.info).map(function(t){return"".concat(t[0],": ").concat("object"===d(t[1])?JSON.stringify(t[1]):t[1])}).join("; \n")}),t},getStatusInfo:function(t){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={statusStr:null,statusClass:null,subtask:null};switch(t.state){case"PROGRESS":n.statusStr="Running",n.statusClass="warning";break;case"INFO":n.statusStr="Info",n.statusClass="info";break;case"WARNING":n.statusStr="Warning",n.statusClass="warning";break;case"FAILURE":n.statusStr="Failed",n.statusClass="danger",a&&!t.is_running&&(n.subtask="End of Job",n.statusStr="Finished with error(s)");break;case"RETRY":n.statusStr="Retry",n.statusClass="warning";break;case"SUCCESS":n.statusStr="Completed",n.statusClass="success completed",a&&!t.is_running&&(n.subtask="Completed",n.statusStr="Successfully completed");break;case"REVOKED":n.statusStr="Revoked",n.statusClass="warning";break;case"STARTED":n.statusStr="Started",n.statusClass="warning",a&&(n.statusStr="Running");break;case"PENDING":n.statusStr="Pending",n.statusClass="warning";break;case"RECEIVED":n.statusStr="Received",n.statusClass="warning"}return n},deleteTask:function(t,a){var n=e(t.currentTarget).parent().parent().attr("schedule-task-id");(new l).deleteTask(n,function(){a.render()})},cancel:function(a,n){var s=e("#currentTask").attr("data-rel"),i=new t;clearInterval(n.poll),i.removeTask(s)},addHandlers:function(t){var a=this;t.find("div.submit button.btn-cancel").on("click",e.proxy(function(){return this.cancel(),!1},this)),t.find("div.abm-top-options a.btn-close").on("click",function(t){return t.preventDefault(),a.cancel(t,a),!1}),t.find("div.abm-top-options a.btn-refresh").on("click",function(t){return t.preventDefault(),a.listLog(),a.updateStatus(),!1}),t.find("select.filterSession").on("change",function(t){return t.preventDefault(),a.currentSession=e(t.currentTarget).val(),a.listLog(),a.updateStatus(),!1}),t.find("select.filterStatus").on("change",function(t){return t.preventDefault(),a.currentStatusFilter=e(t.currentTarget).val(),a.listLog(),a.updateStatus(),!1}),t.find(".box-title").on("click",".btn-run-task",function(t){return t.preventDefault(),a.run(t,a),!1}),t.find(".box-title").on("click",".btn-stop-task",function(t){return t.preventDefault(),a.stop(t,a),!1}),t.find(".box-title").on("click",".btnDownloadLog",function(t){return t.preventDefault(),a.downloadLog(t,a),!1}),t.find(".btn-search-logs").on("click",function(t){t.preventDefault(),n.e(296).then(function(){var t=[n(2105)];(function(t){new t({task:{id:a.options.taskQuery.periodic_task_id}}).render(function(t){a.listLog(!1,t)})}).apply(null,t)}).catch(n.oe)})},updateStatus:function(){var t=e(".mainTask[data-rel='tasks-log']"),a=e("div[data-id='"+this._uId+"'] .currentTaskStatus");if(this&&this.options&&this.options.taskQuery&&e(".mainTask[data-rel='tasks-log']").is(":visible")){if(1===t.find("span.label-success.completed").length)return a.html("Successfully completed"),a.attr("class","currentTaskStatus label label-success"),void clearTimeout(this.autorefreshStateTimeout);if(1===t.find("span.label.label-danger").length)return a.html("Finished with error(s)"),a.attr("class","currentTaskStatus label label-danger"),void clearTimeout(this.autorefreshStateTimeout)}}})}.apply(a,l))||(t.exports=o)}).call(this,n(218),n(1),n(134))},2057:function(t,a,n){var s=n(690);function e(t){return t&&(t.__esModule?t.default:t)}t.exports=(s.default||s).template({1:function(t,a,n,s,e){return" hide "},3:function(t,a,n,s,e){return" selected "},compiler:[7,">= 4.0.0"],main:function(t,a,s,i,l){var o,r=t.lambda,d=t.escapeExpression,u=null!=a?a:t.nullContext||{};return'<div class="abm-base-tmp '+d(r(null!=a?a.tmpClass:a,a))+' container-fluid mainTask" data-id="'+d(r(null!=a?a.id:a,a))+'" data-rel="'+d(r(null!=a?a.dataRel:a,a))+'"\n  data-type="tab-content">\n  <div class="row">\n    <div class="col-sm-12">\n      <div class="box">\n        <div class="box-title">\n          <h3><i class="fa fa-th-list"></i>'+d(r(null!=a?a.taskName:a,a))+'</h3>\n          <div class="actions abm-top-options">\n\n            <a href="#" class="btn btn-small btn-run-task '+(null!=(o=e(n(689)).call(u,null!=a?a.fromSBMO:a,"==",!0,{name:"ifCond",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?o:"")+'"><i\n                class="fa fa-caret-right"></i> '+d(e(n(688)).call(u,"_run",{name:"L",hash:{},data:l}))+' </a>\n\n            <a href="#" class="btn btn-small btn-red btn-stop-task nodisplay"><i class="fa fa-stop-circle-o"></i>\n              '+d(e(n(688)).call(u,"stop",{name:"L",hash:{},data:l}))+' </a>\n\n            <a href="#" class="btnAutoRefresh btn btn-mini custom-checkbox checkbox-active"><i\n                class="far fa-check-square"></i> '+d(e(n(688)).call(u,"automatic_refresh",{name:"L",hash:{},data:l}))+'</a>\n\n\n            \x3c!--<a href="#" class="btn btn-refresh"><i class="fa fa-refresh"></i></a>--\x3e\n            <a href="#" class="btn btn-close"><i class="fa fa-times"></i></a>\n          </div>\n        </div>\n        <div class="box-content nopadding log-container">\n\n          <div class="row" style="padding-top: 15px;">\n            <div class="col-sm-3">\n              <p><strong>'+d(e(n(688)).call(u,"_created_by",{name:"L",hash:{},data:l}))+":</strong> "+d(r(null!=a?a.createdBy:a,a))+" </p>\n              <p><strong>"+d(e(n(688)).call(u,"_run_policy",{name:"L",hash:{},data:l}))+":</strong> "+d(r(null!=a?a.runPolicy:a,a))+"</p>\n              <p><strong>"+d(e(n(688)).call(u,"_next_execution",{name:"L",hash:{},data:l}))+":</strong> "+d(r(null!=a?a.nextExecution:a,a))+'</p>\n            </div>\n            <div class="col-sm-3">\n              <p style="display:none;"><strong>'+d(e(n(688)).call(u,"_filter_by_session",{name:"L",hash:{},data:l}))+':</strong>\n                <select class="filterSession">\n                  <option value="0">Current</option>\n                  <option value="-1">Last 5</option>\n                  <option value="-2">All</option>\n                </select>\n              </p>\n\n              <p>\n                <strong>'+d(e(n(688)).call(u,"_current_status",{name:"L",hash:{},data:l}))+':</strong>\n                <span class="currentTaskStatus label label-'+d(r(null!=(o=null!=a?a.statusInfo:a)?o.statusClass:o,a))+'">'+d(r(null!=(o=null!=a?a.statusInfo:a)?o.statusStr:o,a))+'</span>\n                <span class="lastDescription">'+d(r(null!=(o=null!=a?a.statusInfo:a)?o.lastDescription:o,a))+'</span>\n              </p>\n\n              <p>\n                <button class="btn btn-small btn-primary btn-search-logs"><i class="fa fa-list-alt"></i>\n                  <span>'+d(e(n(688)).call(u,"_task_log_search",{name:"L",hash:{},data:l}))+'</span></button>\n              </p>\n\n              <p style="display: none;">\n                <strong style="float: left; margin-top: 5px; margin-right: 5px;">From date:</strong>\n                <input type="text" data-date-format="yyyy/mm/dd" class="form-control input-sm fromdatepick"\n                  style="width: 115px;">\n              </p>\n\n              <p style="display:none;">\n                <strong>'+d(e(n(688)).call(u,"_filter_by_status",{name:"L",hash:{},data:l}))+':</strong>\n                <select class="filterStatus">\n                  <option value="0">Result</option>\n                  <option value="1" '+(null!=(o=e(n(689)).call(u,null!=a?a.fromSBMO:a,"==",!0,{name:"ifCond",hash:{},fn:t.program(3,l,0),inverse:t.noop,data:l}))?o:"")+'>All</option>\n                </select>\n              </p>\n            </div>\n\n            <div class="col-sm-3">\n\n            </div>\n\n          </div>\n\n          <div class="row">\n            <div class="col-sm-12 logTableWrapper">\n              <div class="dataTables_paginate sruc-project-pagintaion">\n                <button class="previous paginate_button disabled " disabled="disabled"><i\n                    class="fa fa-chevron-left"></i></button>\n                <button class="next paginate_button disabled" disabled="disabled"><i\n                    class="fa fa-chevron-right"></i></button>\n                <span>'+d(e(n(688)).call(u,"_showing",{name:"L",hash:{},data:l}))+'</span>\n                <span class="info" data-key="from"></span>\n                <span>'+d(e(n(688)).call(u,"_to",{name:"L",hash:{},data:l}))+'</span>\n                <span class="info" data-key="to"></span>\n                <span>'+d(e(n(688)).call(u,"_from",{name:"L",hash:{},data:l}))+'</span>\n                <span class="info" data-key="of"></span>\n              </div>\n\n              <table class="table table-hover table-condensed dataTable dataTable-scroll-x etlTasks dataTable-nosort">\n                <thead>\n                  <tr>\n                    <th width="20%">'+d(e(n(688)).call(u,"_sub_task",{name:"L",hash:{},data:l}))+'</th>\n                    <th width="15%">'+d(e(n(688)).call(u,"_activity",{name:"L",hash:{},data:l}))+'</th>\n                    <th width="40%">'+d(e(n(688)).call(u,"_detail",{name:"L",hash:{},data:l}))+'</th>\n                    <th width="10%">'+d(e(n(688)).call(u,"_timestamp",{name:"L",hash:{},data:l}))+" ("+d(r(null!=a?a.browserTimezone:a,a))+')</th>\n                    <th width="15%">'+d(e(n(688)).call(u,"_status",{name:"L",hash:{},data:l}))+"</th>\n                  </tr>\n                </thead>\n                <tbody>\n\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"},useData:!0})},2058:function(t,a,n){var s=n(690);t.exports=(s.default||s).template({1:function(t,a,n,s,e){var i,l,o=null!=a?a:t.nullContext||{},r=n.helperMissing,d="function",u=t.escapeExpression;return'<tr schedule-task-log-id="'+u(typeof(l=null!=(l=n.id||(null!=a?a.id:a))?l:r)===d?l.call(o,{name:"id",hash:{},data:e}):l)+'" subtask="'+u(typeof(l=null!=(l=n.description||(null!=a?a.description:a))?l:r)===d?l.call(o,{name:"description",hash:{},data:e}):l)+'" schedule-task-session-id="'+u(typeof(l=null!=(l=n.scheduleTaskSessionId||(null!=a?a.scheduleTaskSessionId:a))?l:r)===d?l.call(o,{name:"scheduleTaskSessionId",hash:{},data:e}):l)+'"\n  data-sortable="false" '+(null!=(i=n.if.call(o,null!=a?a.newSession:a,{name:"if",hash:{},fn:t.program(2,e,0),inverse:t.noop,data:e}))?i:"")+">\n  <td>\n    <span>"+u(typeof(l=null!=(l=n.description||(null!=a?a.description:a))?l:r)===d?l.call(o,{name:"description",hash:{},data:e}):l)+"</span>\n  </td>\n  <td>\n    <span>"+u(typeof(l=null!=(l=n.activity||(null!=a?a.activity:a))?l:r)===d?l.call(o,{name:"activity",hash:{},data:e}):l)+"</span>\n  </td>\n  <td>\n    <span>"+u(typeof(l=null!=(l=n.logDetail||(null!=a?a.logDetail:a))?l:r)===d?l.call(o,{name:"logDetail",hash:{},data:e}):l)+"</span>\n  </td>\n  <td>\n"+(null!=(i=n.if.call(o,null!=a?a.newSession:a,{name:"if",hash:{},fn:t.program(4,e,0),inverse:t.program(6,e,0),data:e}))?i:"")+'  </td>\n  <td>\n    <span class="label label-'+u(typeof(l=null!=(l=n.statusClass||(null!=a?a.statusClass:a))?l:r)===d?l.call(o,{name:"statusClass",hash:{},data:e}):l)+'">'+u(typeof(l=null!=(l=n.statusStr||(null!=a?a.statusStr:a))?l:r)===d?l.call(o,{name:"statusStr",hash:{},data:e}):l)+"</span>\n  </td>\n</tr>\n\n"},2:function(t,a,n,s,e){return' class="label-grey-3" '},4:function(t,a,n,s,e){return"    <span></span>\n"},6:function(t,a,n,s,e){var i;return"    <span>"+t.escapeExpression("function"==typeof(i=null!=(i=n.logDate||(null!=a?a.logDate:a))?i:n.helperMissing)?i.call(null!=a?a:t.nullContext||{},{name:"logDate",hash:{},data:e}):i)+"</span>\n"},compiler:[7,">= 4.0.0"],main:function(t,a,n,s,e){var i;return null!=(i=n.each.call(null!=a?a:t.nullContext||{},null!=a?a.data:a,{name:"each",hash:{},fn:t.program(1,e,0),inverse:t.noop,data:e}))?i:""},useData:!0})},739:function(t,a,n){"use strict";(function(s){var e,i=n(693);void 0===(e=function(){return s.Model.extend({url:"myFileManager",getTask:function(t,a){(0,i.send)("scheduler/".concat(t,"/"),null,{type:"GET"},a)},getTaskLog:function(t,a){(0,i.send)("taskLog/by_periodic_task/",t,{type:"POST"},a,null,!0)},filterLogs:function(t,a,n){(0,i.send)("taskLog/filter_logs/?page=".concat(t),JSON.stringify(a),{type:"POST",contentType:"application/json;charset=utf-8"},n,null,!0)},create:function(t,a,n){(0,i.send)("scheduler/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},a,n,!1,!0)},edit:function(t,a,n){(0,i.send)("scheduler/".concat(t.id,"/"),JSON.stringify(t),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},a,n,!1,!0)},partialEdit:function(t,a,n,s){(0,i.send)("scheduler/".concat(t,"/"),JSON.stringify(a),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},n,s,!1,!0)},list:function(t,a){(0,i.send)("scheduler/",null,{type:"GET"},t,a)},deleteTask:function(t,a){(0,i.send)("scheduler/".concat(t,"/"),null,{type:"DELETE"},a)},runTask:function(t,a){var n=t.periodic_task_id;t.scheduleTaskId;(0,i.send)("scheduler/".concat(n,"/runTask/"),null,{type:"POST"},a)},getPythonTimezones:function(t,a){(0,i.send)("scheduler/getPythonTimezones/",null,{type:"GET"},t,a)}})}.apply(a,[]))||(t.exports=e)}).call(this,n(218))}}]);