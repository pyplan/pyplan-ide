/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[270,311],{2054:function(t,a,n){"use strict";(function(e,s,l){var i,r,o=n(18);i=[n(748),n(740),n(2055)],void 0===(r=function(t,a,i){return e.View.extend({el:s("#main"),_uId:"",permisions:[],listToWatch:{values:[]},processLength:null,taskSchedulerModel:new a,taskSchedulerController:new t,render:function(){s("div[data-rel='"+this.options.taskType+"']").remove();var t=this;this._uId=s.uuid(),this.taskSchedulerModel.list(function(a){t.tasksList=a,a.forEach(function(a){t.listToWatch.values.push(a.id);var n=t.getStatusInfo(a.state);a.last_run_at?a.last_run_at=l(a.last_run_at).format("MM/DD/YYYY h:mm:ss a"):a.last_run_at="N/A",a.next_execution?a.nextRunDate=l(a.next_execution).format("MM/DD/YYYY h:mm:ss a"):a.nextRunDate="N/A",a.statusStr=n.statusStr,a.statusClass=n.statusClass,a.hasParams?(a.btnColor=a.hasParams?"btn-orange":"btn-green",a.hasParams=!!a.hasParams):(a.btnColor="btn-green",a.hasParams=!1)});var n={tasks:a,id:t._uId,dataRel:t.options.taskType,tmpClass:t.options.taskType,title:"Model Tasks"},e=i(n);t.$el.append(e),t.view=s("div[data-id='"+t._uId+"']"),s("div[data-id='"+t._uId+"']").find("table").dataTable({fnRowCallback:function(a,n,e,l){this.fnGetPosition(a);return 0===s(a).find("div.multi-switch").length&&(s("td:eq(5) .multi-switch",a).multiSwitch(),s(a).find("div.multi-switch .switch-content:not(.disabled)").on("click",function(a){t.updatePolicy(a,t)})),a}}),s('<div class="actions data-table-options">').insertAfter(".dataTables_length");var r=s("div[data-id='"+t._uId+"']").find("div.data-table-options");function o(){var a=s(window).height();t.h=a-320,s("div[data-id='"+t._uId+"']").find(".dataTables_scrollBody").css("height",t.h+"px")}s('<button class="btn btn-green btn-addTask" task-type="'+t.options.taskType+'"><i class="fa fa-plus"></i> Add task </button>').appendTo(r),s(window).resize(o),o(),t.addHandlers(s("div[data-id='"+t._uId+"']")),t.view.find(".btn-addTask").on("click",function(a){return a.preventDefault(),t.addTask(a,t),!1}),t.view.on("click",".btn-copy-task",function(a){return a.preventDefault(),t.copyTask(a,t),!1}),t.view.on("click",".btn-edit-task",function(a){return a.preventDefault(),t.editTask(a,t),!1}),t.view.on("click",".btn-delete-task",function(a){return a.preventDefault(),t.deleteTask(a,t),!1}),t.view.on("click",".btn-log-task",function(a){return a.preventDefault(),t.showLog(a,t),!1}),t.view.on("click",".btn-run-task",function(a){return a.preventDefault(),t.run(a,t),!1}),t.view.on("click",".btn-stop-task",function(a){return a.preventDefault(),t.stop(a,t),!1}),t.view.on("removeView",function(){t.onRemoveView()}),t.poll=setInterval(function(){t.refreshTaskStates()},7e3)})},refreshTaskStates:function(){if(this.view.is(":visible"));},onRemoveView:function(){this.permisions=null,this.taskSchedulerModel=null,this.taskSchedulerController=null,this.listToWatch=null,clearInterval(this.poll)},getStatusInfo:function(t){var a={statusStr:null,statusClass:null};switch(t){case"PROGRESS":a.statusStr="Running",a.statusClass="warning";break;case"INFO":a.statusStr="Info",a.statusClass="info";break;case"WARNING":a.statusStr="Warning",a.statusClass="warning";break;case"FAILURE":a.statusStr="Failed",a.statusClass="danger";break;case"RETRY":a.statusStr="Retry",a.statusClass="warning";break;case"SUCCESS":a.statusStr="Completed",a.statusClass="success";break;case"REVOKED":a.statusStr="Revoked",a.statusClass="warning";break;case"STARTED":a.statusStr="Started",a.statusClass="warning";break;case"PENDING":a.statusStr="Pending",a.statusClass="warning";break;case"RECEIVED":a.statusStr="Received",a.statusClass="warning"}return a},updatePolicy:function(t,a){var n=!s(t.currentTarget).hasClass("active"),e=s(t.currentTarget).closest("tr").attr("schedule-task-id"),l={enabled:n};this.taskSchedulerModel.partialEdit(e,l,function(a){s(t.currentTarget).closest("tr").find("button.btn-run-task").enable(n)})},addTask:function(t,a){var e=s(t.currentTarget).attr("task-type");Promise.resolve().then(function(){var t=[n(748)];(function(t){(new t).addScheduleTask(null,e,a.tasksList)}).apply(null,t)}).catch(n.oe)},editTask:function(t,e){var l=s(t.currentTarget).parent().parent().attr("schedule-task-id");(new a).getTask(l,function(t){Promise.resolve().then(function(){var a=[n(748)];(function(a){(new a).showRunModelTask(t)}).apply(null,a)}).catch(n.oe)})},copyTask:function(t,n){var e=s(t.currentTarget).parent().parent().attr("schedule-task-id");(new a).copyTask(e,function(t){n.render()})},deleteTask:function(t,e){var l=s(t.currentTarget).parent().parent().attr("schedule-task-id");n.e(5).then(function(){var t=[n(684)];(function(t){(new t).show({title:(0,o.translate)("_delete_task"),text:(0,o.translate)("_delete_task_msg"),buttons:[{title:(0,o.translate)("yes"),css:"primary",code:"yes"},{title:(0,o.translate)("no"),code:"no"}],callback:function(t){"yes"==t&&(new a).deleteTask(l,function(){e.render()})}})}).apply(null,t)}).catch(n.oe)},showLog:function(t,a){var n=s(t.currentTarget).closest("tr"),e={periodic_task_id:s(n).attr("schedule-task-id"),scheduleSubTask:null,scheduleTaskSessionId:0,hasParam:s(n).attr("has-param"),headerInfo:{}};a.taskSchedulerController.showTaskLogs(e)},run:function(t,e){var l=s(t.currentTarget).parent().parent().attr("schedule-task-id"),i=s(t.currentTarget).parent().parent().attr("has-param"),r=new a;"true"===i?n.e(88).then(function(){var t=[n(1342)];(function(t){(new t).render(l,e,e.onRunWithParams)}).apply(null,t)}).catch(n.oe):r.runTask({periodic_task_id:l},function(t){if(t){var a=e.view.find('table tr[schedule-task-id="'+l+'"] td span');a.html((0,o.translate)("_running")),a.attr("class","label label-warning");e.view.find('table tr[schedule-task-id="'+l+'"]')}})},stop:function(t,n){var e=s(t.currentTarget).parent().parent().attr("schedule-task-id");n=this;(new a).stopTask(e,function(t){var a=n.view.find('table tr[schedule-task-id="'+e+'"]');t&&(a.find(".btn-stop-task").hide(),a.find(".btn-run-task").show(),n.refreshTaskStates())})},onRunWithParams:function(t,n){n=n;var e=t.id;(new a).runTask({periodic_task_id:e},function(t){if(t){var a=n.view.find('table tr[schedule-task-id="'+e+'"] td span');a.html((0,o.translate)("_running")),a.attr("class","label label-warning");n.view.find('table tr[schedule-task-id="'+e+'"]')}})},cancel:function(t,a){var e=s("#currentTask").attr("data-rel");Promise.resolve().then(function(){var t=[n(683)];(function(t){clearInterval(a.poll),(new t).removeTask(e)}).apply(null,t)}).catch(n.oe)},addHandlers:function(t){var a=this;s("div[data-id='"+this._uId+"']").find("div.submit button.btn-cancel").on("click",s.proxy(function(){return this.cancel(),!1},this)),s("div[data-id='"+this._uId+"']").find("div.abm-top-options a.btn-close").on("click",function(t){return t.preventDefault(),a.cancel(t,a),!1})}})}.apply(a,i))||(t.exports=r)}).call(this,n(218),n(1),n(134))},2055:function(t,a,n){var e=n(690);function s(t){return t&&(t.__esModule?t.default:t)}t.exports=(e.default||e).template({1:function(t,a,e,l,i){var r,o=t.lambda,c=t.escapeExpression,u=null!=a?a:t.nullContext||{};return'              <tr schedule-task-id="'+c(o(null!=a?a.id:a,a))+'" has-param="'+c(o(null!=a?a.hasParams:a,a))+'" data-sortable="false">\n                <td>\n                  <strong>'+c(o(null!=a?a.name:a,a))+"</strong>\n                </td>\n                <td>\n                  "+c(o(null!=a?a.created_by:a,a))+"\n                </td>\n                <td>\n                  "+c(o(null!=a?a.last_run_at:a,a))+'\n                </td>\n                <td>\n                  <span class="label label-'+c(o(null!=a?a.statusClass:a,a))+'">'+c(o(null!=a?a.statusStr:a,a))+"</span>\n                </td>\n                <td>\n                  "+c(o(null!=a?a.nextRunDate:a,a))+"\n                </td>\n                <td>\n                  <center>\n"+(null!=(r=s(n(689)).call(u,null!=a?a.scheduleRunType:a,"==",4,{name:"ifCond",hash:{},fn:t.program(2,i,0),inverse:t.program(4,i,0),data:i}))?r:"")+'                  </center>\n                </td>\n\n                <td>\n\n                  \x3c!--button class="btn btn-small btn-copy-task" rel="tooltip" title=""\n                    data-original-title="'+c(s(n(688)).call(u,"_copy_task",{name:"L",hash:{},data:i}))+'"><i class="fa fa-files"></i></button--\x3e\n                  <button class="btn btn-small btn-edit-task" rel="tooltip" title=""\n                    data-original-title="'+c(s(n(688)).call(u,"_edit_task",{name:"L",hash:{},data:i}))+'"><i class="fa fa-pencil"></i></button>\n                  <button class="btn btn-small btn-delete-task" rel="tooltip" title=""\n                    data-original-title="'+c(s(n(688)).call(u,"_delete_task",{name:"L",hash:{},data:i}))+'"><i class="fa fa-trash"></i></button>\n\n                  <button class="btn btn-small btn-log-task" rel="tooltip" title=""\n                    data-original-title="'+c(s(n(688)).call(u,"_watch_task_log",{name:"L",hash:{},data:i}))+'"><i class="fa fa-list-alt"></i></button>\n\n'+(null!=(r=s(n(689)).call(u,null!=a?a.scheduleRunType:a,"==",4,{name:"ifCond",hash:{},fn:t.program(7,i,0),inverse:t.program(9,i,0),data:i}))?r:"")+'\n                  <button class="btn btn-small btn-red btn-stop-task nodisplay"><i class="fa fa-stop-circle-o"></i>\n                    '+c(s(n(688)).call(u,"stop",{name:"L",hash:{},data:i}))+" </button>\n                </td>\n\n              </tr>\n\n"},2:function(t,a,n,e,s){return"                    Manual\n"},4:function(t,a,e,l,i){var r;return'\n                    <input type="checkbox" class="multi-switch" data-format-key="bottomTotal"\n                      '+(null!=(r=s(n(689)).call(null!=a?a:t.nullContext||{},null!=a?a.enabled:a,"==",!0,{name:"ifCond",hash:{},fn:t.program(5,i,0),inverse:t.noop,data:i}))?r:"")+" />\n"},5:function(t,a,n,e,s){return' checked="checked" '},7:function(t,a,e,l,i){var r=t.escapeExpression;return'                  <button class="btn btn-small '+r(t.lambda(null!=a?a.btnColor:a,a))+' btn-run-task"><i class="fa fa-caret-right"></i> '+r(s(n(688)).call(null!=a?a:t.nullContext||{},"_run",{name:"L",hash:{},data:i}))+"\n                  </button>\n"},9:function(t,a,e,l,i){var r,o=t.escapeExpression,c=null!=a?a:t.nullContext||{};return'                  <button class="btn btn-small '+o(t.lambda(null!=a?a.btnColor:a,a))+' btn-run-task" '+(null!=(r=s(n(689)).call(c,null!=a?a.enabled:a,"==",!1,{name:"ifCond",hash:{},fn:t.program(10,i,0),inverse:t.noop,data:i}))?r:"")+'><i class="fa fa-caret-right"></i> '+o(s(n(688)).call(c,"_run",{name:"L",hash:{},data:i}))+" </button>\n"},10:function(t,a,n,e,s){return'\n                    disabled="disabled" '},compiler:[7,">= 4.0.0"],main:function(t,a,e,l,i){var r,o=t.lambda,c=t.escapeExpression,u=null!=a?a:t.nullContext||{};return'<div class="abm-base-tmp '+c(o(null!=a?a.tmpClass:a,a))+' container-fluid mainTask" data-id="'+c(o(null!=a?a.id:a,a))+'" data-rel="'+c(o(null!=a?a.dataRel:a,a))+'"\n  data-type="tab-content">\n  <div class="row">\n    <div class="col-sm-12">\n      <div class="box">\n        <div class="box-title">\n          <h3><i class="fa fa-th-list"></i>'+c(o(null!=a?a.title:a,a))+'</h3>\n          <div class="actions abm-top-options">\n            <a href="#" class="btn btn-close"><i class="fa fa-times"></i></a>\n          </div>\n        </div>\n        <div class="box-content nopadding abm-content">\n\n          <table class="table table-hover table-condensed dataTable dataTable-scroll-x etlTasks dataTable-nosort">\n            <thead>\n              <tr>\n                <th width="20%">'+c(s(n(688)).call(u,"_name",{name:"L",hash:{},data:i}))+'</th>\n                <th width="12%">'+c(s(n(688)).call(u,"_created_by",{name:"L",hash:{},data:i}))+'</th>\n                <th width="12%">'+c(s(n(688)).call(u,"_last_execution",{name:"L",hash:{},data:i}))+'</th>\n                <th width="12%">'+c(s(n(688)).call(u,"_last_status",{name:"L",hash:{},data:i}))+'</th>\n                <th width="12%">'+c(s(n(688)).call(u,"_next_execution",{name:"L",hash:{},data:i}))+'</th>\n                <th width="10%">'+c(s(n(688)).call(u,"_enabled",{name:"L",hash:{},data:i}))+'</th>\n                <th width="22%">'+c(s(n(688)).call(u,"_options",{name:"L",hash:{},data:i}))+"</th>\n              </tr>\n            </thead>\n            <tbody>\n"+(null!=(r=e.each.call(u,null!=a?a.tasks:a,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i}))?r:"")+"            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"},useData:!0})},740:function(t,a,n){"use strict";(function(e){var s,l=n(693);void 0===(s=function(){return e.Model.extend({url:"myFileManager",getTask:function(t,a){(0,l.send)("scheduler/".concat(t,"/"),null,{type:"GET"},a)},getTaskLog:function(t,a){(0,l.send)("taskLog/by_periodic_task/",t,{type:"POST"},a,null,!0)},filterLogs:function(t,a,n){(0,l.send)("taskLog/filter_logs/?page=".concat(t),JSON.stringify(a),{type:"POST",contentType:"application/json;charset=utf-8"},n,null,!0)},create:function(t,a,n){(0,l.send)("scheduler/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},a,n,!1,!0)},edit:function(t,a,n){(0,l.send)("scheduler/".concat(t.id,"/"),JSON.stringify(t),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},a,n,!1,!0)},partialEdit:function(t,a,n,e){(0,l.send)("scheduler/".concat(t,"/"),JSON.stringify(a),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},n,e,!1,!0)},list:function(t,a){(0,l.send)("scheduler/",null,{type:"GET"},t,a)},deleteTask:function(t,a){(0,l.send)("scheduler/".concat(t,"/"),null,{type:"DELETE"},a)},runTask:function(t,a){var n=t.periodic_task_id;t.scheduleTaskId;(0,l.send)("scheduler/".concat(n,"/runTask/"),null,{type:"POST"},a)},getPythonTimezones:function(t,a){(0,l.send)("scheduler/getPythonTimezones/",null,{type:"GET"},t,a)}})}.apply(a,[]))||(t.exports=s)}).call(this,n(218))}}]);