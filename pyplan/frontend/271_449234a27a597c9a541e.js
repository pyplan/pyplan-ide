/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[271,310],{2074:function(t,e,a){"use strict";(function(n,s){var l,o;l=[a(742),a(736),a(2075),a(2076)],void 0===(o=function(t,e,l,o){return n.View.extend({el:s("#main"),taskSchedulerCtrl:new t,arrPurgueSessions:[],arrOleDb:[],arrRunModel:[],arrAllTasks:[],initialize:function(){},render:function(){s('.container-fluid.mainTask[data-rel="task-scheduler"]').remove(),s("div[data-rel='run-model-task']").remove(),s("div[data-rel='oledb-task']").remove();var t=this,e=l();this.$el.append(e);var a=s(".task-scheduler-content");function n(){var t=s(window).height();t-=95,a.height(t-(s(".page-header").height()+20))}s(window).resize(n),n(),s(".run-model-task").on("click",function(){return t.runModelTask(t),!1}),s(".oledb-task").on("click",function(){return t.oledbTask(t),!1}),s(".filter-tabs a").on("click",function(){return t.filterTable(event,t),!1}),s(".btn-copy-task").on("click",function(){return t.copyTask(t),!1}),s(".btn-edit-task").on("click",function(){return t.editTask(t),!1}),s(".btn-delete-task").on("click",function(){return t.deleteTask(t),!1}),s(".btn-run-task").on("click",function(){return t.run(t),!1}),s(".btn-reset-task").on("click",function(){return t.reset(t),!1}),s("div[data-rel='task-scheduler']").find("div.abm-top-options a.btn-close").on("click",this.close);var o=s("#right-column").height();s("#tree-container").height(o),this.getThis().on("removeView",function(){t.onRemoveView()}),this.getThis().on("beforeRemoveView",function(e,a){t.onBeforeRemoveView(e,a)}),this.showList(),s(".btn-delete-task").attr("disabled",!0),s(".btn-edit-task").attr("disabled",!0),s(".btn-copy-task").attr("disabled",!0),s(".btn-run-task").attr("disabled",!0),s(".btn-reset-task").attr("disabled",!0)},fnGetSelected:function(){return s(".task-scheduler-content").find("tr.row_selected").attr("data-id")},close:function(){Promise.resolve().then(function(){var t=[a(684)];(function(t){(new t).removeTask("task-scheduler")}).apply(null,t)}).catch(a.oe)},editTask:function(t){var n=t.fnGetSelected();(new e).getTask(n,function(t){var e=t.scheduleTaskType;Promise.resolve().then(function(){var n=[a(742)];(function(a){0===e?(new a).showRunModelTask(t):2===e&&(new a).showOledbTask(t)}).apply(null,n)}).catch(a.oe)})},copyTask:function(t){var a=t.fnGetSelected();(new e).copyTask(a,function(e){t.showList()})},deleteTask:function(t){var a=t.fnGetSelected();(new e).deleteTask(a,function(){t.showList()})},showList:function(){var t=new e,a=this;s("#task-scheduler-table tbody").empty();var n=s("#task-scheduler-table").dataTable();n.fnClearTable(),n.fnDestroy(),a.arrAllTasks=[],a.arrRunModel=[],a.arrPurgueSessions=[],a.arrOleDb=[],t.list(function(t){for(var e={data:t},n=0;n<e.data.length;n++)e.data[n].enabled?(e.data[n].statusStr="Enabled",e.data[n].statusClass="success"):(e.data[n].statusStr="Disabled",e.data[n].statusClass="warning"),e.data[n].modelPath||(e.data[n].modelPath="N/A"),0===e.data[n].scheduleTaskType?(e.data[n].scheduleTaskTypeStr="Run Model",a.arrRunModel.push(e.data[n])):1===e.data[n].scheduleTaskType?(e.data[n].scheduleTaskTypeStr="Purgue session",a.arrPurgueSessions.push(e.data[n])):(e.data[n].scheduleTaskTypeStr="OleDB",a.arrOleDb.push(e.data[n])),a.arrAllTasks.push(e.data[n]);var l=o(e);s("#task-scheduler-table tbody").append(l),s("#task-scheduler-table tbody").find(".task-log-btn").on("click",function(t){return a.showTaskLog(t,a),!1}),a.instanceTable()})},instanceTable:function(){var t,e=s(".task-scheduler-content"),a=this;s("#task-scheduler-table tbody tr").click(function(e){s(this).hasClass("row_selected")?(s(this).removeClass("row_selected"),a.disableActions()):(t.$("tr.row_selected").removeClass("row_selected"),s(this).addClass("row_selected"),a.enableActions())}),t=e.find("table").dataTable()},disableActions:function(){s(".btn-delete-task").attr("disabled",!0),s(".btn-edit-task").attr("disabled",!0),s(".btn-copy-task").attr("disabled",!0),s(".btn-run-task").attr("disabled",!0),s(".btn-reset-task").attr("disabled",!0)},enableActions:function(){s(".btn-delete-task").attr("disabled",!1),s(".btn-edit-task").attr("disabled",!1),s(".btn-copy-task").attr("disabled",!1),s(".btn-run-task").attr("disabled",!1),s(".btn-reset-task").attr("disabled",!1)},filterTable:function(t,e){e.disableActions();for(var a=s(".filter-tabs li"),n=0;n<a.length;n++)s(a[n]).removeClass("active");s(t.currentTarget).parent().addClass("active");var l,i=s(t.currentTarget).attr("data-rel");s("#task-scheduler-table tbody").empty();var d=s("#task-scheduler-table").dataTable();d.fnClearTable(),d.fnDestroy(),l="sessions-tasks"===i?e.arrPurgueSessions:"run-model-tasks"===i?e.arrRunModel:"oledb-tasks"===i?e.arrOleDb:e.arrAllTasks;var r=o({data:l});s("#task-scheduler-table tbody").append(r),s("#task-scheduler-table tbody").find(".task-log-btn").on("click",function(t){return e.showTaskLog(t,e),!1}),e.instanceTable()},runModelTask:function(t){Promise.resolve().then(function(){var t=[a(684)];(function(t){var e="run-model-task";(new t).hideAllTasks(),(new t).addTask(e,"Add task"),(new t).selectTask(e,"Add task")}).apply(null,t)}).catch(a.oe)},oledbTask:function(t){Promise.resolve().then(function(){var t=[a(684)];(function(t){var e="oledb-task";(new t).hideAllTasks(),(new t).addTask(e,"Add task"),(new t).selectTask(e,"Add task")}).apply(null,t)}).catch(a.oe)},run:function(t){var a=t.fnGetSelected();(new e).runTask(a,function(t){})},reset:function(t){var a=t.fnGetSelected();(new e).resetTask(a,function(t){})},showTaskLog:function(t,n){var l=s(t.currentTarget).attr("data-id");a.e(14).then(function(){(function(s){var o=[a(734)];(function(a){(new e).getTaskLog(l,function(e){for(var l=0;l<e.length;l++){switch(e[l].state){case"0":e[l].stateStr="Ready",e[l].stateClass="info";break;case"1":e[l].stateStr="Running",e[l].stateClass="success";break;case"2":e[l].stateStr="Complete",e[l].stateClass="success";break;case"3":e[l].stateStr="Failed",e[l].stateClass="danger";break;case"4":e[l].stateStr="WaitForResources",e[l].stateClass="warning";break;case"5":e[l].stateStr="Info",e[l].stateClass="info"}var o=e[l].logDate.split("T");e[l].logDate=s(o[0]).format("YYYY/MM/DD")+" "+o[1],e[l].logStr=e[l].log}var i={title:"Task Log",content:e,left:t.clientX,top:t.clientY,className:"popover_workflow"};e.length>0&&(i.haveLog=!0),(new a).showTaskLog(i,function(t){n.oldPopover=t.options.id})})}).apply(null,o)}).call(this,a(134))}).catch(a.oe)},getThis:function(){return this.$el.find(".mainTask[data-rel='knowledge-base']")},onRemoveView:function(){this.el=s("#main")},onBeforeRemoveView:function(t,e){this.$el.find(".mainTask[data-rel='knowledge-base']").remove()}})}.apply(e,l))||(t.exports=o)}).call(this,a(218),a(1))},2075:function(t,e,a){var n=a(690);t.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(t,e,a,n,s){return'<div class="abm-base-tmp container-fluid mainTask" data-rel="task-scheduler" data-type="tab-content">\n\n  \x3c!-- LIST VIEW --\x3e\n\n  <div class="box task-scheduler-content">\n    <div class="box-title">\n      <h3><i class="fa fa-th-list"></i>Schedule task</h3>\n      <div class="actions abm-top-options">\n        <a href="#" class="btn btn-close"><i class="fa fa-times"></i></a>\n      </div>\n    </div>\n    <div class="box-content abm-content">\n\n      <div class="row">\n        <div class="col-sm-6">\n\n          <div class="btn-group">\n            <a href="#" data-toggle="dropdown" class="btn dropdown-toggle" rel="tooltip" title="Create"\n              data-placement="bottom" data-original-title="Create">\n              <i class="fa fa-plus-circle"></i>\n              <span class="caret"></span>\n            </a>\n            <ul class="dropdown-menu">\n              <li>\n                <a href="#" class="run-model-task">Run model</a>\n              </li>\n              <li>\n                <a href="#" class="oledb-task">OleDB task</a>\n              </li>\n            </ul>\n          </div>\n          <button class="btn btn-copy-task" rel="tooltip" title="Duplicate task" data-placement="bottom"\n            data-original-title="Duplicate task"><i class="fa fa-files"></i></button>\n          <button class="btn btn-edit-task" rel="tooltip" title="Edit task" data-placement="bottom"\n            data-original-title="Edit task"><i class="fa fa-pencil"></i></button>\n          <button class="btn btn-delete-task" rel="tooltip" title="Delete task" data-placement="bottom"\n            data-original-title="Delete task"><i class="fa fa-trash"></i></button>\n        </div>\n        <div class="col-sm-6">\n          <p class="pull-right">\n            <button class="btn btn-green btn-run-task" rel="tooltip" title="Run task" data-placement="bottom"\n              data-original-title="Run task"><i class="fa fa-play"></i> Run task </button>\n            <button class="btn btn-orange btn-reset-task" rel="tooltip" title="Reset task" data-placement="bottom"\n              data-original-title="Reset task"><i class="fa fa-recycle"></i> Reset task</button>\n          </p>\n        </div>\n      </div>\n\n      <ul class="tabs tabs-inline tabs-top filter-tabs"\n        style="border-color: #DDD; border-width: 0 0 1px 0; border-style: solid;">\n        <li class="active">\n          <a href="#tab1" data-toggle="tab" data-rel="all-tasks">\n            <i class="fa fa-clock all-tasks"></i>All</a>\n        </li>\n        <li>\n          <a href="#tab1" data-toggle="tab" data-rel="sessions-tasks">\n            <i class="fa fa-lock"></i>Sessions</a>\n        </li>\n        <li>\n          <a href="#tab1" data-toggle="tab" data-rel="run-model-tasks">\n            <i class="fa fa-cube"></i>Models</a>\n        </li>\n        <li>\n          <a href="#tab1" data-toggle="tab" data-rel="oledb-tasks">\n            <i class="fa fa-database"></i>OleDB</a>\n        </li>\n      </ul>\n\n      <div class="tab-content padding tab-content-inline tab-content-bottom">\n\n        \x3c!-- START TAB --\x3e\n        <div class="tab-pane active" id="tab1">\n          <table id="task-scheduler-table" class="table table-nomargin table-bordered dataTable-selectable">\n            <thead>\n              <tr>\n                <th width="35%">Name</th>\n                <th width="10%">Type</th>\n                <th width="30%">Definition</th>\n                <th width="20%">Status</th>\n                <th width="5%">Log</th>\n              </tr>\n            </thead>\n            <tbody>\n\n            </tbody>\n          </table>\n        </div>\n        \x3c!-- END TAB --\x3e\n\n      </div>\n\n    </div>\n  </div>\n\n</div>'},useData:!0})},2076:function(t,e,a){var n=a(690);t.exports=(n.default||n).template({1:function(t,e,a,n,s){var l,o=null!=e?e:t.nullContext||{},i=t.hooks.helperMissing,d="function",r=t.escapeExpression;return'<tr role="row" class="odd" data-id="'+r(typeof(l=null!=(l=a.scheduleTaskId||(null!=e?e.scheduleTaskId:e))?l:i)===d?l.call(o,{name:"scheduleTaskId",hash:{},data:s,loc:{start:{line:2,column:36},end:{line:2,column:54}}}):l)+'">\n  <td width="35%" class="userName sorting_1">'+r(typeof(l=null!=(l=a.scheduleTaskName||(null!=e?e.scheduleTaskName:e))?l:i)===d?l.call(o,{name:"scheduleTaskName",hash:{},data:s,loc:{start:{line:3,column:45},end:{line:3,column:65}}}):l)+'</td>\n  <td width="10%">'+r(typeof(l=null!=(l=a.scheduleTaskTypeStr||(null!=e?e.scheduleTaskTypeStr:e))?l:i)===d?l.call(o,{name:"scheduleTaskTypeStr",hash:{},data:s,loc:{start:{line:4,column:18},end:{line:4,column:41}}}):l)+'</td>\n  <td width="30%">'+r(typeof(l=null!=(l=a.modelPath||(null!=e?e.modelPath:e))?l:i)===d?l.call(o,{name:"modelPath",hash:{},data:s,loc:{start:{line:5,column:18},end:{line:5,column:31}}}):l)+'</td>\n  <td width="20%">\n    <div class="options">\n        <span class="label label-'+r(typeof(l=null!=(l=a.statusClass||(null!=e?e.statusClass:e))?l:i)===d?l.call(o,{name:"statusClass",hash:{},data:s,loc:{start:{line:8,column:33},end:{line:8,column:48}}}):l)+'">'+r(typeof(l=null!=(l=a.statusStr||(null!=e?e.statusStr:e))?l:i)===d?l.call(o,{name:"statusStr",hash:{},data:s,loc:{start:{line:8,column:50},end:{line:8,column:63}}}):l)+'</span>\n    </div>\n  </td>\n  <td width="5%">\n    <div class="log">\n      <button class="btn task-log-btn" data-id="'+r(typeof(l=null!=(l=a.scheduleTaskId||(null!=e?e.scheduleTaskId:e))?l:i)===d?l.call(o,{name:"scheduleTaskId",hash:{},data:s,loc:{start:{line:13,column:48},end:{line:13,column:66}}}):l)+'" rel="tooltip" title="Show log" data-placement="bottom" data-original-title="Show log"><i class="fa fa-list-alt"></i></button>\n    </div>\n  </td>\n</tr>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,s){var l;return null!=(l=a.each.call(null!=e?e:t.nullContext||{},null!=e?e.data:e,{name:"each",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:1,column:0},end:{line:17,column:9}}}))?l:""},useData:!0})},736:function(t,e,a){"use strict";(function(n){var s,l=a(693);void 0===(s=function(){return n.Model.extend({url:"myFileManager",getTask:function(t,e){(0,l.send)("scheduler/".concat(t,"/"),null,{type:"GET"},e)},getTaskLog:function(t,e){(0,l.send)("taskLog/by_periodic_task/",t,{type:"POST"},e,null,!0)},filterLogs:function(t,e,a){(0,l.send)("taskLog/filter_logs/?page=".concat(t),JSON.stringify(e),{type:"POST",contentType:"application/json;charset=utf-8"},a,null,!0)},create:function(t,e,a){(0,l.send)("scheduler/",JSON.stringify(t),{type:"POST",contentType:"application/json;charset=utf-8",dataType:"text"},e,a,!1,!0)},edit:function(t,e,a){(0,l.send)("scheduler/".concat(t.id,"/"),JSON.stringify(t),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},e,a,!1,!0)},partialEdit:function(t,e,a,n){(0,l.send)("scheduler/".concat(t,"/"),JSON.stringify(e),{type:"PATCH",contentType:"application/json;charset=utf-8",dataType:"text"},a,n,!1,!0)},list:function(t,e){(0,l.send)("scheduler/",null,{type:"GET"},t,e)},deleteTask:function(t,e){(0,l.send)("scheduler/".concat(t,"/"),null,{type:"DELETE"},e)},runTask:function(t,e){var a=t.periodic_task_id;t.scheduleTaskId;(0,l.send)("scheduler/".concat(a,"/runTask/"),null,{type:"POST"},e)},getPythonTimezones:function(t,e){(0,l.send)("scheduler/getPythonTimezones/",null,{type:"GET"},t,e)}})}.apply(e,[]))||(t.exports=s)}).call(this,a(218))}}]);