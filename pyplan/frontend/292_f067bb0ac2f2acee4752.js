/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[292,4],{2144:function(a,t,n){"use strict";(function(e,l){var s,o,i=n(18);s=[n(683),n(739),n(2145),n(2146)],void 0===(o=function(a,t,n,s){return e.View.extend({el:l("#main"),render:function(e){var o=this,r=n(this.options.task.id),c=(0,i.translate)("_task_log_search");(new a).show({title:c,html:r,modalClass:"mediumModal filterLogs",buttons:[{title:(0,i.translate)("close"),code:"close"}],callback:function(a,t){if("yes"==a){return e(e),t.modal("hide"),!1}},onLoad:function(a){var t=this;setTimeout(function(){(0,i.postRender)(t.getBase()),t.getBase().find(".fromdatepick").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(a){l(this).datepicker("hide"),t.getBase().find(".form-vertical").valid()}),t.getBase().on("click",".btnSearchLogs",function(){if(event.preventDefault(),t.getBase().find(".loading").show(),!t.getBase().find(".form-vertical").valid())return!1;t.listLog()}),t.getBase().on("click",".showLog",function(n){n.preventDefault();var s=l(n.currentTarget).closest("tr").attr("schedule-task-log-id"),o=l.grep(t.result,function(a){return a.id===s});e(o[0].task_logs),a.modal("hide")})},500)},getBase:function(){return l(".filterLogs")},renderItems:function(a){var t=s({data:a});this.getBase().find("table").find("tbody").append(t),this.instanceTable()},instanceTable:function(){var a=this.getBase().find("table"),t=l(window).height();t-=300,this.getBase().find(".dataTables_scrollBody").css("height",t+"px"),this.getBase().find(".dataTables_scrollBody").css("max-height",t+"px"),a.DataTable({searching:!1,paging:!1,ordering:!1,info:!1,scrollY:t,scrollCollapse:!0})},listLog:function(){var a=this;this.getBase().find(".dataTables_paginate").find(".paginate_button").prop("disabled","disabled"),this.currentFrom<this.pageSize&&(this.currentFrom=1);var n=this.getBase().find("table"),e={periodic_task_id:o.options.task.id},l=this.getBase().find(".taskLogMinDate").val();l&&(e.min_date=l);var s=this.getBase().find(".taskLogMaxDate").val();l&&(e.max_date=s);var i=this.getBase().find(".taskLogStatus").val();""!=i&&(e.state=i);var r=this.getBase().find(".taskLogParams").val();""!=r&&(e.params=JSON.stringify(r.split(",").map(function(a){return a.trim()}))),(new t).filterLogs(e,function(t){a.result=t;var e=n.DataTable();e.clear(),e.destroy(),n.find("tbody").empty();var l=a.formatLog(t);a.searching=!1,a.renderItems(l),a.getBase().find(".loading").hide()})},formatLog:function(a){var t=this;return a&&a.forEach(function(a){a.status=a.state,a.jsonParams=JSON.stringify(a.params),a.created_at=a.created_at.split("T")[0];var n=t.getStatusInfo(a,!1);a.statusStr=n.statusStr,a.statusClass=n.statusClass,a.logDetail=a.info&&Object.entries(a.info).map(function(a){return"".concat(a[0],": ").concat(a[1])}).join("; \n")}),a},getStatusInfo:function(a){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t={statusStr:null,statusClass:null,subtask:null};switch(a.state){case"FAILURE":t.statusStr="Failed",t.statusClass="danger";break;case"SUCCESS":t.statusStr="Completed",t.statusClass="success completed"}return t}})}})}.apply(t,s))||(a.exports=o)}).call(this,n(218),n(1))},2145:function(a,t,n){var e=n(690);function l(a){return a&&(a.__esModule?a.default:a)}a.exports=(e.default||e).template({compiler:[8,">= 4.3.0"],main:function(a,t,e,s,o){var i=null!=t?t:a.nullContext||{},r=a.escapeExpression;return'<form action="#" onsubmit="return false;" id="filterLogsModal" autocomplete="off" class="form-vertical form-validate"\n  novalidate="novalidate">\n  <div class="row">\n\n    <div class="col-sm-6">\n      <div class="form-group">\n        <label for="taskLogMinDate" class="control-label">'+r(l(n(688)).call(i,"_task_log_min_date",{name:"L",hash:{},data:o,loc:{start:{line:7,column:58},end:{line:7,column:84}}}))+'</label>\n        <input id="taskLogMinDate" name="taskLogMinDate" type="text" data-rule-required="true"\n          data-date-format="yyyy/mm/dd" class="form-control taskLogMinDate fromdatepick">\n      </div>\n\n      <div class="form-group">\n        <label for="taskLogMaxDate" class="control-label">'+r(l(n(688)).call(i,"_task_log_max_date",{name:"L",hash:{},data:o,loc:{start:{line:13,column:58},end:{line:13,column:84}}}))+'</label>\n        <input id="taskLogMaxDate" name="taskLogMaxDate" type="text" data-rule-required="true"\n          data-date-format="yyyy/mm/dd" class="form-control taskLogMaxDate fromdatepick">\n      </div>\n    </div>\n\n    <div class="col-sm-6">\n      <div class="form-group">\n        <label for="taskLogState" class="control-label">'+r(l(n(688)).call(i,"_task_log_state",{name:"L",hash:{},data:o,loc:{start:{line:21,column:56},end:{line:21,column:79}}}))+'</label>\n        <select class="form-control taskLogStatus">\n          <option value="">Select status</option>\n          <option value="SUCCESS">SUCCESS</option>\n          <option value="FAILURE">FAILURE</option>\n        </select>\n      </div>\n\n      <div class="form-group source-group">\n        <label for="taskLogParams" class="control-label">'+r(l(n(688)).call(i,"_task_log_params",{name:"L",hash:{},data:o,loc:{start:{line:30,column:57},end:{line:30,column:81}}}))+'</label>\n        <input id="taskLogParams" type="text" class="form-control taskLogParams"\n          placeholder="Separated comma values (Ex: val1,val2)">\n      </div>\n    </div>\n\n  </div>\n  <div class="row">\n    <div class="col-sm-12" style="margin-bottom: 15px;">\n      <button class="btn btn-primary btnSearchLogs" style="width: 150px;">Search</button>\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="col-sm-12">\n      <table class="table table-hover table-condensed dataTable dataTable-scroll-x etlTasks dataTable-nosort">\n        <thead>\n          <tr>\n            <th width="15%">'+r(l(n(688)).call(i,"_task",{name:"L",hash:{},data:o,loc:{start:{line:48,column:28},end:{line:48,column:41}}}))+'</th>\n            <th width="10%">'+r(l(n(688)).call(i,"_date",{name:"L",hash:{},data:o,loc:{start:{line:49,column:28},end:{line:49,column:41}}}))+'</th>\n            <th width="40%">'+r(l(n(688)).call(i,"_task_log_params",{name:"L",hash:{},data:o,loc:{start:{line:50,column:28},end:{line:50,column:52}}}))+'</th>\n            <th width="10%">'+r(l(n(688)).call(i,"_status",{name:"L",hash:{},data:o,loc:{start:{line:51,column:28},end:{line:51,column:43}}}))+'</th>\n            <th width="10%">'+r(l(n(688)).call(i,"_watch_log",{name:"L",hash:{},data:o,loc:{start:{line:52,column:28},end:{line:52,column:46}}}))+'</th>\n          </tr>\n        </thead>\n        <tbody>\n\n        </tbody>\n      </table>\n    </div>\n\n\n    <div class="row text-center loading" style="display: none;">\n      <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>\n    </div>\n  </div>\n\n</form>'},useData:!0})},2146:function(a,t,n){var e=n(690);a.exports=(e.default||e).template({1:function(a,t,n,e,l){var s,o,i=null!=t?t:a.nullContext||{},r=a.hooks.helperMissing,c="function",d=a.escapeExpression;return'<tr schedule-task-log-id="'+d(typeof(o=null!=(o=n.id||(null!=t?t.id:t))?o:r)===c?o.call(i,{name:"id",hash:{},data:l,loc:{start:{line:2,column:26},end:{line:2,column:32}}}):o)+'" data-sortable="false" '+(null!=(s=n.if.call(i,null!=t?t.newSession:t,{name:"if",hash:{},fn:a.program(2,l,0),inverse:a.noop,data:l,loc:{start:{line:2,column:56},end:{line:2,column:103}}}))?s:"")+">\n  <td>\n    <span>"+d(a.lambda(null!=(s=null!=t?t.periodic_task:t)?s.name:s,t))+"</span>\n  </td>\n  <td>\n    <span>"+d(typeof(o=null!=(o=n.created_at||(null!=t?t.created_at:t))?o:r)===c?o.call(i,{name:"created_at",hash:{},data:l,loc:{start:{line:7,column:10},end:{line:7,column:24}}}):o)+"</span>\n  </td>\n  <td>\n    <span>"+d(typeof(o=null!=(o=n.jsonParams||(null!=t?t.jsonParams:t))?o:r)===c?o.call(i,{name:"jsonParams",hash:{},data:l,loc:{start:{line:10,column:10},end:{line:10,column:24}}}):o)+'</span>\n  </td>\n  <td>\n    <span class="label label-'+d(typeof(o=null!=(o=n.statusClass||(null!=t?t.statusClass:t))?o:r)===c?o.call(i,{name:"statusClass",hash:{},data:l,loc:{start:{line:13,column:29},end:{line:13,column:44}}}):o)+'">'+d(typeof(o=null!=(o=n.state||(null!=t?t.state:t))?o:r)===c?o.call(i,{name:"state",hash:{},data:l,loc:{start:{line:13,column:46},end:{line:13,column:55}}}):o)+'</span>\n  </td>\n  <td>\n    <button class="btn showLog"><i class="fa fa-eye"></i></button>\n  </td>\n</tr>\n\n'},2:function(a,t,n,e,l){return' class="label-grey-3" '},compiler:[8,">= 4.3.0"],main:function(a,t,n,e,l){var s;return null!=(s=n.each.call(null!=t?t:a.nullContext||{},null!=t?t.data:t,{name:"each",hash:{},fn:a.program(1,l,0),inverse:a.noop,data:l,loc:{start:{line:1,column:0},end:{line:20,column:9}}}))?s:""},useData:!0})},683:function(a,t,n){"use strict";(function(e){var l;void 0===(l=function(){return e.Controller.extend({name:"showModal",show:function(a){Promise.all([n.e(2),n.e(116)]).then(function(){var t=[n(701)];(function(t){(new t).render(a)}).apply(null,t)}).catch(n.oe)}})}.apply(t,[]))||(a.exports=l)}).call(this,n(694))}}]);