/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[298],{1031:function(e,t,i){"use strict";(function(o){var n,a;i(18);n=[i(716),i(969),i(220)],void 0===(a=function(e,t,n){return e.extend({el:o("#n_o_n_e"),diagram:void 0,nodeClickTimeout:-1,render:function(e){this.baseRender(e),this.drawItem()},isDiagramView:function(){return!0},needRefresh:function(){return!0},refreshItemDash:function(){this.fullRefresh(!0)},drawItem:function(){this.options.model=new n;var e=this;o(this.tagId).find(".item-area").addClass("extrafullSize"),this.setDefaultOptions();var i={id:o.uuid(),contextMenu:!1,autoCenter:!1,listenMouseDown:!0,breadCrumb:this.currentResult.itemProperties.diagramOptions.showBreadcrumb,nodeClick:function(t,i){e.nodeClick(t,i)},nodeDoubleclick:function(t,i){e.nodeDoubleclick(t,i)},diagramClick:function(){e.diagramClick()},updateProperties:function(t){e.updateProperties(t)},executeButton:function(t){e.executeButton(t)},onUpdateDefinition:function(t){e.model.reevaluateNodesNeeded(e.tagId)},nodeMouseDown:function(t,i){if(e.editMode&&i&&t.data.originalEvent.shiftKey){t.stopPropagation();var n=o.extend({},t.data.originalEvent),a=o("<div class='nodeGhost'></div>").appendTo("body");i.originalId&&""!=i.originalId&&"formnode"!==i.nodeClass?a.attr("data-nodeId",i.originalId).attr("data-nodeClass",i.originalClass):a.attr("data-nodeId",i.id).attr("data-nodeClass",i.nodeClass),a.attr("data-source",e.tagId),a.css({left:n.pageX-40,top:n.pageY-22}),a.draggable({stop:function(e,t){setTimeout((function(){a.draggable("destroy"),a.remove()}),10)}});var s=o.createMouseEvent(a[0],"mousedown",n);o.dispatchMouseEvent(a[0],"mousedown",s)}else{n=o.extend({},t.data.originalEvent),s=o.createMouseEvent(o("body")[0],"mousedown",n);o.dispatchMouseEvent(o("body")[0],"mousedown",s)}}};this.updateSize(),o(this.tagId).find(".item-area").empty(),this.diagram=new t(i),this.diagram.setElement(o(this.tagId).find(".item-area")),this.diagram.render(),this.fullRefresh()},fullRefresh:function(e){this.drawDiagram(e)},onRemoveItemView:function(){o(".left-menu[data-rel='"+this.tagId+"']").find("select[data-format-key='node.dashboard']").select2("destroy"),this.diagram&&(this.diagram.destroy(),this.diagram=null)},updateValues:function(e){},_evaluateNode:function(e,t,i,o,n){},baseUpdateSize:function(){o(this.tagId).find(".item-area").height(o(this.tagId).find(".item-area").parent().height()-30)},updateSize:function(){o(this.tagId).find(".item-area").height(o(this.tagId).find(".item-area").parent().height()-30),this.diagram&&this.diagram.onResize()},drawDiagram:function(e){this.diagram&&(e?this.diagram.navigateCurrentModule():this.diagram.navigateThisModule(this.getNodeId(),this.currentResult.itemProperties.diagramOptions)),this.isReady=!0},setDefaultOptions:function(){this.currentResult.itemProperties?this.currentResult.itemProperties.diagramOptions?null==this.currentResult.itemProperties.diagramOptions.showBreadcrumb&&(this.currentResult.itemProperties.diagramOptions.showBreadcrumb=!0):this.currentResult.itemProperties.diagramOptions={showBreadcrumb:!0}:this.currentResult.itemProperties={diagramOptions:{showBreadcrumb:!0}}},updateProperties:function(e){e&&this.currentResult&&(this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions=o.extend(!0,this.currentResult.itemProperties.diagramOptions,e))},setShowBreadcrumb:function(e){this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions.showBreadcrumb=e,this.diagram.options.breadCrumb=e,this.fullRefresh(!0)},setShowDefinition:function(e){this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions.showDefinition=e},setNodeEvent:function(e,t,i,n){this.setDefaultOptions(),this.currentResult.itemProperties.diagramOptions.nodeEventDic||(this.currentResult.itemProperties.diagramOptions.nodeEventDic={});var a=o(".left-menu[data-rel='"+this.tagId+"'] [data-rel='nodeId']").val();"-1"==e?delete this.currentResult.itemProperties.diagramOptions.nodeEventDic[a]:this.currentResult.itemProperties.diagramOptions.nodeEventDic[a]={action:e,value:t,extraValue:i,showIn:n}},getNodeId:function(){var e=this.currentResult.nodeId;return!e&&this.currentResult.itemProperties.diagramOptions&&this.currentResult.itemProperties.diagramOptions.currentModule&&(e=this.currentResult.itemProperties.diagramOptions.currentModule),e},nodeClick:function(e,t){this.editMode?this.showNodeProperties(t):this.currentResult.itemProperties.diagramOptions.showDefinition?this.showNodeDefinition(e,t):"button"==t.nodeClass&&this.executeButton(t)},nodeDoubleclick:function(e,t){if(!this.editMode&&"text"!=t.nodeClass&&"button"!=t.nodeClass){this.setDefaultOptions();var n=this.currentResult.itemProperties.diagramOptions.nodeEventDic;if(n&&n[t.id]){var a="oncontainer";if(n[t.id].showIn&&(a=n[t.id].showIn),this.fromEmbedded&&(a="oncontainer"),"opendashboard"==n[t.id].action){var s=n[t.id].value,r=n[t.id].extraValue;"oncontainer"==a&&o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").length>0?o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").first().trigger("showDashboardInContainer",[null,s]):this.fromEmbedded||Promise.resolve().then((function(){var e=[i(687)];(function(e){(new e).showDashboard(s,-1,r)}).apply(null,e)})).catch(i.oe)}else if("evaluatenode"==n[t.id].action||"-1"==n[t.id].action){var d=t.id;t.originalId&&(d=t.originalId),"oncontainer"==a&&o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").length>0?o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").first().trigger("showDashboardInContainer",[d]):this.fromEmbedded||this.options.model.evaluateNode(t.id,(function(e){e&&Promise.resolve().then((function(){var t=[i(687)];(function(t){(new t).showDashboard(e.dashboardId,-1,e.name,!0)}).apply(null,t)})).catch(i.oe)}))}}else!this.fromEmbedded&&o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").length>0?o(this.tagId).closest(".dashboard-area").find(".dashboardContainer").first().trigger("showDashboardInContainer",[t.id]):this.options.model.evaluateNode(t.id,(function(e){if(e){var t=void 0,o={};window.location.href.indexOf("/#shared/")>0&&(t=!1,o.closable=!0),Promise.resolve().then((function(){var n=[i(687)];(function(i){(new i).showDashboard(e.id,-1,e.name,!0,t,o)}).apply(null,n)})).catch(i.oe)}}))}},diagramClick:function(){this.hideNodeDefinition()},hideNodeDefinition:function(e,t){this.grid.container.closest(".dashboardTask").find(".nodeDefinitionWindow").trigger("removePanel")},showNodeDefinition:function(e,t){var o=this.grid.container.closest(".dashboardTask");"text"!=t.nodeClass?this.options.model.getNodeProperties(t.id,[{name:"definition"}],(function(e){Promise.resolve().then((function(){var n=[i(687)];(function(i){var n={target:o,editorId:"ace-".concat(t.id),title:"".concat(t.title," (").concat(t.id,")"),content:e.properties[0].value};(new i).showNodeInfo(n)}).apply(null,n)})).catch(i.oe)})):o.find(".nodeDefinitionWindow").trigger("removePanel")},showNodeProperties:function(e){var t=o(".left-menu[data-rel='"+this.tagId+"']");t.find(".forDiagram").hide(),t.find(".forOpenDashboard").hide(),t.find(".forNode").show(),t.find("[data-rel='nodeId']").val(e.id),t.find("[data-rel='nodeTitle']").val(e.title);var i="mediumdefinition";if(("button"==e.nodeClass.toLowerCase()||e.originalClass&&"button"==e.originalClass.toLowerCase())&&(i="mediumscript"),("text"==e.nodeClass.toLowerCase()||e.originalClass&&"text"==e.originalClass.toLowerCase())&&(i="mediumdescription"),this.options.model.getNodeProperties(e.id,[{name:i}],(function(e){t.find("[data-rel='nodeId']").val()==e.node&&t.find("[data-rel='nodeDefinition']").val(e.properties[0].value)})),"button"==e.nodeClass.toLowerCase()||e.originalClass&&"button"==e.originalClass.toLowerCase()||"text"==e.nodeClass.toLowerCase()||e.originalClass&&"text"==e.originalClass.toLowerCase())t.find(".clickEvent").hide(),t.trigger("closeAll");else{t.find(".clickEvent").show(),t.find("select[data-format-key='node.event']").val("-1"),t.find("div.forOpenDashboard").hide();var n=this.currentResult.itemProperties.diagramOptions.nodeEventDic;if(n&&n[e.id]){var a=n[e.id];t.find("select[data-format-key='node.event']").val(a.action),a.showIn?t.find("select[data-format-key='node.showin']").val(a.showIn):t.find("select[data-format-key='node.showin']").val("oncontainer"),"opendashboard"==a.action&&(t.find("div.forOpenDashboard").show(),t.find("select[data-format-key='node.dashboard']").select2("val",a.value))}}t.closest(".dock").trigger("updateTitle",[e.id])},showDiagramProperties:function(){var e=o(".left-menu[data-rel='"+this.tagId+"']");e.find(".forDiagram").show(),e.find(".forNode").hide(),e.trigger("closeAll")},executeButton:function(e){var t=this;this.editMode?t.showNodeProperties(e):this.options.model.executeButton(e.id,(function(i){t.queryForFinishCalc(e.id)}))},queryForFinishCalc:function(e){var t=this,i=0;setTimeout((function(){!function o(){i++,t.options.model.isInBackground(e,(function(e){e?i<4?setTimeout((function(){o()}),300):setTimeout((function(){o()}),1e3):(t&&(t.fullRefresh(!0),t.options&&t.options.model&&t.model.reevaluateNodesNeeded()),t=null)}))}()}),200)}})}.apply(t,n))||(e.exports=a)}).call(this,i(1))}}]);