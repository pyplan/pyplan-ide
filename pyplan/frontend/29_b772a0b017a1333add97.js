/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{1129:function(e,t,a){"use strict";(function(n,r){var o,i=a(18);void 0===(o=function(){return n.Controller.extend({name:"NodeJs",socket:void 0,start:function(){},triggerEvent:function(e,t){var a={event:e,body:t};this.socket&&this.socket.connected&&this.socket.emit("sendMessage",__currentToken,a)},changeToken:function(e){this.socket&&this.socket.connected&&this.socket.emit("changeToken",e)},processMessage:function(e){if(e)switch(e.event){case"FPCaseAfterSave":r("#projectMapSidebar").trigger("refreshProject",[e.body]);break;case"DashboardShareAfterSave":r("#model-summary").trigger("reloadShared",[e.body]);break;case"UpdateCreateScenarioProgress":r("#scenarioManager,#dataSnapshot").trigger("updateProgress",[e.body]);break;case"RefreshImageDashboard":r("#summary").trigger("refreshImageDashboard",[e.body]),r("#report-manager").trigger("refreshImageDashboard",[e.body]),r("#main .mainTask[data-rel='dashboard-"+e.body+"']").trigger("refreshImageDashboard",[e.body]);break;case"AfterCreateDashboardComment":r(".dashboard-comments").trigger("refreshExternalComments",[e.body]);break;case"NeedLogout":r("body").trigger("needLogout");break;case"SessionKilled":r("body").trigger("sessionKilled");break;case"MemoryQuotaExceeded":r("body").trigger("memoryQuotaExceeded",[e.body]);break;case"ProcessCancelByMemoryQuotaExceeded":var t=(0,i.translate)("process_cancel_by_quota").replace("##quota##",e.body.memoryQuota).replace("##current##",e.body.modelMemory);(0,i.showMessage)(t,(0,i.translate)("_canceled"),"error");break;case"modelprogressbar":Promise.all([a.e(2),a.e(4),a.e(55)]).then((function(){var t=[a(682)];(function(t){(new t).showProgressBar(e.body)}).apply(null,t)})).catch(a.oe);break;case"modelmsgbox":Promise.all([a.e(2),a.e(4),a.e(55)]).then((function(){var t=[a(682)];(function(t){(new t).showMsgBox(e.body)}).apply(null,t)})).catch(a.oe);break;case"GenericMessage":var n=e.body.title;t=e.body.text;(0,i.showMessage)(t,n);break;case"notify":Promise.all([a.e(2),a.e(116)]).then((function(){var t=[a(968)];(function(t){(new t).notify(e.body)}).apply(null,t)})).catch(a.oe);break;case"ReloadAllOpenDashboards":Promise.all([a.e(2),a.e(4),a.e(7),a.e(30)]).then((function(){var e=[a(691)];(function(e){(new e).refreshAllOpenDashboards()}).apply(null,e)})).catch(a.oe);break;case"UpdatePrintReportProgress":Promise.all([a.e(2),a.e(4),a.e(7),a.e(30)]).then((function(){var t=[a(691)];(function(t){(new t).updatePrintReportProgress(e.body)}).apply(null,t)})).catch(a.oe);break;case"UpdatePrintReportMessage":Promise.all([a.e(2),a.e(4),a.e(7),a.e(30)]).then((function(){var t=[a(691)];(function(t){(new t).updatePrintReportMessage(e.body)}).apply(null,t)})).catch(a.oe);break;case"UpdatePrintReportComplete":Promise.all([a.e(2),a.e(4),a.e(7),a.e(30)]).then((function(){var t=[a(691)];(function(t){(new t).updatePrintReportComplete(e.body)}).apply(null,t)})).catch(a.oe);break;case"ExecuteButtonComplete":r("#genericLoading").hide(),e&&e.body&&e.body.error&&(0,i.showMessage)(e.body.result,void 0,"error");break;case"loadInputTemplate":case"unloadInputTemplate":case"setInputTemplatePos":case"setInputTemplateValues":r(".inputFormTask").trigger("collabMessage",[e.event,e.body]);break;case"ModelEditionAvailable":e&&e.body&&e.body.message&&((0,i.showMessage)(e.body.message,void 0,"info"),__currentSession.modelInfo&&__currentSession.modelInfo.uri==e.body.modelfile&&a.e(224).then((function(){var e=[a(220)];(function(e){var t=new e,a=r("#navigation li.modelopened[data-key='btnSaveModelAs'] a"),n=r("#navigation li.modelopened[data-key='btnSaveModelAs'] a i");t.canEdit()?(r("#navigation li.modelopened[data-key='btnSaveModel']").show(),n.removeClass("fa-paste").addClass("fa-save-all"),a.prop("title",(0,i.translate)("save_model_as")),r("#navigation li.modelopened[data-key='btnSaveModelAs']").show()):t.isInPublic()}).apply(null,e)})).catch(a.oe))}}})}.apply(t,[]))||(e.exports=o)}).call(this,a(677),a(1))},1846:function(e,t,a){var n=a(670);e.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(e,t,a,n,r){return'\n<div class="row formFilters" style="display: block;">\n    \n</div>\n\n<div class="row">\n\n    <ul class="inputFormCollabWrapper">\n    </ul>\n    <div class="col-sm-12 tableWrapper" style="width:100%;">\n    </div>\n\n    <div class="col-sm-12 rowCount">\n        \n    </div>\n\n</div>\n'},useData:!0})},1847:function(e,t,a){var n=a(670);e.exports=(n.default||n).template({1:function(e,t,n,r,o){var i,l,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"\n"+(null!=(i=(l=a(669),l&&(l.__esModule?l.default:l)).call(null!=t?t:e.nullContext||{},null!=t?s(t,"filterType"):t,"==","text",{name:"ifCond",hash:{},fn:e.program(2,o,0),inverse:e.program(4,o,0),data:o,loc:{start:{line:3,column:0},end:{line:44,column:11}}}))?i:"")},2:function(e,t,a,n,r){var o=e.lambda,i=e.escapeExpression,l=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="col-sm-3">\n\n    <div class="form-group">\n        <label for="textfield" class="control-label col-sm-12">'+i(o(null!=t?l(t,"header"):t,t))+'</label>\n        <div class="col-sm-10">\n            <div class="input-group">\n                <input class="form-control filterText col-sm-12" type="text" name="textfield" id="textfield"\n                    class="form-control" filter="true" field="'+i(o(null!=t?l(t,"field"):t,t))+'" value-field="'+i(o(null!=t?l(t,"valueField"):t,t))+'" filter-type="'+i(o(null!=t?l(t,"filterType"):t,t))+'"\n                    node-filter-id="'+i(o(null!=t?l(t,"nodeFilterId"):t,t))+'" template-code="'+i(o(null!=t?l(t,"entity"):t,t))+'" template-id="'+i(o(null!=t?l(t,"inputTemplateId"):t,t))+'"\n                    use-like="'+i(o(null!=t?l(t,"useLike"):t,t))+'" read-only="'+i(o(null!=t?l(t,"readOnly"):t,t))+'" status-ready="false" value="'+i(o(null!=t?l(t,"defaultVal"):t,t))+'">\n                <div class="input-group-btn">\n                    <button class="btn" type="button"> <i class="fa fa-search"></i> </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'},4:function(e,t,a,n,r){var o,i=e.lambda,l=e.escapeExpression,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="col-sm-3">\n    <div class="form-group">\n        <label for="textfield" class="control-label">'+l(i(null!=t?c(t,"header"):t,t))+"</label>\n\n"+(null!=(o=c(a,"if").call(s,null!=t?c(t,"multiple"):t,{name:"if",hash:{},fn:e.program(5,r,0),inverse:e.noop,data:r,loc:{start:{line:26,column:8},end:{line:28,column:19}}}))?o:"")+'\n            <div class="selectRemote" style="width: 100%; '+(null!=(o=c(a,"if").call(s,null!=t?c(t,"multiple"):t,{name:"if",hash:{},fn:e.program(7,r,0),inverse:e.noop,data:r,loc:{start:{line:30,column:58},end:{line:30,column:82}}}))?o:"")+'" filter="true" field="'+l(i(null!=t?c(t,"field"):t,t))+'"\n                value-field="'+l(i(null!=t?c(t,"valueField"):t,t))+'" filter-type="'+l(i(null!=t?c(t,"filterType"):t,t))+'" node-filter-id="'+l(i(null!=t?c(t,"nodeFilterId"):t,t))+'"\n                template-code="'+l(i(null!=t?c(t,"entity"):t,t))+'" template-id="'+l(i(null!=t?c(t,"inputTemplateId"):t,t))+'" use-like="'+l(i(null!=t?c(t,"useLike"):t,t))+'"\n                entity-label="'+l(i(null!=t?c(t,"entityLabel"):t,t))+'" related-field="'+l(i(null!=t?c(t,"relatedField"):t,t))+'"\n                related-manytomanyentity="'+l(i(null!=t?c(t,"relatedManyToManyEntity"):t,t))+'" related-manytomanykey="'+l(i(null!=t?c(t,"relatedManyToManyKey"):t,t))+'"\n                include-all="'+l(i(null!=t?c(t,"includeAll"):t,t))+'" read-only="'+l(i(null!=t?c(t,"readOnly"):t,t))+'" sort-by="'+l(i(null!=t?c(t,"sortBy"):t,t))+'" default-value="'+l(i(null!=t?c(t,"defaultValue"):t,t))+'"\n                status-ready="false"></div>\n\n'+(null!=(o=c(a,"if").call(s,null!=t?c(t,"multiple"):t,{name:"if",hash:{},fn:e.program(9,r,0),inverse:e.noop,data:r,loc:{start:{line:38,column:12},end:{line:40,column:15}}}))?o:"")+"\n    </div>\n</div>\n"},5:function(e,t,a,n,r){return'        <div class="multiple-wrapper">\n'},7:function(e,t,a,n,r){return" "},9:function(e,t,a,n,r){return"        </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,n,r){var o,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(o=i(a,"each").call(null!=t?t:e.nullContext||{},null!=t?i(t,"filters"):t,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:1,column:0},end:{line:45,column:9}}}))?o:""},useData:!0})},714:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestFile=t.request=void 0;var n=a(18);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t,a,n,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(n,r)}function i(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var i=e.apply(t,a);function l(e){o(i,n,r,l,s,"next",e)}function s(e){o(i,n,r,l,s,"throw",e)}l(void 0)}))}}var l=__apiURL,s=function(e){if(e&&e.hasError){var t=new Error(e.error);throw t.response=e,t}return e},c=function(e){var t=e.fileName,a=e.response;if(a&&a.hasError){var n=new Error(a.error);throw n.response=a,n}return{fileName:t,response:a}},d=function(e){return e.text().then((function(e){return e?JSON.parse(e):{}}))},u=function(){var e=i(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.headers.get("Content-Disposition").split("=")[1].replace(/['"]/g,""),e.next=3,t.blob().then((function(e){return e}));case 3:return n=e.sent,e.abrupt("return",{fileName:a,response:n});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),h=function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.statusText);t.response=e,e.text().then((function(a){throw(0,n.showMessage)("status : ".concat(e.status," <br/> ").concat(e.statusText," <br/> ").concat(a),(0,n.translate)("_request_error_in_fetch"),"error"),t}))},p=function(e,t){var a=__currentToken,n=e,o=e.headers?e.headers:{};if(a&&t.indexOf("/security/login?")<0){var i=new Headers(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){r(e,t,a[t])}))}return e}({Authorization:"Token ".concat(__currentToken),"session-key":__currentSession?__currentSession.session_key:""},o));n.headers=i}return n},f=function(){var e=i(regeneratorRuntime.mark((function e(t,a){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p(a,t),e.abrupt("return",fetch("".concat(l).concat(t),n).then(h).then(d).then(s));case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}();t.request=f;var m=function(){var e=i(regeneratorRuntime.mark((function e(t,a){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=p(a,t),e.abrupt("return",fetch("".concat(l).concat(t),n).then(h).then(u).then(c));case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}();t.requestFile=m},742:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bulkPartialUpdateTaskItemStatusTransition=t.listPosibleByFromStatusId=t.listTaskItemStatusTransitions=t.deleteTaskItemStatus=t.partialUpdateTaskItemStatus=t.createTaskItemStatus=t.listTaskItemStatuses=t.listTaskItemHistoryById=t.bulkPartialUpdateTaskItem=t.partialUpdateTaskItem=t.deleteTaskGroup=t.partialUpdateTaskGroup=t.createTaskGroup=t.listTaskGroups=t.deleteTask=t.listTasksByGroupsIds=t.listTasksByStatusId=t.listTasks=t.createTask=void 0;var n=a(714);function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}t.createTask=function(e){return(0,n.request)("/wftask/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})};t.listTasks=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).length>0&&Object.entries(e).map((function(e){var t=r(e,2),a=t[0],n=t[1];return"".concat(a,"=").concat(n)})).join("&");return(0,n.request)("/wftask/".concat(t?"?".concat(t):""),{method:"GET"})};t.listTasksByStatusId=function(e){return(0,n.request)("/wftask/list_by_status_id/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})};t.listTasksByGroupsIds=function(e){return(0,n.request)("/wftask/list_by_groups_ids/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({groups_ids:e})})};t.deleteTask=function(e){return(0,n.request)("/wftask/".concat(e,"/"),{method:"DELETE"})};t.listTaskGroups=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).length>0&&Object.entries(e).map((function(e){var t=r(e,2),a=t[0],n=t[1];return"".concat(a,"=").concat(n)})).join("&");return(0,n.request)("/wftaskgroup/".concat(t?"?".concat(t):""),{method:"GET"})};t.createTaskGroup=function(e){return(0,n.request)("/wftaskgroup/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})};t.partialUpdateTaskGroup=function(e,t){return(0,n.request)("/wftaskgroup/".concat(e,"/"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})};t.deleteTaskGroup=function(e){return(0,n.request)("/wftaskgroup/".concat(e,"/"),{method:"DELETE"})};t.partialUpdateTaskItem=function(e,t){return(0,n.request)("/wftaskitem/".concat(e,"/"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})};t.bulkPartialUpdateTaskItem=function(e){return(0,n.request)("/wftaskitem/bulk_partial_update/",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})};t.listTaskItemHistoryById=function(e){return(0,n.request)("/wftaskitemhistory/list_by_task_item_id/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})};t.listTaskItemStatuses=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).length>0&&Object.entries(e).map((function(e){var t=r(e,2),a=t[0],n=t[1];return"".concat(a,"=").concat(n)})).join("&");return(0,n.request)("/wftaskitemstatus/".concat(t?"?".concat(t):""),{method:"GET"})};t.createTaskItemStatus=function(e){return(0,n.request)("/wftaskitemstatus/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})};t.partialUpdateTaskItemStatus=function(e,t){return(0,n.request)("/wftaskitemstatus/".concat(e,"/"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})};t.deleteTaskItemStatus=function(e){return(0,n.request)("/wftaskitemstatus/".concat(e,"/"),{method:"DELETE"})};t.listTaskItemStatusTransitions=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e).length>0&&Object.entries(e).map((function(e){var t=r(e,2),a=t[0],n=t[1];return"".concat(a,"=").concat(n)})).join("&");return(0,n.request)("/wftaskitemstatustransition/".concat(t?"?".concat(t):""),{method:"GET"})};t.listPosibleByFromStatusId=function(e){return(0,n.request)("/wftaskitemstatustransition/list_posible_by_from_status_id/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})};t.bulkPartialUpdateTaskItemStatusTransition=function(e){return(0,n.request)("/wftaskitemstatustransition/bulk_partial_update/",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},910:function(module,exports,__webpack_require__){"use strict";(function(Backbone,$){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,_globalFxs=__webpack_require__(18),_handsontable=_interopRequireDefault(__webpack_require__(811)),_workflow=__webpack_require__(742),_moment=_interopRequireDefault(__webpack_require__(223));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),n.forEach((function(t){_defineProperty(e,t,a[t])}))}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function asyncGeneratorStep(e,t,a,n,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void a(e)}l.done?t(s):Promise.resolve(s).then(n,r)}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var o=e.apply(t,a);function i(e){asyncGeneratorStep(o,n,r,i,l,"next",e)}function l(e){asyncGeneratorStep(o,n,r,i,l,"throw",e)}i(void 0)}))}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(755),__webpack_require__(1129),__webpack_require__(1846),__webpack_require__(1847)],__WEBPACK_AMD_DEFINE_RESULT__=function(InputModuleModel,NodeJsManager,HTMLTemplate,HTMLFilters){var view=Backbone.View.extend({el:$("#main"),table:void 0,templateMetadata:void 0,templateData:void 0,tableData:void 0,hasRowTotal:!1,departmentDic:void 0,userDic:void 0,tableOptions:null,changesDic:{rows:[],toDelete:[]},rowsToDelete:{toDelete:[]},externalView:null,nodeJSManager:null,totalFilters:0,historyTimeOut:-1,titleTimeOut:-1,historyDic:null,includeHistory:!1,tagId:null,errorList:"",firstLoad:!0,_div:document.createElement("div"),_button:document.createElement("button"),render:function(e){var t=this;t._div.className="remoteDropdown",t._button.className="btn formBtn",this.tagId=e,this.nodeJSManager=new NodeJsManager,this.inputModuleModel=new InputModuleModel;var a=HTMLTemplate();this.getBase().append(a),this.drawTemplate(!1),this.addHandlers(),this.getBase().closest(".mainTask").on("removeView",(function(){t.onRemoveView()})),this.getBase().closest(".mainTask").on("collabMessage",(function(e,a,n){t.onCollabMessage(a,n)})),this.getBase().closest(".mainTask").on("refreshOnFocus",(function(){t.templateMetadata.refreshOnFocus&&t.getTemplateData()})),$(window).resize((function(){t.options.inputForm?t.onBaseResize():t.onResize()})),this.addMouseOverTitleHandler()},onResize:function(){this.getBase().find(".tableWrapper");var e=this.getBase().find(".formFilters").height(),t=$(window).width()-10;t-=68;var a=$(window).height();a-=145+e,this.table&&this.table.updateSettings({height:a,width:t})},onBaseResize:function(){var e=this.getBase().find(".formFilters").height(),t=this.$el.parent().width(),a=this.$el.parent().height();a-=55+e,this.table&&this.table.updateSettings({height:a,width:t})},onRemoveView:function(){if(this.inputModuleModel=null,this.departmentDic=null,this.userDic=null,this.changesDic={rows:[],toDelete:[]},this.table&&(this.table.destroy(),this.table=null),this.templateMetadata=null,this.templateData=null,this.tableData=null,this.externalView&&this.externalView.destroy)try{this.externalView.destroy()}catch(e){}this.externalView=null,this.nodeJSManager=null,this.historyDic=null},resize:function(){this.getBase().find(".inputTable").parent().height($(window).height()-200),this.getBase().find(".inputTable").height($(window).height()-200),this.getBase().find(".inputTable").trigger("updateSize")},getBase:function(){return this.$el},getBaseTask:function(){var e=this.options.templateId;return $('div[data-rel="form-'+e+'"]')},addHandlers:function(){var e=this,t=this.options.templateId;this.getBaseTask().find("button.addRow").on("click",(function(t){e.addNewRow()})),this.getBaseTask().find("button.showFilters").on("click",(function(t){e.toggleFilters()})),this.getBaseTask().find("button.showWorkflow").on("click",(function(t){t.preventDefault(),e.showWorkflow(t)})),this.getBaseTask().find("button.showHistory").on("click",(function(t){t.preventDefault(),e.includeHistory=!e.includeHistory,$(this).toggleClass("selected"),e.getTemplateData()})),this.getBase().find(".tableWrapper").on("mouseover","td.with-history",(function(){var t=$(this).attr("data-history-key"),a=event;e.historyTimeOut=setTimeout((function(){e.showHistoryData(a,t)}),500)})),this.getBase().find(".tableWrapper").on("mouseover","a.with-description",(function(){var t=$(this).attr("data-desc"),a=event;e.titleTimeOut=setTimeout((function(){e.showColDescription(a,t)}),500)})),this.getBase().find(".tableWrapper").on("mouseout","td.with-history",(function(){clearTimeout(e.historyTimeOut)})),this.getBase().find(".tableWrapper").on("mouseout","a.with-description",(function(){clearTimeout(e.titleTimeOut)})),$("a[data-rel="+t+"] div").on("click",(function(t){$(this).hasClass("orange")&&__webpack_require__.e(14).then((function(){var a=[__webpack_require__(733)];(function(a){var n={title:"Errors",content:e.errorList,left:t.clientX,top:t.clientY};(new a).show(n)}).apply(null,a)})).catch(__webpack_require__.oe)})),$(e.tagId).find(".dataStatus.orange").on("click",(function(t){__webpack_require__.e(14).then((function(){var a=[__webpack_require__(733)];(function(a){var n={title:"Errors",content:e.errorList,left:t.clientX,top:t.clientY};(new a).show(n)}).apply(null,a)})).catch(__webpack_require__.oe)}))},addMouseOverTitleHandler:function(){var e,t=this;$(this.tagId).find(".item-title .knowledge-arrow").hover((function(a){if(t.templateMetadata.workflowGroups&&t.templateMetadata.workflowGroups.length>0)return e=setTimeout((function(){$(".popover-title").parent().remove(),t.showWorkflow(a)}),1e3),!1}),(function(){clearTimeout(e)}))},toggleFilters:function(e){this.getBase().find(".formFilters").toggle()},addNewRow:function(){var e=this,t={id:this.options.templateId,debugConsole:"-- AddNewRow --",rows:[{changes:[],id:-1}]};e.addDataForHiddenCols(e.table.getInstance(),t.rows[0]),this.inputModuleModel.setData(t,(function(t){var a=e.table.countRows(),n=a;e.hasRowTotal&&(n=a-1),e.table.alter("insert_row",n,1,"ContextMenu.rowAbove"),e.table.setDataAtRowProp(n,"id",t[0].newId)}))},deleteRows:function(){var e=this;this.inputModuleModel.setData(e.rowsToDelete,(function(t){t.length>0&&(e.drawTable(),e.rowsToDelete.toDelete=[],e.toRemoveOnTable=[])}))},drawTemplate:function(e){var t=this,a=this.options.templateId;a||(a=this.options.inputForm.templateId),this.inputModuleModel.getMetadata(a,(function(n){t.loadMetadata(n,a,e),t.$el.trigger("onUpdateMetadata",n),n.readOnly&&t.redrawTable()}))},loadMetadata:function(e,t,a){var n=this;this.templateMetadata=e,this.includeExternalJs();var r=e.filters||[];this.loadToolbar();var o=!0;this.totalFilters=r.length;for(var i=0;i<r.length;i++)!0===r[i].includeAll||void 0===r[i].includeAll?(r[i].includeAll=!0,o=!1):!1===r[i].includeAll&&(o=!1);r.length>0&&this.drawFilters(r,a);var l=new Promise((function(t,a){n.checkForDepartmentSelector(e)?n.createDepartmentDict((function(){t(!0)})):t(!1)})),s=new Promise((function(t,a){n.checkForUserSelector(e)?n.createUserDict((function(){t(!0)})):t(!1)}));Promise.all([l,s]).then((function(e){(e[0]||e[1]||o)&&n.getTemplateData()})),this.templateMetadata.allowAdd&&$(this.tagId).trigger("setAddButton")},getTemplateData:function getTemplateData(){var _this=this,formId=this.options.templateId;formId||(formId=this.options.inputForm.templateId);var params={id:formId,filters:[],includeHistory:_this.includeHistory},filters=[];if(_this.firstLoad&&_this.options.savedFilters&&_this.options.savedFilters.length>0)for(var i=0;i<_this.options.savedFilters.length;i++)this.getBase().find('.formFilters .selectRemote[field="'+_this.options.savedFilters[i].field+'"]').select2("data",_this.options.savedFilters[i].val);_this.firstLoad=!1,this.getBase().find(".formFilters .selectRemote.select2-offscreen, .formFilters .filterText").each((function(e,t){var a,n,r=$(t).attr("field"),o=$(t).attr("value-field"),i=$(t).attr("use-like"),l=$(t).attr("filter-type"),s=$(t).attr("node-filter-id");if(i="true"===i,"text"===l)n=[],""==(a=$(t).val()).trim()&&(a="-1"),i=!0;else if(o){var c=$(t).select2("data");n=[$(t).select2("data")],"1"===l?(a=[],$.each(c,(function(e,t){a.push(t[o])}))):a="-1"===c.id?"-1":c[o]}else a=$(t).select2("val"),n=[$(t).select2("data")];var d=[];"string"==typeof a&&(a=[a]),a.length>0&&"-1"!==a[0]&&($.each(a,(function(e,t){d.push(t)})),o?filters.push({field:o,nodeFilterId:s,idxValues:n,values:d,useLike:i}):filters.push({field:r,nodeFilterId:s,idxValues:n,values:d,useLike:i}))})),filters.length>0&&(params.filters=filters),_this.lastFiltersStatus=params.filters,this.inputModuleModel.getData(params,(function(templateData){try{var fnOnLoad;if(_this.templateMetadata&&_this.templateMetadata.onLoad)eval(" fnOnLoad = "+_this.templateMetadata.onLoad),fnOnLoad(params)}catch(e){console.log("Error onLoad: "+e.message)}_this.templateData=templateData,_this.drawTable()}))},loadToolbar:function(){this.templateMetadata.allowAdd&&this.getBaseTask().find("button.addRow").show(),this.templateMetadata.workflowGroups&&this.templateMetadata.workflowGroups.length>0&&this.getBaseTask().find("button.showWorkflow").show(),this.templateMetadata.enableHistoryChanges},instanceTextFilters:function(e){var t=this;this.getBase().find(".filterText").each((function(e,a){var n=$(a),r=n.attr("template-id"),o=n.attr("template-code"),i=n.attr("filter-type"),l=n.attr("entity-label"),s=n.attr("field"),c=n.attr("value-field"),d="true"===n.attr("read-only"),u={code:o,pageSize:10};o||(u.templateId=r);var h=t.getFilterFromField(s),p=h&&h.initialValue?t.evaluateIfIsFunction(h.initialValue):void 0,f={params:u,$el:$(a),labelField:l,valueField:c,readOnly:d,filterType:i,initialValue:p,tagId:t.tagId,inputLength:3,callback:function(){t.table&&null!==t.table.table&&t.table.destroy(),t.getBase().find('.formFilters .filterText[field="'+s+'"]').attr("status-ready","true"),t.allFiltersLoaded()}};__webpack_require__.e(284).then((function(){var e=[__webpack_require__(2643)];(function(e){new e(f).render()}).apply(null,e)})).catch(__webpack_require__.oe)}))},drawFilters:function(e,t){var a=this,n={filters:e};if(t)return!0,void a.allFiltersLoaded();var r=HTMLFilters(n);this.getBase().find(".formFilters").append(r),a.instanceTextFilters(),this.getBase().find(".formFilters .selectRemote").each((function(e,t){var n=$(t).attr("template-id"),r=$(t).attr("template-code"),o=($(t).attr("filter"),$(t).attr("filter-type")),i=$(t).attr("node-filter-id"),l=$(t).attr("entity-label"),s=$(t).attr("field"),c=$(t).attr("related-field"),d=$(t).attr("value-field"),u=$(t).attr("related-manytomanyentity"),h=$(t).attr("related-manytomanykey"),p="true"===$(t).attr("include-all"),f="true"===$(t).attr("read-only"),m=$(t).attr("sort-by"),g=$(t).attr("default-value"),_=null,b={code:r,pageSize:10};""!==r&&null!==r?b.code=r:b.templateId=n;var v=c.split(","),y=[];v.length>0&&""!==v[0]&&$.each(v,(function(e,t){_=null,t=t.trim();var n=a.getBase().find('.formFilters .selectRemote[field="'+t+'"]');_={relatedEl:n,relatedField:t,relatedManyToManyEntity:u=u,relatedManyToManyKey:h=h},y.push(_)}));var w={params:b,$el:$(this),labelField:l,valueField:d,relatedObject:y,includeAll:p,readOnly:f,sortBy:m,filterType:o,nodeFilterId:i,tagId:a.tagId,defaultValue:g,inputLength:0,callback:function(e){a.table&&null!==a.table.table&&a.table.destroy(),a.getBase().find('.formFilters .selectRemote[field="'+s+'"]').attr("status-ready","true"),a.countRelatedFilters(s),a.allFiltersLoaded()}};__webpack_require__.e(287).then((function(){var e=[__webpack_require__(2644)];(function(e){new e(w).render()}).apply(null,e)})).catch(__webpack_require__.oe)}))},allFiltersLoaded:function(){!(this.getBase().find('.formFilters .selectRemote[status-ready="false"]').length>0)&&(this.getTemplateData(),this.refreshFiltersToIndex())},refreshFiltersToIndex:function(){$(this.tagId).trigger("onFiltersChange",[this.lastFiltersStatus])},countRelatedFilters:function(e,t){var a=this;this.getBase().find(".formFilters .selectRemote").each((function(t,n){var r=$(this).attr("related-field"),o=0,i=-1;r?(o=(r=r.replace(/\s/g,"").split(",")).length,i=r.indexOf(e)):o=0,o>1&&i>=0?($(this).attr("status-ready",!1),a.checkMultipleRelated($(this),o,r)):e===$(this).attr("related-field")&&($(this).attr("status-ready",!1),$(this).trigger("relatedChanged",$(this).attr("field")))}))},checkMultipleRelated:function(e,t,a){for(var n=0,r=0;r<t;r++)"true"===$('.selectRemote[field="'+a[r].trim()+'"]').attr("status-ready")&&n++;n!==t||"false"!==$(e).attr("status-ready")&&!1!==$(e).attr("status-ready")?"false"===$(e).attr("status-ready")&&this.checkMultipleRelated(e,t,a):$(e).trigger("relatedChanged",$(e).attr("field"))},checkIfRelatedHasValues:function(e){e=e;this.getBase().find(".formFilters .selectRemote").each((function(t,a){e===$(this).attr("related-field")&&(e=$(this).attr("field"))}))},drawTable:function(){this.tableData=this.templateData,this.historyDic=this.generateHistoryDic(),this.redrawTable(),this.sendCurrentPosition()},departmentsRenderer:function(e,t,a,n,r,o,i){var l,s=this;if(_handsontable.default.renderers.TextRenderer.apply(this,arguments),o){var c="",d=o.split(",");d.map((function(e){""!=c&&(c+=", "),c+=s.departmentDic[e]})),l=c}else l="";_handsontable.default.dom.empty(t);var u=$(document.createElement("div"));u.css("width","100%"),u.text(l),u.appendTo($(t)),_handsontable.default.dom.addEvent(t,"dblclick",(function(t){t.preventDefault(),s.openDepartmentSelector(e,a,n,e.getSourceDataAtCell(a,n))}))},usersRenderer:function(e,t,a,n,r,o,i){var l,s=this;if(_handsontable.default.renderers.TextRenderer.apply(this,arguments),o){var c="",d=o.split(",");d.map((function(e){""!=c&&(c+=", "),c+=s.userDic[e]})),l=c}else l="";_handsontable.default.dom.empty(t);var u=$(document.createElement("div"));u.css("width","100%"),u.text(l),u.appendTo($(t)),_handsontable.default.dom.addEvent(t,"dblclick",(function(t){t.preventDefault(),s.openUserSelector(e,a,n,e.getSourceDataAtCell(a,n))}))},buttonRenderer:function buttonRenderer(instance,td,row,col,prop,value,cellProperties){_handsontable.default.renderers.TextRenderer.apply(this,arguments);var _this=this,buttonLabel=instance.getSettings().columns[col].buttonLabel;_handsontable.default.dom.empty(td);var button=_this._button.cloneNode(!0);return button.textContent=buttonLabel,td.appendChild(button),_handsontable.default.dom.addEvent(button,"click",(function(e){e.preventDefault();try{var fnOnClick;if(eval(" fnOnClick = "+instance.getSettings().columns[col].onclick),!1===fnOnClick(_this,instance,row,col))return!1}catch(e){console.log("Error onClick: "+e.message)}})),td},openDepartmentSelector:function(e,t,a,n){var r=this,o=[],i=null!=n?n.split(","):"",l=function(){var e={value:s,text:r.departmentDic[s],selected:!1};i.length>0&&i.forEach((function(t){e.value===t&&(e.selected=!0)})),o.push(e)};for(var s in this.departmentDic)l();var c={sourceDepartments:o,callback:function(n){e.setDataAtCell(t,a,n)}};__webpack_require__.e(33).then((function(){var e=[__webpack_require__(844)];(function(e){(new e).openDepartmentSelectorModal(c,null)}).apply(null,e)})).catch(__webpack_require__.oe)},openUserSelector:function(e,t,a,n){var r=this,o=[],i=null!=n?n.split(","):"",l=function(){var e={value:s,text:r.userDic[s],selected:!1};i.length>0&&i.forEach((function(t){e.value===t&&(e.selected=!0)})),o.push(e)};for(var s in this.userDic)l();var c={sourceUsers:o,callback:function(n){e.setDataAtCell(t,a,n)}};__webpack_require__.e(33).then((function(){var e=[__webpack_require__(844)];(function(e){(new e).openUserSelectorModal(c,null)}).apply(null,e)})).catch(__webpack_require__.oe)},remoteDropdownRenderer:function(e,t,a,n,r,o,i){var l=this,s="|-|",c="",d=e.getSettings().columns[n].readOnly;if(l.hasRowTotal&&a===e.countRows()-1)return t;if(l.checkValidations(e,a),null!==o&&"null|-| "!==o&&"|-|"!==o||(c=""),null!==o&&(o.indexOf(s)>=0&&(c=o.split(s)[1]),-1===o.indexOf(s)&&(c=null)),null!==c){_handsontable.default.renderers.BaseRenderer.apply(this,arguments),_handsontable.default.dom.empty(t);var u=l._div.cloneNode(!0),h=e.getSettings().columns[n].relatedField;return null!==h&&""!==h&&void 0!==h&&u.setAttribute("related-field",h),u.textContent=c,t.appendChild(u),$(u).on("changeRemote",(function(t,a){e.setDataAtCell(a.instance.row,a.relatedCol,"null|-| ")})),_handsontable.default.dom.addEvent(u,"click",(function(s){s.preventDefault(),i.readOnly||d||l.initializeRemoteDropdown(e,t,a,n,r,o,i)})),t}},initializeRemoteDropdown:function(e,t,a,n,r,o,i){var l=this,s={pageSize:10},c=e.getSettings().columns[n].code;""!==c&&null!==c?s.code=c:s.templateId=e.getSettings().columns[n].inputTemplateId;var d=e.getSourceDataAtCell(a,n);if(e.getSettings().columns[n].relatedField)var u=e.getSettings().columns[n].relatedField.split(",");if(void 0!==u){var h,p,f=null,m=null,g=[];$.each(u,(function(t,r){var o=null;r=r.trim();for(var i=0;i<l.templateMetadata.columns.length;i++)if(h=l.templateMetadata.columns[i].field,p=l.templateMetadata.columns[i].hidden,r===h&&!0===p){var s=l.getBase().find('.formFilters .selectRemote[field="'+l.templateMetadata.columns[i].field+'"]'),c=s.val();f=s.attr("related-manytomanyentity"),m=s.attr("related-manytomanykey"),o={relatedVal:c,relatedField:r,relatedManyToManyEntity:f,relatedManyToManyKey:m},g.push(o)}null===o&&null!==e.getDataAtRowProp(a,r)&&(c=e.getDataAtRowProp(a,r),f=e.getSettings().columns[n].relatedManyToManyEntity,m=e.getSettings().columns[n].relatedManyToManyKey,o={relatedVal:c,relatedField:r,relatedManyToManyEntity:f,relatedManyToManyKey:m},g.push(o))}))}var _={params:s,$el:$(t).find("div"),labelField:e.getSettings().columns[n].entityLabel,valueField:e.getSettings().columns[n].data,enabledItemField:e.getSettings().columns[n].enabledItemField,relatedObject:g,tableInstance:{instance:e,row:a,col:n},inputLength:0,callback:function(t){var a=this.tableInstance.row,n=this.tableInstance.col,r=this.tableInstance.instance.getCellMeta(a,n),o=this.tableInstance.instance.getSettings().columns;if(e.getSourceDataAtCell(a,n)!==t[r.prop]){e.setDataAtCell(this.tableInstance.row,this.tableInstance.col,t[r.prop]);for(var i=null,l=0;l<o.length;l++)o[l].relatedField===r.prop&&(i=l);i&&this.tableInstance.col!==i&&this.$el.trigger("changeRemote",{instance:this.tableInstance,field:r,relatedCol:i})}}};d&&(_.selectedId=d.split("|-|")[0],_.selectedLabel=d.split("|-|")[1]),__webpack_require__.e(286).then((function(){var e=[__webpack_require__(2645)];(function(e){new e(_).render()}).apply(null,e)})).catch(__webpack_require__.oe)},redrawTable:function redrawTable(){var _this=this,separator="|-|";this.table&&(this.getBase().find(".inputTable").remove(),this.table=null),this.getBase().find(".tableWrapper").append('<div class="inputTable" style="height:100%, overflow:scroll"></div>');var $table=this.getBase().find(".inputTable");this.tableOptions=this.parseMetadata(),this.hasRowTotal&&this.tableData.push([]),_handsontable.default.renderers.registerRenderer("remoteDropdown",(function(e,t,a,n,r,o,i){return _this.remoteDropdownRenderer(e,t,a,n,r,o,i)})),_handsontable.default.renderers.registerRenderer("departmentsRenderer",(function(e,t,a,n,r,o,i){return _this.departmentsRenderer(e,t,a,n,r,o,i)})),_handsontable.default.renderers.registerRenderer("usersRenderer",(function(e,t,a,n,r,o,i){return _this.usersRenderer(e,t,a,n,r,o,i)})),_handsontable.default.renderers.registerRenderer("buttonRenderer",(function(e,t,a,n,r,o,i){return _this.buttonRenderer(e,t,a,n,r,o,i)}));var hot1=$table.handsontable({data:this.tableData,fixedColumnsLeft:this.tableOptions.fixedColumnsLeft,manualColumnResize:this.tableOptions.columnResize,nestedHeaders:this.tableOptions.nestedHeaders,colWidths:this.tableOptions.colWidths,colHeaders:!1!==this.tableOptions.colHeaders&&function(e){var t=_this.tableOptions.colHeaders[e],a=_this.tableOptions.columns[e].description;return a&&""!==a&&(t='<a data-desc="'+a+'" class="with-description">'+t+"</a>"),t},contextMenu:!!this.tableOptions.allowRemove&&["remove_row"],rowHeaders:this.tableOptions.rowHeaders,columns:this.tableOptions.columns,minRows:0,stretchH:"all",afterSelection:function(e,t,a,n){var r=[],o=[e,a];o.sort((function(e,t){return t-e}));for(var i=o[0]-o[1]+1,l=o[1];l<=o[0];l++)r.push(this.getDataAtRowProp(l,"id"));_this.rowsToDelete.id=_this.options.templateId;var s=o[0]===o[1]?o[0]:o[1];_this.toRemoveOnTable=[s,i],_this.rowsToDelete.toDelete=r},afterDeselect:function(){_this.rowsToDelete.toDelete=[],_this.toRemoveOnTable=[]},afterRemoveRow:function(e,t){_this.deleteRows()},beforeKeyDown:function(e){8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&46!=e.keyCode||$(e.path[1]).hasClass("select2-search")&&(e.isImmediatePropagationEnabled=!1)},beforeRender:function(e){_this.beforeRender(e,_this.tableOptions)},afterRenderer:function(e,t,a,n,r,o){_this.applyStyles(this,e,t,a,n,r,o)},beforeChange:function beforeChange(changes,source){for(var row,col,prop,cellProperties,cols=this.getSettings().columns,cc=changes.length-1;cc>=0;cc--){for(var isNumeric=!1,value=changes[cc][3],currentCol,i=0;i<cols.length;i++)if(cols[i].data===changes[cc][1]){isNumeric="numeric"===cols[i].type,currentCol=cols[i];break}if(isNumeric&&isNaN(value)&&!0!==value&&""!==value)return!1;if(row=changes[cc][0],col=this.propToCol(changes[cc][1]),prop=changes[cc][1],cellProperties=this.getCellMeta(row,col),null!==changes[cc][2]&&void 0!==changes[cc][2]&&-1!==changes[cc][2]&&!isNumeric&&changes[cc][2].toString().indexOf(separator)>=0&&-1===changes[cc][3].toString().indexOf(separator))return!1;if(currentCol&&void 0!==currentCol.onBeforeChange&&currentCol.onBeforeChange)try{var fnOnChange;if(eval(" fnOnChange = "+currentCol.onBeforeChange),!1===fnOnChange(_this,this,changes[cc],source))return!1}catch(e){console.log("Error onBeforeChange: "+e.message)}}},afterChange:function(e,t){null!==e&&e.length>0&&("CopyPaste.paste"!==t&&"edit"!==t&&"Autofill.fill"!==t&&"UndoRedo.undo"!==t&&"UndoRedo.redo"!==t||"id"===e[0][1]||_this.updateDic(e,t,this))},cells:function cells(row,col,prop){var cellProperties={};try{var fnCustomFn,fn=_this.getOnCellFunctionByProp(prop,this.instance);fn&&(eval("fnCustomFn= "+_this.getOnCellFunctionByProp(prop,this.instance)),fnCustomFn(this.instance,null,row,col,prop,null,cellProperties))}catch(e){console.log("getOnCellFunctionByProp error: "+e.message)}return _this.hasRowTotal?(row===this.instance.countRows()-1&&(cellProperties.readOnly=!0),cellProperties):cellProperties}});this.table=$table.handsontable("getInstance");var countRows=_this.hasRowTotal?this.table.countRows()-1:this.table.countRows();this.getBase().find(".rowCount").text("Total rows: "+countRows);try{this.externalView&&this.externalView.onCreateTable&&this.externalView.onCreateTable(this.table)}catch(e){console.log("Error on external view:onCreateTable"+e.message)}this.options.inputForm?_this.onBaseResize():_this.onResize(),_this.templateMetadata.workflowGroups&&_this.templateMetadata.workflowGroups.length>0&&$(this.tagId).find(".item-title .knowledge-arrow").addClass("on")},getOnCellFunctionByProp:function(e,t){for(var a=0;a<this.templateMetadata.columns.length;a++)if(this.templateMetadata.columns[a].field===e)return this.templateMetadata.columns[a].onCell},addDataForHiddenCols:function(e,t){for(var a=this.templateMetadata.columns,n=0;n<a.length;n++)if(a[n].hidden){var r=this.getBase().find('.formFilters .selectRemote[field="'+a[n].field+'"]');if(r.length>0){for(var o=r.val(),i=!1,l=0;l<t.changes.length;l++)if(t.changes[l].field===a[n].field){i=!0;break}i||t.changes.push({field:a[n].field,value:o})}}},updateDic:function updateDic(changes,source,instance){var _this=this,separator="|-|",instance=instance,inputTemplateId=this.options.templateId,dataRow,rowIndex,changeField;this.changesDic.debugConsole="-- updateDic ("+source+") --",this.changesDic.toDelete=[],this.changesDic.rows=[],this.changesDic.id=inputTemplateId;for(var isReadOnly=!1,x=0;x<changes.length;x++)if(isReadOnly=instance.getCellMeta(changes[x][0],instance.propToCol(changes[x][1])).readOnly,isReadOnly&&console.log("readonly: "+changes[x][0]+", "+instance.propToCol(changes[x][1])),!isReadOnly){dataRow=instance.getSourceDataAtRow(changes[x][0]),dataRow.id||(dataRow.id=-1);var value=changes[x][3];rowIndex=changes[x][0],changeField=changes[x][1],"object"===_typeof(changes[x][3])&&(value=null===changes[x][3]?"":changes[x][3].id),"number"!=typeof value&&value.indexOf(separator)>=0&&(value=value.split(separator)[0],"null"===value&&(value=null));for(var change={id:dataRow.id,rowIndex:rowIndex,changes:[{field:changeField,value:value}]},isRowOnEdition=!1,i=0;i<this.changesDic.rows.length;i++)if(this.changesDic.rows[i].rowIndex===rowIndex){isRowOnEdition=!0;for(var j=0;j<this.changesDic.rows[i].changes.length;j++)this.changesDic.rows[i].changes[j].field===changeField&&this.changesDic.rows[i].changes.splice(j,1);this.changesDic.rows[i].changes.push({field:changeField,value:value});break}isRowOnEdition||(this.changesDic.rows.push(change),-1===change.id&&_this.addDataForHiddenCols(instance,this.changesDic.rows[this.changesDic.rows.length-1]))}var formId=this.options.templateId,row,prop,dataStatusDash=$(_this.tagId).find(".commonOptsWrapper .dataStatus");$(dataStatusDash).removeClass(["green,","orange"]).addClass("yellow"),$("a[data-rel="+formId+"] div").removeClass(["green,","orange"]).addClass("yellow"),this.inputModuleModel.setData(this.changesDic,(function(res){var error=!1,row;if(res.length>0)for(var i=0;i<res.length;i++)res[i].err&&(error=!0,_this.errorList+="- "+res[i].err+"<br>");if(error){$(dataStatusDash).removeClass("green yellow").addClass("orange"),$("a[data-rel="+formId+"] div").removeClass("green yellow").addClass("orange");for(var i=0;i<_this.changesDic.rows.length;i++)row=_this.changesDic.rows[i].rowIndex,_this.checkValidations(instance,row)}else{try{var fnOnChange;if(_this.templateMetadata&&_this.templateMetadata.onChange)eval(" fnOnChange = "+_this.templateMetadata.onChange),fnOnChange(_this.changesDic),$(dataStatusDash).removeClass("orange yellow").addClass("green"),$("a[data-rel="+formId+"] div").removeClass("orange yellow").addClass("green"),_this.errorList=""}catch(e){$(dataStatusDash).removeClass("green yellow").addClass("orange"),$("a[data-rel="+formId+"] div").removeClass("green yellow").addClass("orange"),console.log("Error onChange: "+e.message)}for(var i=0;i<res.length;i++)res[i].newId!==res[i].id&&res[i].id<0&&instance.setDataAtRowProp(res[i].rowIndex,"id",res[i].newId);$(dataStatusDash).removeClass("orange yellow").addClass("green"),$("a[data-rel="+formId+"] div").removeClass("orange, yellow").addClass("green"),_this.changesDic.rows=[],_this.errorList=""}}),(function(e){var t=_this.options.templateId;$(dataStatusDash).removeClass("green yellow").addClass("orange"),$("a[data-rel="+t+"] div").removeClass("green yellow").addClass("orange")}))},checkValidations:function(e,t){for(var a=e.getSettings().columns,n=0;n<a.length;n++){var r=null;if(a[n].validators&&a[n].validators.required&&(null===(r=e.getDataAtCell(t,n))||"null|-| "===r||"|-|"===r)){var o=e.getCell(t,n);$(o).addClass("required-td")}}},firstRowRenderer:function(e,t,a,n,r,o,i){_handsontable.default.renderers.TextRenderer.apply(this,arguments),t.style.fontWeight="bold",t.style.color="green",t.style.background="#CEC"},beforeRender:function(e,t){if(e){this.table||(this.table=this.getBase().find(".inputTable").handsontable("getInstance"));for(var a=this.tableData,n=this.table.getSettings().columns,r=0;r<n.length;r++)if(n[r].formula)for(var o=0;o<a.length;o++)a[o]["_cc"+r]=this.parseFormula(a[o],n[r].formula)}},parseFormula:function parseFormula(row,columnFormula){for(var res,formula=columnFormula,performCalc=!1,re=/#(.*?)#/gim,resReg;null!==(resReg=re.exec(columnFormula));){resReg.index===re.lastIndex&&re.lastIndex++;var key=resReg[1];if(void 0!==row[key]){performCalc=!0;var rr=new RegExp("#"+key+"#","gi");formula=formula.replace(rr,row[key])}}if(performCalc)try{res=eval(formula)}catch(e){res=0}return res},applyStyles:function applyStyles(hotInstance,TD,row,col,prop,value,cellProperties){var _this=this,fnConditional;if(cellProperties||(cellProperties={}),cellProperties.style)for(var key in cellProperties.style)TD.style[key]=this.evaluateIfIsFunction(cellProperties.style[key]);cellProperties.conditionalFormat&&($.isArray(cellProperties.conditionalFormat)?fnConditional=function(e,t,a,n,r,o,i){for(var l=cellProperties.conditionalFormat,s=0;s<l.length;s++)if(o>=l[s].from&&o<l[s].to){for(var c in l[s].style)t.style[c]=l[s].style[c];break}}:eval("fnConditional = "+cellProperties.conditionalFormat),fnConditional(hotInstance,TD,row,col,prop,value,cellProperties));if(row<=this.tableData.length-1&&cellProperties.customCellFunction)try{var fnCustomFn;eval("fnCustomFn= "+cellProperties.customCellFunction),fnCustomFn(hotInstance,TD,row,col,prop,value,cellProperties)}catch(e){console.log("customCellFunction error: "+e.message)}if(this.historyDic){var key=row+"||"+prop;this.historyDic[key]&&($(TD).addClass("with-history").attr("data-history-key",key),$("<div class='history'></div>").appendTo(TD))}this.hasRowTotal&&row==this.tableData.length-1&&(TD.style.backgroundColor="#666666",TD.style.color="#ffffff",1!==this.tableOptions.columns[col].totalType&&(cellProperties.type="text"))},parseMetadata:function(){var e={fixedColumnsLeft:void 0,columnResize:!1,colHeaders:[],columns:[],columnSummary:[],nestedHeaders:[]};if(this.templateMetadata){e.fixedColumnsLeft=this.templateMetadata.fixedColumns,e.columnResize=this.templateMetadata.columnResize,e.colHeaders=this.templateMetadata.colHeaders,e.rowHeaders=this.templateMetadata.rowHeaders,e.allowRemove=this.templateMetadata.allowRemove,e.allowAdd=this.templateMetadata.allowAdd,e.colWidths=this.templateMetadata.colWidths,e.nestedHeaders=[],void 0!==this.templateMetadata.nestedHeaders&&null!==this.templateMetadata.nestedHeaders?e.nestedHeaders=this.templateMetadata.nestedHeaders:e.nestedHeaders=null;for(var t,a=[],n=0,r=0;r<this.templateMetadata.columns.length;r++){var o=this.templateMetadata.columns[r];o.hidden||(t=this.generateTableColumn(o,n),a.push(o.header),e.columns.push(t),n++)}null!==e.nestedHeaders&&e.nestedHeaders.length>0?(e.nestedHeaders.push(a),e.colHeaders=!1):e.colHeaders=a}return e},numericValidator:function(e,t){isNaN(e)&&!0===e&&""===e?t(!1):t(!0)},checkUnique:function(e,t){var a=!0,n=[];this.table&&(n=this.table.getDataAtCol(e));for(var r=0;r<n.length;r++)if(!(a=t!==n[r]))return a;return a},applyValidator:function(e,t,a,n){var r=!0;e.required&&0===t.length&&(r=!1),e.range&&(t<e.range[0]||t>e.range[1])&&(r=!1),e.unique&&!1!==e.unique&&(r=this.checkUnique(a,t)),n(r)},generateTableColumn:function(e,t){var a=this,n={},r=e.type;switch(n.data=e.field,r){case"numeric":n.readOnly=!1,1===e.totalType&&(a.hasRowTotal=!0,n.renderer=function(e,t,n,r,o,i){n==e.countRows()-1&&(i=a.getTotal(e,r)),arguments[5]=i,_handsontable.default.renderers.NumericRenderer.apply(this,arguments)});break;case"text":n.readOnly=!1;break;case"dropdown":n.source=this.getListFromDataset(e.entity,e.entityLabel);break;case"calc":r="numeric",n.readOnly=!0,n.formula=e.formula,n.data="_cc"+t;break;case"departmentSelector":r="text",n.readOnly=!1,n.renderer="departmentsRenderer",n.editor=!1;break;case"userSelector":r="text",n.readOnly=!1,n.renderer="usersRenderer",n.editor=!1;break;case"remoteDropdown":r="text",n.readOnly=!1,n.renderer="remoteDropdown",n.editor=!1,e.relatedField&&(n.relatedField=e.relatedField),e.relatedManyToManyEntity&&(n.relatedManyToManyEntity=e.relatedManyToManyEntity,n.relatedManyToManyKey=e.relatedManyToManyKey);break;case"relatedColumn":r="0"==e.relatedColumnType||"numeric"==e.relatedColumnType?"numeric":"text",n.readOnly=!0;break;case"button":r="text",n.onclick=e.onClick,n.buttonLabel=e.buttonLabel,n.renderer="buttonRenderer",n.editor=!1,n.data="id";break;case"date":case"dateTime":r="date",n.readOnly=!1,n.type="date",n.dateFormat="YYYY-MM-DD",n.correctFormat=!0,n.allowEmpty=!1,n.datePickerConfig={firstDay:0,showWeekNumber:!0,numberOfMonths:2}}return!0===a.templateMetadata.readOnly&&(n.readOnly=!0),n.type=r,n.format=e.format,n.required=e.required,n.style=e.style,n.conditionalFormat=e.conditionalFormat,n.inputTemplateId=e.inputTemplateId,n.code=e.entity,n.entityLabel=e.entityLabel,n.totalType=e.totalType,n.validators=e.validators,n.customCellFunction=e.customCellFunction,n.onCell=e.onCell,n.onBeforeChange=e.onBeforeChange,n.hidden=!0===e.hidden,n.enabledItemField=e.enabledItemField,n.description=e.description,e.validators&&(n.validator=function(e,n){a.applyValidator(this.validators,e,t,n)},n.allowInvalid=!1),e.readOnly&&(e.readOnly?n.readOnly=!0:this.isFunction(e.readOnly)&&(n.readOnly=this.evaluateIfIsFunction(e.readOnly))),n},getTotal:function(e,t){var a;return e.getData().reduce((function(e,n){return null!=(a=0===n.length||""===n[t]?0:n[t])?e+a:e}),0)},getLabelFromDataset:function(e,t,a){var n=null;if(this.templateMetadata&&this.templateMetadata.dataset[t])for(var r=this.templateMetadata.dataset[t],o=0;o<r.data.length;o++)if(r.data[o][0]==e){var i=r.columns.indexOf(a.toLowerCase());n=r.data[o][i];break}return n},getListFromDataset:function(e,t){var a=[];if(this.templateMetadata&&this.templateMetadata.dataset[e])for(var n=this.templateMetadata.dataset[e],r=0;r<n.data.length;r++){var o=n.columns.indexOf(t.toLowerCase());a.push(n.data[r][o])}return a},isFunction:function(e){return!!(e&&e.length>30&&e.toLowerCase().startsWith("function"))},evaluateIfIsFunction:function evaluateIfIsFunction(value){var res=value;if(this.isFunction(value))try{var _this=this;eval("res = "+value),res=res()}catch(e){return console.log(e.message),null}return res},ensureEmptyRow:function(){var e=!1;if(this.tableData){if(this.tableData.length<=1)e=!0;else{for(var t=this.tableData[this.tableData.length-2],a=!0,n=0;n<t.length;n++)if(t[n]){a=!1;break}e=!a}e&&this.tableData.push({})}return e},checkForDepartmentSelector:function(e){return e&&e.columns&&e.columns.some((function(e){return"departmentSelector"==e.type}))},checkForUserSelector:function(e){return e&&e.columns&&e.columns.some((function(e){return"userSelector"==e.type}))},createDepartmentDict:function(e){var t=this;Promise.resolve().then((function(){var a=[__webpack_require__(220)];(function(a){(new a).getDepartments((function(a){t.departmentDic={},a&&a.forEach((function(e){t.departmentDic[e.id]=e.name})),e()}))}).apply(null,a)})).catch(__webpack_require__.oe)},createUserDict:function(e){var t=this;__webpack_require__.e(27).then((function(){var a=[__webpack_require__(713)];(function(a){(new a).listByCompany((function(a){t.userDic={},a&&a.forEach((function(e){t.userDic[e.user_company_id]="".concat(e.first_name," ").concat(e.last_name)})),e()}))}).apply(null,a)})).catch(__webpack_require__.oe)},sendCurrentPosition:function(){var e=this;if(this&&this.table&&this.templateMetadata){try{if(this.getBase().is(":visible")&&this.table.getSelectedRange()){var t=this.table.getSourceDataAtRow(this.table.getSelectedRange().from.row).id,a=this.table.getCellMeta(this.table.getSelectedRange().from.row,this.table.getSelectedRange().from.col).prop;if(this.nodeJSManager){var n={};n.code=this.templateMetadata.code,n.id=t,n.col=a,n.userName=__currentSession.userName,n.userId=__currentSession.loginId,this.nodeJSManager.triggerEvent("setInputTemplatePos",n)}}setTimeout((function(){e.sendCurrentPosition()}),7e3)}catch(e){}this.getBase().find(".inputFormCollabWrapper li[data_live=0]").each((function(t,a){e.collabRemoveRemoteCellIndicator(a)})),this.getBase().find(".inputFormCollabWrapper li[data_live=0]").remove(),this.getBase().find(".inputFormCollabWrapper li[data_live=1]").attr("data_live",0)}},collabRemoveRemoteCellIndicator:function(e){if($(e).attr("class").match(/\bcollabItemCell_(\d+)\b/)){var t=$(e).attr("class").match(/\bcollabItemCell_(\d+)\b/)[0];this.getBase().find("td").removeClass(t)}},collabGetNextColorClass:function(e){return"collabItemCell_"+e.find("li").length},collabCreateItem:function(e,t){0==e.find("li[data_id='"+t.userId+"']").length?$("<li/>").text(t.userName.substr(0,1)).attr("data_id",t.userId).attr("title",t.userName).attr("data_live",1).appendTo(e).addClass(this.collabGetNextColorClass(e)):e.find("li[data_id='"+t.userId+"']").attr("data_live",1)},collabSetActiveCell:function(e,t){var a=e.find("li[data_id='"+t.userId+"']").attr("class");this.getBase().find("td").removeClass(a);var n=this.table.getSourceData();if(n)try{for(var r=0;r<n.length;r++)if(n[r].id==t.id){for(var o=0;o<this.templateMetadata.columns.length;o++)if(this.templateMetadata.columns[o].field==t.col){var i=this.table.getCell(r,o,!0);i&&!$(i).hasClass(a)&&$(i).addClass(a);break}break}}catch(e){console.log("error in sync set pos: "+e.message)}n=null},collabSetChanges:function(e,t){if(t.rowsChanged&&t.rowsChanged.length>0){var a=this.table.getSourceData();if(a)for(var n=0;n<t.rowsChanged.length;n++)for(var r=t.rowsChanged[n],o=0;o<a.length;o++)if(a[o].id==r.id){for(var i=0;i<r.changes.length;i++){var l=r.changes[i].field,s=r.changes[i].values?r.changes[i].values:r.changes[i].value;try{this.table.setDataAtRowProp(o,l,s,"collab"),!0}catch(e){console.log("error in sync changes: "+e.message)}}break}}},onCollabMessage:function(e,t){if(t){var a=t.userId;if(a!=__currentSession.loginId&&this.table&&this.templateMetadata&&this.templateMetadata.code==t.code){var n=this.getBase().find(".inputFormCollabWrapper");switch(e){case"loadInputTemplate":this.collabCreateItem(n,t);break;case"unloadInputTemplate":n.find("li[data_id='"+a+"']").length>0&&(this.collabRemoveRemoteCellIndicator(n.find("li[data_id='"+a+"']")[0]),n.find("li[data_id='"+a+"']").remove());break;case"setInputTemplatePos":this.collabCreateItem(n,t),this.collabSetActiveCell(n,t);break;case"setInputTemplateValues":this.collabCreateItem(n,t),this.collabSetChanges(n,t)}}}},includeExternalJs:function(){if(this.templateMetadata&&this.templateMetadata.externalJs)try{var e=this;__webpack_require__.e(42).then((function(){var t=[__webpack_require__(702)("./"+this.templateMetadata.externalJs)];(function(t){e.externalView=new t($.extend(!0,{},e.options)),e.externalView.render(),e=null}).apply(null,t)})).catch(__webpack_require__.oe)}catch(e){console.log("Error on create external view: "+e.message)}},showWorkflow:(_showWorkflow=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var a,n,r,o,i,l,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.templateMetadata.workflowGroups&&this.templateMetadata.workflowGroups.length>0)){e.next=16;break}return e.next=3,(0,_workflow.listTasksByGroupsIds)({groups_ids:this.templateMetadata.workflowGroups});case 3:if(!((a=e.sent)&&a.length>0)){e.next=16;break}if(n=void 0!==__currentSession.fromEmbedded&&__currentSession.fromEmbedded,r=a.map((function(e){var t=e.owner.id==__currentSession.userCompanyId,a=e.responsible.id==__currentSession.userCompanyId,n=e.subscribers.some((function(e){return e.id==__currentSession.userCompanyId}));return _objectSpread({},e,{canEdit:t||(a||n)&&(0,_globalFxs.haveAccess)("change_assigned_wftask")||(0,_globalFxs.haveAccess)("change_company_wftask"),items:e.items.filter((function(e){return new Date(e.start)<=Date.now()&&new Date(e.end)>=Date.now()}))})})),!((o=r.filter((function(e){return e.items.length>0}))).length>0)){e.next=16;break}return e.next=11,Promise.all(o.map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_workflow.listPosibleByFromStatusId)({id:t.items[0].status.id});case 2:return a=e.sent,n=[_objectSpread({},t.items[0],{start:"".concat(t.items[0].start.substring(0,10)),end:"".concat(t.items[0].end.substring(0,10)),possibleStatuses:[t.items[0].status].concat(_toConsumableArray(a.map((function(e){return e.to_status}))))})],e.abrupt("return",_objectSpread({},t,{items:n}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()));case 11:i=e.sent,l={tasks:i},s={title:(0,_globalFxs.translate)("workflow"),workflow:l,workflowData:!0,content:"",left:t.clientX,top:t.clientY,className:"popover_workflow",workflowEnabled:!0,fromEmbedded:n,fromImputTemplate:!0,inputFormView:this,onSaveCallback:function(){this.inputFormView.drawTemplate(!0)}},__webpack_require__.e(14).then((function(){var e=[__webpack_require__(733)];(function(e){(new e).show(s,(function(e){}))}).apply(null,e)})).catch(__webpack_require__.oe);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return _showWorkflow.apply(this,arguments)}),generateHistoryDic:function(){var e={},t=!1;if(this.tableData&&this.tableData.length>0&&null!=_typeof(this.tableData.historyColumns))for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].historyColumns){t=!0;for(var n=this.tableData[a].historyColumns.split(","),r=0;r<n.length;r++)e[a+"||"+n[r]]=!0}return t?e:null},showHistoryData:function(e,t){if(this.historyDic&&this.historyDic[t]){$(".popover_inputetemplate_history").remove();var a={inputTemplateId:this.options.templateId,entityId:this.table.getSourceDataAtRow(t.split("||")[0]).id,columnName:t.split("||")[1]};this.inputModuleModel.getHistoryChanges(a,(function(t){for(var a="",n=0;n<t.length;n++)a+="<b>"+(0,_moment.default)(t[n].dateChange).format("MM/DD/YYYY HH:mm")+"</b> "+t[n].newUser+" changed de value '"+t[n].oldValue+"' for '"+t[n].newValue+"' <br/>";var r={content:a,left:e.clientX,top:e.clientY,className:"popover_inputetemplate_history"};__webpack_require__.e(14).then((function(){var e=[__webpack_require__(733)];(function(e){(new e).show(r,(function(e){}))}).apply(null,e)})).catch(__webpack_require__.oe)}))}},showColDescription:function(e,t){$(".popover_inputetemplate_colDesc").remove();var a={content:t,left:e.clientX,top:e.clientY,title:(0,_globalFxs.translate)("_description"),className:"popover_inputetemplate_colDesc"};__webpack_require__.e(14).then((function(){var e=[__webpack_require__(733)];(function(e){(new e).show(a,(function(e){}))}).apply(null,e)})).catch(__webpack_require__.oe)},getDataByEntity:function(e,t){this.inputModuleModel.getData(e,(function(e){t(e)}))},getFilterFromField:function(e){return this.templateMetadata&&this.templateMetadata.filters&&this.templateMetadata.filters.find((function(t){return t.field==e}))}}),_showWorkflow;return view}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this,__webpack_require__(219),__webpack_require__(1))}}]);