/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{1535:function(e,t,a){var n=a(690);e.exports=(n.default||n).template({compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l){return'\n<div class="row formFilters" style="display: block;">\n    \n</div>\n\n<div class="row">\n\n    <ul class="inputFormCollabWrapper">\n    </ul>\n    <div class="col-sm-12 tableWrapper" style="width:100%;">\n    </div>\n\n    <div class="col-sm-12 rowCount">\n        \n    </div>\n\n</div>\n'},useData:!0})},1536:function(e,t,a){var n=a(690);e.exports=(n.default||n).template({1:function(e,t,n,l,r){var i;return"\n"+(null!=(i=function(e){return e&&(e.__esModule?e.default:e)}(a(689)).call(null!=t?t:e.nullContext||{},null!=t?t.filterType:t,"==","text",{name:"ifCond",hash:{},fn:e.program(2,r,0),inverse:e.program(4,r,0),data:r,loc:{start:{line:3,column:0},end:{line:43,column:11}}}))?i:"")},2:function(e,t,a,n,l){var r=e.lambda,i=e.escapeExpression;return'<div class="col-sm-3">\n\n    <div class="form-group">\n        <label for="textfield" class="control-label col-sm-12">'+i(r(null!=t?t.header:t,t))+'</label>\n        <div class="col-sm-10">\n            <div class="input-group">\n                <input class="form-control filterText col-sm-12" type="text" name="textfield" id="textfield"\n                    class="form-control" filter="true" field="'+i(r(null!=t?t.field:t,t))+'" value-field="'+i(r(null!=t?t.valueField:t,t))+'" filter-type="'+i(r(null!=t?t.filterType:t,t))+'"\n                    node-filter-id="'+i(r(null!=t?t.nodeFilterId:t,t))+'" template-code="'+i(r(null!=t?t.entity:t,t))+'" template-id="'+i(r(null!=t?t.inputTemplateId:t,t))+'"\n                    use-like="'+i(r(null!=t?t.useLike:t,t))+'" read-only="'+i(r(null!=t?t.readOnly:t,t))+'" status-ready="false" value="'+i(r(null!=t?t.defaultVal:t,t))+'">\n                <div class="input-group-btn">\n                    <button class="btn" type="button"> <i class="fa fa-search"></i> </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'},4:function(e,t,a,n,l){var r,i=e.lambda,o=e.escapeExpression,s=null!=t?t:e.nullContext||{};return'<div class="col-sm-3">\n    <div class="form-group">\n        <label for="textfield" class="control-label">'+o(i(null!=t?t.header:t,t))+"</label>\n\n"+(null!=(r=a.if.call(s,null!=t?t.multiple:t,{name:"if",hash:{},fn:e.program(5,l,0),inverse:e.noop,data:l,loc:{start:{line:26,column:8},end:{line:28,column:19}}}))?r:"")+'\n            <div class="selectRemote" style="width: 100%; '+(null!=(r=a.if.call(s,null!=t?t.multiple:t,{name:"if",hash:{},fn:e.program(7,l,0),inverse:e.noop,data:l,loc:{start:{line:30,column:58},end:{line:30,column:82}}}))?r:"")+'" filter="true" field="'+o(i(null!=t?t.field:t,t))+'"\n                value-field="'+o(i(null!=t?t.valueField:t,t))+'" filter-type="'+o(i(null!=t?t.filterType:t,t))+'" node-filter-id="'+o(i(null!=t?t.nodeFilterId:t,t))+'"\n                template-code="'+o(i(null!=t?t.entity:t,t))+'" template-id="'+o(i(null!=t?t.inputTemplateId:t,t))+'" use-like="'+o(i(null!=t?t.useLike:t,t))+'"\n                entity-label="'+o(i(null!=t?t.entityLabel:t,t))+'" related-field="'+o(i(null!=t?t.relatedField:t,t))+'"\n                related-manytomanyentity="'+o(i(null!=t?t.relatedManyToManyEntity:t,t))+'" related-manytomanykey="'+o(i(null!=t?t.relatedManyToManyKey:t,t))+'"\n                include-all="'+o(i(null!=t?t.includeAll:t,t))+'" read-only="'+o(i(null!=t?t.readOnly:t,t))+'" sort-by="'+o(i(null!=t?t.sortBy:t,t))+'" status-ready="false"></div>\n\n'+(null!=(r=a.if.call(s,null!=t?t.multiple:t,{name:"if",hash:{},fn:e.program(9,l,0),inverse:e.noop,data:l,loc:{start:{line:37,column:12},end:{line:39,column:15}}}))?r:"")+"\n    </div>\n</div>\n"},5:function(e,t,a,n,l){return'        <div class="multiple-wrapper">\n'},7:function(e,t,a,n,l){return" "},9:function(e,t,a,n,l){return"        </div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l){var r;return null!=(r=a.each.call(null!=t?t:e.nullContext||{},null!=t?t.filters:t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:1,column:0},end:{line:44,column:9}}}))?r:""},useData:!0})},686:function(e,t,a){"use strict";(function(n,l){var r,i=a(18);!function(e){e&&e.__esModule}(a(975));void 0===(r=function(){return n.Controller.extend({name:"NodeJs",socket:void 0,start:function(){},triggerEvent:function(e,t){var a={event:e,body:t};this.socket&&this.socket.connected&&this.socket.emit("sendMessage",__currentToken,a)},changeToken:function(e){this.socket&&this.socket.connected&&this.socket.emit("changeToken",e)},processMessage:function(e){if(e)switch(e.event){case"FPCaseAfterSave":l("#projectMapSidebar").trigger("refreshProject",[e.body]);break;case"DashboardShareAfterSave":l("#model-summary").trigger("reloadShared",[e.body]);break;case"UpdateCreateScenarioProgress":l("#scenarioManager,#dataSnapshot").trigger("updateProgress",[e.body]);break;case"RefreshImageDashboard":l("#summary").trigger("refreshImageDashboard",[e.body]),l("#report-manager").trigger("refreshImageDashboard",[e.body]),l("#main .mainTask[data-rel='dashboard-"+e.body+"']").trigger("refreshImageDashboard",[e.body]);break;case"AfterCreateDashboardComment":l(".dashboard-comments").trigger("refreshExternalComments",[e.body]);break;case"NeedLogout":l("body").trigger("needLogout");break;case"SessionKilled":l("body").trigger("sessionKilled");break;case"MemoryQuotaExceeded":l("body").trigger("memoryQuotaExceeded",[e.body]);break;case"ProcessCancelByMemoryQuotaExceeded":var t=(0,i.translate)("process_cancel_by_quota").replace("##quota##",e.body.memoryQuota).replace("##current##",e.body.modelMemory);(0,i.showMessage)(t,void 0,"error");break;case"modelprogressbar":Promise.all([a.e(2),a.e(6),a.e(59)]).then(function(){var t=[a(700)];(function(t){(new t).showProgressBar(e.body)}).apply(null,t)}).catch(a.oe);break;case"modelmsgbox":Promise.all([a.e(2),a.e(6),a.e(59)]).then(function(){var t=[a(700)];(function(t){(new t).showMsgBox(e.body)}).apply(null,t)}).catch(a.oe);break;case"GenericMessage":var n=e.body.title;t=e.body.text;(0,i.showMessage)(t,n);break;case"notify":Promise.all([a.e(2),a.e(104)]).then(function(){var t=[a(883)];(function(t){(new t).notify(e.body)}).apply(null,t)}).catch(a.oe);break;case"ReloadAllOpenDashboards":Promise.all([a.e(2),a.e(6),a.e(28)]).then(function(){var e=[a(699)];(function(e){(new e).refreshAllOpenDashboards()}).apply(null,e)}).catch(a.oe);break;case"UpdatePrintReportProgress":Promise.all([a.e(2),a.e(6),a.e(28)]).then(function(){var t=[a(699)];(function(t){(new t).updatePrintReportProgress(e.body)}).apply(null,t)}).catch(a.oe);break;case"UpdatePrintReportMessage":Promise.all([a.e(2),a.e(6),a.e(28)]).then(function(){var t=[a(699)];(function(t){(new t).updatePrintReportMessage(e.body)}).apply(null,t)}).catch(a.oe);break;case"UpdatePrintReportComplete":Promise.all([a.e(2),a.e(6),a.e(28)]).then(function(){var t=[a(699)];(function(t){(new t).updatePrintReportComplete(e.body)}).apply(null,t)}).catch(a.oe);break;case"ExecuteButtonComplete":l("#genericLoading").hide(),e&&e.body&&e.body.error&&(0,i.showMessage)(e.body.result,void 0,"error");break;case"loadInputTemplate":case"unloadInputTemplate":case"setInputTemplatePos":case"setInputTemplateValues":l(".inputFormTask").trigger("collabMessage",[e.event,e.body]);break;case"ModelEditionAvailable":e&&e.body&&e.body.message&&((0,i.showMessage)(e.body.message,void 0,"info"),__currentSession.modelInfo&&__currentSession.modelInfo.uri==e.body.modelfile&&a.e(38).then(function(){var e=[a(219)];(function(e){(new e).canEdit()&&(l("#navigation li.modelopened[data-key='btnSaveModel']").show(),l("#navigation li.modelopened[data-key='btnSaveModelAs']").show())}).apply(null,e)}).catch(a.oe))}}})}.apply(t,[]))||(e.exports=r)}).call(this,a(694),a(1))},887:function(module,exports,__webpack_require__){"use strict";(function(Backbone,$,moment){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,_globalFxs=__webpack_require__(18),_handsontable=_interopRequireDefault(__webpack_require__(925));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(750),__webpack_require__(686),__webpack_require__(1535),__webpack_require__(1536)],__WEBPACK_AMD_DEFINE_RESULT__=function(InputModuleModel,NodeJsManager,HTMLTemplate,HTMLFilters){var view=Backbone.View.extend({el:$("#main"),table:void 0,templateMetadata:void 0,templateData:void 0,tableData:void 0,hasRowTotal:!1,groupDic:void 0,groupEditor:void 0,tableOptions:null,changesDic:{rows:[],toDelete:[]},rowsToDelete:{toDelete:[]},externalView:null,nodeJSManager:null,totalFilters:0,historyTimeOut:-1,titleTimeOut:-1,historyDic:null,includeHistory:!1,tagId:null,errorList:"",firstLoad:!0,_div:document.createElement("div"),_button:document.createElement("button"),render:function(e){var t=this;t._div.className="remoteDropdown",t._button.className="btn formBtn",this.tagId=e,this.nodeJSManager=new NodeJsManager,this.inputModuleModel=new InputModuleModel;var a=HTMLTemplate();this.getBase().append(a),this.drawTemplate(!1),this.addHandlers(),this.getBase().closest(".mainTask").on("removeView",function(){t.onRemoveView()}),this.getBase().closest(".mainTask").on("collabMessage",function(e,a,n){t.onCollabMessage(a,n)}),this.getBase().closest(".mainTask").on("refreshOnFocus",function(){t.templateMetadata.refreshOnFocus&&t.getTemplateData()}),$(window).resize(function(){t.options.inputForm?t.onBaseResize():t.onResize()}),this.addMouseOverTitleHandler()},onResize:function(){this.getBase().find(".tableWrapper");var e=this.getBase().find(".formFilters").height(),t=$(window).width()-10;t-=68;var a=$(window).height();a-=145+e,this.table&&this.table.updateSettings({height:a,width:t})},onBaseResize:function(){this.getBase().find(".tableWrapper");var e=this.getBase().find(".formFilters").height(),t=this.$el.width(),a=this.$el.height();a-=42+e,this.table&&this.table.updateSettings({height:a,width:t})},onRemoveView:function(){if(this.templateMetadata&&this.nodeJSManager){var e={};e.code=this.templateMetadata.code,e.userName=__currentSession.userName,e.userId=__currentSession.loginId,this.nodeJSManager.triggerEvent("unloadInputTemplate",e)}if(this.inputModuleModel=null,this.groupDic=null,this.groupEditor=null,this.changesDic={rows:[],toDelete:[]},this.table&&(this.table.destroy(),this.table=null),this.templateMetadata=null,this.templateData=null,this.tableData=null,this.externalView&&this.externalView.destroy)try{this.externalView.destroy()}catch(e){}this.externalView=null,this.nodeJSManager=null,this.historyDic=null},resize:function(){this.getBase().find(".inputTable").parent().height($(window).height()-200),this.getBase().find(".inputTable").height($(window).height()-200),this.getBase().find(".inputTable").trigger("updateSize")},getBase:function(){return this.$el},getBaseTask:function(){var e=this.options.templateId;return $('div[data-rel="form-'+e+'"]')},addHandlers:function(){var e=this,t=this.options.templateId;this.getBaseTask().find("button.addRow").on("click",function(t){e.addNewRow()}),this.getBaseTask().find("button.showFilters").on("click",function(t){e.toggleFilters()}),this.getBaseTask().find("button.showWorkflow").on("click",function(t){t.preventDefault(),e.showWorkflow(t)}),this.getBaseTask().find("button.showHistory").on("click",function(t){t.preventDefault(),e.includeHistory=!e.includeHistory,$(this).toggleClass("selected"),e.getTemplateData()}),this.getBase().find(".tableWrapper").on("mouseover","td.with-history",function(){var t=$(this).attr("data-history-key"),a=event;e.historyTimeOut=setTimeout(function(){e.showHistoryData(a,t)},500)}),this.getBase().find(".tableWrapper").on("mouseover","a.with-description",function(){var t=$(this).attr("data-desc"),a=event;e.titleTimeOut=setTimeout(function(){e.showColDescription(a,t)},500)}),this.getBase().find(".tableWrapper").on("mouseout","td.with-history",function(){clearTimeout(e.historyTimeOut)}),this.getBase().find(".tableWrapper").on("mouseout","a.with-description",function(){clearTimeout(e.titleTimeOut)}),$("a[data-rel="+t+"] div").on("click",function(t){$(this).hasClass("orange")&&__webpack_require__.e(13).then(function(){var a=[__webpack_require__(737)];(function(a){var n={title:"Errors",content:e.errorList,left:t.clientX,top:t.clientY};(new a).show(n)}).apply(null,a)}).catch(__webpack_require__.oe)}),$(e.tagId).find(".item-title div div").on("click",function(t){$(this).hasClass("orange")&&__webpack_require__.e(13).then(function(){var a=[__webpack_require__(737)];(function(a){var n={title:"Errors",content:e.errorList,left:t.clientX,top:t.clientY};(new a).show(n)}).apply(null,a)}).catch(__webpack_require__.oe)})},addMouseOverTitleHandler:function(){var e,t=this;$(this.tagId).find(".item-title .knowledge-arrow").hover(function(a){if(t.templateMetadata.workflowGroups&&t.templateMetadata.workflowGroups.length>0)return e=setTimeout(function(){$(".popover-title").parent().remove(),t.showWorkflow(a)},1e3),!1},function(){clearTimeout(e)})},toggleFilters:function(e){this.getBase().find(".formFilters").toggle()},addNewRow:function(){var e=this,t={id:this.options.templateId,debugConsole:"-- AddNewRow --",rows:[{changes:[],id:-1}]};e.addDataForHiddenCols(e.table.getInstance(),t.rows[0]),this.inputModuleModel.setData(t,function(t){var a=e.table.countRows(),n=a;e.hasRowTotal&&(n=a-1),e.table.alter("insert_row",n,1,"ContextMenu.rowAbove"),e.table.setDataAtRowProp(n,"id",t[0].newId)})},deleteRows:function(){var e=this;this.inputModuleModel.setData(e.rowsToDelete,function(t){t.length>0&&(e.drawTable(),e.rowsToDelete.toDelete=[],e.toRemoveOnTable=[])})},drawTemplate:function(e){var t=this,a=this.options.templateId;a||(a=this.options.inputForm.templateId),this.inputModuleModel.getMetadata(a,function(n){t.loadMetadata(n,a,e),t.$el.trigger("onUpdateMetadata",n)})},loadMetadata:function(e,t,a){this.templateMetadata=e,this.includeExternalJs();var n=e.filters;this.loadToolbar();var l=!0;this.totalFilters=n.length;for(var r=0;r<n.length;r++)!0===n[r].includeAll||void 0===n[r].includeAll?(n[r].includeAll=!0,l=!1):!1===n[r].includeAll&&(l=!1);if(n.length>0&&this.drawFilters(n,a),l&&this.getTemplateData(),this.checkForGroupSelector(e)){var i=this;this.createGroupDict(function(){i.getTemplateData(),i=null})}if(this.templateMetadata&&this.nodeJSManager){var o={};o.code=this.templateMetadata.code,o.userName=__currentSession.userName,o.userId=__currentSession.loginId,this.nodeJSManager.triggerEvent("loadInputTemplate",o)}this.templateMetadata.allowAdd&&$(this.tagId).trigger("setAddButton")},getTemplateData:function getTemplateData(){var _this=this,formId=this.options.templateId;formId||(formId=this.options.inputForm.templateId);var params={id:formId,filters:[],includeHistory:_this.includeHistory},filters=[];if(_this.firstLoad&&_this.options.savedFilters&&_this.options.savedFilters.length>0)for(var i=0;i<_this.options.savedFilters.length;i++)this.getBase().find('.formFilters .selectRemote[field="'+_this.options.savedFilters[i].field+'"]').select2("data",_this.options.savedFilters[i].val);_this.firstLoad=!1,this.getBase().find(".formFilters .selectRemote.select2-offscreen, .formFilters .filterText").each(function(e,t){var a,n,l=$(t).attr("field"),r=$(t).attr("value-field"),i=$(t).attr("use-like"),o=$(t).attr("filter-type"),s=$(t).attr("node-filter-id");if(i="true"===i,"text"===o)n=[],""==(a=$(t).val()).trim()&&(a="-1"),i=!0;else if(r){var d=$(t).select2("data");n=[$(t).select2("data")],"1"===o?(a=[],$.each(d,function(e,t){a.push(t[r])})):a="-1"===d.id?"-1":d[r]}else a=$(t).select2("val"),n=[$(t).select2("data")];var c=[];"string"==typeof a&&(a=[a]),a.length>0&&"-1"!==a[0]&&($.each(a,function(e,t){c.push(t)}),r?filters.push({field:r,nodeFilterId:s,idxValues:n,values:c,useLike:i}):filters.push({field:l,nodeFilterId:s,idxValues:n,values:c,useLike:i}))}),filters.length>0&&(params.filters=filters),_this.lastFiltersStatus=params.filters,this.inputModuleModel.getData(params,function(templateData){try{var fnOnLoad;if(_this.templateMetadata&&_this.templateMetadata.onLoad)eval(" fnOnLoad = "+_this.templateMetadata.onLoad),fnOnLoad(params)}catch(e){console.log("Error onLoad: "+e.message)}_this.templateData=templateData,_this.drawTable()})},loadToolbar:function(){this.templateMetadata.allowAdd&&this.getBaseTask().find("button.addRow").show(),this.templateMetadata.workflowGroups&&this.templateMetadata.workflowGroups.length>0&&this.getBaseTask().find("button.showWorkflow").show(),this.templateMetadata.enableHistoryChanges},instanceTextFilters:function(e){var t=this;this.getBase().find(".filterText").each(function(e,a){var n=$(a).attr("template-id"),l=$(a).attr("template-code"),r=($(a).attr("filter"),$(a).attr("filter-type")),i=$(a).attr("entity-label"),o=$(a).attr("field"),s=$(a).attr("value-field"),d="true"===$(a).attr("read-only"),c={code:l,pageSize:10};""!==l&&null!==l?c.code=l:c.templateId=n;var u={params:c,$el:$(this),labelField:i,valueField:s,readOnly:d,filterType:r,tagId:t.tagId,inputLength:3,callback:function(){t.table&&null!==t.table.table&&t.table.destroy(),t.getBase().find('.formFilters .filterText[field="'+o+'"]').attr("status-ready","true"),t.allFiltersLoaded()}};__webpack_require__.e(274).then(function(){var e=[__webpack_require__(2117)];(function(e){new e(u).render()}).apply(null,e)}).catch(__webpack_require__.oe)})},drawFilters:function(e,t){var a=this,n={filters:e};if(t)return!0,void a.allFiltersLoaded();var l=HTMLFilters(n);this.getBase().find(".formFilters").append(l),a.instanceTextFilters(),this.getBase().find(".formFilters .selectRemote").each(function(e,t){var n=$(t).attr("template-id"),l=$(t).attr("template-code"),r=($(t).attr("filter"),$(t).attr("filter-type")),i=$(t).attr("node-filter-id"),o=$(t).attr("entity-label"),s=$(t).attr("field"),d=$(t).attr("related-field"),c=$(t).attr("value-field"),u=$(t).attr("related-manytomanyentity"),h=$(t).attr("related-manytomanykey"),p="true"===$(t).attr("include-all"),f="true"===$(t).attr("read-only"),m=$(t).attr("sort-by"),g=null,v={code:l,pageSize:10};""!==l&&null!==l?v.code=l:v.templateId=n;var _=d.split(","),b=[];_.length>0&&""!==_[0]&&$.each(_,function(e,t){g=null,t=t.trim();var n=a.getBase().find('.formFilters .selectRemote[field="'+t+'"]');g={relatedEl:n,relatedField:t,relatedManyToManyEntity:u=u,relatedManyToManyKey:h=h},b.push(g)});var y={params:v,$el:$(this),labelField:o,valueField:c,relatedObject:b,includeAll:p,readOnly:f,sortBy:m,filterType:r,nodeFilterId:i,tagId:a.tagId,inputLength:0,callback:function(e){a.table&&null!==a.table.table&&a.table.destroy(),a.getBase().find('.formFilters .selectRemote[field="'+s+'"]').attr("status-ready","true"),a.countRelatedFilters(s),a.allFiltersLoaded()}};__webpack_require__.e(275).then(function(){var e=[__webpack_require__(2118)];(function(e){new e(y).render()}).apply(null,e)}).catch(__webpack_require__.oe)})},allFiltersLoaded:function(){!(this.getBase().find('.formFilters .selectRemote[status-ready="false"]').length>0)&&(this.getTemplateData(),this.refreshFiltersToIndex())},refreshFiltersToIndex:function(){$(this.tagId).trigger("onFiltersChange",[this.lastFiltersStatus])},countRelatedFilters:function(e,t){var a=this;this.getBase().find(".formFilters .selectRemote").each(function(t,n){var l=$(this).attr("related-field"),r=0,i=-1;l?(r=(l=l.replace(/\s/g,"").split(",")).length,i=l.indexOf(e)):r=0,r>1&&i>=0?($(this).attr("status-ready",!1),a.checkMultipleRelated($(this),r,l)):e===$(this).attr("related-field")&&($(this).attr("status-ready",!1),$(this).trigger("relatedChanged",$(this).attr("field")))})},checkMultipleRelated:function(e,t,a){for(var n=0,l=0;l<t;l++)"true"===$('.selectRemote[field="'+a[l].trim()+'"]').attr("status-ready")&&n++;n!==t||"false"!==$(e).attr("status-ready")&&!1!==$(e).attr("status-ready")?"false"===$(e).attr("status-ready")&&this.checkMultipleRelated(e,t,a):$(e).trigger("relatedChanged",$(e).attr("field"))},checkIfRelatedHasValues:function(e){e=e;this.getBase().find(".formFilters .selectRemote").each(function(t,a){e===$(this).attr("related-field")&&(e=$(this).attr("field"))})},drawTable:function(){this.tableData=this.templateData,this.historyDic=this.generateHistoryDic(),this.redrawTable(),this.sendCurrentPosition()},groupsRenderer:function(e,t,a,n,l,r,i){_handsontable.default.renderers.TextRenderer.apply(this,arguments);var o,s=this;if(r){var d="",c=r.split(",");c.map(function(e){""!=d&&(d+=", "),d+=s.groupDic[e]}),o=d}else o="",c="";_handsontable.default.dom.empty(t);var u=document.createElement("div");$(u).css("width","100%"),$(u).text(o),t.appendChild(u),_handsontable.default.dom.addEvent(t,"dblclick",function(t){t.preventDefault(),c=e.getSourceDataAtCell(a,n),s.openGroupSelector(e,a,n,c)})},buttonRenderer:function buttonRenderer(instance,td,row,col,prop,value,cellProperties){_handsontable.default.renderers.TextRenderer.apply(this,arguments);var _this=this,buttonLabel=instance.getSettings().columns[col].buttonLabel;_handsontable.default.dom.empty(td);var button=_this._button.cloneNode(!0);return button.textContent=buttonLabel,td.appendChild(button),_handsontable.default.dom.addEvent(button,"click",function(e){e.preventDefault();try{var fnOnClick;if(eval(" fnOnClick = "+instance.getSettings().columns[col].onclick),!1===fnOnClick(_this,instance,row,col))return!1}catch(e){console.log("Error onClick: "+e.message)}}),td},openGroupSelector:function(e,t,a,n){var l=[];n=null!==n&&void 0!==n?n.split(","):"";for(var r in this.groupDic){var i={value:r,text:this.groupDic[r],selected:!1};if(n.length>0)for(var o=0;o<n.length;o++)i.value===n[o]&&(i.selected=!0);l.push(i)}var s={sourceGroups:l,callback:function(n){e.setDataAtCell(t,a,n)}};__webpack_require__.e(40).then(function(){var e=[__webpack_require__(860)];(function(e){(new e).openGroupSelectorModal(s,null)}).apply(null,e)}).catch(__webpack_require__.oe)},remoteDropdownRenderer:function(e,t,a,n,l,r,i){var o=this,s="",d=e.getSettings().columns[n].readOnly;if(o.hasRowTotal&&a===e.countRows()-1)return t;if(o.checkValidations(e,a),null!==r&&"null|-| "!==r&&"|-|"!==r||(s=""),null!==r&&(r.indexOf("|-|")>=0&&(s=r.split("|-|")[1]),-1===r.indexOf("|-|")&&(s=null)),null!==s){_handsontable.default.renderers.BaseRenderer.apply(this,arguments),_handsontable.default.dom.empty(t);var c=o._div.cloneNode(!0),u=e.getSettings().columns[n].relatedField;return null!==u&&""!==u&&void 0!==u&&c.setAttribute("related-field",u),c.textContent=s,t.appendChild(c),$(c).on("changeRemote",function(t,a){e.setDataAtCell(a.instance.row,a.relatedCol,"null|-| ")}),_handsontable.default.dom.addEvent(c,"click",function(s){s.preventDefault(),i.readOnly||d||o.initializeRemoteDropdown(e,t,a,n,l,r,i)}),t}},initializeRemoteDropdown:function(e,t,a,n,l,r,i){var o=this,s={pageSize:10},d=e.getSettings().columns[n].code;""!==d&&null!==d?s.code=d:s.templateId=e.getSettings().columns[n].inputTemplateId;var c=e.getSourceDataAtCell(a,n);if(e.getSettings().columns[n].relatedField)var u=e.getSettings().columns[n].relatedField.split(",");if(void 0!==u){var h,p,f=null,m=null,g=[];$.each(u,function(t,l){var r=null;l=l.trim();for(var i=0;i<o.templateMetadata.columns.length;i++)if(h=o.templateMetadata.columns[i].field,p=o.templateMetadata.columns[i].hidden,l===h&&!0===p){var s=o.getBase().find('.formFilters .selectRemote[field="'+o.templateMetadata.columns[i].field+'"]'),d=s.val();f=s.attr("related-manytomanyentity"),m=s.attr("related-manytomanykey"),r={relatedVal:d,relatedField:l,relatedManyToManyEntity:f,relatedManyToManyKey:m},g.push(r)}null===r&&null!==e.getDataAtRowProp(a,l)&&(d=e.getDataAtRowProp(a,l),f=e.getSettings().columns[n].relatedManyToManyEntity,m=e.getSettings().columns[n].relatedManyToManyKey,r={relatedVal:d,relatedField:l,relatedManyToManyEntity:f,relatedManyToManyKey:m},g.push(r))})}var v={params:s,$el:$(t).find("div"),labelField:e.getSettings().columns[n].entityLabel,valueField:e.getSettings().columns[n].data,enabledItemField:e.getSettings().columns[n].enabledItemField,relatedObject:g,tableInstance:{instance:e,row:a,col:n},inputLength:0,callback:function(t){var a=this.tableInstance.row,n=this.tableInstance.col,l=this.tableInstance.instance.getCellMeta(a,n),r=this.tableInstance.instance.getSettings().columns;if(e.getSourceDataAtCell(a,n)!==t[l.prop]){e.setDataAtCell(this.tableInstance.row,this.tableInstance.col,t[l.prop]);for(var i=null,o=0;o<r.length;o++)r[o].relatedField===l.prop&&(i=o);i&&this.tableInstance.col!==i&&this.$el.trigger("changeRemote",{instance:this.tableInstance,field:l,relatedCol:i})}}};c&&(v.selectedId=c.split("|-|")[0],v.selectedLabel=c.split("|-|")[1]),__webpack_require__.e(276).then(function(){var e=[__webpack_require__(2119)];(function(e){new e(v).render()}).apply(null,e)}).catch(__webpack_require__.oe)},redrawTable:function redrawTable(){var _this=this,separator="|-|";this.table&&(this.getBase().find(".inputTable").remove(),this.table=null),this.getBase().find(".tableWrapper").append('<div class="inputTable" style="height:100%, overflow:scroll"></div>');var $table=this.getBase().find(".inputTable");null===this.tableOptions&&(this.tableOptions=this.parseMetadata()),this.hasRowTotal&&this.tableData.push([]),_handsontable.default.renderers.registerRenderer("remoteDropdown",function(e,t,a,n,l,r,i){return _this.remoteDropdownRenderer(e,t,a,n,l,r,i)}),_handsontable.default.renderers.registerRenderer("groupsRenderer",function(e,t,a,n,l,r,i){return _this.groupsRenderer(e,t,a,n,l,r,i)}),_handsontable.default.renderers.registerRenderer("buttonRenderer",function(e,t,a,n,l,r,i){return _this.buttonRenderer(e,t,a,n,l,r,i)});var hot1=$table.handsontable({data:this.tableData,fixedColumnsLeft:this.tableOptions.fixedColumnsLeft,manualColumnResize:this.tableOptions.columnResize,nestedHeaders:this.tableOptions.nestedHeaders,colHeaders:!1!==this.tableOptions.colHeaders&&function(e){var t=_this.tableOptions.colHeaders[e],a=_this.tableOptions.columns[e].description;return a&&""!==a&&(t='<a data-desc="'+a+'" class="with-description">'+t+"</a>"),t},contextMenu:!!this.tableOptions.allowRemove&&["remove_row"],rowHeaders:this.tableOptions.rowHeaders,columns:this.tableOptions.columns,minRows:0,stretchH:"all",afterSelection:function(e,t,a,n){var l=[],r=[e,a];r.sort(function(e,t){return t-e});for(var i=r[0]-r[1]+1,o=r[1];o<=r[0];o++)l.push(this.getDataAtRowProp(o,"id"));_this.rowsToDelete.id=_this.options.templateId;var s=r[0]===r[1]?r[0]:r[1];_this.toRemoveOnTable=[s,i],_this.rowsToDelete.toDelete=l},afterDeselect:function(){_this.rowsToDelete.toDelete=[],_this.toRemoveOnTable=[]},afterRemoveRow:function(e,t){_this.deleteRows()},beforeKeyDown:function(e){8!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&46!=e.keyCode||$(e.path[1]).hasClass("select2-search")&&(e.isImmediatePropagationEnabled=!1)},beforeRender:function(e){_this.beforeRender(e,_this.tableOptions)},afterRenderer:function(e,t,a,n,l,r){_this.applyStyles(this,e,t,a,n,l,r)},beforeChange:function beforeChange(changes,source){for(var row,col,prop,cellProperties,cols=this.getSettings().columns,cc=changes.length-1;cc>=0;cc--){for(var isNumeric=!1,value=changes[cc][3],currentCol,i=0;i<cols.length;i++)if(cols[i].data===changes[cc][1]){isNumeric="numeric"===cols[i].type,currentCol=cols[i];break}if(isNumeric&&isNaN(value)&&!0!==value&&""!==value)return!1;if(row=changes[cc][0],col=this.propToCol(changes[cc][1]),prop=changes[cc][1],cellProperties=this.getCellMeta(row,col),null!==changes[cc][2]&&void 0!==changes[cc][2]&&-1!==changes[cc][2]&&!isNumeric&&changes[cc][2].toString().indexOf(separator)>=0&&-1===changes[cc][3].toString().indexOf(separator))return!1;if(currentCol&&void 0!==currentCol.onBeforeChange&&currentCol.onBeforeChange)try{var fnOnChange;if(eval(" fnOnChange = "+currentCol.onBeforeChange),!1===fnOnChange(_this,this,changes[cc],source))return!1}catch(e){console.log("Error onBeforeChange: "+e.message)}}},afterChange:function(e,t){null!==e&&e.length>0&&("CopyPaste.paste"!==t&&"edit"!==t&&"Autofill.fill"!==t&&"UndoRedo.undo"!==t&&"UndoRedo.redo"!==t||"id"===e[0][1]||_this.updateDic(e,t,this))},cells:function cells(row,col,prop){var cellProperties={};try{var fnCustomFn,fn=_this.getOnCellFunctionByProp(prop,this.instance);fn&&(eval("fnCustomFn= "+_this.getOnCellFunctionByProp(prop,this.instance)),fnCustomFn(this.instance,null,row,col,prop,null,cellProperties))}catch(e){console.log("getOnCellFunctionByProp error: "+e.message)}return _this.hasRowTotal?(row===this.instance.countRows()-1&&(cellProperties.readOnly=!0),cellProperties):cellProperties}});this.table=$table.handsontable("getInstance");var countRows=_this.hasRowTotal?this.table.countRows()-1:this.table.countRows();this.getBase().find(".rowCount").text("Total rows: "+countRows);try{this.externalView&&this.externalView.onCreateTable&&this.externalView.onCreateTable(this.table)}catch(e){console.log("Error on external view:onCreateTable"+e.message)}this.options.inputForm?_this.onBaseResize():_this.onResize(),_this.templateMetadata.workflowGroups&&_this.templateMetadata.workflowGroups.length>0&&$(this.tagId).find(".item-title .knowledge-arrow").addClass("on")},getOnCellFunctionByProp:function(e,t){for(var a=0;a<this.templateMetadata.columns.length;a++)if(this.templateMetadata.columns[a].field===e)return this.templateMetadata.columns[a].onCell},addDataForHiddenCols:function(e,t){for(var a=this.templateMetadata.columns,n=0;n<a.length;n++)if(a[n].hidden){var l=this.getBase().find('.formFilters .selectRemote[field="'+a[n].field+'"]');if(l.length>0){for(var r=l.val(),i=!1,o=0;o<t.changes.length;o++)if(t.changes[o].field===a[n].field){i=!0;break}i||t.changes.push({field:a[n].field,value:r})}}},updateDic:function updateDic(changes,source,instance){var _this=this,separator="|-|",instance=instance,inputTemplateId=this.options.templateId,dataRow,rowIndex,changeField;this.changesDic.debugConsole="-- updateDic ("+source+") --",this.changesDic.toDelete=[],this.changesDic.rows=[],this.changesDic.id=inputTemplateId;for(var isReadOnly=!1,x=0;x<changes.length;x++)if(isReadOnly=instance.getCellMeta(changes[x][0],instance.propToCol(changes[x][1])).readOnly,isReadOnly&&console.log("readonly: "+changes[x][0]+", "+instance.propToCol(changes[x][1])),!isReadOnly){dataRow=instance.getSourceDataAtRow(changes[x][0]),dataRow.id||(dataRow.id=-1);var value=changes[x][3];rowIndex=changes[x][0],changeField=changes[x][1],"object"===_typeof(changes[x][3])&&(value=null===changes[x][3]?"":changes[x][3].id),"number"!=typeof value&&value.indexOf(separator)>=0&&(value=value.split(separator)[0],"null"===value&&(value=null));for(var change={id:dataRow.id,rowIndex:rowIndex,changes:[{field:changeField,value:value}]},isRowOnEdition=!1,i=0;i<this.changesDic.rows.length;i++)if(this.changesDic.rows[i].rowIndex===rowIndex){isRowOnEdition=!0;for(var j=0;j<this.changesDic.rows[i].changes.length;j++)this.changesDic.rows[i].changes[j].field===changeField&&this.changesDic.rows[i].changes.splice(j,1);this.changesDic.rows[i].changes.push({field:changeField,value:value});break}isRowOnEdition||(this.changesDic.rows.push(change),-1===change.id&&_this.addDataForHiddenCols(instance,this.changesDic.rows[this.changesDic.rows.length-1]))}var formId=this.options.templateId,row,prop,dataStatusDash=$(_this.tagId).find(".item-title div div");$(dataStatusDash).removeClass().addClass("dataStatus yellow"),$("a[data-rel="+formId+"] div").removeClass().addClass("dataStatus yellow"),this.inputModuleModel.setData(this.changesDic,function(res){var error=!1,row;if(res.length>0)for(var i=0;i<res.length;i++)res[i].err&&(error=!0,_this.errorList+="- "+res[i].err+"<br>");if(error){$(dataStatusDash).removeClass().addClass("dataStatus orange"),$("a[data-rel="+formId+"] div").removeClass().addClass("dataStatus orange");for(var i=0;i<_this.changesDic.rows.length;i++)row=_this.changesDic.rows[i].rowIndex,_this.checkValidations(instance,row)}else{try{var fnOnChange;if(_this.templateMetadata&&_this.templateMetadata.onChange)eval(" fnOnChange = "+_this.templateMetadata.onChange),fnOnChange(_this.changesDic),$(dataStatusDash).removeClass().addClass("dataStatus green"),$("a[data-rel="+formId+"] div").removeClass().addClass("dataStatus green"),_this.errorList=""}catch(e){$(dataStatusDash).removeClass().addClass("dataStatus orange"),$("a[data-rel="+formId+"] div").removeClass().addClass("dataStatus orange"),console.log("Error onChange: "+e.message)}for(var i=0;i<res.length;i++)res[i].newId!==res[i].id&&res[i].id<0&&instance.setDataAtRowProp(res[i].rowIndex,"id",res[i].newId);$(dataStatusDash).removeClass().addClass("dataStatus green"),$("a[data-rel="+formId+"] div").removeClass().addClass("dataStatus green"),_this.changesDic.rows=[],_this.errorList=""}},function(e){var t=_this.options.templateId;$(dataStatusDash).removeClass().addClass("dataStatus orange"),$("a[data-rel="+t+"] div").removeClass().addClass("dataStatus orange")})},checkValidations:function(e,t){for(var a=e.getSettings().columns,n=0;n<a.length;n++){var l=null;if(a[n].validators&&a[n].validators.required&&(null===(l=e.getDataAtCell(t,n))||"null|-| "===l||"|-|"===l)){var r=e.getCell(t,n);$(r).addClass("required-td")}}},firstRowRenderer:function(e,t,a,n,l,r,i){_handsontable.default.renderers.TextRenderer.apply(this,arguments),t.style.fontWeight="bold",t.style.color="green",t.style.background="#CEC"},beforeRender:function(e,t){if(e){this.table||(this.table=this.getBase().find(".inputTable").handsontable("getInstance"));for(var a=this.tableData,n=this.table.getSettings().columns,l=0;l<n.length;l++)if(n[l].formula)for(var r=0;r<a.length;r++)a[r]["_cc"+l]=this.parseFormula(a[r],n[l].formula)}},parseFormula:function parseFormula(row,columnFormula){for(var res,formula=columnFormula,performCalc=!1,re=/#(.*?)#/gim,resReg;null!==(resReg=re.exec(columnFormula));){resReg.index===re.lastIndex&&re.lastIndex++;var key=resReg[1];if(void 0!==row[key]){performCalc=!0;var rr=new RegExp("#"+key+"#","gi");formula=formula.replace(rr,row[key])}}if(performCalc)try{res=eval(formula)}catch(e){res=0}return res},applyStyles:function applyStyles(hotInstance,TD,row,col,prop,value,cellProperties){var _this=this,fnConditional;if(cellProperties||(cellProperties={}),cellProperties.style)for(var key in cellProperties.style)TD.style[key]=this.evaluateIfIsFunction(cellProperties.style[key]);cellProperties.conditionalFormat&&($.isArray(cellProperties.conditionalFormat)?fnConditional=function(e,t,a,n,l,r,i){for(var o=cellProperties.conditionalFormat,s=0;s<o.length;s++)if(r>=o[s].from&&r<o[s].to){for(var d in o[s].style)t.style[d]=o[s].style[d];break}}:eval("fnConditional = "+cellProperties.conditionalFormat),fnConditional(hotInstance,TD,row,col,prop,value,cellProperties));if(row<=this.tableData.length-1&&cellProperties.customCellFunction)try{var fnCustomFn;eval("fnCustomFn= "+cellProperties.customCellFunction),fnCustomFn(hotInstance,TD,row,col,prop,value,cellProperties)}catch(e){console.log("customCellFunction error: "+e.message)}if(this.historyDic){var key=row+"||"+prop;this.historyDic[key]&&($(TD).addClass("with-history").attr("data-history-key",key),$("<div class='history'></div>").appendTo(TD))}this.hasRowTotal&&row==this.tableData.length-1&&(TD.style.backgroundColor="#666666",TD.style.color="#ffffff",1!==this.tableOptions.columns[col].totalType&&(cellProperties.type="text"))},parseMetadata:function(){var e={fixedColumnsLeft:void 0,columnResize:!1,colHeaders:[],columns:[],columnSummary:[],nestedHeaders:[]};if(this.templateMetadata){e.fixedColumnsLeft=this.templateMetadata.fixedColumns,e.columnResize=this.templateMetadata.columnResize,e.colHeaders=this.templateMetadata.colHeaders,e.rowHeaders=this.templateMetadata.rowHeaders,e.allowRemove=this.templateMetadata.allowRemove,e.allowAdd=this.templateMetadata.allowAdd,e.nestedHeaders=[],void 0!==this.templateMetadata.nestedHeaders&&null!==this.templateMetadata.nestedHeaders?e.nestedHeaders=this.templateMetadata.nestedHeaders:e.nestedHeaders=null;for(var t,a=[],n=0,l=0;l<this.templateMetadata.columns.length;l++){var r=this.templateMetadata.columns[l];r.hidden||(t=this.generateTableColumn(r,n),a.push(r.header),e.columns.push(t),n++)}null!==e.nestedHeaders&&e.nestedHeaders.length>0?(e.nestedHeaders.push(a),e.colHeaders=!1):e.colHeaders=a}return e},numericValidator:function(e,t){isNaN(e)&&!0===e&&""===e?t(!1):t(!0)},checkUnique:function(e,t){var a=!0,n=[];this.table&&(n=this.table.getDataAtCol(e));for(var l=0;l<n.length;l++)if(!(a=t!==n[l]))return a;return a},applyValidator:function(e,t,a,n){var l=!0;e.required&&0===t.length&&(l=!1),e.range&&(t<e.range[0]||t>e.range[1])&&(l=!1),e.unique&&!1!==e.unique&&(l=this.checkUnique(a,t)),n(l)},generateTableColumn:function(e,t){var a=this,n={},l=e.type;switch(n.data=e.field,l){case"numeric":n.readOnly=!1,1===e.totalType&&(a.hasRowTotal=!0,n.renderer=function(e,t,n,l,r,i){n==e.countRows()-1&&(i=a.getTotal(e,l)),arguments[5]=i,_handsontable.default.renderers.NumericRenderer.apply(this,arguments)});break;case"text":n.readOnly=!1;break;case"dropdown":n.source=this.getListFromDataset(e.entity,e.entityLabel);break;case"calc":l="numeric",n.readOnly=!0,n.formula=e.formula,n.data="_cc"+t;break;case"departmentSelector":l="text",n.readOnly=!1,n.renderer="groupsRenderer",n.editor=!1;break;case"remoteDropdown":l="text",n.readOnly=!1,n.renderer="remoteDropdown",n.editor=!1,e.relatedField&&(n.relatedField=e.relatedField),e.relatedManyToManyEntity&&(n.relatedManyToManyEntity=e.relatedManyToManyEntity,n.relatedManyToManyKey=e.relatedManyToManyKey);break;case"relatedColumn":l="0"==e.relatedColumnType||"numeric"==e.relatedColumnType?"numeric":"text",n.readOnly=!0;break;case"button":l="text",n.onclick=e.onClick,n.buttonLabel=e.buttonLabel,n.renderer="buttonRenderer",n.editor=!1,n.data="id";break;case"date":case"dateTime":l="date",n.readOnly=!1,n.type="date",n.dateFormat="YYYY-MM-DD",n.correctFormat=!0,n.allowEmpty=!1,n.datePickerConfig={firstDay:0,showWeekNumber:!0,numberOfMonths:3,disableDayFn:function(e){return 0===e.getDay()||6===e.getDay()}}}return!0===a.templateMetadata.readOnly&&(n.readOnly=!0),n.type=l,n.format=e.format,n.required=e.required,n.style=e.style,n.conditionalFormat=e.conditionalFormat,n.inputTemplateId=e.inputTemplateId,n.code=e.entity,n.entityLabel=e.entityLabel,n.totalType=e.totalType,n.validators=e.validators,n.customCellFunction=e.customCellFunction,n.onCell=e.onCell,n.onBeforeChange=e.onBeforeChange,n.hidden=!0===e.hidden,n.enabledItemField=e.enabledItemField,n.description=e.description,e.validators&&(n.validator=function(e,n){a.applyValidator(this.validators,e,t,n)},n.allowInvalid=!1),e.readOnly&&(e.readOnly?n.readOnly=!0:this.isFunction(e.readOnly)&&(n.readOnly=this.evaluateIfIsFunction(e.readOnly))),n},getTotal:function(e,t){var a;return e.getData().reduce(function(e,n){return null!=(a=0===n.length||""===n[t]?0:n[t])?e+a:e},0)},getLabelFromDataset:function(e,t,a){var n=null;if(this.templateMetadata&&this.templateMetadata.dataset[t])for(var l=this.templateMetadata.dataset[t],r=0;r<l.data.length;r++)if(l.data[r][0]==e){var i=l.columns.indexOf(a.toLowerCase());n=l.data[r][i];break}return n},getListFromDataset:function(e,t){var a=[];if(this.templateMetadata&&this.templateMetadata.dataset[e])for(var n=this.templateMetadata.dataset[e],l=0;l<n.data.length;l++){var r=n.columns.indexOf(t.toLowerCase());a.push(n.data[l][r])}return a},isFunction:function(e){return!!(e&&e.length>30&&e.toLowerCase().startsWith("function"))},evaluateIfIsFunction:function evaluateIfIsFunction(value){var res=value;if(this.isFunction(value))try{var _this=this;eval("res = "+value),res=res()}catch(e){return console.log(e.message),null}return res},ensureEmptyRow:function(){var e=!1;if(this.tableData){if(this.tableData.length<=1)e=!0;else{for(var t=this.tableData[this.tableData.length-2],a=!0,n=0;n<t.length;n++)if(t[n]){a=!1;break}e=!a}e&&this.tableData.push({})}return e},checkForGroupSelector:function(e){var t=!1;if(e&&e.columns)for(var a=0;a<e.columns.length;a++)if("groupSelector"==e.columns[a].type){t=!0;break}return t},createGroupDict:function(e){var t=this;__webpack_require__.e(277).then(function(){var a=[__webpack_require__(747)];(function(a){(new a).List(void 0,function(a){if(t.groupDic={},a)for(var n=0;n<a.length;n++)t.groupDic[a[n].groupId]=a[n].name;t=null,e()})}).apply(null,a)}).catch(__webpack_require__.oe)},sendCurrentPosition:function(){var e=this;if(this&&this.table&&this.templateMetadata){try{if(this.getBase().is(":visible")&&this.table.getSelectedRange()){var t=this.table.getSourceDataAtRow(this.table.getSelectedRange().from.row).id,a=this.table.getCellMeta(this.table.getSelectedRange().from.row,this.table.getSelectedRange().from.col).prop;if(this.nodeJSManager){var n={};n.code=this.templateMetadata.code,n.id=t,n.col=a,n.userName=__currentSession.userName,n.userId=__currentSession.loginId,this.nodeJSManager.triggerEvent("setInputTemplatePos",n)}}setTimeout(function(){e.sendCurrentPosition()},7e3)}catch(e){}this.getBase().find(".inputFormCollabWrapper li[data_live=0]").each(function(t,a){e.collabRemoveRemoteCellIndicator(a)}),this.getBase().find(".inputFormCollabWrapper li[data_live=0]").remove(),this.getBase().find(".inputFormCollabWrapper li[data_live=1]").attr("data_live",0)}},collabRemoveRemoteCellIndicator:function(e){if($(e).attr("class").match(/\bcollabItemCell_(\d+)\b/)){var t=$(e).attr("class").match(/\bcollabItemCell_(\d+)\b/)[0];this.getBase().find("td").removeClass(t)}},collabGetNextColorClass:function(e){return"collabItemCell_"+e.find("li").length},collabCreateItem:function(e,t){0==e.find("li[data_id='"+t.userId+"']").length?$("<li/>").text(t.userName.substr(0,1)).attr("data_id",t.userId).attr("title",t.userName).attr("data_live",1).appendTo(e).addClass(this.collabGetNextColorClass(e)):e.find("li[data_id='"+t.userId+"']").attr("data_live",1)},collabSetActiveCell:function(e,t){var a=e.find("li[data_id='"+t.userId+"']").attr("class");this.getBase().find("td").removeClass(a);var n=this.table.getSourceData();if(n)try{for(var l=0;l<n.length;l++)if(n[l].id==t.id){for(var r=0;r<this.templateMetadata.columns.length;r++)if(this.templateMetadata.columns[r].field==t.col){var i=this.table.getCell(l,r,!0);i&&!$(i).hasClass(a)&&$(i).addClass(a);break}break}}catch(e){console.log("error in sync set pos: "+e.message)}n=null},collabSetChanges:function(e,t){if(t.rowsChanged&&t.rowsChanged.length>0){var a=this.table.getSourceData();if(a)for(var n=0;n<t.rowsChanged.length;n++)for(var l=t.rowsChanged[n],r=0;r<a.length;r++)if(a[r].id==l.id){for(var i=0;i<l.changes.length;i++){var o=l.changes[i].field,s=l.changes[i].values?l.changes[i].values:l.changes[i].value;try{this.table.setDataAtRowProp(r,o,s,"collab"),!0}catch(e){console.log("error in sync changes: "+e.message)}}break}}},onCollabMessage:function(e,t){if(t){var a=t.userId;if(a!=__currentSession.loginId&&this.table&&this.templateMetadata&&this.templateMetadata.code==t.code){var n=this.getBase().find(".inputFormCollabWrapper");switch(e){case"loadInputTemplate":this.collabCreateItem(n,t);break;case"unloadInputTemplate":n.find("li[data_id='"+a+"']").length>0&&(this.collabRemoveRemoteCellIndicator(n.find("li[data_id='"+a+"']")[0]),n.find("li[data_id='"+a+"']").remove());break;case"setInputTemplatePos":this.collabCreateItem(n,t),this.collabSetActiveCell(n,t);break;case"setInputTemplateValues":this.collabCreateItem(n,t),this.collabSetChanges(n,t)}}}},includeExternalJs:function(){if(this.templateMetadata&&this.templateMetadata.externalJs)try{var e=this;__webpack_require__.e(42).then(function(){var t=[__webpack_require__(713)("./"+this.templateMetadata.externalJs)];(function(t){e.externalView=new t($.extend(!0,{},e.options)),e.externalView.render(),e=null}).apply(null,t)}).catch(__webpack_require__.oe)}catch(e){console.log("Error on create external view: "+e.message)}},getPossibleTransitions:function(e,t,a){var n=[],l=(0,_globalFxs.haveAccess)("BYPASSWORKFLOWTASKTRANSITIONS");if(e)for(var r=e.stateId,i=0;i<t.length;i++){for(var o=!1,s=0;s<a.length;s++)if(r==a[s].fromStateId&&t[i].taskStateId==a[s].toStateId){o=!0;break}(l||o||r==t[i].taskStateId)&&n.push(t[i])}return n},showWorkflow:function(e){var t=this;if(this.templateMetadata.workflowGroups&&this.templateMetadata.workflowGroups.length>0){var a=this.templateMetadata.workflowGroups;__webpack_require__.e(34).then(function(){var n=[__webpack_require__(707)];(function(n){var l=new n;l.getWorkflowByGroups(a,function(a){var n=void 0!==__currentSession.fromEmbedded&&__currentSession.fromEmbedded,r={tasks:[]};a&&a.length>0&&l.listStates(function(i){l.listTransitions(function(l){for(var o=0;o<a.length;o++)for(var s=0;s<a[o].tasks.length;s++)a[o].tasks[s].startDate=moment(a[o].tasks[s].startDate).format("MM/DD"),a[o].tasks[s].endDate=moment(a[o].tasks[s].endDate).format("MM/DD"),a[o].tasks[s].transitions=t.getPossibleTransitions(a[o].tasks[s],i,l),r.tasks.push(a[o].tasks[s]);var d={title:(0,_globalFxs.translate)("workflow"),workflow:r,workflowData:!0,content:"",left:e.clientX,top:e.clientY,className:"popover_workflow",workflowEnabled:!0,fromEmbedded:n,fromImputTemplate:!0,inputFormView:t,onSaveCallback:function(){this.inputFormView.drawTemplate(!0)}};__webpack_require__.e(13).then(function(){var e=[__webpack_require__(737)];(function(e){(new e).show(d,function(e){})}).apply(null,e)}).catch(__webpack_require__.oe)})})})}).apply(null,n)}).catch(__webpack_require__.oe)}},generateHistoryDic:function(){var e={},t=!1;if(this.tableData&&this.tableData.length>0&&void 0!=_typeof(this.tableData.historyColumns))for(var a=0;a<this.tableData.length;a++)if(this.tableData[a].historyColumns){t=!0;for(var n=this.tableData[a].historyColumns.split(","),l=0;l<n.length;l++)e[a+"||"+n[l]]=!0}return t?e:null},showHistoryData:function(e,t){if(this.historyDic&&this.historyDic[t]){$(".popover_inputetemplate_history").remove();var a={inputTemplateId:this.options.templateId,entityId:this.table.getSourceDataAtRow(t.split("||")[0]).id,columnName:t.split("||")[1]};this.inputModuleModel.getHistoryChanges(a,function(t){for(var a="",n=0;n<t.length;n++)a+="<b>"+moment(t[n].dateChange).format("MM/DD/YYYY HH:mm")+"</b> "+t[n].newUser+" changed de value '"+t[n].oldValue+"' for '"+t[n].newValue+"' <br/>";var l={content:a,left:e.clientX,top:e.clientY,className:"popover_inputetemplate_history"};__webpack_require__.e(13).then(function(){var e=[__webpack_require__(737)];(function(e){(new e).show(l,function(e){})}).apply(null,e)}).catch(__webpack_require__.oe)})}},showColDescription:function(e,t){$(".popover_inputetemplate_colDesc").remove();var a={content:t,left:e.clientX,top:e.clientY,title:(0,_globalFxs.translate)("_description"),className:"popover_inputetemplate_colDesc"};__webpack_require__.e(13).then(function(){var e=[__webpack_require__(737)];(function(e){(new e).show(a,function(e){})}).apply(null,e)}).catch(__webpack_require__.oe)},getDataByEntity:function(e,t){this.inputModuleModel.getData(e,function(e){t(e)})}});return view}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this,__webpack_require__(218),__webpack_require__(1),__webpack_require__(134))}}]);