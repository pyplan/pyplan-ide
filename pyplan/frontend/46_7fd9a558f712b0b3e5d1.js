/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1134:function(t,e,a){"use strict";(function(i,n,r){var d,o,s=a(18);function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}d=[a(702),a(706),a(1401)],void 0===(o=function(t,e,d){var o,h=i.View.extend((l(o={el:n("#main"),menuInitiated:!1,editionModeInitiated:!1,dashboardModels:[],render:function(e,a){this.dashboardId=e;var i=this;if(this.dashboardModels.push(this.options.dashboardModel),this.dashboardController=new t,r(),1===n(".tabs-area .dash-tabs").length)return!1;function r(){var t=!!event&&n(event.currentTarget).hasClass("reports-view");if(event&&(event.target===window||t)){n(".tabs-area").show();var e=n(".tabs-area .toolbar").width(),a=(n(".nav-tabs").width(),n(".pagination").width()),r=n("#left").width();n(".nav-tabs").width(n(window).width()-e-a-r-100),setTimeout(function(){i.doAdapt()},350)}}this.refreshDashboardTabs(a),n(window).resize(r)},reloadDashboard:function(t,e){var a=this.getModel().getItemsModel();n.each(a,function(t,e){n(e.tagId).trigger("removeItemView")}),this.getModel().removeAllItemsModel();var i=this;this.getModel().getDashboard(t,function(t){i.refreshDashboardName(t),i.getModel().setNodeOwner(t.nodeOwner),i.parseDashboard(t,e),i.getParent().find("div.breadcrumbs2").show(),i.checkShared(t,!1),i=null})},refreshDashboardName:function(t){if(t){var e=t.dashboardId,a=t.name;this.dashboardName=a,n("span[data-rel='dashboard-"+e+"']").text(a),n("#topMenuBar li a[rel='dashboard-"+e+"']").text(a),n(".dash-tabs li a[data-rel='"+e+"']").text(a)}},getModel:function(t){var e=(t?n(t.target):this.getParent().find(".dash-tabs li a.active")).attr("data-rel"),a=null;return n.each(this.dashboardModels,function(t,i){i.attributes.dashId==e&&(a=i)}),a},checkShared:function(t,e){var a=this.getModel();if(window.location.href.indexOf("/#shared/")>0)return n(".tabs-area").find(".toolbar .shared-message").hide(),n(".tabs-area").find(".toolbar .btn-group .btn").hide(),n(".tabs-area").find(".toolbar .btn-group .btnRefresh").show(),this.checkFromDiagram(a.attributes),!1;if(a){if(null===a.attributes.imOwner||a.attributes.imOwner)e||(n(".tabs-area").find(".toolbar .btnEdit").show(),n(".tabs-area").find(".toolbar .btnShare").show(),n(".tabs-area").find(".toolbar .shared-message").html(""));else{n(".tabs-area").find(".toolbar .btnEdit").hide(),n(".tabs-area").find(".toolbar .btnShare").hide(),n(".tabs-area").find(".toolbar .shared-message").html((0,s.translate)("Is shared"));var i=this;this.getParent().on("refreshImageDashboard",function(t,e){i.reloadDashboard(e)})}this.checkFromDiagram(a.attributes),this.getNavigator(a.attributes.dashId)}},addHandlers:function(){var t=this;n(".tabs-area .dash-tabs").on("click",'li a:not(".moreBtn")',function(){event.preventDefault(),n(".tabs-area .dash-tabs ul.-secondary li:visible").length>=1&&n(".tabs-area .dash-tabs .moreBtn").click(),n(".tabs-area .nav-tabs li").find("a").removeClass("active"),n(this).addClass("active");n(this).attr("data-key");var e=n(this).attr("data-rel");"true"!==n(this).attr("data-opened")&&(n(".dashboard-titles li a").attr("data-opened",!1),n(this).attr("data-opened",!0),Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).showEmbeddableDashboard(e,"dashboard","Loading...",!1,!1,{embeddable:!0})}).apply(null,t)}).catch(a.oe)),Promise.resolve().then(function(){var t=[a(684)];(function(t){(new t).selectTask("dashboard-"+e)}).apply(null,t)}).catch(a.oe),t.checkShared(!1)}),n(".tabs-area .dash-tabs").on("click","li i",function(){n(this).closest("li").find("a").attr("data-key");var e=n(this).closest("li").find("a").attr("data-rel");e=e.indexOf("-")>1?e:parseInt(e.split("-")[0]),t.dashboardModels.splice(t.dashboardModels.findIndex(function(t){return t.attributes.dashId==e}),1),Promise.resolve().then(function(){var i=[a(684)];(function(a){(new a).removeTask("dashboard-"+e),setTimeout(function(){t.refreshDashboardTabs()},150)}).apply(null,i)}).catch(a.oe)}),n(document).off("contextmenu",".tabs-area li a"),n(document).on("contextmenu",".tabs-area li a",function(e){return t.showTabContextMenu(n(this),e),!1}),this.getParent().find("div.toolbar button.btnEdit").on("click",n.proxy(function(){t.getGrid().data("gridstack").grid.float=!1,t.editionModeInitiated?t.refreshMode(!0):(t.editionModeInitiated=!0,t.refreshMode(!0))},this)),this.getParent().find("div.toolbar button.btnAdd").on("click",function(){t.addNewWidget(t)}),this.getParent().find("div.toolbar button.btnShow").on("click",n.proxy(function(){this.refreshMode(!1),this.checkFromDiagram(this.getModel().attributes),t.getGrid().data("gridstack").grid.float=!0,setTimeout(function(){t.saveDashboard(),t.doAdapt()},200)},this)),this.getParent().find("div.toolbar button.btnCancel").on("click",function(){t.getParent().find("div.toolbar button.btnShow").hide(),t.getParent().find("div.toolbar button.btnCancel").hide(),t.getParent().find("div.toolbar button.btnAdd").hide(),t.getParent().find("div.sure_cancel_dashboard").show(),t.getParent().find("div.toolbar button.btnGoCancel").show(),t.getParent().find("div.toolbar button.btnCancelCancel").show()}),this.getParent().find("div.toolbar button.btnGoCancel").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");t.getParent().find("div.sure_cancel_dashboard").hide(),t.refreshMode(!1),t.getGrid().addClass("grid-stack-autoposition"),n('[data-rel="dashboard-'+e+'"]').trigger("reloadDashboard")}),this.getParent().find("div.toolbar button.btnCancelCancel").on("click",function(){t.getParent().find("div.sure_cancel_dashboard").hide(),t.getParent().find("div.toolbar button.btnShow").show(),t.getParent().find("div.toolbar button.btnCancel").show(),t.getParent().find("div.toolbar button.btnAdd").show()}),this.getParent().find("div.toolbar button.btnShare").on("click",n.proxy(function(){var t=n(".dashboardTask:visible").attr("data-id").split(/-(.+)/)[1];(0,s.haveAccess)("share_dashboard")?a.e(48).then(function(){var e=[a(1112)];(function(e){(new e).showSharer(t)}).apply(null,e)}).catch(a.oe):a.e(17).then(function(){var t=[a(685)];(function(t){(new t).show({title:"WARNING!",text:(0,s.translate)("share_dashboard_access_denied"),notifyType:"error"})}).apply(null,t)}).catch(a.oe)},this)),this.getParent().find("div.toolbar button.btnScenarios").on("click",function(){a.e(29).then(function(){(function(e){var i=[a(918)];(function(a){var i={nodeList:[]},r=[];n.each(n(".dash-tabs li a"),function(e,a){var i=n(this).attr("data-rel");r=n('div.mainTask[data-rel="dashboard-'+i+'"]').triggerHandler("getModel",[r]),h=t.getModel().getItemModel(i)});var d=[];n.each(r,function(t,e){n.each(e.getItemsModel(),function(t,e){d.push(e)})});var o=["indexlist","formnode","selector","button","objectItem","map","indicator"];"cubengine"==__currentSession.modelInfo.engine&&(o=["indexlist","formnode","selector","button","objectItem","map"]),n.each(d,function(t,a){if(a&&a.currentNodeId)if(a.currentResult&&-1!==e.inArray(a.currentResult.itemType,o));else{var r=a.currentNodeId;a.currentResult&&a.currentResult.nodeProperties&&a.currentResult.nodeProperties.originalId&&(r=a.currentResult.nodeProperties.originalId),a.pivotTable&&a.pivotTable.metadata&&a.pivotTable.metadata.nodeProperties&&a.pivotTable.metadata.nodeProperties.originalId&&(r=a.pivotTable.metadata.nodeProperties.originalId),0===n.grep(i.nodeList,function(t){return t.id===r}).length&&i.nodeList.push({id:r,name:a.currentResult&&a.currentResult.itemProperties&&a.currentResult.itemProperties.title?a.currentResult.itemProperties.title.text:a.currentNodeId})}}),(new a).show(i)}).apply(null,i)}).call(this,a(1))}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnDataSnapshot").on("click",function(){a.e(29).then(function(){var t=[a(918)];(function(t){(new t).showDataSnapshot()}).apply(null,t)}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnCopy").on("click",function(){var e=n(".dashboardTask:visible").attr("data-id").split(/-(.+)/)[1],i=t.getParent().find("a.active").first().text();t.dashboardController.showCopyDashboard(e,i,function(e,i){Promise.resolve().then(function(){var r=[a(702)];(function(a){n("#model-summary").trigger("fullRefresh"),t.dashboardController.showDashboard(e,-1,i)}).apply(null,r)}).catch(a.oe)})}),this.getParent().find("div.toolbar button.btnRefresh").on("click",n.proxy(function(){Promise.resolve().then(function(){var e=[a(219)];(function(e){(new e).executeForRefresh(function(e){var a=[];t.noQuery&&n.each(t.noQuery,function(t,e){n.each(e.rel,function(t,e){a.push(e)})}),t.getModel().initializeDashboardQuery(t.noQuery);var i=t.getModel().getItemsModel();n.each(i,function(t,e){a.indexOf(e.currentNodeId)>=0||n(e.tagId).trigger("refreshItemDash")})})}).apply(null,e)}).catch(a.oe)},this)),this.getParent().find("div.toolbar button.btnComments").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");Promise.resolve().then(function(){var i=[a(702)];(function(a){(new a).showDashboardComments({dashboardId:e,parent:t.getParent()})}).apply(null,i)}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnPrint").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");Promise.resolve().then(function(){var t=[a(752)];(function(t){(new t).printDashboard(e)}).apply(null,t)}).catch(a.oe)}),this.getParent().find(".main-fullscreen button[data-rel='close-screen']").on("click",function(){var e=n(this).closest(".main-fullscreen").find(".item-area").parent(),a="#"+e.attr("data-parent"),i=(e.attr("data-parent"),n(a)),r=n(this).closest(".main-fullscreen"),d=(i.offset(),e.attr("data-orignal-w")),o=e.attr("data-orignal-h"),s=e.attr("data-orignal-y"),l=e.attr("data-orignal-x"),h=n(this);r.animate({top:s+"px",left:l+"px",width:d,height:o},{done:function(){n.wrapper.append(e.detach()),r.hide(),h.show(),t.updateSizes(),t.getModel().getItemModel(a).onEndNormalScreenAnimation()}}),t.getModel().getItemModel(a).updateSize(d,o,!0)}),this.getParent().find(".report-navigator a").on("click",function(){event.preventDefault();var e=n(this).attr("data-id"),a=n(this).attr("title");e&&(t.dashboardController.showDashboard(e,-1,a),t.getNavigator(e))})},getCurrentViewPort:function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t},checkFromDiagram:function(t){t.node&&""!==t.node&&null!==t.node?(n(".tabs-area").find(".toolbar .btnCopy").hide(),n(".tabs-area").find(".toolbar .btnShare").hide()):window.location.href.indexOf("/#shared/")<0&&n(".tabs-area").find(".toolbar .btnCopy").show()},addNewWidget:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;(h=t).fromAddButton=!0;var r=this.getGrid().data("gridstack"),d=0;r.grid.nodes.length>0&&(d=Math.max.apply(Math,r.grid.nodes.map(function(t){return t.y+t.height})));var o=12,s=7;switch(this.getCurrentViewPort()){case"xs":o=2,s=3;break;case"sm":case"md":o=6,s=4;break;case"lg":o=12}var l={x:0,y:d,width:o,height:s};e&&(l=e);var h=this;i&&"empty"!=i.itemType?a.e(0).then(function(){var t=[a(723)];(function(t){var e=new t({model:h.getModel()});e.setElement(n("div.grid-stack")),e.currentResult=n.extend(!0,{},i.currentResult),e.grid=r,e.dashboardModel=h.getModel(),e.loadingDashboard=!0,e.currentResult.itemId=n.uuid(),e.currentResult.itemType="table"==i.currentResult.itemType?"columnchart":"table",e.currentResult.itemProperties.bottomTotal=!1,e.currentResult.itemProperties.rightTotal=!1,e.currentResult.x=l.x,e.currentResult.y=l.y,e.currentResult.width=l.width,e.currentResult.height=l.height,h.getModel().addItemToModel(e),e.createNewView(e.currentResult,!1)}).apply(null,t)}).catch(a.oe):Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(h.getModel(),function(t){t.setElement(h.getGrid()),t.model=h.getModel(),t.grid=r,t.currentResult=l,t.itemType="empty",t.currentResult.itemType="empty",t._applyItemId(l,null);t.render(null,null,!0),h.getModel().addItemToModel(t),t.setEditMode(h.getModel().editMode)})}).apply(null,t)}).catch(a.oe),h.getModel().setStateModified(!0)},refreshMode:function(t){var e=this;e.getModel().editMode=t,this.getParent().find("div.toolbar button").hide(),this.getGrid().data("gridstack").setStatic(!t);var i=this.getModel().getItemsModel();n.each(i,function(e,a){a.setEditMode(t)}),t?(this.getParent().find(".dash-tabs").hide(),this.getGrid().addClass("editing"),this.getParent().find("div.toolbar button.btnShow").show(),this.getParent().find("div.toolbar button.btnCancel").show(),this.getParent().find("div.toolbar button.btnAdd").show(),this.getGrid().removeClass("grid-stack-autoposition")):(this.getParent().find(".dash-tabs").show(),this.getGrid().removeClass("editing"),this.getParent().find("div.toolbar button").show(),this.getParent().find("div.toolbar button.btnShow").hide(),this.getParent().find("div.toolbar button.btnCancel").hide(),this.getParent().find("div.toolbar button.btnAdd").hide()),a.e(64).then(function(){var t=[a(731)];(function(t){(new t).list(null,function(t){e.getModel().setStyleLibraries(t)})}).apply(null,t)}).catch(a.oe)},sortWidgets:function(t,e){return t.currentResult.y<e.currentResult.y?-1:t.currentResult.y>e.currentResult.y?1:t.currentResult.x<e.currentResult.x?-1:t.currentResult.x>e.currentResult.x?1:0},saveDashboard:function(){var t=this,e={},a=[],i=this.getModel().getItemsModel(),r=[],d=[];n.each(i,function(t,e){var a=e.getRelatedNoQuery();a&&a.length>0&&r.push({node:e.currentNodeId,rel:a});var i=e.getStylesUsed();i&&(d=d.concat(i))}),e.noQuery=r,i.sort(this.sortWidgets),n.each(i,function(t,i){e={};var r=i.tagId;if(i){e.index=t,e.nodeId=i.currentNodeId,e.itemId=i.itemId;var d=i.grid.grid.getNodeDataByDOMEl(n(r));e.x=d.x,e.y=d.y,e.width=d.width,e.height=d.height,e.itemProperties=i.currentResult.itemProperties,e.itemType=i.currentResult.itemType,e.objectType=i.currentResult.objectType,i.currentResult&&(e.itemType=i.currentResult.itemType,"objectItem"==e.itemType&&(e.objectType=i.currentResult.objectType),e.rows=i.currentResult.rows,e.columns=i.currentResult.columns,e.dims=i.currentResult.dims,e.itemProperties=i.currentResult.itemProperties),a.push(e)}});var o=t.getParent().find(".dash-tabs li a.active").attr("data-key").split(/-(.+)/)[1];this.getModel().getDashboard(o,function(e){var r,s=t.getModel().getStateModified();switch(r=e.definition?e.definition:{},t.getCurrentViewPort()){case"xs":r.definitionSmall=a,s&&(delete r.definitionLarge,delete r.definitionMedium);break;case"sm":case"md":r.definitionMedium=a,s&&(delete r.definitionLarge,delete r.definitionSmall);break;case"lg":r.definitionLarge=a,s&&(delete r.definitionMedium,delete r.definitionSmall)}t.getModel().updateDefinition(o,r,d,function(){n.each(i,function(t,e){e.onSaveDashboard()}),t.getModel().setStateModified(!1),t=null})})},recalcWidgets:function(t,e){var a,i=this.getCurrentViewPort(),n=t;switch(e){case"xs":a=r.map(n,function(t){var e,a=1===t.width||2===t.width?t.width:2;e=a>=2?0:0===t.x||1===t.x?t.x:0;var i=Object.assign({},t);return i.width=a,i.x=e,i},this);break;case"sm":case"md":var d=2;"xs"===i&&(d=3);a=r.map(n,function(t){var e=t.width*d;e=Math.floor(e);var a=t.x*d;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this);break;case"lg":d=2;"xs"===i&&(d=6),a=r.map(n,function(t){var e=t.width*d;e=Math.floor(e);var a=t.x*d;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this)}return a}},"getCurrentViewPort",function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t}),l(o,"isBreakpoint",function(t){return n(".device-"+t).is(":visible")}),l(o,"showTabContextMenu",function(t,e){var i={_me:{name:(0,s.translate)("close")},_all:{name:(0,s.translate)("close_all")},_others:{name:(0,s.translate)("close_all_but_this")}};n.contextMenu("destroy",".tabs-area"),n.contextMenu({selector:".tabs-area",callback:function(e,i){switch(e){case"_me":t.closest("li").find("i").click();break;case"_all":case"_others":var r=t.attr("data-key");"_all"==e&&(r="_123123_"),Promise.resolve().then(function(){var i=[a(684)];(function(a){var i=new a,d=[];t.closest("ul.dash-tabs").find("li a:not(.moreBtn)").each(function(t,e){n(e).attr("data-key")!=r&&d.push(n(e).attr("data-key"))}),d.length>0&&n.each(d,function(t,a){"_all"==e?i.removeTask(a,!1):(i.selectTask(r),i.removeTask(a,!0))})}).apply(null,i)}).catch(a.oe)}},items:i,events:{hide:function(t){n.contextMenu("destroy",".tabs-area")}},zIndex:0}),n(".tabs-area").contextMenu({x:e.clientX,y:e.clientY})}),l(o,"refreshDashboardTabs",function(t,e){var a=this,i=!1,r=[];window.location.href.indexOf("/#shared/")>0&&(i=!0),i?"dashboard"===t||"evaluatedNode"===t||void 0===t?(this.dashboardModels.forEach(function(t){var e="dashboard-"+t.attributes.dashId,a=t.attributes.dashId,i=!!t.attributes.extraOptions&&t.attributes.extraOptions.closable,d=n("#topMenuBar ul li a[rel='"+e+"']").text();d||(d=n('.dashboardTask.new[data-rel="'+e+'"]').attr("dash-title")),r.push({id:a,key:e,title:d,closeBtn:i,notDesktop:!1})}),r.length>0&&a.drawTabs(r)):this.options.dashboardModel.getNavigator({dashboardId:this.dashboardId},function(t){t&&t.list.length>0&&n.each(t.list,function(t,e){r.push({id:e.id,key:"dashboard-"+e.id,title:e.name,closeBtn:!1,notDesktop:!1})}),r.length>0&&a.drawTabs(r)}):(n(".dashboardTask.new").each(function(t,e){var a=n(e).attr("data-rel"),i=a.split(/-(.+)/)[1],d=n("#topMenuBar ul li a[rel='"+a+"']").text();d||(d=n(e).attr("dash-title")),r.push({id:i,key:a,title:d,closeBtn:!0,notDesktop:!1})}),r.length>0&&a.drawTabs(r))}),l(o,"drawTabs",function(t){var e=this;n(".tabs-area").remove();var a,i=n(".tabs-area");if(i.empty(),i.hide(),t.length>0){var r=d(t);n(r).insertBefore(n(n(".mainTask.dashboardTask")[0])),i.show()}var o=n(".dashboardTask:visible").attr("data-rel");window.location.href.indexOf("/#shared/")>0?a=n('.tabs-area .nav-tabs li a[data-key="'+o+'"]'):(a=n('.tabs-area .nav-tabs li a[data-key="'+o+'"]'),this.dashboardId=a.attr("data-rel")),a.addClass("active"),a.attr("data-opened",!0),a.click(),this.getNavigator(this.dashboardId);var s=n(".nav-tabs"),l=s.find(".-primary");s.addClass("--jsfied"),l.append('\n        <li class="-more">\n          <a class="moreBtn" aria-haspopup="true" aria-expanded="false">\n            More <span>&darr;</span>\n          </a>\n          <ul class="-secondary">\n            '.concat(l.html(),"\n          </ul>\n        </li>\n      "));s.find(".-secondary").find("li"),s.find("li");var h=n("li.-more").find(".moreBtn");h.on("click",function(t){t.preventDefault(),s.toggleClass("--show-secondary"),h.attr("aria-expanded",s.hasClass("--show-secondary"))}),this.addHandlers(),this.doAdapt(),n(".tabs-area .toolbar").on("pendingRefresh",function(t,a){var i,r=e.getParent().find(".dash-tabs li a");n.each(r,function(t,r){i=n(r).attr("data-rel");n.each(e.dashboardModels,function(t,e){parseInt(e.attributes.dashId)===parseInt(i)&&n.each(e.getItemsModel(),function(t,e){e.currentNodeId==a.nodeId&&n(r).attr("pending-refresh",!0)})})})}),n(".tabs-area .toolbar").on("checkIfPendingRefresh",function(t,a){"true"===e.getParent().find(".dash-tabs li a.active").attr("pending-refresh")&&(n(".tabs-area .toolbar .btnRefresh").click(),e.getParent().find(".dash-tabs li a.active").attr("pending-refresh",!1)),e.checkShared(null,!1)}),e.checkShared(null,!1)}),l(o,"getNavigator",function(t){var e=this,a=this.getModel();a&&(a.getNavigator({dashboardId:t},function(a){a&&a.list.length>1?(a.priorId>0&&e.getParent().find(".btnNavigatorPrior").attr("data-id",a.priorId).attr("title",a.priorName).closest("li").removeClass("disabled"),a.nextId>0&&e.getParent().find(".btnNavigatorNext").attr("data-id",a.nextId).attr("title",a.nextName).closest("li").removeClass("disabled"),e.getParent().find(".nav-tabs li a").removeClass("active"),e.getParent().find('.nav-tabs li a[data-rel="'.concat(t,'"]')).addClass("active")):(e.getParent().find(".btnNavigatorPrior").closest("li").addClass("disabled"),e.getParent().find(".btnNavigatorNext").closest("li").addClass("disabled"))}),window.location.href.indexOf("/#shared/")>0&&n(".report-navigator").hide())}),l(o,"doAdapt",function(){n(".tabs-area").show();var t=n(".tabs-area .toolbar").width(),e=(n(".nav-tabs").width(),n(".pagination").width()),a=n("#left").width();n(".nav-tabs").width(n(window).width()-t-e-a-100);var i=n(".nav-tabs"),r=i.find(".-primary"),d=i.find(".-primary > li:not(.-more)"),o=i.find(".-secondary").find("li"),s=i.find("li"),l=n("li.-more"),h=l.find(".moreBtn");s.each(function(t,e){e.classList.remove("--hidden")});var c=h.length>0?h.width():0,u=[],b=r.length>0?r.width():0;d.each(function(t,e){b>=c+e.offsetWidth?c+=e.offsetWidth:(e.classList.add("--hidden"),u.push(t))}),u.length?o.each(function(t,e){u.includes(t)||e.classList.add("--hidden")}):(l.addClass("--hidden"),i.removeClass("--show-secondary"),h.attr("aria-expanded",!1)),n(".mainTask:visible").hasClass("dashboardTask")?n(".tabs-area").show():n(".tabs-area").hide()}),l(o,"getParent",function(){return n(".tabs-area")}),l(o,"getGrid",function(){var t=this.getParent().find("a.active").attr("data-rel");return n(".grid-dash-"+t)}),o));return h}.apply(e,d))||(t.exports=o)}).call(this,a(218),a(1),a(220))},1400:function(t,e,a){var i=a(690);t.exports=(i.default||i).template({1:function(t,e,a,i,n){return" from-external "},compiler:[7,">= 4.0.0"],main:function(t,e,a,i,n){var r,d,o=null!=e?e:t.nullContext||{},s=a.helperMissing,l=t.escapeExpression;return'<div\n  class="container-fluid mainTask full-horizontal dashboardTask new hideClose '+(null!=(r=a.if.call(o,null!=(r=null!=e?e.extraOptions:e)?r.external:r,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.noop,data:n}))?r:"")+'"\n  data-rel="dashboard-'+l("function"==typeof(d=null!=(d=a.id||(null!=e?e.id:e))?d:s)?d.call(o,{name:"id",hash:{},data:n}):d)+'" dash-name="'+l("function"==typeof(d=null!=(d=a.dashTitle||(null!=e?e.dashTitle:e))?d:s)?d.call(o,{name:"dashTitle",hash:{},data:n}):d)+'" data-type="tab-content">\n\n\n\n  <div class="breadcrumbs2 nodisplay">\n  </div>\n\n  <div class="device-xs visible-xs"></div>\n  <div class="device-sm visible-sm"></div>\n  <div class="device-md visible-md"></div>\n  <div class="device-lg visible-lg"></div>\n  <div class="device-xl visible-xl"></div>\n\n  <div style="display: none;">\n    <span>Number of Columns:</span> <span id="grid-size"></span>\n  </div>\n\n\n\n  <div class="grid-stack grid-dash-'+l("function"==typeof(d=null!=(d=a.id||(null!=e?e.id:e))?d:s)?d.call(o,{name:"id",hash:{},data:n}):d)+' dashboard-area main-pane">\n  </div>\n\n\n  <div class="main-fullscreen" style="display: none; position:absolute;">\n    <div class="item-toolbar-view">\n      <button class="btn btn-small" data-rel="close-screen">\n        <i class="fa fa-arrows-alt"></i>\n      </button>\n    </div>\n  </div>\n</div>'},useData:!0})},1401:function(t,e,a){var i=a(690);function n(t){return t&&(t.__esModule?t.default:t)}t.exports=(i.default||i).template({1:function(t,e,i,r,d){return'      <button class="btn btnEdit" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"edit_dashboard",{name:"L",hash:{},data:d}))+'">\n        <i class="fa fa-pencil-square-o"></i>\n      </button>\n      <button class="btn btnShow nodisplay">\n        <i class="fa fa-check"></i>\n      </button>\n      <button class="btn btnCancel nodisplay">\n        <i class="fa fa-times"></i>\n      </button>\n      <button class="btn btnAdd nodisplay">\n        <i class="fa fa-plus"></i>\n      </button>\n'},3:function(t,e,a,i,n){return""},5:function(t,e,i,r,d){var o;return null!=(o=n(a(695)).call(null!=e?e:t.nullContext||{},"share_dashboard",{name:"haveAccess",hash:{},fn:t.program(6,d,0),inverse:t.noop,data:d}))?o:""},6:function(t,e,i,r,d){return'      <button class="btn btnShare" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"share",{name:"L",hash:{},data:d}))+'">\n        <i class="fa fa-share-square"></i>\n      </button>\n'},8:function(t,e,i,r,d){return'      <button class="btn btnCopy" title="'+t.escapeExpression(n(a(688)).call(null!=e?e:t.nullContext||{},"copy_dashboard",{name:"L",hash:{},data:d}))+'">\n        <i class="far fa-copy"></i>\n      </button>\n'},10:function(t,e,i,r,d){var o,s=t.lambda,l=t.escapeExpression;return'      <li>\n        <a href="#" data-rel="'+l(s(null!=e?e.id:e,e))+'" data-key="'+l(s(null!=e?e.key:e,e))+'" title="'+l(s(null!=e?e.title:e,e))+'">'+l(s(null!=e?e.title:e,e))+"</a>\n"+(null!=(o=n(a(689)).call(null!=e?e:t.nullContext||{},null!=e?e.closeBtn:e,"==",!0,{name:"ifCond",hash:{},fn:t.program(11,d,0),inverse:t.noop,data:d}))?o:"")+"      </li>\n"},11:function(t,e,a,i,n){return'        <i class="fa fa-close" />\n'},compiler:[7,">= 4.0.0"],main:function(t,e,i,r,d){var o,s=null!=e?e:t.nullContext||{},l=t.escapeExpression;return'<div class="tabs-area">\n\n  <div class="toolbar" style="float: left; background: #eee; padding-right:2px;">\n    <div class="btn-group">\n'+(null!=(o=n(a(695)).call(s,"add_dashboard",{name:"haveAccess",hash:{},fn:t.program(1,d,0),inverse:t.noop,data:d}))?o:"")+'      <button class="btn btnRefresh" title="'+l(n(a(688)).call(s,"refresh_dashboard",{name:"L",hash:{},data:d}))+'">\n        <i class="fa fa-refresh"></i>\n      </button>\n\n'+(null!=(o=n(a(695)).call(s,"view_report",{name:"haveAccess",hash:{},fn:t.program(3,d,0),inverse:t.noop,data:d}))?o:"")+(null!=(o=i.if.call(s,null!=(o=null!=e?e[0]:e)?o.notDesktop:o,{name:"if",hash:{},fn:t.program(5,d,0),inverse:t.noop,data:d}))?o:"")+(null!=(o=n(a(695)).call(s,"MANAGESCENARIOS",{name:"haveAccess",hash:{},fn:t.program(3,d,0),inverse:t.noop,data:d}))?o:"")+(null!=(o=n(a(695)).call(s,"add_dashboard",{name:"haveAccess",hash:{},fn:t.program(8,d,0),inverse:t.noop,data:d}))?o:"")+"\n\n"+(null!=(o=n(a(695)).call(s,"list_dashboardcomments",{name:"haveAccess",hash:{},fn:t.program(3,d,0),inverse:t.noop,data:d}))?o:"")+'\n\n      <div class="sure_cancel_dashboard nodisplay">\n        <span>'+l(n(a(688)).call(s,"sure_cancel_save_dashboard",{name:"L",hash:{},data:d}))+'</span>\n        <button class="btn btn-small btn-red btnGoCancel">'+l(n(a(688)).call(s,"yes",{name:"L",hash:{},data:d}))+'</button>\n        <button class="btn btn-small btn-grey btnCancelCancel">'+l(n(a(688)).call(s,"no",{name:"L",hash:{},data:d}))+'</button>\n      </div>\n\n      <a class="btn btn-default" id="save-widgets" href="#" style="display: none;">Save</a>\n\n    </div>\n    <span class="shared-message"></span>\n  </div>\n\n  <nav class="nav-tabs" style="float: left;">\n    <ul class="dash-tabs -primary nodisplay">\n\n'+(null!=(o=i.each.call(s,e,{name:"each",hash:{},fn:t.program(10,d,0),inverse:t.noop,data:d}))?o:"")+'\n    </ul>\n  </nav>\n\n  <ul class="pagination pagination-sm report-navigator">\n    <li class="disabled">\n      <a href="#" class="btnNavigatorPrior">\n        <i class="fa fa-chevron-left"></i>\n      </a>\n    </li>\n    <li class="disabled">\n      <a href="#" class="btnNavigatorNext">\n        <i class="fa fa-chevron-right"></i>\n      </a>\n    </li>\n  </ul>\n</div>\n'},useData:!0})},881:function(t,e,a){"use strict";(function(i,n,r,d){var o,s,l=a(18);o=[a(702),a(706),a(1400),a(1134)],void 0===(s=function(t,e,o,s){return i.View.extend({el:n("#main"),menuInitiated:!1,editionModeInitiated:!1,fromExternal:!1,initialize:function(){},render:function(i,d,h,c,u){this.currentDashboardId=i,this.keyView="div.mainTask[data-rel='dashboard-"+i+"']",c&&c.external&&(this.fromExternal=!0);var b={id:i,extraOptions:c};this.dashboardModel=new e({dashId:i,dashboardViewList:[],nodeOwner:"",imOwner:u,editMode:!1,extraOptions:c}),this.dashboardController=new t;var f=this,g=o(b);this.$el.append(g),this.dashboardTabs=new s({dashboardModel:this.dashboardModel}),this.dashboardTabs.render(i),this.reloadDashboard(i,c,h),f.fromAddButton=!1,this.currentViewPort=this.getCurrentViewPort();var m=12;switch(this.currentViewPort){case"xs":m=2;break;case"sm":case"md":m=6;break;case"lg":m=12}var v={float:!0,staticGrid:!0,verticalMargin:2,cellHeight:68,disableOneColumnMode:!0,width:m,resizable:{handles:"sw, w, se, e, s"},draggable:{handle:".widgetTitle",scroll:!0}};f.getGrid().removeClass("grid-stack-12").removeClass("grid-stack-6"),f.getGrid().gridstack(v),f.grid=f.getGrid().data("gridstack"),n(window).on("resize.updateSizes",function(t){n(".mainTask.dashboardTask:visible").length>=1&&f.updateSizes(t)}),this.updateSizes(),this.addHandlers(),this.addGenericHandlers(),n(this.keyView).on("reloadDashboard",function(){f.grid.removeAll(),f.reloadDashboard(i,!1)}),this.getGrid().on("added",function(t,e){f.fromAddButton&&(f.afterAddWidget(),f.fromAddButton=!1)}).on("removed",function(t,e){}).on("gsresizestop",function(t,e){setTimeout(function(){var t=r(e).attr("id");f.afterChangeWidget(t);var a=f.dashboardModel.getItemModel("#"+t);a.updateSize(),n(".chartToolbar.popover").length>0&&a.addProperties(!0)},100)}).on("dragstop",function(t,e){setTimeout(function(){var e=r(t.target).attr("id");f.afterChangeWidget(e);var a=f.dashboardModel.getItemModel("#"+e);n(".chartToolbar.popover").length>0&&a.addProperties(!0)},100)}),this.getGrid().on("click",".clearWidget",function(t){if(n(t.target).closest(".grid-stack-item-content").find(".chartTypeSelector").length)return!1;a.e(5).then(function(){var e=[a(683)];(function(e){(new e).show({title:(0,l.translate)("clear_widget"),text:(0,l.translate)("sure_clear_widget"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"}],callback:function(e){if("yes"==e){var i="#"+n(t.target).closest(".grid-stack-item").attr("id"),r=n(t.target).closest(".grid-stack-item").attr("id"),d=f.dashboardModel.getItemModel(i),o={x:d.currentResult.x,y:d.currentResult.y,width:d.currentResult.width,height:d.currentResult.height};f.dashboardModel.removeItemModel(d),f.grid.remove_widget(i),Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(f.dashboardModel,function(t){t.setElement(f.grid),t.model=f.dashboardModel,t.grid=f.grid,t.currentResult=o,t.itemType="empty",t.currentResult.itemType="empty",t._applyItemId(null,r),t.render(),f.dashboardModel.addItemToModel(t),t.setEditMode(f.dashboardModel.editMode)})}).apply(null,t)}).catch(a.oe)}}})}).apply(null,e)}).catch(a.oe)}),this.getGrid().on("click",".restoreWidget",function(t){var e=n(event.target).closest(".grid-stack-item");n(e).find(".restoreWidget").hide();var a=n(e).find(".grid-stack-item-content"),i=a.attr("data-orignal-w"),r=a.attr("data-orignal-h"),d=a.attr("data-orignal-x"),o=a.attr("data-orignal-y");e.animate({top:o,left:d,width:i,height:r},{done:function(){e.removeAttr("style"),f.dashboardModel.getItemModel("#"+e.attr("id")).updateSize(i,e.height()-28,!0),n("body").css("overflow-y","visible"),n("#"+e.attr("id")+"-fullscreenHelper").hide(),setTimeout(function(){window.scrollTo(0,n("#"+e.attr("id")).offset().top)},100)}})}),this.getGrid().on("click",".splitWidgetRight",function(t){var e=n(t.currentTarget).attr("graph");f.getGrid().find(".splitWidgetRight").removeAttr("graph"),f.getGrid().find(".splitWidgetBottom").removeAttr("graph"),parseInt(n(t.currentTarget).closest(".grid-stack-item").attr("data-gs-width"))>1&&f.splitWidget(t,"right",e)}),this.getGrid().on("click",".splitWidgetBottom",function(t){var e=n(t.currentTarget).attr("graph");f.getGrid().find(".splitWidgetRight").removeAttr("graph"),f.getGrid().find(".splitWidgetBottom").removeAttr("graph"),parseInt(n(t.currentTarget).closest(".grid-stack-item").attr("data-gs-height"))>1&&f.splitWidget(t,"bottom",e)}),this.getGrid().on("click",".removeWidget",function(t){var e=n(t.target).closest(".grid-stack-item").attr("data-gs-id");f.dashboardModel.getItemModel("#"+e).checkNodeOwner()||a.e(5).then(function(){var e=[a(683)];(function(e){(new e).show({title:(0,l.translate)("delete_widget"),text:(0,l.translate)("sure_delete_widget"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"}],callback:function(e){"yes"==e&&f.removeWidget(t)}})}).apply(null,e)}).catch(a.oe)}),n(".clearGrid").on("click",function(){f.clearGrid()}),this.getGrid().on("click",".moreChartTypes",function(t){var e=n(event.target).closest(".grid-stack-item").attr("data-gs-id");f.moreChartTypesMenu(e)}),n(".dash-overlay").on("click",function(){f.closeToolbar()}),n("#save-widgets").on("click",function(){setTimeout(function(){f.saveDashboard()},200)}),this.clearGrid=function(){return this.grid.removeAll(),!0}.bind(this),this.getThis().on("refreshView",function(){f.getParent().find("div.toolbar button.btnRefresh").trigger("click")}),this.getThis().on("changeNumberFormat",function(t,e){f&&f.dashboardModel&&f.dashboardModel.applyNumberFormat(e)}),this.getThis().on("reevaluateNodesNeeded",function(t,e){f&&f.dashboardModel&&f.dashboardModel.reevaluateNodesNeededInThisDashboard(e)}),this.getThis().on("removeView",function(){f.onRemoveView()}),this.getThis().on("beforeRemoveView",function(t,e){f.onBeforeRemoveView(t,e)}),this.getParent().on("selectView",function(){n(".tabs-area .nav-tabs li a").removeClass("active"),n('.tabs-area .nav-tabs li a[data-rel="'+f.currentDashboardId+'"]').addClass("active"),f.updateSizes()})},updateSizes:function(t){var e=this,a=-1;clearTimeout(a);var i=t;a=setTimeout(function(){if(n(e.keyView).is(":visible")&&i&&i.target===window&&e.currentViewPort!=e.getCurrentViewPort()){e.currentViewPort=e.getCurrentViewPort();n(window).height();95,e.reloadDashboard(e.currentDashboardId,!1)}},600)},splitWidget:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;function i(t){return t==parseFloat(t)?!(t%2):void 0}t.preventDefault();var r,d,o=this.getGrid().data("gridstack"),s=n(t.currentTarget).closest(".grid-stack-item"),l=s.attr("data-gs-x"),h=s.attr("data-gs-y"),c=s.attr("data-gs-width"),u=s.attr("data-gs-height"),b=i(c),f=i(u);"right"===e&&(c=Math.floor(s.attr("data-gs-width")/2),l=Math.round(s.attr("data-gs-x"))+c,r=b?c:c+1,d=u),"bottom"===e&&(u=Math.floor(s.attr("data-gs-height")/2),h=Math.round(s.attr("data-gs-y"))+u,r=c,d=f?u:u+1),o.resize(s,c,u);var g=this.dashboardModel.getItemModel("#"+s.attr("id"));g.currentResult.width=c,g.currentResult.height=u,g.itemType=a||"empty",this.dashboardModel.updateSizes(!0,!0);var m={x:l,y:h,width:r,height:d};this.dashboardTabs.addNewWidget(this.dashboardTabs,m,g),this.dashboardModel.setStateModified(!0)},removeWidget:function(t){t.preventDefault();var e=this.getGrid().data("gridstack"),a=n(t.currentTarget).closest(".grid-stack-item");e.remove_widget(a);var i=this.dashboardModel.getItemModel("#"+a.attr("id"));this.dashboardModel.removeItemModel(i),this.dashboardModel.setStateModified(!0)},isBreakpoint:function(t){return n(".device-"+t).is(":visible")},afterAddWidget:function(){this.getGrid().data("gridstack"),this.getCurrentViewPort()},afterChangeWidget:function(t){this.getGrid().data("gridstack"),this.getCurrentViewPort();var e=this.dashboardModel.getItemModel("#"+t);e.currentResult.x=n("#"+t).attr("data-gs-x"),e.currentResult.y=n("#"+t).attr("data-gs-y"),e.currentResult.width=n("#"+t).attr("data-gs-width"),e.currentResult.height=n("#"+t).attr("data-gs-height")},afterGridChange:function(){this.getGrid().data("gridstack")&&(this.isBreakpoint("xs")||(this.isBreakpoint("sm")||(this.isBreakpoint("md")||this.isBreakpoint("lg"))))},prepareWidgets:function(t,e){var a,i,r=[],d=this.grid.grid.nodes;return r.lg=[],r.md=[],r.sm=[],r.xs=[],n.each(d,function(t,n){switch(e){case"lg":a=1===n.width?n.width:n.width/2,a=Math.floor(a),i=0===n.x?n.x:n.x/2,i=Math.floor(i);var d={height:n.height,maxHeight:n.maxHeight,maxWidth:n.maxWidth,minHeight:n.minHeight,minWidth:n.minWidth,width:n.width,x:n.x,y:n.y,id:n.id},o={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};a=1===n.width||2===n.width?n.width:2,i=n.width>1?0:n.x>=1?1:0;var s={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};r.lg.push(d),r.md.push(o),r.sm.push(o),r.xs.push(s);break;case"sm":case"md":o={height:n.height,maxHeight:n.maxHeight,maxWidth:n.maxWidth,minHeight:n.minHeight,minWidth:n.minWidth,width:n.width,x:n.x,y:n.y,id:n.id};a=2*n.width,a=Math.floor(a),i=2*n.x,i=Math.floor(i);d={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};a=1===n.width||2===n.width?n.width:2,i=a>=2?0:0===n.x||1===n.x?n.x:0;s={height:n.height,maxHeight:n.maxHeight,maxWidth:a,minHeight:n.minHeight,minWidth:a,width:a,x:i,y:n.y,id:n.id};r.lg.push(d),r.md.push(o),r.sm.push(o),r.xs.push(s)}}),r},getSerializedDataForViewport:function(t){var e=localStorage.getItem("@DashboardName-"+t);return e=JSON.parse(e)},getCurrentViewPort:function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t},getOptionsMenu:function(){var t=this,e={callback:function(e,i){switch(e){case"columnchart":case"complexchart":case"table":case"nodetable":case"wizard":case"filter":var r=n("#"+i).closest(".grid-stack-item"),d=["variable"];"wizard"==e&&(d=null,e=void 0),"filter"==e&&(d=["index","decision","inputnode"],e=void 0),function(t,e,i){a.e(31).then(function(){var n=[a(925)];(function(a){(new a).show(t,{callback:i,filteredClasses:e})}).apply(null,n)}).catch(a.oe)}(event,d,function(a){var n=a.nodeId;if("module"==a.nodeClass)t.createNewView({itemType:"objectItem",objectType:"diagramviewer",itemProperties:{diagramOptions:{currentModule:n}}});else{var r=t.dashboardModel.getItemModel("#"+i);r.grid=t.grid,r.currentResult.itemProperties={},r.currentResult.itemType="objectItem",r.currentResult.objectType=e,r.model=t.dashboardModel,r.initializeWithNode(n)}});break;case"inputform":!function(t,e){a.e(45).then(function(){var i=[a(1022)];(function(a){(new a).show(t,{callback:e})}).apply(null,i)}).catch(a.oe)}(event,function(a){var r=a.templateId,d=a.name,o=t.dashboardModel.getItemModel("#"+i),s=n("#"+i).closest(".grid-stack-item");t.grid.remove_widget(s),o.grid=t.grid,o.currentResult.itemProperties={templateId:r,inputForm:{templateId:r},title:{text:d,style:{color:"#000"},enabled:!0},subtitle:{style:{color:"#000"}}},o.currentResult.itemType="objectItem",o.currentResult.objectType=e,o.model=t.dashboardModel,o.editMode=!0,o.createNewView(o.currentResult)});break;case"texteditor":case"diagramviewer":case"mapviewer":case"menuwidget":var o=t.dashboardModel.getItemModel("#"+i);r=n("#"+i).closest(".grid-stack-item");t.grid.remove_widget(r),o.grid=t.grid,o.currentResult.itemProperties={},o.currentResult.itemType="objectItem",o.currentResult.objectType=e,o.model=t.dashboardModel,o.editMode=!0,o.createNewView(o.currentResult)}},items:{}};return e.items.texteditor={type:"icon_text",name:"Text",iconClass:""},e.items.mapviewer={type:"icon_text",name:"Gis Map",iconClass:""},e.items.inputform={type:"icon_text",name:"Input Form",iconClass:""},e.items.wizard={type:"icon_text",name:"Wizard",iconClass:""},e.items.filter={type:"icon_text",name:"Filter",iconClass:""},e.items.menuwidget={type:"icon_text",name:"Menu",iconClass:""},e},moreChartTypesMenu:function(t){var e='div[data-gs-id="'+t+'"] .moreChartTypes',a=this.getOptionsMenu();if(a&&(this.menuInitiated&&n.contextMenu("destroy",e),!n.isEmptyObject(a.items))){var i=this;this.menuInitiated=!0,n.contextMenu({selector:e,callback:function(e,n){a.callback(e,t),a.items&&a.items[e]&&a.items[e].persist&&setTimeout(function(){i.moreChartTypesMenu()},100)},items:a.items})}this.menuInitiated&&n(e).contextMenu()},closeToolbar:function(){var t,e=n(".popover");Promise.resolve().then(function(){var i=[a(706)];(function(a){var i=(new a).getItemsModel();n.each(i,function(t,e){n(e.tagId).css("z-index",1)}),e.length>0&&(t=e.attr("data-id"),e.remove(),n(t).css("z-index",1),n(".dash-overlay").hide())}).apply(null,i)}).catch(a.oe)},recalcWidgets:function(t,e){var a,i=this.getCurrentViewPort(),n=t;switch(e){case"xs":a=d.map(n,function(t){var e,a=1===t.width||2===t.width?t.width:2;e=a>=2?0:0===t.x||1===t.x?t.x:0;var i=Object.assign({},t);return i.width=a,i.x=e,i},this);break;case"sm":case"md":var r=2;"xs"===i&&(r=3);a=d.map(n,function(t){var e=t.width*r;e=Math.floor(e);var a=t.x*r;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this);break;case"lg":r=2;"xs"===i&&(r=6),a=d.map(n,function(t){var e=t.width*r;e=Math.floor(e);var a=t.x*r;a=Math.floor(a);var i=Object.assign({},t);return i.width=e,i.x=a,i},this)}return a},reloadDashboard:function(t,a,i,r){var d=this;n(".tabs-area").find(".toolbar").hide(),this.dashboardModel||(this.dashboardModel=new e({dashId:t,dashboardViewList:[],nodeOwner:"",extraOptions:null}));var o=this.dashboardModel.getItemsModel();n.each(o,function(t,e){n(e.tagId).trigger("removeItemView")}),d.dashboardModel.removeAllItemsModel(),d.grid&&d.grid.removeAll(),d.getParent().find(".grid-stack.dashboard-area").empty(),this.dashboardModel.getDashboard(t,function(e){n('.nav-tabs li a[data-rel="'+t+'"]').text(e.name),d.getParent().attr("dash-title",e.name);var o=d.getCurrentViewPort(),s=12,l={};if(e.definition){switch(l=e.definition,o){case"xs":l=l.definitionSmall?l.definitionSmall:l.definitionMedium?d.recalcWidgets(l.definitionMedium,"xs"):d.recalcWidgets(l.definitionLarge,"xs"),s=2;break;case"sm":case"md":l.definitionMedium?(l=l.definitionMedium,d.getGrid().removeClass("grid-stack-autoposition")):l.definitionLarge?(d.getGrid().addClass("grid-stack-autoposition"),l=l.definitionLarge):(d.getGrid().addClass("grid-stack-autoposition"),l=d.recalcWidgets(l.definitionSmall,"md")),s=6;break;case"lg":l.definitionLarge?(l=l.definitionLarge,d.getGrid().removeClass("grid-stack-autoposition")):l=l.definitionMedium?d.recalcWidgets(l.definitionMedium,"lg"):d.recalcWidgets(l.definitionSmall,"lg"),s=12}e.definition=l}else switch(d.currentViewPort){case"xs":s=2;break;case"sm":case"md":s=6;break;case"lg":s=12}d.getGrid().removeClass("grid-stack-12").removeClass("grid-stack-6").removeClass("grid-stack-2"),d.getGrid().addClass("grid-stack-"+s),d.getGrid().data("gridstack").setGridWidth(s),window.location.href.indexOf("/#shared/")>0?(void 0==r&&d.dashboardTabs.refreshDashboardTabs("evaluatedNode",a),n(".tabs-area .toolbar").hide(),n(".loader.embeddable").hide(),n("body").css("background-color","#FFF")):d.dashboardTabs.refreshDashboardTabs(),e.uuid&&(n('.mainTask.dashboardTask.new[data-rel="dashboard-'+t+'"]').attr("data-id","dashboard-"+e.dashboardId),n('.nav-tabs li a[data-rel="'+t+'"]').attr("data-key","dashboard-"+e.dashboardId)),d.dashboardModel.attributes.imOwner=e.ownerId===__currentSession.userCompanyId,d.refreshDashboardName(e),d.dashboardModel.setNodeOwner(e.node),d.parseDashboard(e,i),d.getParent().find("div.breadcrumbs2").show(),d.checkShared(e,i),d.checkFromDiagram(e),n(".tabs-area").find(".toolbar").show(),window.location.href.indexOf("/#shared/")>0&&(n(".loadingPlaceholder").hide(),n(".loader.embeddable").hide(),n("body").css("background-color","#FFF")),d=null})},checkFromDiagram:function(t){""!==t.node&&null!==t.node&&(n(".tabs-area").find(".toolbar .btnCopy").hide(),n(".tabs-area").find(".toolbar .btnShare").hide())},checkShared:function(t,e){if(window.location.href.indexOf("/#shared/")>0)return n(".tabs-area").find(".toolbar .shared-message").hide(),n(".tabs-area").find(".toolbar .btn-group .btn").hide(),n(".tabs-area").find(".toolbar .btn-group .btnRefresh").show(),!1;if(this.dashboardModel.attributes.imOwner)e||(n(".tabs-area").find(".toolbar .btnEdit").show(),n(".tabs-area").find(".toolbar .btnShare").show(),n(".tabs-area").find(".toolbar .shared-message").html(""));else{n(".tabs-area").find(".toolbar .btnEdit").hide(),n(".tabs-area").find(".toolbar .btnShare").hide(),n(".tabs-area").find(".toolbar .shared-message").html((0,l.translate)("Is shared"));var a=this;this.getParent().on("refreshImageDashboard",function(t,e){a.reloadDashboard(e)})}},refreshDashboardName:function(t){if(window.location.href.indexOf("/#shared/")<0){var e=n("#topMenuBar span#currentTask").attr("data-rel").match(/-/g).length>1;if(t){var a=e?t.uuid:t.dashboardId,i=t.name;this.dashboardName=i,n('span[data-rel="dashboard-'.concat(a,'"]')).text(i),n('#topMenuBar li a[rel="dashboard-'.concat(a,'"]')).text(i),n('.dash-tabs li a[data-rel="'.concat(a,'"]')).text(i),n('.dash-tabs li a[data-rel="'.concat(a,'"]')).attr("title",i)}}},removeDashboard:function(t){Promise.resolve().then(function(){var e=[a(684)];(function(e){(new e).removeTask(t)}).apply(null,e)}).catch(a.oe)},parseDashboard:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this,r=t.definition;this.dashboardModel.setStyleLibraries(t.styleLibraries);var d=i.dashboardModel.get("extraOptions")&&i.dashboardModel.get("extraOptions").isInputNode;if(t.definition&&!d||!t.node||this.dashboardController.getEmptyContent(this.dashboardModel,function(a){var r=i.getCurrentViewPort(),o=12;"sm"!==r&&"md"!==r||(o=6);var s=n("#main").height()-80,l=Math.floor(s/68);a.setElement(n("div.grid-stack")),a.grid=i.grid,a.dashboardModel=i.dashboardModel,a.currentResult={x:0,y:0,width:o,height:l},a.loadingDashboard=!0,a.render(),i.dashboardModel.addItemToModel(a),a.initializeWithNode(t.node,!!d&&"nodetable"),t.definition&&""!=t.definition&&!d||e&&n("div.toolbar button.btnEdit").click()}),r&&r.length>0){var o=[],s=[];r.noQuery&&r.noQuery.length>0&&void 0!=r.noQuery[0].rel&&(o=r.noQuery,n.each(o,function(t,e){n.each(e.rel,function(t,e){s.push(e)})})),i.noQuery=o,i.ownerWidth=r.ownerWidth,i.ownerHeight=r.ownerHeight,i.dashboardModel.initializeDashboardQuery(i.noQuery);var l=o.indexOf(r.nodeId)>=0;n.each(r,function(t,e){"empty"===e.itemType?Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(i.dashboardModel,function(t){t.setElement(n("div.grid-stack")),t.grid=i.grid,t.currentResult=e,t.dashboardModel=i.dashboardModel,t.loadingDashboard=!0,t.render(),n(t.tagId).find(".btnMenu").hide(),i.dashboardModel.addItemToModel(t)})}).apply(null,t)}).catch(a.oe):a.e(0).then(function(){var t=[a(723)];(function(t){var a=new t({model:i.dashboardModel});a.setElement(n("div.grid-stack")),a.grid=i.grid,a.dashboardModel=i.dashboardModel,a.loadingDashboard=!0,a.widget=e,i.dashboardModel.addItemToModel(a),a.createNewView(e,l)}).apply(null,t)}).catch(a.oe)})}t.definition&&!d||e&&(n("div.toolbar button.btnEdit").click(),setTimeout(function(t){i.dashboardTabs.addNewWidget(i.dashboardTabs)},100)),i.fromExternal&&setTimeout(function(){i.initPromiseWatcher()},1e3)},resetView:function(){this.checkNodeOwner()||this.createNewView({itemType:"empty"})},getThis:function(){return n(this.keyView)},onRemoveView:function(){n(".tabs-area").remove(),n(".mainTask.dashboardTask.new").length<1&&n(window).off("resize.updateSizes"),0===n(".mainTask.dashboardTask.new").length&&n(window).off("keyup.closeTabs"),n(this.keyView).off(),this.dashboardController=null;var t=this.dashboardModel.getItemsModel();n.each(t,function(t,e){n(e.tagId).trigger("removeItemView")}),this.dashboardModel.removeAllItemsModel(),this.dashboardModel=null,this.noQuery=null;var e=this;setTimeout(function(){e.dashboardTabs.refreshDashboardTabs(),e.dashboardTabs.getModel()&&window.location.href.indexOf("/#shared/")<0&&e.dashboardTabs.checkFromDiagram(e.dashboardTabs.getModel().attributes),e=null},300)},onBeforeRemoveView:function(t,e){if(n(".mainTask.dashboardTask.new").length<1&&n(window).off("resize.updateSizes"),this.dashboardModel.editMode){t.preventDefault();var i=this;a.e(5).then(function(){var t=[a(683)];(function(t){(new t).show({title:(0,l.translate)("_save")+": "+i.dashboardName,text:(0,l.translate)("save_pending_changes"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"},{title:(0,l.translate)("cancel"),code:"cancel"}],callback:function(t){"yes"==t?(i.refreshMode(!1),i.saveDashboard(),setTimeout(function(){e()},1e3)):"no"==t&&(i.dashboardModel.editMode=!1,setTimeout(function(){e(!0)},1e3))}})}).apply(null,t)}).catch(a.oe)}},refreshMode:function(t){this.dashboardModel.editMode=t,this.getParent().find("div.toolbar button").hide();var e=this.dashboardModel.getItemsModel();n.each(e,function(e,a){a.setEditMode(t)}),t?(this.getParent().find(".dash-tabs").hide(),this.getParent().closest(".mainTask").addClass("editing"),this.getParent().find("div.toolbar button.btnShow").show(),this.getParent().find("div.toolbar button.btnCancel").show(),this.getParent().find("div.objectsToolbar").fadeIn(),this.getParent().find(".dockDashboardProperty").fadeIn()):(this.getParent().find(".dash-tabs").show(),this.getParent().closest(".mainTask").removeClass("editing"),this.getParent().find("div.toolbar button").show(),this.getParent().find("div.toolbar button.btnShow").hide(),this.getParent().find("div.toolbar button.btnCancel").hide(),this.getParent().find("div.objectsToolbar").fadeOut(),this.getParent().find(".dockDashboardProperty").fadeOut())},addGenericHandlers:function(){var t=n(this.keyView),e=this;void 0!==__currentSession.fromEmbedded&&(this.fromEmbedded=__currentSession.fromEmbedded),this.fromEmbedded||t.on("click",".link-to-dashboard",function(){if(!e.dashboardModel.editMode){var t=n(this).attr("data-dashboard-id"),i=(0,l.translate)("loading_dashboard"),r=!0;if("_self"===n(this).attr("data-target")&&(r=!1),e.dashboardController.showDashboard(t,-1,i,!0,e.dashboardModel.editMode),!r){var d=e.getParent().attr("data-rel");Promise.resolve().then(function(){var t=[a(684)];(function(t){(new t).removeTask(d,!0)}).apply(null,t)}).catch(a.oe)}}})},addHandlers:function(){1===n(".mainTask.dashboardTask.new").length&&n(window).on("keyup.closeTabs",function(t){t.ctrlKey&&81===t.keyCode&&n(".tabs-area .dash-tabs li a.active").closest("li").find("i.fa.fa-close").click()})},getParent:function(){return n(this.keyView)},getGrid:function(){return n(".grid-dash-"+this.currentDashboardId)},initPromiseWatcher:function(){if(this.dashboardModel){var t=this.dashboardModel.getItemsModel();if(t&&t.length>0){var e=!0;if(n.each(t,function(t,a){0==n(a.tagId).find(".item-class-selector").length&&(e=e&&a.isReady)}),!e&&this.getParent().find(".dashboard-area").length>0){var a=this;setTimeout(function(){a.initPromiseWatcher(),a=null},1e3)}}}}})}.apply(e,o))||(t.exports=s)}).call(this,a(218),a(1),a(1),a(220))}}]);