/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1156:function(t,e,a){"use strict";(function(n,i,r){var o,d,s=a(18);function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}o=[a(702),a(706),a(1450)],void 0===(d=function(t,e,o){var d,h=n.View.extend((l(d={el:i("#main"),menuInitiated:!1,editionModeInitiated:!1,dashboardModels:[],render:function(e,a){this.dashboardId=e;var n=this;if(this.dashboardModels.push(this.options.dashboardModel),this.dashboardController=new t,r(),1===i(".tabs-area .dash-tabs").length)return!1;function r(){var t=!!event&&i(event.currentTarget).hasClass("reports-view");if(event&&(event.target===window||t)){i(".tabs-area").show();var e=i(".tabs-area .toolbar").width(),a=(i(".nav-tabs").width(),i(".pagination").width()),r=i("#left").width();i(".nav-tabs").width(i(window).width()-e-a-r-100),setTimeout(function(){n.doAdapt()},350)}}this.refreshDashboardTabs(a),i(window).resize(r)},reloadDashboard:function(t,e){var a=this.getModel().getItemsModel();i.each(a,function(t,e){i(e.tagId).trigger("removeItemView")}),this.getModel().removeAllItemsModel();var n=this;this.getModel().getDashboard(t,function(t){n.refreshDashboardName(t),n.getModel().setNodeOwner(t.nodeOwner),n.parseDashboard(t,e),n.getParent().find("div.breadcrumbs2").show(),n.checkShared(!1),n=null})},refreshDashboardName:function(t){if(t){var e=t.dashboardId,a=t.name;this.dashboardName=a,i("span[data-rel='dashboard-"+e+"']").text(a),i("#topMenuBar li a[rel='dashboard-"+e+"']").text(a),i(".dash-tabs li a[data-rel='"+e+"']").text(a)}},getModel:function(t){var e=(t?i(t.target):this.getParent().find(".dash-tabs li a.active")).attr("data-rel"),a=null;return i.each(this.dashboardModels,function(t,n){parseInt(n.attributes.dashId)===parseInt(e)&&(a=n)}),a},checkShared:function(t,e){if(this.getModel().attributes.imOwner)e||(i(".tabs-area").find(".toolbar .btnEdit").show(),i(".tabs-area").find(".toolbar .btnShare").show(),i(".tabs-area").find(".toolbar .shared-message").html(""));else{i(".tabs-area").find(".toolbar .btnEdit").hide(),i(".tabs-area").find(".toolbar .btnShare").hide(),t.sharedBy?i(".tabs-area").find(".toolbar .shared-message").html((0,s.translate)("full_shared_by")+": "+t.sharedBy):i(".tabs-area").find(".toolbar .shared-message").html((0,s.translate)("Is shared"));var a=this;this.getParent().on("refreshImageDashboard",function(t,e){a.reloadDashboard(e)})}},addHandlers:function(){var t=this;i(".tabs-area .dash-tabs").on("click",'li a:not(".moreBtn")',function(){event.preventDefault(),t.checkShared(!1),i(".tabs-area .dash-tabs ul.-secondary li:visible").length>=1&&i(".tabs-area .dash-tabs .moreBtn").click(),i(".tabs-area .nav-tabs li").find("a").removeClass("active"),i(this).addClass("active");var e=i(this).attr("data-key"),n=i(this).attr("data-rel");"true"!==i(this).attr("data-opened")&&(i(".dashboard-titles li a").attr("data-opened",!1),i(this).attr("data-opened",!0),Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).showEmbeddableDashboard(n,null,"Loading...",!1,!1,null)}).apply(null,t)}).catch(a.oe)),Promise.resolve().then(function(){var t=[a(684)];(function(t){(new t).selectTask(e)}).apply(null,t)}).catch(a.oe)}),i(".tabs-area .dash-tabs").on("click","li i",function(){var e=i(this).closest("li").find("a").attr("data-key"),n=i(this).closest("li").find("a").attr("data-rel");t.dashboardModels=i.grep(t.dashboardModels,function(t){return t.attributes.dashId!=n}),Promise.resolve().then(function(){var n=[a(684)];(function(a){(new a).removeTask(e),t.refreshDashboardTabs()}).apply(null,n)}).catch(a.oe)}),i(document).off("contextmenu",".tabs-area li a"),i(document).on("contextmenu",".tabs-area li a",function(e){return t.showTabContextMenu(i(this),e),!1}),this.getParent().find("div.toolbar button.btnEdit").on("click",i.proxy(function(){t.getGrid().data("gridstack").grid.float=!1,t.editionModeInitiated?t.refreshMode(!0):(t.editionModeInitiated=!0,t.refreshMode(!0))},this)),this.getParent().find("div.toolbar button.btnAdd").on("click",function(){t.addNewWidget(t)}),this.getParent().find("div.toolbar button.btnShow").on("click",i.proxy(function(){this.refreshMode(!1),this.checkFromDiagram(this.getModel().attributes),t.getGrid().data("gridstack").grid.float=!0,setTimeout(function(){t.saveDashboard(),t.doAdapt()},200)},this)),this.getParent().find("div.toolbar button.btnCancel").on("click",function(){t.getParent().find("div.toolbar button.btnShow").hide(),t.getParent().find("div.toolbar button.btnCancel").hide(),t.getParent().find("div.toolbar button.btnAdd").hide(),t.getParent().find("div.sure_cancel_dashboard").show(),t.getParent().find("div.toolbar button.btnGoCancel").show(),t.getParent().find("div.toolbar button.btnCancelCancel").show()}),this.getParent().find("div.toolbar button.btnGoCancel").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");t.getParent().find("div.sure_cancel_dashboard").hide(),t.refreshMode(!1),t.getGrid().addClass("grid-stack-autoposition"),i('[data-rel="dashboard-'+e+'"]').trigger("reloadDashboard")}),this.getParent().find("div.toolbar button.btnCancelCancel").on("click",function(){t.getParent().find("div.sure_cancel_dashboard").hide(),t.getParent().find("div.toolbar button.btnShow").show(),t.getParent().find("div.toolbar button.btnCancel").show(),t.getParent().find("div.toolbar button.btnAdd").show()}),this.getParent().find("div.toolbar button.btnShare").on("click",i.proxy(function(){var t=this.getParent().find("a.active").attr("data-rel");(0,s.haveAccess)("share_dashboard")?a.e(49).then(function(){var e=[a(1116)];(function(e){(new e).showSharer(t)}).apply(null,e)}).catch(a.oe):a.e(17).then(function(){var t=[a(685)];(function(t){(new t).show({title:"WARNING!",text:(0,s.translate)("share_dashboard_access_denied"),notifyType:"error"})}).apply(null,t)}).catch(a.oe)},this)),this.getParent().find("div.toolbar button.btnScenarios").on("click",function(){a.e(31).then(function(){(function(e){var n=[a(922)];(function(a){var n={nodeList:[]},r=[];i.each(i(".dash-tabs li a"),function(e,a){var n=i(this).attr("data-rel");r=i('div.mainTask[data-rel="dashboard-'+n+'"]').triggerHandler("getModel",[r]),h=t.getModel().getItemModel(n)});var o=[];i.each(r,function(t,e){i.each(e.getItemsModel(),function(t,e){o.push(e)})});var d=["indexlist","formnode","selector","button","objectItem","map","indicator"];"cubengine"==__currentSession.modelInfo.engine&&(d=["indexlist","formnode","selector","button","objectItem","map"]),i.each(o,function(t,a){if(a&&a.currentNodeId)if(a.currentResult&&-1!==e.inArray(a.currentResult.itemType,d));else{var r=a.currentNodeId;a.currentResult&&a.currentResult.nodeProperties&&a.currentResult.nodeProperties.originalId&&(r=a.currentResult.nodeProperties.originalId),a.pivotTable&&a.pivotTable.metadata&&a.pivotTable.metadata.nodeProperties&&a.pivotTable.metadata.nodeProperties.originalId&&(r=a.pivotTable.metadata.nodeProperties.originalId),0===i.grep(n.nodeList,function(t){return t.id===r}).length&&n.nodeList.push({id:r,name:a.currentResult&&a.currentResult.itemProperties&&a.currentResult.itemProperties.title?a.currentResult.itemProperties.title.text:a.currentNodeId})}}),(new a).show(n)}).apply(null,n)}).call(this,a(1))}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnDataSnapshot").on("click",function(){a.e(31).then(function(){var t=[a(922)];(function(t){(new t).showDataSnapshot()}).apply(null,t)}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnCopy").on("click",function(){var e=t.getParent().find("a.active").first().attr("data-rel"),n=t.getParent().find("a.active").first().text();t.dashboardController.showCopyDashboard(e,n,function(e,n){Promise.resolve().then(function(){var r=[a(702)];(function(a){i("#model-summary").trigger("fullRefresh"),t.dashboardController.showDashboard(e,-1,n)}).apply(null,r)}).catch(a.oe)})}),this.getParent().find("div.toolbar button.btnRefresh").on("click",i.proxy(function(){Promise.resolve().then(function(){var e=[a(219)];(function(e){(new e).executeForRefresh(function(e){var a=[];t.noQuery&&i.each(t.noQuery,function(t,e){i.each(e.rel,function(t,e){a.push(e)})}),t.getModel().initializeDashboardQuery(t.noQuery);var n=t.getModel().getItemsModel();i.each(n,function(t,e){a.indexOf(e.currentNodeId)>=0||i(e.tagId).trigger("refreshItemDash")})})}).apply(null,e)}).catch(a.oe)},this)),this.getParent().find("div.toolbar button.btnComments").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");Promise.resolve().then(function(){var n=[a(702)];(function(a){(new a).showDashboardComments({dashboardId:e,parent:t.getParent()})}).apply(null,n)}).catch(a.oe)}),this.getParent().find("div.toolbar button.btnPrint").on("click",function(){var e=t.getParent().find("a.active").attr("data-rel");Promise.resolve().then(function(){var t=[a(752)];(function(t){(new t).printDashboard(e)}).apply(null,t)}).catch(a.oe)}),this.getParent().find(".main-fullscreen button[data-rel='close-screen']").on("click",function(){var e=i(this).closest(".main-fullscreen").find(".item-area").parent(),a="#"+e.attr("data-parent"),n=(e.attr("data-parent"),i(a)),r=i(this).closest(".main-fullscreen"),o=(n.offset(),e.attr("data-orignal-w")),d=e.attr("data-orignal-h"),s=e.attr("data-orignal-y"),l=e.attr("data-orignal-x"),h=i(this);r.animate({top:s+"px",left:l+"px",width:o,height:d},{done:function(){i.wrapper.append(e.detach()),r.hide(),h.show(),t.updateSizes(),t.getModel().getItemModel(a).onEndNormalScreenAnimation()}}),t.getModel().getItemModel(a).updateSize(o,d,!0)}),this.getParent().find(".report-navigator a").on("click",function(){event.preventDefault();var e=i(this).attr("data-id"),a=i(this).attr("title");e&&(t.dashboardController.showDashboard(e,-1,a),t.getNavigator(e))})},getCurrentViewPort:function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t},checkFromDiagram:function(t){""!==t.node&&null!==t.node?(i(".tabs-area").find(".toolbar .btnCopy").hide(),i(".tabs-area").find(".toolbar .btnShare").hide()):i(".tabs-area").find(".toolbar .btnCopy").show()},addNewWidget:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;(h=t).fromAddButton=!0;var r=this.getGrid().data("gridstack"),o=0;r.grid.nodes.length>0&&(o=Math.max.apply(Math,r.grid.nodes.map(function(t){return t.y+t.height})));var d=12,s=7;switch(this.getCurrentViewPort()){case"xs":d=2,s=3;break;case"sm":case"md":d=6,s=4;break;case"lg":d=12}var l={x:0,y:o,width:d,height:s};e&&(l=e);var h=this;n&&"empty"!=n.itemType?a.e(0).then(function(){var t=[a(722)];(function(t){var e=new t({model:h.getModel()});e.setElement(i("div.grid-stack")),e.currentResult=i.extend(!0,{},n.currentResult),e.grid=r,e.dashboardModel=h.getModel(),e.loadingDashboard=!0,e.currentResult.itemId=i.uuid(),e.currentResult.itemType="table"==n.currentResult.itemType?"columnchart":"table",e.currentResult.itemProperties.bottomTotal=!1,e.currentResult.itemProperties.rightTotal=!1,e.currentResult.x=l.x,e.currentResult.y=l.y,e.currentResult.width=l.width,e.currentResult.height=l.height,h.getModel().addItemToModel(e),e.createNewView(e.currentResult,!1)}).apply(null,t)}).catch(a.oe):Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(h.getModel(),function(t){t.setElement(h.getGrid()),t.model=h.getModel(),t.grid=r,t.currentResult=l,t.itemType="empty",t.currentResult.itemType="empty",t._applyItemId(l,null);t.render(null,null,!0),h.getModel().addItemToModel(t),t.setEditMode(h.getModel().editMode)})}).apply(null,t)}).catch(a.oe),h.getModel().setStateModified(!0)},refreshMode:function(t){var e=this;e.getModel().editMode=t,this.getParent().find("div.toolbar button").hide(),this.getGrid().data("gridstack").setStatic(!t);var n=this.getModel().getItemsModel();i.each(n,function(e,a){a.setEditMode(t)}),t?(this.getParent().find(".dash-tabs").hide(),this.getGrid().addClass("editing"),this.getParent().find("div.toolbar button.btnShow").show(),this.getParent().find("div.toolbar button.btnCancel").show(),this.getParent().find("div.toolbar button.btnAdd").show(),this.getGrid().removeClass("grid-stack-autoposition")):(this.getParent().find(".dash-tabs").show(),this.getGrid().removeClass("editing"),this.getParent().find("div.toolbar button").show(),this.getParent().find("div.toolbar button.btnShow").hide(),this.getParent().find("div.toolbar button.btnCancel").hide(),this.getParent().find("div.toolbar button.btnAdd").hide()),a.e(65).then(function(){var t=[a(731)];(function(t){(new t).list(null,function(t){e.getModel().setStyleLibraries(t)})}).apply(null,t)}).catch(a.oe)},sortWidgets:function(t,e){return t.currentResult.y<e.currentResult.y?-1:t.currentResult.y>e.currentResult.y?1:t.currentResult.x<e.currentResult.x?-1:t.currentResult.x>e.currentResult.x?1:0},saveDashboard:function(){var t=this,e={},a=[],n=this.getModel().getItemsModel(),r=[],o=[];i.each(n,function(t,e){var a=e.getRelatedNoQuery();a&&a.length>0&&r.push({node:e.currentNodeId,rel:a});var n=e.getStylesUsed();n&&(o=o.concat(n))}),e.noQuery=r,n.sort(this.sortWidgets),i.each(n,function(t,n){e={};var r=n.tagId;if(n){e.index=t,e.nodeId=n.currentNodeId,e.itemId=n.itemId;var o=n.grid.grid.getNodeDataByDOMEl(i(r));e.x=o.x,e.y=o.y,e.width=o.width,e.height=o.height,e.itemProperties=n.currentResult.itemProperties,e.itemType=n.currentResult.itemType,e.objectType=n.currentResult.objectType,n.currentResult&&(e.itemType=n.currentResult.itemType,"objectItem"==e.itemType&&(e.objectType=n.currentResult.objectType),e.rows=n.currentResult.rows,e.columns=n.currentResult.columns,e.dims=n.currentResult.dims,e.itemProperties=n.currentResult.itemProperties),a.push(e)}});var d=t.getParent().find(".dash-tabs li a.active").attr("data-rel");this.getModel().getDashboard(d,function(e){var r,s=t.getModel().getStateModified();switch(r=e.definition?e.definition:{},t.getCurrentViewPort()){case"xs":r.definitionSmall=a,s&&(delete r.definitionLarge,delete r.definitionMedium);break;case"sm":case"md":r.definitionMedium=a,s&&(delete r.definitionLarge,delete r.definitionSmall);break;case"lg":r.definitionLarge=a,s&&(delete r.definitionMedium,delete r.definitionSmall)}t.getModel().updateDefinition(d,r,o,function(){i.each(n,function(t,e){e.onSaveDashboard()}),t.getModel().setStateModified(!1),t=null})})},recalcWidgets:function(t,e){var a,n=this.getCurrentViewPort(),i=t;switch(e){case"xs":a=r.map(i,function(t){var e,a=1===t.width||2===t.width?t.width:2;e=a>=2?0:0===t.x||1===t.x?t.x:0;var n=Object.assign({},t);return n.width=a,n.x=e,n},this);break;case"sm":case"md":var o=2;"xs"===n&&(o=3);a=r.map(i,function(t){var e=t.width*o;e=Math.floor(e);var a=t.x*o;a=Math.floor(a);var n=Object.assign({},t);return n.width=e,n.x=a,n},this);break;case"lg":o=2;"xs"===n&&(o=6),a=r.map(i,function(t){var e=t.width*o;e=Math.floor(e);var a=t.x*o;a=Math.floor(a);var n=Object.assign({},t);return n.width=e,n.x=a,n},this)}return a}},"getCurrentViewPort",function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t}),l(d,"isBreakpoint",function(t){return i(".device-"+t).is(":visible")}),l(d,"showTabContextMenu",function(t,e){var n={_me:{name:(0,s.translate)("close")},_all:{name:(0,s.translate)("close_all")},_others:{name:(0,s.translate)("close_all_but_this")}};i.contextMenu("destroy",".tabs-area"),i.contextMenu({selector:".tabs-area",callback:function(e,n){switch(e){case"_me":t.closest("li").find("i").click();break;case"_all":case"_others":var r=t.attr("data-key");"_all"==e&&(r="_123123_"),Promise.resolve().then(function(){var n=[a(684)];(function(a){var n=new a,o=[];t.closest("ul.dash-tabs").find("li a:not(.moreBtn)").each(function(t,e){i(e).attr("data-key")!=r&&o.push(i(e).attr("data-key"))}),o.length>0&&i.each(o,function(t,a){"_all"==e?n.removeTask(a,!1):(n.selectTask(r),n.removeTask(a,!0))})}).apply(null,n)}).catch(a.oe)}},items:n,events:{hide:function(t){i.contextMenu("destroy",".tabs-area")}},zIndex:0}),i(".tabs-area").contextMenu({x:e.clientX,y:e.clientY})}),l(d,"refreshDashboardTabs",function(t){var e=this,a=!1,n=[];window.location.href.indexOf("/#shared/")>0&&(a=!0),a?"dashboard"===t?(i(".dashboardTask.new").each(function(t,e){var a=i(e).attr("data-rel"),r=a.split(/-(.+)/)[1],o=i("#topMenuBar ul li a[rel='"+a+"']").text();o||(o=i(e).attr("dash-title")),n.push({id:r,key:a,title:o,closeBtn:!1,notDesktop:!1})}),e.drawTabs(n)):this.options.dashboardModel.getNavigator({dashboardId:this.dashboardId},function(t){t&&t.list.length>0&&i.each(t.list,function(t,e){n.push({id:e.id,key:"dashboard-"+e.id,title:e.name,closeBtn:!1,notDesktop:!1})}),e.drawTabs(n)}):(i(".dashboardTask.new").each(function(t,e){var a=i(e).attr("data-rel"),r=a.split(/-(.+)/)[1],o=i("#topMenuBar ul li a[rel='"+a+"']").text();o||(o=i(e).attr("dash-title")),n.push({id:r,key:a,title:o,closeBtn:!0,notDesktop:!1})}),e.drawTabs(n))}),l(d,"drawTabs",function(t){var e=this;i(".tabs-area").remove();var a,n=i(".tabs-area");if(n.empty(),n.hide(),t.length>0){var r=o(t);i(r).insertBefore(i(i(".mainTask.dashboardTask")[0])),n.show()}if(window.location.href.indexOf("/#shared/")>0)a=i('.tabs-area .nav-tabs li a[data-rel="'+this.dashboardId+'"]');else{var d=i("#currentTask").attr("data-rel");a=i('.tabs-area .nav-tabs li a[data-key="'+d+'"]'),this.dashboardId=a.attr("data-rel")}a.addClass("active"),a.attr("data-opened",!0),a.click(),this.getNavigator(this.dashboardId);var s=i(".nav-tabs"),l=s.find(".-primary");s.addClass("--jsfied"),l.append('\n        <li class="-more">\n          <a class="moreBtn" aria-haspopup="true" aria-expanded="false">\n            More <span>&darr;</span>\n          </a>\n          <ul class="-secondary">\n            '.concat(l.html(),"\n          </ul>\n        </li>\n      "));s.find(".-secondary").find("li"),s.find("li");var h=i("li.-more").find(".moreBtn");h.on("click",function(t){t.preventDefault(),s.toggleClass("--show-secondary"),h.attr("aria-expanded",s.hasClass("--show-secondary"))}),this.addHandlers(),this.doAdapt(),i(".tabs-area .toolbar").on("pendingRefresh",function(t,a){var n,r=e.getParent().find(".dash-tabs li a");i.each(r,function(t,r){n=i(r).attr("data-rel");i.each(e.dashboardModels,function(t,e){parseInt(e.attributes.dashId)===parseInt(n)&&i.each(e.getItemsModel(),function(t,e){e.currentNodeId==a.nodeId&&i(r).attr("pending-refresh",!0)})})})}),i(".tabs-area .toolbar").on("checkIfPendingRefresh",function(t,a){"true"===e.getParent().find(".dash-tabs li a.active").attr("pending-refresh")&&(console.log("refrescando!"),i(".tabs-area .toolbar .btnRefresh").click(),e.getParent().find(".dash-tabs li a.active").attr("pending-refresh",!1))})}),l(d,"getNavigator",function(t){var e=this,a=this.getModel();a&&(a.getNavigator({dashboardId:t},function(a){a&&(a.priorId>0&&e.getParent().find(".btnNavigatorPrior").attr("data-id",a.priorId).attr("title",a.priorName).closest("li").removeClass("disabled"),a.nextId>0&&e.getParent().find(".btnNavigatorNext").attr("data-id",a.nextId).attr("title",a.nextName).closest("li").removeClass("disabled")),e.getParent().find(".nav-tabs li a").removeClass("active"),e.getParent().find('.nav-tabs li a[data-rel="'+t+'"]').addClass("active")}),window.location.href.indexOf("/#shared/")>0&&i(".report-navigator").hide())}),l(d,"doAdapt",function(){i(".tabs-area").show();var t=i(".tabs-area .toolbar").width(),e=(i(".nav-tabs").width(),i(".pagination").width()),a=i("#left").width();i(".nav-tabs").width(i(window).width()-t-e-a-100);var n=i(".nav-tabs"),r=n.find(".-primary"),o=n.find(".-primary > li:not(.-more)"),d=n.find(".-secondary").find("li"),s=n.find("li"),l=i("li.-more"),h=l.find(".moreBtn");s.each(function(t,e){e.classList.remove("--hidden")});var c=h.length>0?h.width():0,u=[],b=r.length>0?r.width():0;o.each(function(t,e){b>=c+e.offsetWidth?c+=e.offsetWidth:(e.classList.add("--hidden"),u.push(t))}),u.length?d.each(function(t,e){u.includes(t)||e.classList.add("--hidden")}):(l.addClass("--hidden"),n.removeClass("--show-secondary"),h.attr("aria-expanded",!1)),i(".mainTask:visible").hasClass("dashboardTask")?i(".tabs-area").show():i(".tabs-area").hide()}),l(d,"getParent",function(){return i(".tabs-area")}),l(d,"getGrid",function(){var t=this.getParent().find("a.active").attr("data-rel");return i(".grid-dash-"+t)}),d));return h}.apply(e,o))||(t.exports=d)}).call(this,a(218),a(1),a(220))},1449:function(t,e,a){var n=a(690);t.exports=(n.default||n).template({1:function(t,e,a,n,i){return" from-external "},compiler:[8,">= 4.3.0"],main:function(t,e,a,n,i){var r,o,d=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,l=t.escapeExpression;return'<div\n  class="container-fluid mainTask full-horizontal dashboardTask new hideClose '+(null!=(r=a.if.call(d,null!=(r=null!=e?e.extraOptions:e)?r.external:r,{name:"if",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:2,column:78},end:{line:2,column:129}}}))?r:"")+'"\n  data-rel="dashboard-'+l("function"==typeof(o=null!=(o=a.id||(null!=e?e.id:e))?o:s)?o.call(d,{name:"id",hash:{},data:i,loc:{start:{line:3,column:22},end:{line:3,column:28}}}):o)+'" dash-name="'+l("function"==typeof(o=null!=(o=a.dashTitle||(null!=e?e.dashTitle:e))?o:s)?o.call(d,{name:"dashTitle",hash:{},data:i,loc:{start:{line:3,column:41},end:{line:3,column:54}}}):o)+'" data-type="tab-content">\n\n\n\n  <div class="breadcrumbs2 nodisplay">\n  </div>\n\n  <div class="device-xs visible-xs"></div>\n  <div class="device-sm visible-sm"></div>\n  <div class="device-md visible-md"></div>\n  <div class="device-lg visible-lg"></div>\n  <div class="device-xl visible-xl"></div>\n\n  <div style="display: none;">\n    <span>Number of Columns:</span> <span id="grid-size"></span>\n  </div>\n\n\n\n  <div class="grid-stack grid-dash-'+l("function"==typeof(o=null!=(o=a.id||(null!=e?e.id:e))?o:s)?o.call(d,{name:"id",hash:{},data:i,loc:{start:{line:22,column:35},end:{line:22,column:41}}}):o)+' dashboard-area main-pane">\n  </div>\n\n\n  <div class="main-fullscreen" style="display: none; position:absolute;">\n    <div class="item-toolbar-view">\n      <button class="btn btn-small" data-rel="close-screen">\n        <i class="fa fa-arrows-alt"></i>\n      </button>\n    </div>\n  </div>\n</div>'},useData:!0})},1450:function(t,e,a){var n=a(690);function i(t){return t&&(t.__esModule?t.default:t)}t.exports=(n.default||n).template({1:function(t,e,n,r,o){return'      <button class="btn btnEdit" title="'+t.escapeExpression(i(a(688)).call(null!=e?e:t.nullContext||{},"edit_dashboard",{name:"L",hash:{},data:o,loc:{start:{line:6,column:41},end:{line:6,column:63}}}))+'">\n        <i class="fa fa-pencil-square-o"></i>\n      </button>\n      <button class="btn btnShow nodisplay">\n        <i class="fa fa-check"></i>\n      </button>\n      <button class="btn btnCancel nodisplay">\n        <i class="fa fa-times"></i>\n      </button>\n      <button class="btn btnAdd nodisplay">\n        <i class="fa fa-plus"></i>\n      </button>\n'},3:function(t,e,a,n,i){return""},5:function(t,e,n,r,o){var d;return null!=(d=i(a(695)).call(null!=e?e:t.nullContext||{},"share_dashboard",{name:"haveAccess",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:26,column:6},end:{line:30,column:21}}}))?d:""},6:function(t,e,n,r,o){return'      <button class="btn btnShare" title="'+t.escapeExpression(i(a(688)).call(null!=e?e:t.nullContext||{},"share",{name:"L",hash:{},data:o,loc:{start:{line:27,column:42},end:{line:27,column:55}}}))+'">\n        <i class="fa fa-share-square"></i>\n      </button>\n'},8:function(t,e,n,r,o){return'      <button class="btn btnCopy" title="'+t.escapeExpression(i(a(688)).call(null!=e?e:t.nullContext||{},"copy_dashboard",{name:"L",hash:{},data:o,loc:{start:{line:38,column:41},end:{line:38,column:63}}}))+'">\n        <i class="far fa-copy"></i>\n      </button>\n'},10:function(t,e,n,r,o){var d,s=t.lambda,l=t.escapeExpression;return'      <li>\n        <a href="#" data-rel="'+l(s(null!=e?e.id:e,e))+'" data-key="'+l(s(null!=e?e.key:e,e))+'" title="'+l(s(null!=e?e.title:e,e))+'">'+l(s(null!=e?e.title:e,e))+"</a>\n"+(null!=(d=i(a(689)).call(null!=e?e:t.nullContext||{},null!=e?e.closeBtn:e,"==",!0,{name:"ifCond",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:75,column:8},end:{line:77,column:19}}}))?d:"")+"      </li>\n"},11:function(t,e,a,n,i){return'        <i class="fa fa-close" />\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,r,o){var d,s=null!=e?e:t.nullContext||{},l=t.escapeExpression;return'<div class="tabs-area">\n\n  <div class="toolbar" style="float: left; background: #eee; padding-right:2px;">\n    <div class="btn-group">\n'+(null!=(d=i(a(695)).call(s,"add_dashboard",{name:"haveAccess",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:6},end:{line:18,column:21}}}))?d:"")+'      <button class="btn btnRefresh" title="'+l(i(a(688)).call(s,"refresh_dashboard",{name:"L",hash:{},data:o,loc:{start:{line:19,column:44},end:{line:19,column:69}}}))+'">\n        <i class="fa fa-refresh"></i>\n      </button>\n\n'+(null!=(d=i(a(695)).call(s,"view_report",{name:"haveAccess",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:23,column:6},end:{line:24,column:21}}}))?d:"")+(null!=(d=n.if.call(s,null!=(d=null!=e?e[0]:e)?d.notDesktop:d,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:25,column:6},end:{line:31,column:13}}}))?d:"")+(null!=(d=i(a(695)).call(s,"MANAGESCENARIOS",{name:"haveAccess",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:32,column:6},end:{line:36,column:21}}}))?d:"")+(null!=(d=i(a(695)).call(s,"add_dashboard",{name:"haveAccess",hash:{},fn:t.program(8,o,0),inverse:t.noop,data:o,loc:{start:{line:37,column:6},end:{line:41,column:21}}}))?d:"")+"\n\n"+(null!=(d=i(a(695)).call(s,"list_dashboardcomments",{name:"haveAccess",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o,loc:{start:{line:47,column:6},end:{line:51,column:21}}}))?d:"")+'\n\n      <div class="sure_cancel_dashboard nodisplay">\n        <span>'+l(i(a(688)).call(s,"sure_cancel_save_dashboard",{name:"L",hash:{},data:o,loc:{start:{line:58,column:14},end:{line:58,column:48}}}))+'</span>\n        <button class="btn btn-small btn-red btnGoCancel">'+l(i(a(688)).call(s,"yes",{name:"L",hash:{},data:o,loc:{start:{line:59,column:58},end:{line:59,column:69}}}))+'</button>\n        <button class="btn btn-small btn-grey btnCancelCancel">'+l(i(a(688)).call(s,"no",{name:"L",hash:{},data:o,loc:{start:{line:60,column:63},end:{line:60,column:73}}}))+'</button>\n      </div>\n\n      <a class="btn btn-default" id="save-widgets" href="#" style="display: none;">Save</a>\n\n    </div>\n    <span class="shared-message"></span>\n  </div>\n\n  <nav class="nav-tabs" style="float: left;">\n    <ul class="dash-tabs -primary nodisplay">\n\n'+(null!=(d=n.each.call(s,e,{name:"each",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o,loc:{start:{line:72,column:6},end:{line:79,column:15}}}))?d:"")+'\n    </ul>\n  </nav>\n\n  <ul class="pagination pagination-sm report-navigator">\n    <li class="disabled">\n      <a href="#" class="btnNavigatorPrior">\n        <i class="fa fa-chevron-left"></i>\n      </a>\n    </li>\n    <li class="disabled">\n      <a href="#" class="btnNavigatorNext">\n        <i class="fa fa-chevron-right"></i>\n      </a>\n    </li>\n  </ul>\n</div>\n'},useData:!0})},882:function(t,e,a){"use strict";(function(n,i,r,o){var d,s,l=a(18);d=[a(702),a(706),a(1449),a(1156)],void 0===(s=function(t,e,d,s){return n.View.extend({el:i("#main"),menuInitiated:!1,editionModeInitiated:!1,fromExternal:!1,initialize:function(){},render:function(n,o,h,c,u){this.currentDashboardId=n,this.keyView="div.mainTask[data-rel='dashboard-"+n+"']",c&&c.external&&(this.fromExternal=!0);var b={id:n,extraOptions:c};this.dashboardModel=new e({dashId:n,dashboardViewList:[],nodeOwner:"",imOwner:u,editMode:!1,extraOptions:c}),this.dashboardController=new t;var f=this,g=d(b);this.$el.append(g),this.dashboardTabs=new s({dashboardModel:this.dashboardModel}),this.dashboardTabs.render(n),this.reloadDashboard(n,h),f.fromAddButton=!1,this.currentViewPort=this.getCurrentViewPort();var m=12;switch(this.currentViewPort){case"xs":m=2;break;case"sm":case"md":m=6;break;case"lg":m=12}var v={float:!0,staticGrid:!0,verticalMargin:2,cellHeight:68,disableOneColumnMode:!0,width:m,resizable:{handles:"sw, w, se, e, s"},draggable:{handle:".widgetTitle",scroll:!0}};f.getGrid().removeClass("grid-stack-12").removeClass("grid-stack-6"),f.getGrid().gridstack(v),f.grid=f.getGrid().data("gridstack"),i(window).on("resize.updateSizes",function(t){i(".mainTask.dashboardTask:visible").length>=1&&f.updateSizes(t)}),this.updateSizes(),this.addHandlers(),this.addGenericHandlers(),i(this.keyView).on("reloadDashboard",function(){f.grid.removeAll(),f.reloadDashboard(n,!1)}),this.getGrid().on("added",function(t,e){f.fromAddButton&&(f.afterAddWidget(),f.fromAddButton=!1)}).on("removed",function(t,e){}).on("gsresizestop",function(t,e){setTimeout(function(){var t=r(e).attr("id");f.afterChangeWidget(t);var a=f.dashboardModel.getItemModel("#"+t);a.updateSize(),i(".chartToolbar.popover").length>0&&a.addProperties(!0)},100)}).on("dragstop",function(t,e){setTimeout(function(){var e=r(t.target).attr("id");f.afterChangeWidget(e);var a=f.dashboardModel.getItemModel("#"+e);i(".chartToolbar.popover").length>0&&a.addProperties(!0)},100)}),this.getGrid().on("click",".clearWidget",function(t){if(i(t.target).closest(".grid-stack-item-content").find(".chartTypeSelector").length)return!1;a.e(4).then(function(){var e=[a(683)];(function(e){(new e).show({title:(0,l.translate)("clear_widget"),text:(0,l.translate)("sure_clear_widget"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"}],callback:function(e){if("yes"==e){var n="#"+i(t.target).closest(".grid-stack-item").attr("id"),r=i(t.target).closest(".grid-stack-item").attr("id"),o=f.dashboardModel.getItemModel(n),d={x:o.currentResult.x,y:o.currentResult.y,width:o.currentResult.width,height:o.currentResult.height};f.dashboardModel.removeItemModel(o),f.grid.remove_widget(n),Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(f.dashboardModel,function(t){t.setElement(f.grid),t.model=f.dashboardModel,t.grid=f.grid,t.currentResult=d,t.itemType="empty",t.currentResult.itemType="empty",t._applyItemId(null,r),t.render(),f.dashboardModel.addItemToModel(t),t.setEditMode(f.dashboardModel.editMode)})}).apply(null,t)}).catch(a.oe)}}})}).apply(null,e)}).catch(a.oe)}),this.getGrid().on("click",".restoreWidget",function(t){var e=i(event.target).closest(".grid-stack-item");i(e).find(".restoreWidget").hide();var a=i(e).find(".grid-stack-item-content"),n=a.attr("data-orignal-w"),r=a.attr("data-orignal-h"),o=a.attr("data-orignal-x"),d=a.attr("data-orignal-y");e.animate({top:d,left:o,width:n,height:r},{done:function(){e.removeAttr("style"),f.dashboardModel.getItemModel("#"+e.attr("id")).updateSize(n,e.height()-28,!0),i("body").css("overflow-y","visible"),i("#"+e.attr("id")+"-fullscreenHelper").hide(),setTimeout(function(){window.scrollTo(0,i("#"+e.attr("id")).offset().top)},100)}})}),this.getGrid().on("click",".splitWidgetRight",function(t){var e=i(t.currentTarget).attr("graph");f.getGrid().find(".splitWidgetRight").removeAttr("graph"),f.getGrid().find(".splitWidgetBottom").removeAttr("graph"),parseInt(i(t.currentTarget).closest(".grid-stack-item").attr("data-gs-width"))>1&&f.splitWidget(t,"right",e)}),this.getGrid().on("click",".splitWidgetBottom",function(t){var e=i(t.currentTarget).attr("graph");f.getGrid().find(".splitWidgetRight").removeAttr("graph"),f.getGrid().find(".splitWidgetBottom").removeAttr("graph"),parseInt(i(t.currentTarget).closest(".grid-stack-item").attr("data-gs-height"))>1&&f.splitWidget(t,"bottom",e)}),this.getGrid().on("click",".removeWidget",function(t){var e=i(t.target).closest(".grid-stack-item").attr("data-gs-id");f.dashboardModel.getItemModel("#"+e).checkNodeOwner()||a.e(4).then(function(){var e=[a(683)];(function(e){(new e).show({title:(0,l.translate)("delete_widget"),text:(0,l.translate)("sure_delete_widget"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"}],callback:function(e){"yes"==e&&f.removeWidget(t)}})}).apply(null,e)}).catch(a.oe)}),i(".clearGrid").on("click",function(){f.clearGrid()}),this.getGrid().on("click",".moreChartTypes",function(t){var e=i(event.target).closest(".grid-stack-item").attr("data-gs-id");f.moreChartTypesMenu(e)}),i(".dash-overlay").on("click",function(){f.closeToolbar()}),i("#save-widgets").on("click",function(){setTimeout(function(){f.saveDashboard()},200)}),this.clearGrid=function(){return this.grid.removeAll(),!0}.bind(this),this.getThis().on("refreshView",function(){f.getParent().find("div.toolbar button.btnRefresh").trigger("click")}),this.getThis().on("changeNumberFormat",function(t,e){f&&f.dashboardModel&&f.dashboardModel.applyNumberFormat(e)}),this.getThis().on("reevaluateNodesNeeded",function(t,e){f&&f.dashboardModel&&f.dashboardModel.reevaluateNodesNeededInThisDashboard(e)}),this.getThis().on("removeView",function(){f.onRemoveView()}),this.getThis().on("beforeRemoveView",function(t,e){f.onBeforeRemoveView(t,e)}),this.getParent().on("selectView",function(){i(".tabs-area .nav-tabs li a").removeClass("active"),i('.tabs-area .nav-tabs li a[data-rel="'+f.currentDashboardId+'"]').addClass("active"),f.updateSizes()})},updateSizes:function(t){var e=this,a=-1;clearTimeout(a);var n=t;a=setTimeout(function(){if(i(e.keyView).is(":visible")&&n&&n.target===window&&e.currentViewPort!=e.getCurrentViewPort()){e.currentViewPort=e.getCurrentViewPort();i(window).height();95,e.reloadDashboard(e.currentDashboardId,!1)}},600)},splitWidget:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;function n(t){return t==parseFloat(t)?!(t%2):void 0}t.preventDefault();var r,o,d=this.getGrid().data("gridstack"),s=i(t.currentTarget).closest(".grid-stack-item"),l=s.attr("data-gs-x"),h=s.attr("data-gs-y"),c=s.attr("data-gs-width"),u=s.attr("data-gs-height"),b=n(c),f=n(u);"right"===e&&(c=Math.floor(s.attr("data-gs-width")/2),l=Math.round(s.attr("data-gs-x"))+c,r=b?c:c+1,o=u),"bottom"===e&&(u=Math.floor(s.attr("data-gs-height")/2),h=Math.round(s.attr("data-gs-y"))+u,r=c,o=f?u:u+1),d.resize(s,c,u);var g=this.dashboardModel.getItemModel("#"+s.attr("id"));g.currentResult.width=c,g.currentResult.height=u,g.itemType=a||"empty",this.dashboardModel.updateSizes(!0,!0);var m={x:l,y:h,width:r,height:o};this.dashboardTabs.addNewWidget(this.dashboardTabs,m,g),this.dashboardModel.setStateModified(!0)},removeWidget:function(t){t.preventDefault();var e=this.getGrid().data("gridstack"),a=i(t.currentTarget).closest(".grid-stack-item");e.remove_widget(a);var n=this.dashboardModel.getItemModel("#"+a.attr("id"));this.dashboardModel.removeItemModel(n),this.dashboardModel.setStateModified(!0)},isBreakpoint:function(t){return i(".device-"+t).is(":visible")},afterAddWidget:function(){this.getGrid().data("gridstack"),this.getCurrentViewPort()},afterChangeWidget:function(t){this.getGrid().data("gridstack"),this.getCurrentViewPort();var e=this.dashboardModel.getItemModel("#"+t);e.currentResult.x=i("#"+t).attr("data-gs-x"),e.currentResult.y=i("#"+t).attr("data-gs-y"),e.currentResult.width=i("#"+t).attr("data-gs-width"),e.currentResult.height=i("#"+t).attr("data-gs-height")},afterGridChange:function(){this.getGrid().data("gridstack")&&(this.isBreakpoint("xs")||(this.isBreakpoint("sm")||(this.isBreakpoint("md")||this.isBreakpoint("lg"))))},prepareWidgets:function(t,e){var a,n,r=[],o=this.grid.grid.nodes;return r.lg=[],r.md=[],r.sm=[],r.xs=[],i.each(o,function(t,i){switch(e){case"lg":a=1===i.width?i.width:i.width/2,a=Math.floor(a),n=0===i.x?i.x:i.x/2,n=Math.floor(n);var o={height:i.height,maxHeight:i.maxHeight,maxWidth:i.maxWidth,minHeight:i.minHeight,minWidth:i.minWidth,width:i.width,x:i.x,y:i.y,id:i.id},d={height:i.height,maxHeight:i.maxHeight,maxWidth:a,minHeight:i.minHeight,minWidth:a,width:a,x:n,y:i.y,id:i.id};a=1===i.width||2===i.width?i.width:2,n=i.width>1?0:i.x>=1?1:0;var s={height:i.height,maxHeight:i.maxHeight,maxWidth:a,minHeight:i.minHeight,minWidth:a,width:a,x:n,y:i.y,id:i.id};r.lg.push(o),r.md.push(d),r.sm.push(d),r.xs.push(s);break;case"sm":case"md":d={height:i.height,maxHeight:i.maxHeight,maxWidth:i.maxWidth,minHeight:i.minHeight,minWidth:i.minWidth,width:i.width,x:i.x,y:i.y,id:i.id};a=2*i.width,a=Math.floor(a),n=2*i.x,n=Math.floor(n);o={height:i.height,maxHeight:i.maxHeight,maxWidth:a,minHeight:i.minHeight,minWidth:a,width:a,x:n,y:i.y,id:i.id};a=1===i.width||2===i.width?i.width:2,n=a>=2?0:0===i.x||1===i.x?i.x:0;s={height:i.height,maxHeight:i.maxHeight,maxWidth:a,minHeight:i.minHeight,minWidth:a,width:a,x:n,y:i.y,id:i.id};r.lg.push(o),r.md.push(d),r.sm.push(d),r.xs.push(s)}}),r},getSerializedDataForViewport:function(t){var e=localStorage.getItem("@DashboardName-"+t);return e=JSON.parse(e)},getCurrentViewPort:function(){var t;return this.isBreakpoint("xs")?t="xs":this.isBreakpoint("sm")?t="sm":this.isBreakpoint("md")?t="md":this.isBreakpoint("lg")&&(t="lg"),t},getOptionsMenu:function(){var t=this,e={callback:function(e,n){switch(e){case"columnchart":case"complexchart":case"table":case"nodetable":case"wizard":case"filter":var r=i("#"+n).closest(".grid-stack-item"),o=["variable"];"wizard"==e&&(o=null,e=void 0),"filter"==e&&(o=["index","decision","inputnode"],e=void 0),function(t,e,n){a.e(32).then(function(){var i=[a(929)];(function(a){(new a).show(t,{callback:n,filteredClasses:e})}).apply(null,i)}).catch(a.oe)}(event,o,function(a){var i=a.nodeId;if("module"==a.nodeClass)t.createNewView({itemType:"objectItem",objectType:"diagramviewer",itemProperties:{diagramOptions:{currentModule:i}}});else{var r=t.dashboardModel.getItemModel("#"+n);r.grid=t.grid,r.currentResult.itemProperties={},r.currentResult.itemType="objectItem",r.currentResult.objectType=e,r.model=t.dashboardModel,r.initializeWithNode(i)}});break;case"inputform":!function(t,e){a.e(46).then(function(){var n=[a(1026)];(function(a){(new a).show(t,{callback:e})}).apply(null,n)}).catch(a.oe)}(event,function(a){var r=a.templateId,o=a.name,d=t.dashboardModel.getItemModel("#"+n),s=i("#"+n).closest(".grid-stack-item");t.grid.remove_widget(s),d.grid=t.grid,d.currentResult.itemProperties={templateId:r,inputForm:{templateId:r},title:{text:o,style:{color:"#000"},enabled:!0},subtitle:{style:{color:"#000"}}},d.currentResult.itemType="objectItem",d.currentResult.objectType=e,d.model=t.dashboardModel,d.editMode=!0,d.createNewView(d.currentResult)});break;case"texteditor":case"diagramviewer":case"mapviewer":case"menuwidget":var d=t.dashboardModel.getItemModel("#"+n);r=i("#"+n).closest(".grid-stack-item");t.grid.remove_widget(r),d.grid=t.grid,d.currentResult.itemProperties={},d.currentResult.itemType="objectItem",d.currentResult.objectType=e,d.model=t.dashboardModel,d.editMode=!0,d.createNewView(d.currentResult)}},items:{}};return e.items.texteditor={type:"icon_text",name:"Text",iconClass:""},e.items.mapviewer={type:"icon_text",name:"Gis Map",iconClass:""},e.items.inputform={type:"icon_text",name:"Input Form",iconClass:""},e.items.wizard={type:"icon_text",name:"Wizard",iconClass:""},e.items.filter={type:"icon_text",name:"Filter",iconClass:""},e.items.menuwidget={type:"icon_text",name:"Menu",iconClass:""},e},moreChartTypesMenu:function(t){var e='div[data-gs-id="'+t+'"] .moreChartTypes',a=this.getOptionsMenu();if(a&&(this.menuInitiated&&i.contextMenu("destroy",e),!i.isEmptyObject(a.items))){var n=this;this.menuInitiated=!0,i.contextMenu({selector:e,callback:function(e,i){a.callback(e,t),a.items&&a.items[e]&&a.items[e].persist&&setTimeout(function(){n.moreChartTypesMenu()},100)},items:a.items})}this.menuInitiated&&i(e).contextMenu()},closeToolbar:function(){var t,e=i(".popover");Promise.resolve().then(function(){var n=[a(706)];(function(a){var n=(new a).getItemsModel();i.each(n,function(t,e){i(e.tagId).css("z-index",1)}),e.length>0&&(t=e.attr("data-id"),e.remove(),i(t).css("z-index",1),i(".dash-overlay").hide())}).apply(null,n)}).catch(a.oe)},recalcWidgets:function(t,e){var a,n=this.getCurrentViewPort(),i=t;switch(e){case"xs":a=o.map(i,function(t){var e,a=1===t.width||2===t.width?t.width:2;e=a>=2?0:0===t.x||1===t.x?t.x:0;var n=Object.assign({},t);return n.width=a,n.x=e,n},this);break;case"sm":case"md":var r=2;"xs"===n&&(r=3);a=o.map(i,function(t){var e=t.width*r;e=Math.floor(e);var a=t.x*r;a=Math.floor(a);var n=Object.assign({},t);return n.width=e,n.x=a,n},this);break;case"lg":r=2;"xs"===n&&(r=6),a=o.map(i,function(t){var e=t.width*r;e=Math.floor(e);var a=t.x*r;a=Math.floor(a);var n=Object.assign({},t);return n.width=e,n.x=a,n},this)}return a},reloadDashboard:function(t,a){var n=this;i(".tabs-area").find(".toolbar").hide(),this.dashboardModel||(this.dashboardModel=new e({dashId:t,dashboardViewList:[],nodeOwner:"",extraOptions:null}));var r=this.dashboardModel.getItemsModel();i.each(r,function(t,e){i(e.tagId).trigger("removeItemView")}),n.dashboardModel.removeAllItemsModel(),n.grid&&n.grid.removeAll(),n.getParent().find(".grid-stack.dashboard-area").empty(),this.dashboardModel.getDashboard(t,function(e){i('.nav-tabs li a[data-rel="'+t+'"]').text(e.name),n.getParent().attr("dash-title",e.name);var r=n.getCurrentViewPort(),o=12,d={};if(e.definition){switch(d=e.definition,r){case"xs":d=d.definitionSmall?d.definitionSmall:d.definitionMedium?n.recalcWidgets(d.definitionMedium,"xs"):n.recalcWidgets(d.definitionLarge,"xs"),o=2;break;case"sm":case"md":d.definitionMedium?(d=d.definitionMedium,n.getGrid().removeClass("grid-stack-autoposition")):d.definitionLarge?(n.getGrid().addClass("grid-stack-autoposition"),d=d.definitionLarge):(n.getGrid().addClass("grid-stack-autoposition"),d=n.recalcWidgets(d.definitionSmall,"md")),o=6;break;case"lg":d.definitionLarge?(d=d.definitionLarge,n.getGrid().removeClass("grid-stack-autoposition")):d=d.definitionMedium?n.recalcWidgets(d.definitionMedium,"lg"):n.recalcWidgets(d.definitionSmall,"lg"),o=12}e.definition=d}else switch(n.currentViewPort){case"xs":o=2;break;case"sm":case"md":o=6;break;case"lg":o=12}n.getGrid().removeClass("grid-stack-12").removeClass("grid-stack-6").removeClass("grid-stack-2"),n.getGrid().addClass("grid-stack-"+o),n.getGrid().data("gridstack").setGridWidth(o),window.location.href.indexOf("/#shared/")>0?(i(".tabs-area .toolbar").hide(),i(".loader.embeddable").hide(),i("body").css("background-color","#FFF")):n.dashboardTabs.refreshDashboardTabs(),n.dashboardModel.attributes.imOwner=e.ownerId===__currentSession.userCompanyId,n.refreshDashboardName(e),n.dashboardModel.setNodeOwner(e.node),n.parseDashboard(e,a),n.getParent().find("div.breadcrumbs2").show(),n.checkShared(e,a),n.checkFromDiagram(e),i(".tabs-area").find(".toolbar").show(),window.location.href.indexOf("/#shared/")>0&&(i(".loadingPlaceholder").hide(),i(".loader.embeddable").hide(),i("body").css("background-color","#FFF")),n=null})},checkFromDiagram:function(t){""!==t.node&&null!==t.node&&(i(".tabs-area").find(".toolbar .btnCopy").hide(),i(".tabs-area").find(".toolbar .btnShare").hide())},checkShared:function(t,e){if(this.dashboardModel.attributes.imOwner)e||(i(".tabs-area").find(".toolbar .btnEdit").show(),i(".tabs-area").find(".toolbar .btnShare").show(),i(".tabs-area").find(".toolbar .shared-message").html(""));else{i(".tabs-area").find(".toolbar .btnEdit").hide(),i(".tabs-area").find(".toolbar .btnShare").hide(),t.sharedBy?i(".tabs-area").find(".toolbar .shared-message").html((0,l.translate)("full_shared_by")+": "+t.sharedBy):i(".tabs-area").find(".toolbar .shared-message").html((0,l.translate)("Is shared"));var a=this;this.getParent().on("refreshImageDashboard",function(t,e){a.reloadDashboard(e)})}},refreshDashboardName:function(t){var e=i("#topMenuBar span#currentTask").attr("data-rel").match(/-/g).length>1;if(t){var a=e?t.uuid:t.dashboardId,n=t.name;this.dashboardName=n,i("span[data-rel='dashboard-"+a+"']").text(n),i("#topMenuBar li a[rel='dashboard-"+a+"']").text(n),i(".dash-tabs li a[data-rel='"+a+"']").text(n),i(".dash-tabs li a[data-rel='"+a+"']").attr("title",n)}},removeDashboard:function(t){Promise.resolve().then(function(){var e=[a(684)];(function(e){(new e).removeTask(t)}).apply(null,e)}).catch(a.oe)},parseDashboard:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this,r=t.definition;this.dashboardModel.setStyleLibraries(t.styleLibraries);var o=n.dashboardModel.get("extraOptions")&&n.dashboardModel.get("extraOptions").isInputNode;if(t.definition&&!o||!t.node||this.dashboardController.getEmptyContent(this.dashboardModel,function(a){var r=n.getCurrentViewPort(),d=12;"sm"!==r&&"md"!==r||(d=6);var s=i("#main").height()-80,l=Math.floor(s/68);a.setElement(i("div.grid-stack")),a.grid=n.grid,a.dashboardModel=n.dashboardModel,a.currentResult={x:0,y:0,width:d,height:l},a.loadingDashboard=!0,a.render(),n.dashboardModel.addItemToModel(a),a.initializeWithNode(t.node,!!o&&"nodetable"),t.definition&&""!=t.definition&&!o||e&&i("div.toolbar button.btnEdit").click()}),r&&r.length>0){var d=[],s=[];r.noQuery&&r.noQuery.length>0&&void 0!=r.noQuery[0].rel&&(d=r.noQuery,i.each(d,function(t,e){i.each(e.rel,function(t,e){s.push(e)})})),n.noQuery=d,n.ownerWidth=r.ownerWidth,n.ownerHeight=r.ownerHeight,n.dashboardModel.initializeDashboardQuery(n.noQuery);var l=d.indexOf(r.nodeId)>=0;i.each(r,function(t,e){"empty"===e.itemType?Promise.resolve().then(function(){var t=[a(702)];(function(t){(new t).getEmptyContent(n.dashboardModel,function(t){t.setElement(i("div.grid-stack")),t.grid=n.grid,t.currentResult=e,t.dashboardModel=n.dashboardModel,t.loadingDashboard=!0,t.render(),i(t.tagId).find(".btnMenu").hide(),n.dashboardModel.addItemToModel(t)})}).apply(null,t)}).catch(a.oe):a.e(0).then(function(){var t=[a(722)];(function(t){var a=new t({model:n.dashboardModel});a.setElement(i("div.grid-stack")),a.grid=n.grid,a.dashboardModel=n.dashboardModel,a.loadingDashboard=!0,a.widget=e,n.dashboardModel.addItemToModel(a),a.createNewView(e,l)}).apply(null,t)}).catch(a.oe)})}t.definition&&!o||e&&(i("div.toolbar button.btnEdit").click(),setTimeout(function(t){n.dashboardTabs.addNewWidget(n.dashboardTabs)},100)),n.fromExternal&&setTimeout(function(){n.initPromiseWatcher()},1e3)},resetView:function(){this.checkNodeOwner()||this.createNewView({itemType:"empty"})},getThis:function(){return i(this.keyView)},onRemoveView:function(){i(".tabs-area").remove(),i(".mainTask.dashboardTask.new").length<1&&i(window).off("resize.updateSizes"),0===i(".mainTask.dashboardTask.new").length&&i(window).off("keyup.closeTabs"),i(this.keyView).off(),this.dashboardController=null;var t=this.dashboardModel.getItemsModel();i.each(t,function(t,e){i(e.tagId).trigger("removeItemView")}),this.dashboardModel.removeAllItemsModel(),this.dashboardModel=null,this.noQuery=null;var e=this;setTimeout(function(){e.dashboardTabs.refreshDashboardTabs(),e.dashboardTabs.getModel()&&e.dashboardTabs.checkFromDiagram(e.dashboardTabs.getModel().attributes),e=null},100)},onBeforeRemoveView:function(t,e){if(i(".mainTask.dashboardTask.new").length<1&&i(window).off("resize.updateSizes"),this.dashboardModel.editMode){t.preventDefault();var n=this;a.e(4).then(function(){var t=[a(683)];(function(t){(new t).show({title:(0,l.translate)("_save")+": "+n.dashboardName,text:(0,l.translate)("save_pending_changes"),buttons:[{title:(0,l.translate)("yes"),css:"primary",code:"yes"},{title:(0,l.translate)("no"),code:"no"},{title:(0,l.translate)("cancel"),code:"cancel"}],callback:function(t){"yes"==t?(n.refreshMode(!1),n.saveDashboard(),setTimeout(function(){e()},1e3)):"no"==t&&(n.dashboardModel.editMode=!1,setTimeout(function(){e(!0)},1e3))}})}).apply(null,t)}).catch(a.oe)}},refreshMode:function(t){this.dashboardModel.editMode=t,this.getParent().find("div.toolbar button").hide();var e=this.dashboardModel.getItemsModel();i.each(e,function(e,a){a.setEditMode(t)}),t?(this.getParent().find(".dash-tabs").hide(),this.getParent().closest(".mainTask").addClass("editing"),this.getParent().find("div.toolbar button.btnShow").show(),this.getParent().find("div.toolbar button.btnCancel").show(),this.getParent().find("div.objectsToolbar").fadeIn(),this.getParent().find(".dockDashboardProperty").fadeIn()):(this.getParent().find(".dash-tabs").show(),this.getParent().closest(".mainTask").removeClass("editing"),this.getParent().find("div.toolbar button").show(),this.getParent().find("div.toolbar button.btnShow").hide(),this.getParent().find("div.toolbar button.btnCancel").hide(),this.getParent().find("div.objectsToolbar").fadeOut(),this.getParent().find(".dockDashboardProperty").fadeOut())},addGenericHandlers:function(){var t=i(this.keyView),e=this;void 0!==__currentSession.fromEmbedded&&(this.fromEmbedded=__currentSession.fromEmbedded),this.fromEmbedded||t.on("click",".link-to-dashboard",function(){if(!e.dashboardModel.editMode){var t=i(this).attr("data-dashboard-id"),n=(0,l.translate)("loading_dashboard"),r=!0;if("_self"===i(this).attr("data-target")&&(r=!1),e.dashboardController.showDashboard(t,-1,n,!0,e.dashboardModel.editMode),!r){var o=e.getParent().attr("data-rel");Promise.resolve().then(function(){var t=[a(684)];(function(t){(new t).removeTask(o,!0)}).apply(null,t)}).catch(a.oe)}}})},addHandlers:function(){1===i(".mainTask.dashboardTask.new").length&&i(window).on("keyup.closeTabs",function(t){t.ctrlKey&&81===t.keyCode&&i(".tabs-area .dash-tabs li a.active").closest("li").find("i.fa.fa-close").click()})},getParent:function(){return i(this.keyView)},getGrid:function(){return i(".grid-dash-"+this.currentDashboardId)},initPromiseWatcher:function(){if(this.dashboardModel){var t=this.dashboardModel.getItemsModel();if(t&&t.length>0){var e=!0;if(i.each(t,function(t,a){0==i(a.tagId).find(".item-class-selector").length&&(e=e&&a.isReady)}),!e&&this.getParent().find(".dashboard-area").length>0){var a=this;setTimeout(function(){a.initPromiseWatcher(),a=null},1e3)}}}}})}.apply(e,d))||(t.exports=s)}).call(this,a(218),a(1),a(1),a(220))}}]);