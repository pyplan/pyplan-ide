/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{1429:function(t,e,i){"use strict";(function(o,n,a,s){var r,l,p=i(18);i(908),i(973),r=[i(1843),i(1845),i(1847),i(977)],void 0===(l=function(t,e,r,l){return o.View.extend({map:void 0,mainLayer:void 0,layerControl:void 0,resizeTimeout:-1,autoPosCounter:0,dashboardModel:void 0,firstTime:!0,defaults:{maxZoom:18,initZoom:10,initLat:"auto",initLng:"auto",showControlLayer:!0,layers:[],autCenter:!0},el:"body",initialize:function(){this.options=n.extend({},this.defaults,this.options)},setOptions:function(t){this.options=n.extend({},this.options,t)},setDashboardMoldel:function(t){this.dashboardModel=t},render:function(){var t=L.latLng(-23.550622,-46.6325);"auto"!=this.options.initLat&&"auto"!=this.options.initLng&&(t=L.latLng(this.options.initLat,this.options.initLng));var e=[];e.push(new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{styleId:997,attribution:""})),e.push(new L.Google("ROADMAP")),e.push(new L.Google("SATELLITE")),e.push(new L.Google("HYBRID"));var i=this.options.startBaseMap;(!i||i>4)&&(i=0),this.map=L.map(this.el,{center:t,zoom:this.options.initZoom,layers:[e[i]],maxZoom:this.options.maxZoom}),this.mainLayer=L.featureGroup().addTo(this.map);var o={"Open Street Map":e[0],"Google roadmap":e[1],"Google satellite":e[2],"Google hybrid":e[3]};this.addControlLayer(o),this.drawLayers();var n=this;this.map.on("zoomend",(function(){n.checkZoomLevels(),n.displayCurrentZoom()}))},destroy:function(){this.map&&(this.mainLayer.clearLayers(),this.map.removeLayer(this.mainLayer),this.map.remove(),this.mainLayer=null,this.map=null)},onResize:function(){if(this.map){var t=n(this.el);t.height()>220&&t.width()>300?n(this.map._controlContainer).find(".leaflet-bottom.leaflet-left").show():n(this.map._controlContainer).find(".leaflet-bottom.leaflet-left").hide(),this.map.invalidateSize(!1)}},drawLayers:function(){if(this.mainLayer){if(this.layerControl){var t=this.layerControl;this.mainLayer.eachLayer((function(e){t.removeLayer(e)}))}this.mainLayer.clearLayers();this.autoPosCounter=this.options.layers.length;for(var e=0;e<this.options.layers.length;e++){var i,o=this.options.layers[e];switch(o.layerType){case"clusterLayer":i=L.clusterLayer(o.options);break;case"markerLayer":i=L.markerLayer(o.options);break;case"lineLayer":i=L.lineLayer(o.options)}i&&(i.setMapView(this),i.addTo(this.mainLayer),this.layerControl&&this.layerControl.addOverlay(i,o.options.layerName))}}},addControlLayer:function(t){this.options.showControlLayer&&this.mainLayer&&(this.layerControl=L.control.layers(t).addTo(this.map))},showInfoBubble:function(t,e,o,s){var r=L.popup({closeOnClick:!0}).setLatLng(t.latlng).setContent("getting info ...").openOn(this.map),p=function(t,e){if(o&&o.map.info&&o.map.info.sparklineFields){var l={chart:{backgroundColor:null,borderWidth:0,type:"area",margin:[2,0,2,0],height:40,style:{overflow:"visible"},skipClone:!0},title:!1,credits:{enabled:!1},xAxis:{labels:{enabled:!1},title:{text:null,style:{fontSize:"9px"}},startOnTick:!1,endOnTick:!1,tickPositions:[]},yAxis:{endOnTick:!1,startOnTick:!1,labels:{enabled:!1},title:{text:null},tickPositions:[0]},legend:{enabled:!1},exporting:{enabled:!1},tooltip:!1,plotOptions:{series:{animation:!1,lineWidth:1,shadow:!1,states:{hover:{lineWidth:1}},marker:{radius:1,states:{hover:{radius:2}}},fillOpacity:.25},column:{negativeColor:"#910000",borderColor:"silver"}}},p=n.uuid();t+="<div id='"+p+"'></div>",setTimeout((function(){var t=n.extend({},l);t.chart.renderTo=n(r._container).find("#"+p).get(0),o.map.info.sparklineTitle&&(t.xAxis.title.text=o.map.info.sparklineTitle);var i=[],s=[];n.each(e,(function(t,e){if(o.map.info.sparklineFields.indexOf(e.Key)>=0&&-1==s.indexOf(e.Key)){s.push(e.Key);var n=parseFloat(e.Value);i.push(n)}})),t.series=[{data:i,pointStart:1}];new a.Chart(t)}),200)}if(o&&o.map.event&&"link_dashboard"==o.map.event.type&&o.map.event.eventData){var c=o.map.event.eventData;t+="<br/><a href='#' class='linkedDashboard'>"+c.linkTitle+"</a>",setTimeout((function(){n(r._container).find("a.linkedDashboard").on("click",(function(){var t=function(){var t=c.dashboardId,e=c.dashboardName;i.e(7).then((function(){var o=[i(690)];(function(i){(new i).showDashboard(t,-1,e,!0)}).apply(null,o)})).catch(i.oe)},o=[];e&&n.each(c.params,(function(t,i){"@id"==i.attribute?o.push({node:i.node,properties:[{name:"definition",value:s}]}):n.each(e,(function(t,e){if(e.Key==i.attribute){var a=e.Value;return null!=a&&null!=a&&(n.isNumeric(a)||(a="'"+a+"'"),o.push({node:i.node,properties:[{name:"definition",value:a}]})),!1}}))})),o&&o.length>0?Promise.resolve().then((function(){var e=[i(220)];(function(e){(new e).setNodesProperties(o,(function(){t()}))}).apply(null,e)})).catch(i.oe):t()}))}),100)}r.setContent(t)};if(o&&o.map.info){var c=e.node,h=e.attIndex,m=e.rowIndex,d=[];o.map.info.node&&""!=o.map.info.node&&(c=o.map.info.node),o.map.info.attIndex&&""!=o.map.info.attIndex&&(h=o.map.info.attIndex),o.map.info.fields&&""!=o.map.info.fields&&(d=o.map.info.fields),o.map.info.sparklineFields&&""!=o.map.info.sparklineFields&&(d=d.concat(o.map.info.sparklineFields));var u=new l,f={node:c,attIndex:h,rowIndex:m,extraData:d.join(","),id:s};u.getBubbleInfo(f,(function(t){if(t&&t.length>0){var e=s;if(o.map.info.fields&&""!=o.map.info.fields){var i=[];n.each(t,(function(t,a){if(o.map.info.fields.indexOf(a.Key)>=0&&-1==i.indexOf(a.Key)){i.push(a.Key);var s=a.Value;s=s?n.isNumeric(s)?parseFloat(s).toFixed(2):s:"-",e+="<br/><b>"+a.Key+": </b>"+s}}))}p(e,t)}else p(s)}))}else p(s)},stringComparer:function(t,e){return!!e&&(t.from.toLowerCase()==e.toString().toLowerCase()||t.to.toLowerCase()==e.toString().toLowerCase())},numericComparer:function(t,e){return e>=parseFloat(t.from)&&e<parseFloat(t.to)||e==parseFloat(t.from)&&e==parseFloat(t.to)},getRangeByVal:function(t,e,i){var o;if(t)for(var n=0;n<t.length;n++)if((isNaN(parseInt(t[n].from))?this.stringComparer:this.numericComparer)(t[n],e)){o=t[n][i];break}return o},generateStyleObject:function(t,e,i){i||(i=30);var o={};if(n.each(["sizeRes","colorRes","iconRes"],(function(t,e){o[e]={max:-1/0,min:1/0,values:[],isString:!1}})),o.sizeRes.min=t.minSize,o.sizeRes.max=t.maxSize,o.colorRes.min=t.minColor,o.colorRes.max=t.maxColor,o.iconRes.min=t.minIcon,o.iconRes.max=t.maxIcon,e.sizeField&&""!=e.sizeField&&(o.sizeBy=function(t){var e=((t=parseFloat(t))-this.sizeRes.min)/(this.sizeRes.max-this.sizeRes.min)*i;return isNaN(e)&&(e=0),e}),e.colorField&&""!=e.colorField)if(0!=e.itemProperties.map.colorSchema.indexOf("#")){if(this.dashboardModel){o.colorRange=this.dashboardModel.getStyleLibrary(e.itemProperties.map.colorSchema);var a=this;o.colorBy=function(t){var e=a.getRangeByVal(this.colorRange,t,"color");if(e)return s(e)}}}else{var r=e.itemProperties.map.colorSchema;o.colorChroma=s.scale(r.split(",")).domain([o.colorRes.min,o.colorRes.max]),o.colorBy=function(t){var e=this.colorChroma(t);if(e)return e}}if(e.iconField&&""!=e.iconField&&(!e.markerType||"circle"!=e.markerType)&&e.itemProperties.map.iconSchema&&""!=e.itemProperties.map.iconSchema&&this.dashboardModel){o.iconRange=this.dashboardModel.getStyleLibrary(e.itemProperties.map.iconSchema);a=this;o.iconBy=function(t){var e=a.getRangeByVal(this.iconRange,t,"icon");if(e)return e}}return o},showLoadingData:function(t){var e=n.uuid(),i=n("<span></span>").addClass("loadingLayer").attr("id",e).text("Loading layer "+t+"..."),o=n(this.map.getContainer());return o.append(i),i.css("margin-left",i.width()/2*-1),setTimeout((function(){if(i.length>0)try{i.fadeIn().css("margin-top",27*(o.find(".loadingLayer:visible").length-1))}catch(t){}}),500),e},hideLoadingData:function(t){t="#"+t,n(this.map.getContainer()).find(t).fadeOut("slow",(function(){n(this).remove()}))},autoposition:function(){if(this.autoPosCounter--,0==this.autoPosCounter){var t=this.mainLayer.getBounds();t&&t._northEast&&t._southWest&&this.map.fitBounds(t)}},checkZoomLevels:function(){if(this.map&&this.options.layers&&this.options.layers.length>0)for(var t=this.map.getZoom(),e=this.$el.find(".leaflet-control-layers-overlays"),i=0;i<this.options.layers.length;i++){var o=this.options.layers[i],n=!0;(o.fromZoom&&t<o.fromZoom||o.toZoom&&t>o.toZoom)&&(n=!1),e.find("label").eq(i).find("input").is(":checked")!=n&&e.find("label").eq(i).find("input").trigger("click")}},displayCurrentZoom:function(){if(this.map){this.$el.find(".zoom-helper").remove();var t=n("<span></span>").addClass("zoom-helper").text((0,p.translate)("zoom_level")+": "+this.map.getZoom()).appendTo(this.$el);t.animate({top:"-3px"},{complete:function(){setTimeout((function(){t.animate({top:"-25px"},{complete:function(){t.remove()}})}),600)}})}}})}.apply(e,r))||(t.exports=l)}).call(this,i(219),i(1),i(26),i(764))},1430:function(t,e,i){var o=i(669);t.exports=(o.default||o).template({compiler:[8,">= 4.3.0"],main:function(t,e,i,o,n){var a,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div id="'+t.escapeExpression("function"==typeof(a=null!=(a=s(i,"mapElementId")||(null!=e?s(e,"mapElementId"):e))?a:t.hooks.helperMissing)?a.call(null!=e?e:t.nullContext||{},{name:"mapElementId",hash:{},data:n,loc:{start:{line:1,column:9},end:{line:1,column:25}}}):a)+'" class="dashboard-map hide-minimize-button">\n\n</div>\n\n<button class="btn btn-maximize-map"><i class="fa fa-arrows-alt"></i></button>'},useData:!0})},1843:function(t,e,i){"use strict";(function(o,n){var a,s,r=i(18);a=[i(1844),i(977)],void 0===(s=function(t,e){var i=new e,a=new t;L.ClusterLayer=L.FeatureGroup.extend({_mapView:void 0,_map:void 0,_inQuery:!1,_prevZoom:-1,_zoomType:"",_zoomTable:[2,2,4,4,4,7,7,7,10,10,12,12,14,14,16,16,18,18],_styleObject:{},_firstTime:!0,_legendControl:void 0,initialize:function(t){L.Util.setOptions(this,t),L.FeatureGroup.prototype.initialize.call(this,[])},addTo:function(t){return t.addLayer(this),this},onAdd:function(t){this._map=t,this._map.on("zoomend",this.getGeoData,this),this._map.on("moveend",this.getGeoData,this),this.on("click",this.layerClick,this),this.getGeoData()},onRemove:function(t){this._map.off("zoomend",this.getGeoData,this),this._map.off("moveend",this.getGeoData,this),this.off("click",this.layerClick,this),this._map=null,this._legendControl&&this._legendControl.hide(),L.FeatureGroup.prototype.onRemove.call(this,t)},setMapView:function(t){this._mapView=t},makeGeoQuery:function(){var t=this._map.getBounds(),e=o.extend({},this.options,{});return delete e.itemProperties,e.isCluster=!0,e.lat1=t.getNorth(),e.lat2=t.getSouth(),e.lng1=t.getEast(),e.lng2=t.getWest(),e.zoom=this._map.getZoom(),e},getGeoData:function(){if(!this._inQuery&&this._map.getZoom()>0){this._inQuery=!0,-1!=this._prevZoom&&(this._prevZoom<this._map.getZoom()?this._zoomType="zoomin":this._prevZoom==this._map.getZoom()?this._zoomType="panning":this._zoomType="zoomout");var t=this._mapView.showLoadingData(this.options.layerName);this.disableMap();var e=this,n=this.makeGeoQuery();e._mapView.firstTime&&(n.lat1=85.05115,n.lat2=-85.05115,n.lng1=-180,n.lng2=180),i.getGeoData(n,(function(i){if(e._inQuery=!1,e.enableMap(),i&&""!=i){e._styleObject=e._mapView.generateStyleObject(i,e.options),e.updateControl();var n=[];e.eachLayer((function(t){n.push(t)}));var a=[];o.each(i.points,(function(t,i){a.push(e.createIcon(i,n))})),e.applyClusterStyles(a,e._styleObject),"zoomin"==e._zoomType?e.animateZoomIn(n,a):"zoomout"==e._zoomType?e.animateZoomOut(n,a):e.noAnimate(n,a)}(e._mapView.firstTime||e._mapView.options.autCenter)&&(e._mapView.firstTime=!1,e._mapView.autoposition()),e._prevZoom=e._map.getZoom(),e._mapView.hideLoadingData(t)}),(function(){e._inQuery=!1,e.enableMap(),e._prevZoom=e._map.getZoom(),e._mapView.hideLoadingData(t)}))}},getGeoDetail:function(t,e){var o=this.makeGeoQuery();o.extraData=t,i.getGeoDetail(o,(function(t){e(t)}))},disableMap:function(){this._map&&(this._map.dragging.disable(),this._map.touchZoom.disable(),this._map.doubleClickZoom.disable(),this._map.scrollWheelZoom.disable(),this._map.boxZoom.disable(),this._map.keyboard.disable(),this._map.tap&&this._map.tap.disable())},enableMap:function(){this._map&&(this._map.dragging.enable(),this._map.touchZoom.enable(),this._map.doubleClickZoom.enable(),this._map.scrollWheelZoom.enable(),this._map.boxZoom.enable(),this._map.keyboard.enable(),this._map.tap&&this._map.tap.enable())},noAnimate:function(t,e){var i=this;o.each(t,(function(t,e){i.removeLayer(e)})),i=null},animateZoomIn:function(t,e){this._map._mapPane.className+=" leaflet-cluster-anim";var i=this;setTimeout((function(){o.each(e,(function(t,e){e.setLatLng([e.options.extraData.lat,e.options.extraData.lng])}))}),100),o.each(t,(function(t,e){e.setOpacity(0)})),setTimeout((function(){o.each(t,(function(t,e){i.removeLayer(e),i._map._mapPane.className=i._map._mapPane.className.replace(" leaflet-cluster-anim","")})),i=null}),300)},animateZoomOut:function(t,e){this._map._mapPane.className+=" leaflet-cluster-anim";var i=this.getZoom(this._map.getZoom()),n=this.deltaX(i),a=this.deltaY(i),s=this;o.each(t,(function(t,i){if(i instanceof L.Marker){i.setOpacity(0);var r=s.getGridKey(i,n,a);o.each(e,(function(t,e){if(e.options.extraData.id==r)return i.setLatLng(e.getLatLng()),!1}))}})),setTimeout((function(){o.each(t,(function(t,e){s.removeLayer(e),s._map._mapPane.className=s._map._mapPane.className.replace(" leaflet-cluster-anim","")})),s=null}),300)},getGridKey:function(t,e,i){return 1e6*Math.ceil((t.getLatLng().lng+180)/e)+Math.ceil((t.getLatLng().lat+90)/i)},getZoom:function(t){return this._zoomTable.length>t-1?this._zoomTable[t-1]:t},deltaX:function(t){return(360/Math.pow(2,t)).toFixed(6)},deltaY:function(t){return(180/Math.pow(2,t)).toFixed(6)},createIcon:function(t,e){var i=t.count;this.options.labelField&&""!=this.options.labelField&&(i=(0,r.formatNumber)(t.labelRes,{decimalPlaces:1}));var n={html:"<div><span>"+i+"</span></div>",iconSize:new L.Point(60,60),className:"marker-cluster marker-cluster-small"},a=L.divIcon(n),s=[t.lat,t.lng],l={extraData:t,opacity:1};t.count>1?l.icon=a:(l.title=t.id,this._styleObject.iconBy&&this._styleObject.iconBy(t.iconRes)&&(l.icon=L.icon({iconSize:[32,32],iconAnchor:[16,32]})));var p=L.marker(s,l).addTo(this),c=this.getZoom(this._prevZoom),h=this.deltaX(c),m=this.deltaY(c);if(e&&"zoomin"==this._zoomType){var d=this.getGridKey(p,h,m);o.each(e,(function(t,e){if(e.options.extraData.id==d)return p.setLatLng(e.getLatLng()),!1}))}return p},layerClick:function(t){if(t.layer&&t.layer.options&&t.layer.options.extraData){var e=t.layer.options.extraData,i=this;if(e.count)if(1==e.count)this.getGeoDetail(e.id,(function(e){if(e&&e.length>0)if(1==e.length)i._mapView.showInfoBubble(t,i.options,i.options.itemProperties,e[0].id);else{var n=0,a=99999;o.each(e,(function(e,i){t.layer.getLatLng().distanceTo(L.latLng(i.lat,i.lng))<a&&(a=t.layer.getLatLng().distanceTo(L.latLng(i.lat,i.lng)),n=e)})),i._mapView.showInfoBubble(t,i.options,i.options.itemProperties,e[n].id)}}));else{var n=this._map.getZoom(),a=this.getZoom(n);if(n==this._map.options.maxZoom)this.showItemsInCluster(t.layer);else{n++;for(var s=this.getZoom(n);s&&s<this._map.options.maxZoom&&s==a;)n++,s=this.getZoom(n);s&&this._map.setZoomAround(t.layer.getLatLng(),n)}}else this._mapView.showInfoBubble(t,this.options,this.options.itemProperties,e.id)}},showItemsInCluster:function(t){var e=this;this.getGeoDetail(t.options.extraData.id,(function(i){if(i&&1==i.length)e._mapView.showInfoBubble(void 0,e.options,e.options.itemProperties,i[0].id);else{var o={layer:t,list:i,map:e._map,group:e,createIcon:function(t){return e.createIcon(t)}};a.setOptions(o),a.render()}}))},applyClusterStyles:function(t){var e=this;o.each(t,(function(t,i){var a=i.options.extraData,s=o(i._icon),r=s.find(">div");if(e._styleObject&&a.count&&a.count>1){if(e._styleObject.sizeBy){var l=e._styleObject.sizeBy(a.sizeRes);l=parseInt(50+l),s.width(l).height(l).css("border-radius",l/2+"px"),r.width(l-10).height(l-10).css("border-radius",(l-10)/2+"px").css("line-height",l-10+"px")}if(e._styleObject.colorBy){var p=e._styleObject.colorBy(a.colorRes);if(p){var c=p.rgb();c&&(s.css("background-color","rgba("+parseInt(c[0])+","+parseInt(c[1])+","+parseInt(c[2])+", 0.4)"),c=n.rgb(c[0],c[1],c[2]).darken().rgb(),r.css("background-color","rgba("+parseInt(c[0])+","+parseInt(c[1])+","+parseInt(c[2])+", 0.4)"))}}}})),e=null},updateControl:function(){!this._legendControl&&this.options.layerName&&this._map&&(this._legendControl=L.control.legend({title:this.options.layerName}).addTo(this._map)),this._legendControl&&this._legendControl.updateStyles(this._styleObject,this.options)}}),L.clusterLayer=function(t){return new L.ClusterLayer(t)}}.apply(e,a))||(t.exports=s)}).call(this,i(1),i(764))},1844:function(t,e,i){"use strict";(function(i,o){var n;void 0===(n=function(){return i.View.extend({_spiderfy:void 0,defaults:{circleSpiralSwitchover:9,spiderfyDistanceMultiplier:1,circleFootSeparation:50,spiralFootSeparation:28,spiralLengthStart:11,spiralLengthFactor:5},setOptions:function(t){this.options=o.extend({},this.options,t)},initialize:function(){this.options=o.extend({},this.defaults,this.options)},render:function(){var t;this.unSpiderfy();var e=this.options.map.latLngToLayerPoint(this.options.layer.getLatLng());this.options.list.length>=this.options.circleSpiralSwitchover?t=this._generatePointsSpiral(this.options.list.length,e):(e.y+=10,t=this._generatePointsCircle(this.options.list.length,e)),this._animationSpiderfy(this.options.layer,this.options.list,t),this.options.map.on("click",this._unspiderfyWrapper,this),this.options.map.on("movestart",this._unspiderfyWrapper,this)},_unspiderfyWrapper:function(t){this.unSpiderfy(),this.options.map.off("click",this._unspiderfyWrapper,this),this.options.map.off("movestart",this._unspiderfyWrapper,this)},unSpiderfy:function(){if(this._spiderfy&&this._spiderfy.length>0){var t=this;o.each(this._spiderfy,(function(e,i){i._spiderLeg&&t.options.group.removeLayer(i._spiderLeg),t.options.group.removeLayer(i)})),t=null,this._spiderfy=void 0}},_animationSpiderfy:function(t,e,i){var o,n,a,s,r=this.options.group,l=this.options.map;this._spiderfy=[];var p={weight:1.5,color:"#222"};for(o=e.length-1;o>=0;o--)s=l.layerPointToLatLng(i[o]),(n=this.options.createIcon(e[o])).setLatLng(s),n.setZIndexOffset&&n.setZIndexOffset(1e6),r.addLayer(n),a=new L.Polyline([t.getLatLng(),s],p),r.addLayer(a),n._spiderLeg=a,this._spiderfy.push(n)},_generatePointsCircle:function(t,e){var i,o,n=2*Math.PI,a=Math.PI/6,s=this.options.spiderfyDistanceMultiplier*this.options.circleFootSeparation*(2+t)/n,r=n/t,l=[];for(l.length=t,i=t-1;i>=0;i--)o=a+i*r,l[i]=new L.Point(e.x+s*Math.cos(o),e.y+s*Math.sin(o))._round();return l},_generatePointsSpiral:function(t,e){var i,o=2*Math.PI,n=this.options.spiderfyDistanceMultiplier*this.options.spiralLengthStart,a=this.options.spiderfyDistanceMultiplier*this.options.spiralFootSeparation,s=this.options.spiderfyDistanceMultiplier*this.options.spiralLengthFactor,r=0,l=[];for(l.length=t,i=t-1;i>=0;i--)r+=a/n+5e-4*i,l[i]=new L.Point(e.x+n*Math.cos(r),e.y+n*Math.sin(r))._round(),n+=o*s/r;return l}})}.apply(e,[]))||(t.exports=n)}).call(this,i(219),i(1))},1845:function(t,e,i){"use strict";(function(o,n){var a,s,r=i(18);a=[i(1846),i(977)],void 0===(s=function(t,e){var i=new e;L.MarkerLayer=L.FeatureGroup.extend({_mapView:void 0,_map:void 0,_styleObject:{},_firstTime:!0,_legendControl:void 0,initialize:function(t){L.Util.setOptions(this,t),L.FeatureGroup.prototype.initialize.call(this,[])},addTo:function(t){return t.addLayer(this),this},onAdd:function(t){this._map=t,this.on("click",this.layerClick,this),this.getGeoData()},onRemove:function(t){this.off("click",this.layerClick,this),this._map=null,this._legendControl&&this._legendControl.hide(),L.FeatureGroup.prototype.onRemove.call(this,t)},setMapView:function(t){this._mapView=t},makeGeoQuery:function(){var t=o.extend({},this.options,{});return delete t.itemProperties,t.isCluster=!1,t},getGeoData:function(){var t=this,e=this.makeGeoQuery(),n=this._mapView.showLoadingData(this.options.layerName);i.getGeoData(e,(function(e){if(e&&""!=e){t._styleObject=t._mapView.generateStyleObject(e,t.options),t.updateControl();var i=[];o.each(e.points,(function(e,o){i.push(t.createIcon(o))})),t.applyClusterStyles(i,t._styleObject),i=null,t._mapView.options.autCenter&&(t._mapView.firstTime=!1,t._mapView.autoposition()),t._mapView.firstTime&&(t._mapView.firstTime=!1,t._mapView.autoposition())}t._mapView.hideLoadingData(n)}),(function(){t._mapView.hideLoadingData(n)}))},createIcon:function(t){var e="";this.options.labelField&&""!=this.options.labelField&&(e=o.isNumeric(t.labelRes)?(0,r.formatNumber)(t.labelRes,{decimalPlaces:1}):t.labelRes);var i=__customer.maps.markerLayer.iconOptions.iconSize,n={html:"<div></div>",iconSize:new L.Point(i,i),className:"marker-cluster marker-cluster-normal"};""!=e&&(n.html="<div><span>"+e+"</span></div>");var a=L.divIcon(n),s=[t.lat,t.lng],l={extraData:t,opacity:1};"icon"==this.options.markerType?this._styleObject.iconBy&&this._styleObject.iconBy(t.iconRes)&&(l.icon=L.icon({iconSize:[32,32],iconAnchor:[16,32]})):l.icon=a;return L.marker(s,l).addTo(this)},layerClick:function(t){if(t.layer&&t.layer.options&&t.layer.options.extraData){var e=t.layer.options.extraData;this._mapView.showInfoBubble(t,this.options,this.options.itemProperties,e.id)}},applyClusterStyles:function(t,e){e&&"circle"==this.options.markerType&&o.each(t,(function(t,i){var a=i.options.extraData,s=o(i._icon),r=s.find(">div");if(e.sizeBy){var l=__customer.maps.markerLayer.iconOptions.iconSize,p=e.sizeBy(a.sizeRes);p=parseInt(l+p),s.width(p).height(p).css("border-radius",p/2+"px"),r.width(p-10).height(p-10).css("border-radius",(p-10)/2+"px").css("line-height",p-10+"px")}if(e.colorBy){var c=e.colorBy(a.colorRes);if(c){var h=c.rgb();h&&(s.css("background-color","rgba("+parseInt(h[0])+","+parseInt(h[1])+","+parseInt(h[2])+", 0.4)"),h=n.rgb(h[0],h[1],h[2]).darken().rgb(),r.css("background-color","rgba("+parseInt(h[0])+","+parseInt(h[1])+","+parseInt(h[2])+", 0.4)"))}}}))},updateControl:function(){this._legendControl||(this._legendControl=L.control.legend({title:this.options.layerName}).addTo(this._map)),this._legendControl.updateStyles(this._styleObject,this.options)}}),L.markerLayer=function(t){return new L.MarkerLayer(t)}}.apply(e,a))||(t.exports=s)}).call(this,i(1),i(764))},1846:function(t,e,i){"use strict";(function(t,e){L.Control.Legend=L.Control.extend({options:{position:"bottomleft",fitBounds:!0,title:"Map Legend",disabled:!1},initialize:function(t){L.Util.setOptions(this,t)},onAdd:function(t){return this._initContainer()},_initContainer:function(){var t=this._container=L.DomUtil.create("div","leaflet-control-zoom leaflet-control-colorsize-selector leaflet-control-legend");return(this._title=L.DomUtil.create("span","legend-title",t)).innerHTML=this.options.title,t},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||L.DomUtil.addClass(this._container,"visible")},hide:function(t){this.isVisible()&&L.DomUtil.removeClass(this._container,"visible"),t&&L.DomEvent.stopPropagation(t)},setEnabled:function(t){this.options.disabled=!t,t||this.contract()},updateStyles:function(t,e){var i=!1;t&&(t.sizeBy&&(i=!0,this._sizeArea||(this._sizeArea=L.DomUtil.create("div","control-detail-area",this._container)),this.drawSize(t,e)),t.colorBy&&(i=!0,this._colorArea||(this._colorArea=L.DomUtil.create("div","control-detail-area",this._container)),t.colorChroma?this.drawColor(t,e):this.drawColorRanges(t.colorRange,e)),t.iconBy&&(i=!0,this._iconArea||(this._iconArea=L.DomUtil.create("div","control-detail-area",this._container)),this.drawIconRanges(t.iconRange,e))),i&&this.show()},drawColor:function(i,o){t(this._colorArea).empty();var n=L.DomUtil.create("div","colorsizebar",this._colorArea);L.DomUtil.create("span","title-by",n).innerHTML=o.colorField;var a,s=L.DomUtil.create("span","min",n),r=L.DomUtil.create("span","max",n),l=i.colorChroma;try{a=e.scale(l.colors()).domain(l.domain(),10).colors()}catch(t){}if(a){t.each(a,(function(e,i){var o=L.DomUtil.create("div","step",n);t(o).css("background-color",i)}))}s.innerHTML=i.colorRes.min,r.innerHTML=i.colorRes.max,isNaN(parseFloat(i.colorRes.min))||(s.innerHTML=parseFloat(i.colorRes.min).toFixed(2)),isNaN(parseFloat(i.colorRes.max))||(r.innerHTML=parseFloat(i.colorRes.max).toFixed(2))},drawSize:function(e,i){t(this._sizeArea).empty();var o=L.DomUtil.create("div","colorsizebar",this._sizeArea);L.DomUtil.create("span","title-by",o).innerHTML=i.sizeField;for(var n=L.DomUtil.create("span","min",o),a=L.DomUtil.create("span","max",o),s=0;s<5;s++){var r=L.DomUtil.create("div","step size",o),l=L.DomUtil.create("i","fa fa-circle",r);t(l).css("font-size",s+4+"px")}n.innerHTML=e.sizeRes.min,a.innerHTML=e.sizeRes.max,isNaN(parseFloat(e.sizeRes.min))||(n.innerHTML=parseFloat(e.sizeRes.min).toFixed(2)),isNaN(parseFloat(e.sizeRes.max))||(a.innerHTML=parseFloat(e.sizeRes.max).toFixed(2))},drawColorRanges:function(e,i){t(this._colorArea).empty(),L.DomUtil.create("span","title-by",this._colorArea).innerHTML=i.colorField;var o=this;t.each(e,(function(e,i){var n=L.DomUtil.create("div","",o._colorArea),a=L.DomUtil.create("div","step",n);t(a).css("background-color",i.color);var s=L.DomUtil.create("span","rangeLabel",n);s.innerHTML=i.from,i.to!=i.from&&(s.innerHTML+=" to "+i.to)}))},drawIconRanges:function(e,i){if(t(this._iconArea).empty(),!1!==e){L.DomUtil.create("span","title-by",this._iconArea).innerHTML=i.iconField;var o=this;t.each(e,(function(t,e){var i=L.DomUtil.create("div","",o._iconArea),n=(L.DomUtil.create("img","step",i),L.DomUtil.create("span","rangeLabel",i));n.innerHTML=e.from,e.to!=e.from&&(n.innerHTML+=" to "+e.to)}))}}}),L.control.legend=function(t){return new L.Control.Legend(t)}}).call(this,i(1),i(764))},1847:function(t,e,i){"use strict";(function(o){var n,a;n=[i(977)],void 0===(a=function(t){var e=new t;L.LineLayer=L.FeatureGroup.extend({_mapView:void 0,_map:void 0,_styleObject:{},_firstTime:!0,_legendControl:void 0,initialize:function(t){L.Util.setOptions(this,t),L.FeatureGroup.prototype.initialize.call(this,[])},addTo:function(t){return t.addLayer(this),this},onAdd:function(t){this._map=t,this.on("click",this.layerClick,this),this.getGeoData()},onRemove:function(t){this.off("click",this.layerClick,this),this._map=null,this._legendControl&&this._legendControl.hide(),L.FeatureGroup.prototype.onRemove.call(this,t)},setMapView:function(t){this._mapView=t},makeGeoQuery:function(){var t=o.extend({},this.options,{});return delete t.itemProperties,t.isCluster=!1,t},getGeoData:function(){var t=this,i=this.makeGeoQuery(),n=this._mapView.showLoadingData(this.options.layerName);e.getGeoData(i,(function(e){e&&""!=e&&(t._styleObject=t._mapView.generateStyleObject(e,t.options,5),t.updateControl(),o.each(e.points,(function(e,i){t.createLayer(i)})),(t._mapView.firstTime||t._mapView.options.autCenter)&&(t._mapView.firstTime=!1,t._mapView.autoposition())),t._mapView.hideLoadingData(n)}),(function(){t._mapView.hideLoadingData(n)}))},createLayer:function(t){var e;if(t.geoDef&&""!=t.geoDef){var i=JSON.parse(t.geoDef),o={color:"#03f",weight:5,extraData:t};switch(this.applyLayerStyles(o,t),i.type){case"polyline":e=L.polyline(i.latlngs,o).addTo(this);break;case"multipolyline":e=L.multiPolyline(i.latlngs,o).addTo(this);break;case"polygon":o.weight=2,e=L.polygon(i.latlngs,o).addTo(this);break;case"multipolygon":o.weight=2,e=L.multipolygon(i.latlngs,o).addTo(this)}}return e},layerClick:function(t){if(t.layer&&t.layer.options&&t.layer.options.extraData){var e=t.layer.options.extraData;this._mapView.showInfoBubble(t,this.options,this.options.itemProperties,e.id)}},applyLayerStyles:function(t,e){if(this._styleObject){if(this._styleObject.sizeBy){var i=this._styleObject.sizeBy(e.sizeRes);i=parseInt(3+i),t.weight=i}if(this._styleObject.colorBy){var o=this._styleObject.colorBy(e.colorRes);o&&(t.color=o.hex(),t.fillColor=o.hex(),t.fillOpacity=.8)}}},updateControl:function(){this._legendControl||(this._legendControl=L.control.legend({title:this.options.layerName}).addTo(this._map)),this._legendControl.updateStyles(this._styleObject,this.options)}}),L.lineLayer=function(t){return new L.LineLayer(t)}}.apply(e,n))||(t.exports=a)}).call(this,i(1))},973:function(t,e){L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1},initialize:function(t,e){L.Util.setOptions(this,e),this._type=google.maps.MapTypeId[t||"SATELLITE"]},onAdd:function(t,e){this._map=t,this._insertAtTheBottom=e,this._initContainer(),this._initMapObject(),t.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),t.on("move",this._update,this),this._reset(),this._update()},onRemove:function(t){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this)},getAttribution:function(){return this.options.attribution},setOpacity:function(t){this.options.opacity=t,t<1&&L.DomUtil.setOpacity(this._container,t)},_initContainer:function(){var t=this._map._container;first=t.firstChild,this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer"),t.insertBefore(this._container,first),this.setOpacity(this.options.opacity);var e=this._map.getSize();this._container.style.width=e.x+"px",this._container.style.height=e.y+"px",this._container.style.zIndex=0},_initMapObject:function(){this._google_center=new google.maps.LatLng(0,0);var t=new google.maps.Map(this._container,{center:this._google_center,zoom:0,mapTypeId:this._type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),e=this;this._reposition=google.maps.event.addListenerOnce(t,"center_changed",(function(){e.onReposition()})),t.backgroundColor="#ff0000",this._google=t},_resetCallback:function(t){this._reset(t.hard)},_reset:function(t){this._initContainer()},_update:function(){this._resize();var t=this._map.getBounds(),e=t.getNorthEast(),i=t.getSouthWest(),o=(new google.maps.LatLngBounds(new google.maps.LatLng(i.lat,i.lng),new google.maps.LatLng(e.lat,e.lng)),this._map.getCenter()),n=new google.maps.LatLng(o.lat,o.lng);this._google.setCenter(n),this._google.setZoom(this._map.getZoom())},_resize:function(){var t=this._map.getSize();this._container.style.width==t.x&&this._container.style.height==t.y||(this._container.style.width=t.x+"px",this._container.style.height=t.y+"px",google.maps.event.trigger(this._google,"resize"))},onReposition:function(){}})},977:function(t,e,i){"use strict";(function(o){var n,a=i(678);void 0===(n=function(){return o.Model.extend({getGeoData:function(t,e,i){(0,a.send)("geo/getGeoData/",t,{type:"GET"},e,i)},getGeoDetail:function(t,e,i){(0,a.send)("geo/getGeoDetail/",t,{type:"GET"},e,i)},getBubbleInfo:function(t,e,i){(0,a.send)("geo/getBubbleInfo/",t,{type:"GET"},e,i)}})}.apply(e,[]))||(t.exports=n)}).call(this,i(219))}}]);