/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[84,4],{1032:function(e,n,t){var a=t(690);function i(e){return e&&(e.__esModule?e.default:e)}e.exports=(a.default||a).template({compiler:[8,">= 4.3.0"],main:function(e,n,a,l,r){var s=null!=n?n:e.nullContext||{},o=e.escapeExpression;return'<div class="map-event-popup">\n\n    <div class="line input-prepend">\n        <span class="add-on">'+o(i(t(688)).call(s,"event_type",{name:"L",hash:{},data:r,loc:{start:{line:4,column:29},end:{line:4,column:47}}}))+'</span>\n\n        <select name="mapEventType" class="medium-selector input-xlarge">\n            <option value="none">'+o(i(t(688)).call(s,"none",{name:"L",hash:{},data:r,loc:{start:{line:7,column:33},end:{line:7,column:45}}}))+'</option>\n            <option value="relatednode">'+o(i(t(688)).call(s,"show_choice_from_related_node",{name:"L",hash:{},data:r,loc:{start:{line:8,column:40},end:{line:8,column:77}}}))+'</option>\n            <option value="link_dashboard">'+o(i(t(688)).call(s,"show_add_link_deashboard_to_info",{name:"L",hash:{},data:r,loc:{start:{line:9,column:43},end:{line:9,column:83}}}))+'</option>\n        </select>\n    </div>\n\n    <div class="line nodisplay eventTypeDetail" data-rel="relatednode">\n\n        <div class="line">\n            <span >'+o(i(t(688)).call(s,"related_node_explain",{name:"L",hash:{},data:r,loc:{start:{line:16,column:19},end:{line:16,column:47}}}))+'</span>\n        </div>\n\n        <div class="line input-prepend">\n            <span class="add-on">'+o(i(t(688)).call(s,"related_node",{name:"L",hash:{},data:r,loc:{start:{line:20,column:33},end:{line:20,column:53}}}))+'</span>\n            <select name="mapEventRelatedNode" class="medium-selector input-xlarge">\n                <option value="">'+o(i(t(688)).call(s,"searching",{name:"L",hash:{},data:r,loc:{start:{line:22,column:33},end:{line:22,column:50}}}))+'...</option>\n            </select>\n        </div>\n    </div>\n\n\n    <div class="line nodisplay eventTypeDetail" data-rel="link_dashboard">\n        <div class="line">\n            <span >'+o(i(t(688)).call(s,"link_deashboard_explain",{name:"L",hash:{},data:r,loc:{start:{line:30,column:19},end:{line:30,column:50}}}))+'</span>\n        </div>\n\n        <div class="line input-prepend">\n            <span class="add-on">'+o(i(t(688)).call(s,"dashboard",{name:"L",hash:{},data:r,loc:{start:{line:34,column:33},end:{line:34,column:50}}}))+'</span>\n            <select class="medium-selector input-xlarge dashboardLinked">\n                <option value="">'+o(i(t(688)).call(s,"loading",{name:"L",hash:{},data:r,loc:{start:{line:36,column:33},end:{line:36,column:48}}}))+'</option>\n            </select>\n        </div>\n\n\n        <table class="table table-hover table-nomargin table-condensed mapEventTable">\n            <thead>\n                <tr>\n                    <th width="50%">'+o(i(t(688)).call(s,"node_to_set",{name:"L",hash:{},data:r,loc:{start:{line:44,column:36},end:{line:44,column:55}}}))+'</th>\n                    <th width="50%">'+o(i(t(688)).call(s,"value_to_set",{name:"L",hash:{},data:r,loc:{start:{line:45,column:36},end:{line:45,column:56}}}))+'</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr class="nodisplay template">\n                    <td>\n                        <input class="input-medium nodename" type="text" >\n                        <button class="btn btn-satblue btn-mini btnSearchNode"><i class="fa fa-search"></i></button>\n                    </td>\n                    <td>\n                        <select class="medium-selector input-xlarge attribute_selector">\n                        </select>\n                    </td>\n                </tr>\n\n            </tbody>\n\n        </table>\n\n        \n\n        \n    </div>\n\n    \n\n\n</div>'},useData:!0})},683:function(e,n,t){"use strict";(function(a){var i;void 0===(i=function(){return a.Controller.extend({name:"showModal",show:function(e){Promise.all([t.e(2),t.e(116)]).then(function(){var n=[t(701)];(function(n){(new n).render(e)}).apply(null,n)}).catch(t.oe)}})}.apply(n,[]))||(e.exports=i)}).call(this,t(694))},862:function(e,n,t){"use strict";(function(a,i){var l,r,s=t(18);l=[t(683),t(1032)],void 0===(r=function(e,n){return a.View.extend({el:i("body"),relatedInitiated:!1,linkInitiated:!1,render:function(t){var a=n(),l=t,r=this;(new e).show({title:(0,s.translate)("map_events"),html:a,height:500,modalClass:"__conditional-format-popup",buttons:[{title:(0,s.translate)("yes"),css:"primary",code:"yes"},{title:(0,s.translate)("cancel"),code:"cancel"}],callback:function(e,n){if("yes"==e){var t=l.getView();if(t){var a,i=n.find("select[name='mapEventType']").val();switch(i){case"relatednode":a={relatedNode:n.find("select[name='mapEventRelatedNode']").val()};break;case"link_dashboard":a={dashboardId:n.find("select.dashboardLinked").val(),dashboardName:n.find("select.dashboardLinked").select2("data").text,params:r.getLinkDashboardParams(n)}}a&&t.setMapEventData(a),t.setMapEventType(i)}}},onLoad:function(e){e.find("select[name='mapEventType']").on("change",function(){var n=i(this).val();e.find("div.eventTypeDetail").hide(),e.find("div.eventTypeDetail[data-rel='"+n+"']").show(),"relatednode"==n&&r.searchRelatedNodes(e,l),"link_dashboard"==n&&r.initiateLinkDashboard(e,l)});var n=l.getView();n.currentResult&&n.currentResult.itemProperties&&n.currentResult.itemProperties.map&&n.currentResult.itemProperties.map.event&&(e.find("select[name='mapEventType']").val(n.currentResult.itemProperties.map.event.type),e.find("select[name='mapEventType']").trigger("change"))}})},searchRelatedNodes:function(e,n){if(!this.relatedInitiated){this.relatedInitiated=!0;var a=n.getView(),l=e.find("select[name='mapEventRelatedNode']");l.html(""),l.append(i("<option />").val("").text((0,s.translate)("searching")));var r=a.currentResult.itemProperties.map.drawIndexes[0];r&&""!=r&&Promise.resolve().then(function(){var e=[t(219)];(function(e){(new e).getOutputs(r,function(e){l.empty(""),i.each(e,function(){l.append(i("<option />").val(this.id).text(this.name))}),a.currentResult.itemProperties.map&&a.currentResult.itemProperties.map.event&&a.currentResult.itemProperties.map.event.eventData&&a.currentResult.itemProperties.map.event.eventData.relatedNode&&l.val(a.currentResult.itemProperties.map.event.eventData.relatedNode)})}).apply(null,e)}).catch(t.oe)}},initiateLinkDashboard:function(e,n){if(!this.linkInitiated){var a=this;this.linkInitiated=!0;var l=n.getView();if(l.currentResult&&l.currentResult.itemProperties&&l.currentResult.itemProperties.map&&l.currentResult.itemProperties.map.attrByDim&&"-1"!=l.currentResult.itemProperties.map.attrByDim){var r=l.currentResult.itemProperties.map.attrByDim;l.model.getIndexValues({id:r},function(n){var t=n.results;t&&(i.each(t,function(n,t){i("<option value='"+t.value+"'>"+t.value+"</option>").appendTo(e.find(".attribute_selector"))}),l.currentResult&&l.currentResult.itemProperties&&l.currentResult.itemProperties.map&&l.currentResult.itemProperties.map.event&&"link_dashboard"==l.currentResult.itemProperties.map.event.type&&a.loadLinkDashboardData(e,l.currentResult.itemProperties.map.event.eventData),a.ensureOneRowFree(e))})}e.on("click","button.btnSearchNode",function(){var e=i(this);t.e(3).then(function(){var n=[t(700)];(function(n){(new n).searchNode(function(n){e.closest("tr").find("input.nodename").val(n.id).trigger("change")})}).apply(null,n)}).catch(t.oe)});var o=e.find("select.dashboardLinked");o.select2({width:230,minimumResultsForSearch:1,escapeMarkup:function(e){return e}}),t.e(12).then(function(){var e=[t(744)];(function(e){(new e).show(o,{complete:function(){o.parent().find(".select2-chosen").html((0,s.translate)("select_dashboard")),l.currentResult&&l.currentResult.itemProperties&&l.currentResult.itemProperties.map&&l.currentResult.itemProperties.map.event&&"link_dashboard"==l.currentResult.itemProperties.map.event.type&&o.select2("val",l.currentResult.itemProperties.map.event.eventData.dashboardId)}})}).apply(null,e)}).catch(t.oe),e.find(".mapEventTable").on("change","input.nodename",function(){a.ensureOneRowFree(e)})}},ensureOneRowFree:function(e){var n=e.find(".mapEventTable"),t=!1;if(1==n.find("tbody tr").length?t=!0:(t=!0,n.find("tbody tr").each(function(e,n){i(n).hasClass("template")||""!=i(n).find("input.nodename").val()||(t=!1)})),t){var a=n.find("tbody tr").first().html();i("<tr/>").append(a).appendTo(n.find("tbody"))}var l=0;n.find("tbody tr").each(function(e,n){i(n).hasClass("template")||""!=i(n).find("input.nodename").val()||l++}),l>1&&n.find("tbody tr").each(function(e,n){if(!i(n).hasClass("template")&&""==i(n).find("input.nodename").val()&&(l++,i(n).remove(),1==l))return!1})},getLinkDashboardParams:function(e){var n=[];return e.find(".mapEventTable").find("tbody tr").each(function(e,t){i(t).hasClass("template")||""==i(t).find("input.nodename").val()||n.push({node:i(t).find("input.nodename").val(),attribute:i(t).find("select.attribute_selector").val()})}),n},loadLinkDashboardData:function(e,n){if(n.params){var t=e.find(".mapEventTable");i.each(n.params,function(e,n){var a=t.find("tbody tr").first().html(),l=i("<tr/>").append(a).appendTo(t.find("tbody"));l.find("input.nodename").val(n.node),l.find("select.attribute_selector").val(n.attribute)})}}})}.apply(n,l))||(e.exports=r)}).call(this,t(218),t(1))}}]);