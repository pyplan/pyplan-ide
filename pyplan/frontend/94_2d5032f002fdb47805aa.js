/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{686:function(e,t,n){"use strict";(function(o,r){var s,i,a=n(18);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=(c(i={},0,"info"),c(i,1,"success"),c(i,2,"error"),i);void 0===(s=function(){return o.Controller.extend({name:"ws",socket:void 0,changeSessionKey:function(e,t){this.socket?(this.socket.send(JSON.stringify({command:"leave",room:e,message:"Leaving!"})),this.socket.send(JSON.stringify({command:"join",room:t,message:"Joining!"}))):this.start()},start:function(){var e=__currentSession.company_code;this.socket=new WebSocket("".concat(__wsURL,"/notifications/").concat(e,"/?apiKey=").concat(__currentToken)),this.events()},events:function(){var e=this,t=__currentSession,n=(t.company_code,t.session_key);this.socket.onopen=function(t){e.socket.send(JSON.stringify({command:"join",room:n,message:"Joining!"}))},this.socket.onmessage=this.processMessage,this.socket.onclose=function(t){console.log("Client notified socket has closed",t),setTimeout(function(){e.start()},5e3)}},triggerEvent:function(e,t){this.socket&&this.socket.connected&&this.socket.send({type:e,session_key:__currentSession.session_key,message:t})},processMessage:function(e){var t,o=function(e){(0,a.showMessage)(e.message?(0,a.translate)(e.message):"",e.title?(0,a.translate)(e.title):"",e.not_level?u[e.not_level]:"info",-1,!1)},r=(c(t={},0,function(e){o(e)}),c(t,1,function(e){o(e),setTimeout(function(){location.reload()},2e3)}),c(t,4,function(e){!function(e){Promise.all([n.e(2),n.e(4),n.e(55)]).then(function(){var t=[n(696)];(function(t){(new t).showProgressBar(e)}).apply(null,t)}).catch(n.oe)}(e)}),t);if(e){var s=JSON.parse(e.data);s&&(s.title||s.message||"number"==typeof s.progress)&&"number"==typeof s.msg_type&&r[s.msg_type]&&r[s.msg_type](s)}},to_delete_processMessage:function(e){if(e){var t=JSON.parse(e.data);switch(t.msg_type){case"MemoryQuotaExceeded":r("body").trigger("memoryQuotaExceeded",[t.body]);break;case"ProcessCancelByMemoryQuotaExceeded":var o=(0,a.translate)("process_cancel_by_quota").replace("##quota##",t.body.memoryQuota).replace("##current##",t.body.modelMemory);(0,a.showMessage)(o,void 0,"error");break;case"modelmsgbox":Promise.all([n.e(2),n.e(4),n.e(55)]).then(function(){var e=[n(696)];(function(e){(new e).showMsgBox(t.body)}).apply(null,e)}).catch(n.oe);break;case"DashboardShareAfterSave":r("#model-summary").trigger("reloadShared",[t.body]);break;case"loadInputTemplate":case"unloadInputTemplate":case"setInputTemplatePos":case"setInputTemplateValues":r(".inputFormTask").trigger("collabMessage",[t.event,t.body]);break;case"ModelEditionAvailable":t&&t.body&&t.body.message&&((0,a.showMessage)(t.body.message,void 0,"info"),__currentSession.modelInfo&&__currentSession.modelInfo.uri==t.body.modelfile&&n.e(106).then(function(){var e=[n(219)];(function(e){(new e).canEdit()&&(r("#navigation li.modelopened[data-key='btnSaveModel']").show(),r("#navigation li.modelopened[data-key='btnSaveModelAs']").show())}).apply(null,e)}).catch(n.oe))}}}})}.apply(t,[]))||(e.exports=s)}).call(this,n(694),n(1))},694:function(e,t,n){var o,r;!function(s,i){if(!s.BackboneMVC){var a=s.BackboneMVC={};o=[n(218),n(220),n(1)],void 0===(r=function(e,t,n){return function(e,t,n,o,r){"use strict";if(void 0===n||void 0===o)return;var s=function(){function e(){this._created=(new Date).getTime()}return o.extend(e.prototype,{_created:null}),e.extend=function(t){var n,r=function(){return void 0!==n?n:(e.apply(this,arguments),void 0!==this.initialize&&this.initialize.apply(this,arguments),n=this)};return r.prototype=new e,o.extend(r.prototype,t),r.prototype.constructor=r,r.prototype.classId=o.uniqueId("controller_"),r},e}();o.extend(t,{namespace:function(t){for(var n=t.split("."),o=e,r=0,s=n.length;r<s;r++)void 0===o[n[r]]&&(o[n[r]]={}),o=o[n[r]]},Controller:{beforeFilter:function(){return(new r.Deferred).resolve()},afterRender:function(){return(new r.Deferred).resolve()},checkSession:function(){return(new r.Deferred).resolve(!0)},default:function(){return!0}},Router:function(){var e={_history:[],routes:{"*components":"dispatch"},dispatch:function(e){var t,n=(e||"").replace(/\/+$/g,"").split("/");if(i[n[0]]?t=n[0]:void 0!==i[l(n[0])]?t=l(n[0]):void 0!==i[f(n[0])]&&(t=f(n[0])),void 0===t)return this[404]();var s=new i[t],a=n.length>1?n[1]:"default";if("function"!=typeof s._actions[a])return this[404]();var d=n.length>2?o.rest(n,2):[];return function(e,t,n,r){e._history.length>888&&(e._history=o.last(e._history,888));e._history.push([t,n,r])}(this,t,a,d),function(e,t,n){var o=new i[e],s=[t].concat(n),a=r.Deferred(),l=o.beforeFilter.apply(o,s);c(l)?a=l:u(a,l);"function"==typeof o._secureActions[t]&&(a=a.pipe(function(){var e=o.checkSession.apply(o,n);return c(e)?e:u(new r.Deferred,e)}));return a=(a=a.pipe(function(){var e=o[t].apply(o,n);return c(e)?e:u(new r.Deferred,e)})).pipe(function(){var e=o.afterRender.apply(o,s);return c(e)?e:u(new r.Deferred,e)})}(t,a,d)},404:function(){},getLastAction:function(){return o.last(this._history,1)[0]},navigate:function(e,t){t&&!0!==t||(t={trigger:t});var s=o.extend({},t);return s.trigger=!1,n.Router.prototype.navigate.call(this,e,s),t.trigger?this.dispatch(e):(new r.Deferred).resolve()}};function t(t){var r=o.extend(t.routes||{},e.routes);return n.Router.extend(o.extend({},e,t,{routes:r}))}var s=n.Router.extend(o.extend({extend:t},e));return s.extend=t,s}(),Model:{extend:function(e){return e=o.extend({__fetchSuccessCallback:null,__fetchErrorCallback:null,fetch:function(e){var t=(e=e||{}).success;e.success=function(e,n){if(t&&t(e,n),e.__fetchSuccessCallback){var o=e.__fetchSuccessCallback;e.__fetchSuccessCallback=null,o.apply(e)}};var r=e.error;e.error=function(e,t){r&&r(e,t),e.trigger("error",r)},n.Model.prototype.fetch.apply(this,[e].concat(o.rest(arguments)))},parse:function(e){return this.__fetchSuccessCallback=null,this.__fetchErrorCallback=null,!e||e.error?(this.trigger("error",e&&e.error||e),{}):(this.__fetchSuccessCallback=function(){this.trigger("read",e.data)}.bind(this),e.data)}},e),n.Model.extend(e)}}}),t.Controller.extend=function e(n,r){return function(n){var c=n.name;if(void 0===c)throw"'name' property is mandatory ";n=o.extend({},r,n);var u=o.extend({},t.Controller),l={},f={};o.each(n,function(e,t){if(u[t]=e,"function"!=typeof e||"_"===t[0]||o.indexOf(a,t)>=0)return!1;if(l[t]=e,t.match(/^user_/i)){f[t]=e;var r=t.replace(/^user_/i,"");"function"!=typeof n[r]&&(f[r]=e,l[r]=e)}}),o.extend(u,l,{_actions:l,_secureActions:f}),"extend"in u&&delete u.extend;var d=s.extend(u);return o.extend(d,{extend:e(d,o.extend({},r,n))}),i[c]=d,d}}(t.Controller,{});var i={},a=["initialize","beforeFilter","afterRender","checkSession"];function c(e){return o.isObject(e)&&e.promise&&"function"==typeof e.promise}function u(e,t){return void 0===t&&(t=!0),e[t?"resolve":"reject"](t)}function l(e){return"string"!=typeof e?null:(e=e.replace(/\s{2,}/g," "),o.map(e.split(" "),function(e){return e.replace(/(^|_)[a-z]/gi,function(e){return e.toUpperCase()}).replace(/_/g,"")}).join(" "))}function f(e){return"string"!=typeof e?null:(e=e.replace(/\s{2,}/g," "),o.map(e.split(" "),function(e){return e.replace(/^[A-Z]/g,function(e){return e.toLowerCase()}).replace(/([a-z])([A-Z])/g,function(e,t,n){return t+"_"+n.toLowerCase()})}).join(" "))}}(s,a,e,t,n),a}.apply(t,o))||(e.exports=r)}}(this)}}]);