/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{686:function(e,t,n){"use strict";(function(r,o){var s,i,a=n(18);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=(c(i={},0,"info"),c(i,1,"success"),c(i,2,"error"),i);void 0===(s=function(){return r.Controller.extend({name:"ws",socket:void 0,changeSessionKey:function(e,t){this.socket?(this.socket.send(JSON.stringify({command:"leave",room:e,message:"Leaving!"})),this.socket.send(JSON.stringify({command:"join",room:t,message:"Joining!"}))):this.start()},start:function(){var e=__currentSession.company_code;this.socket=new WebSocket("".concat(__wsURL,"/notifications/").concat(e,"/?apiKey=").concat(__currentToken)),this.events()},events:function(){var e=this,t=__currentSession.session_key;this.socket.onopen=function(n){e.socket.send(JSON.stringify({command:"join",room:t,message:"Joining!"}))},this.socket.onmessage=this.processMessage,this.socket.onclose=function(t){console.log("Client notified socket has closed",t),setTimeout(function(){e.start()},5e3)}},triggerEvent:function(e,t){this.socket&&this.socket.connected&&this.socket.send({type:e,session_key:__currentSession.session_key,message:t})},processMessage:function(e){var t,r=function(e){(0,a.showMessage)(e.message?(0,a.translate)(e.message):"",e.title?(0,a.translate)(e.title):"",e.not_level?u[e.not_level]:"info",-1,!1)},s=(c(t={},0,function(e){r(e)}),c(t,1,function(e){r(e),setTimeout(function(){location.reload()},2e3)}),c(t,4,function(e){!function(e){Promise.all([n.e(2),n.e(4),n.e(55)]).then(function(){var t=[n(696)];(function(t){(new t).showProgressBar(e)}).apply(null,t)}).catch(n.oe)}(e)}),c(t,5,function(e){o("#main-modal").trigger("progress",e)}),t);if(e){var i=JSON.parse(e.data);i&&(i.title||i.message||"number"==typeof i.progress)&&"number"==typeof i.msg_type&&s[i.msg_type]&&s[i.msg_type](i)}},to_delete_processMessage:function(e){if(e){var t=JSON.parse(e.data);switch(t.msg_type){case"MemoryQuotaExceeded":o("body").trigger("memoryQuotaExceeded",[t.body]);break;case"ProcessCancelByMemoryQuotaExceeded":var r=(0,a.translate)("process_cancel_by_quota").replace("##quota##",t.body.memoryQuota).replace("##current##",t.body.modelMemory);(0,a.showMessage)(r,void 0,"error");break;case"modelmsgbox":Promise.all([n.e(2),n.e(4),n.e(55)]).then(function(){var e=[n(696)];(function(e){(new e).showMsgBox(t.body)}).apply(null,e)}).catch(n.oe);break;case"DashboardShareAfterSave":o("#model-summary").trigger("reloadShared",[t.body]);break;case"loadInputTemplate":case"unloadInputTemplate":case"setInputTemplatePos":case"setInputTemplateValues":o(".inputFormTask").trigger("collabMessage",[t.event,t.body]);break;case"ModelEditionAvailable":t&&t.body&&t.body.message&&((0,a.showMessage)(t.body.message,void 0,"info"),__currentSession.modelInfo&&__currentSession.modelInfo.uri==t.body.modelfile&&n.e(106).then(function(){var e=[n(219)];(function(e){(new e).canEdit()&&(o("#navigation li.modelopened[data-key='btnSaveModel']").show(),o("#navigation li.modelopened[data-key='btnSaveModelAs']").show())}).apply(null,e)}).catch(n.oe))}}}})}.apply(t,[]))||(e.exports=s)}).call(this,n(694),n(1))},694:function(e,t,n){var r,o;!function(s,i){if(!s.BackboneMVC){var a=s.BackboneMVC={};r=[n(218),n(220),n(1)],void 0===(o=function(e,t,n){return function(e,t,n,r,o){"use strict";if(void 0===n||void 0===r)return;var s=function(){function e(){this._created=(new Date).getTime()}return r.extend(e.prototype,{_created:null}),e.extend=function(t){var n,o=function(){return void 0!==n?n:(e.apply(this,arguments),void 0!==this.initialize&&this.initialize.apply(this,arguments),n=this)};return o.prototype=new e,r.extend(o.prototype,t),o.prototype.constructor=o,o.prototype.classId=r.uniqueId("controller_"),o},e}();r.extend(t,{namespace:function(t){for(var n=t.split("."),r=e,o=0,s=n.length;o<s;o++)void 0===r[n[o]]&&(r[n[o]]={}),r=r[n[o]]},Controller:{beforeFilter:function(){return(new o.Deferred).resolve()},afterRender:function(){return(new o.Deferred).resolve()},checkSession:function(){return(new o.Deferred).resolve(!0)},default:function(){return!0}},Router:function(){var e={_history:[],routes:{"*components":"dispatch"},dispatch:function(e){var t,n=(e||"").replace(/\/+$/g,"").split("/");if(i[n[0]]?t=n[0]:void 0!==i[l(n[0])]?t=l(n[0]):void 0!==i[f(n[0])]&&(t=f(n[0])),void 0===t)return this[404]();var s=new i[t],a=n.length>1?n[1]:"default";if("function"!=typeof s._actions[a])return this[404]();var d=n.length>2?r.rest(n,2):[];return function(e,t,n,o){e._history.length>888&&(e._history=r.last(e._history,888));e._history.push([t,n,o])}(this,t,a,d),function(e,t,n){var r=new i[e],s=[t].concat(n),a=o.Deferred(),l=r.beforeFilter.apply(r,s);c(l)?a=l:u(a,l);"function"==typeof r._secureActions[t]&&(a=a.pipe(function(){var e=r.checkSession.apply(r,n);return c(e)?e:u(new o.Deferred,e)}));return a=(a=a.pipe(function(){var e=r[t].apply(r,n);return c(e)?e:u(new o.Deferred,e)})).pipe(function(){var e=r.afterRender.apply(r,s);return c(e)?e:u(new o.Deferred,e)})}(t,a,d)},404:function(){},getLastAction:function(){return r.last(this._history,1)[0]},navigate:function(e,t){t&&!0!==t||(t={trigger:t});var s=r.extend({},t);return s.trigger=!1,n.Router.prototype.navigate.call(this,e,s),t.trigger?this.dispatch(e):(new o.Deferred).resolve()}};function t(t){var o=r.extend(t.routes||{},e.routes);return n.Router.extend(r.extend({},e,t,{routes:o}))}var s=n.Router.extend(r.extend({extend:t},e));return s.extend=t,s}(),Model:{extend:function(e){return e=r.extend({__fetchSuccessCallback:null,__fetchErrorCallback:null,fetch:function(e){var t=(e=e||{}).success;e.success=function(e,n){if(t&&t(e,n),e.__fetchSuccessCallback){var r=e.__fetchSuccessCallback;e.__fetchSuccessCallback=null,r.apply(e)}};var o=e.error;e.error=function(e,t){o&&o(e,t),e.trigger("error",o)},n.Model.prototype.fetch.apply(this,[e].concat(r.rest(arguments)))},parse:function(e){return this.__fetchSuccessCallback=null,this.__fetchErrorCallback=null,!e||e.error?(this.trigger("error",e&&e.error||e),{}):(this.__fetchSuccessCallback=function(){this.trigger("read",e.data)}.bind(this),e.data)}},e),n.Model.extend(e)}}}),t.Controller.extend=function e(n,o){return function(n){var c=n.name;if(void 0===c)throw"'name' property is mandatory ";n=r.extend({},o,n);var u=r.extend({},t.Controller),l={},f={};r.each(n,function(e,t){if(u[t]=e,"function"!=typeof e||"_"===t[0]||r.indexOf(a,t)>=0)return!1;if(l[t]=e,t.match(/^user_/i)){f[t]=e;var o=t.replace(/^user_/i,"");"function"!=typeof n[o]&&(f[o]=e,l[o]=e)}}),r.extend(u,l,{_actions:l,_secureActions:f}),"extend"in u&&delete u.extend;var d=s.extend(u);return r.extend(d,{extend:e(d,r.extend({},o,n))}),i[c]=d,d}}(t.Controller,{});var i={},a=["initialize","beforeFilter","afterRender","checkSession"];function c(e){return r.isObject(e)&&e.promise&&"function"==typeof e.promise}function u(e,t){return void 0===t&&(t=!0),e[t?"resolve":"reject"](t)}function l(e){return"string"!=typeof e?null:(e=e.replace(/\s{2,}/g," "),r.map(e.split(" "),function(e){return e.replace(/(^|_)[a-z]/gi,function(e){return e.toUpperCase()}).replace(/_/g,"")}).join(" "))}function f(e){return"string"!=typeof e?null:(e=e.replace(/\s{2,}/g," "),r.map(e.split(" "),function(e){return e.replace(/^[A-Z]/g,function(e){return e.toLowerCase()}).replace(/([a-z])([A-Z])/g,function(e,t,n){return t+"_"+n.toLowerCase()})}).join(" "))}}(s,a,e,t,n),a}.apply(t,r))||(e.exports=o)}}(this)}}]);