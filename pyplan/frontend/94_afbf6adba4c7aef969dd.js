/*! Copyright Pyplan 2020. All rights reserved. */
(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{1382:function(e,n,t){"use strict";(function(o,r){var a,s=t(693);void 0===(a=function(){return o.Model.extend({errorLog:[],errorStack:[],tryTimeOut:-1,manageError:function(e,n){var t=!0;t=!1,this.addToErrorStack(e,n),t&&this.displayError(n)},addToErrorStack:function(e,n){clearTimeout(this.tryTimeOut),this.showNetworkProblem(),this.errorStack.push(e),this.logError(e,n);var t=this;this.tryTimeOut=setTimeout(function(){t.retrying(),t=null},5e3)},retrying:function(){for(this.hideNetworkProblem();this.errorStack.length>0;){var e=this.errorStack.pop();7==e.length?(0,s.send)(e[0],e[1],e[2],e[3],e[4],e[5],e[6]):6==e.length?(0,s.send)(e[0],e[1],e[2],e[3],e[4],e[5]):5==e.length?(0,s.send)(e[0],e[1],e[2],e[3],e[4]):4==e.length?(0,s.send)(e[0],e[1],e[2],e[3]):3==e.length?(0,s.send)(e[0],e[1],e[2]):2==e.length?(0,s.send)(e[0],e[1]):1==e.length&&(0,s.send)(e[0])}},displayError:function(e){var n,o;try{n=e[0],e[1],o=e[2]}catch(e){}r("#mainLoading").hide();var a=o;try{var s=r.parseJSON(n.responseText);s.hasOwnProperty("hasError")&&(a=s.error)}catch(e){}Promise.all([t.e(2),t.e(18)]).then(function(){var e=[t(685)];(function(e){(new e).show({title:"WARNING!",text:"Could not contact server "+__apiURL+" "+a,notifyType:"error"})}).apply(null,e)}).catch(t.oe)},showNetworkProblem:function(){r("#networkError").show()},hideNetworkProblem:function(){r("#networkError").hide()},logError:function(e,n){try{var t=e[0],o="ready:"+n[0].readyState+" status:"+n[0].status+" - "+n[1];n.length>2&&(o+=" - server: "+n[2]),this.errorLog.push({timestamp:new Date,uri:t,error:o})}catch(e){}}})}.apply(n,[]))||(e.exports=a)}).call(this,t(218),t(1))},687:function(e,n,t){"use strict";(function(o,r,a){var s,i,c=t(18),u=t(693),l=!1;s=[t(1382)],void 0===(i=function(e){r.history.loadUrl=function(e){var n=this;return"#"!==(e=""!==this.getFragment(e)?this.fragment=this.getFragment(e):this.fragment)&&o.any(this.handlers,function(t){return(-1===n.fragment.indexOf("loginas")&&-1===n.fragment.toLowerCase().indexOf("fromtoken")&&-1===n.fragment.toLowerCase().indexOf("login")||null===__currentSession)&&(t.route.test(e)?(t.callback(e),!0):void 0)})},__errorManager=new e;var n=function(e,n){t.e(27).then(function(){var o=[t(724)];(function(t){(new t).useExternalLink(e,n)}).apply(null,o)}).catch(t.oe)};Promise.all([t.e(2),t.e(18)]).then(function(){var e=[t(685)];(function(e){}).apply(null,e)}).catch(t.oe);return{initialize:function(){t.e(97).then(function(){var e=[t(917)];(function(e){(new e).loadPlugins()}).apply(null,e)}).catch(t.oe);var e=function(e,n,o,r,s,i){t.e(98).then(function(){var c=[t(879)];(function(t){(new t).showLogin(e,n,o,r,s,i),a("#cubePlanLoader").hide()}).apply(null,c)}).catch(t.oe)},o=new(r.Router.extend({routes:{"dashboard/:action/:id/:token":"dashboardRoute","share/:guid":"shareRoute","dash/:guid":"sharedDashboardRoute","shared/:guid":"newSharedDashboardRoute","dash/:guid/:nodeId/:definition":"sharedDashboardRouteWithDefinition",login:"login","loginas/:userId/:token":"loginas","resetpassword/:query":"resetPasswordRoute","fromToken/:token":"fromTokenRoute","*action":"defaultRoute"}}));o.on("route:defaultRoute",function(n){try{if(l)return;var t=new URLSearchParams(window.location.search);if(t.has("code")&&t.has("state")){var o=t.get("code"),r=(t.get("state"),__uiURL);a.ajax({url:"".concat(__apiURL,"/rest-auth/linkedin/token/?code=").concat(o,"&redirect_uri=").concat(r),method:"GET",success:function(n){var t=n.access_token;a.ajax({url:"".concat(__apiURL,"/rest-auth/linkedin/"),method:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify({code:o,access_token:t}),success:function(n){__currentToken=n.token,(0,u.ajaxSetup)(),e(null,null,null,null,n,!0),window.history.replaceState({},document.title,"/")},error:function(e){window.history.replaceState({},document.title,"/")}})},error:function(e){window.history.replaceState({},document.title,"/")}})}else e()}catch(n){e()}}),o.on("route:sharedDashboardRoute",function(e){n(e,function(e,n){200===n.status&&(e.session.loginDashboardId=e.entity_id,__currentToken=e.token,__currentSession=e.session,__currentSession.fromEmbedded=!0,(0,c.setProcessDictionary)(e.session.process),(0,u.ajaxSetup)(),a("body").addClass("external"),Promise.all([t.e(2),t.e(6),t.e(19),t.e(26),t.e(58)]).then(function(){var n=[t(918)];(function(n){(new n).render(e)}).apply(null,n)}).catch(t.oe))})}),o.on("route:newSharedDashboardRoute",function(e){n(e,function(e){e&&(e.session.loginDashboardId=e.entity_id,"report"===e.entity_type&&(e.session.loginDashboardId=e.extra_data[0]),__currentToken=e.token,__currentSession=e.session,__currentSession.fromEmbedded=!0,(0,c.setProcessDictionary)(e.session.process),(0,u.ajaxSetup)(),Promise.all([t.e(20),t.e(57)]).then(function(){var e=[t(686)];(function(e){(new e).changeToken(__currentToken)}).apply(null,e)}).catch(t.oe),a("body").addClass("external"),Promise.all([t.e(2),t.e(6),t.e(26),t.e(47),t.e(99)]).then(function(){var n=[t(1448)];(function(n){(new n).render(e)}).apply(null,n)}).catch(t.oe))})}),o.on("route:sharedDashboardRouteWithDefinition",function(e,o,r){n(e,function(e,n){200===n.status&&(e.session.loginDashboardId=e.entity_id,__currentToken=e.token,__currentSession=e.session,__currentSession.fromEmbedded=!0,(0,c.setProcessDictionary)(e.session.process),(0,u.ajaxSetup)(),a("body").addClass("external"),t.e(100).then(function(){var n=[t(219)];(function(n){var a=new n,s=[{name:"definition",value:r}];a.setNodeProperties(o,s,function(n){n&&Promise.all([t.e(2),t.e(6),t.e(19),t.e(26),t.e(203)]).then(function(){var n=[t(918)];(function(n){(new n).render(e)}).apply(null,n)}).catch(t.oe)})}).apply(null,n)}).catch(t.oe))})}),o.on("route:shareRoute",function(e){n(e,function(e,n){200===n.status&&(__currentToken=e.token,__currentSession=e.session,__currentSession.fromEmbedded=!0,(0,c.setProcessDictionary)(e.session.process),(0,u.ajaxSetup)(),a("body").addClass("external"),Promise.all([t.e(2),t.e(6),t.e(19),t.e(26),t.e(58)]).then(function(){var n=[t(918)];(function(n){(new n).render(e)}).apply(null,n)}).catch(t.oe))})}),o.on("route:login",function(){l=!0,e()}),o.on("route:loginas",function(n,o){t.e(27).then(function(){var r=[t(724)];(function(r){(new r).loginas(n,o,-1,function(e){Promise.all([t.e(2),t.e(6),t.e(43)]).then(function(){var e=[t(684)];(function(e){(new e).showApp()}).apply(null,e)}).catch(t.oe)},function(t){e(!1,t,!0,n,o)})}).apply(null,r)}).catch(t.oe)}),o.on("route:fromTokenRoute",function(n){t.e(27).then(function(){var o=[t(724)];(function(o){(new o).loginFromToken(n,function(e){Promise.all([t.e(2),t.e(6),t.e(43)]).then(function(){var e=[t(684)];(function(e){(new e).showApp()}).apply(null,e)}).catch(t.oe)},function(n){e()})}).apply(null,o)}).catch(t.oe)}),o.on("route:dashboardRoute",function(e,n,o){!function(e,n){t.e(27).then(function(){var o=[t(724)];(function(t){(new t).createFromToken(e,n)}).apply(null,o)}).catch(t.oe)}(o,function(){switch(e.toLowerCase()){case"view":a("body").addClass("external"),Promise.all([t.e(2),t.e(6),t.e(19),t.e(101)]).then(function(){var e=[t(748)];(function(e){(new e).render(n,!1,!1,{external:!0})}).apply(null,e)}).catch(t.oe)}})}),o.on("route:resetPasswordRoute",function(e){a("body").css("background-color","#368ee0"),Promise.all([t.e(2),t.e(102)]).then(function(){var n=[t(1452)];(function(n){var t=new n,o={query:e};t.render(o)}).apply(null,n)}).catch(t.oe)}),r.history.start()}}}.apply(n,s))||(e.exports=i)}).call(this,t(220),t(218),t(1))},693:function(e,n,t){"use strict";t.r(n),function(e){t.d(n,"ajaxSetup",function(){return r}),t.d(n,"send",function(){return a});var o=t(18);function r(n=null){e.ajaxSetup({...{dataType:"json",crossDomain:!0,headers:{Authorization:`Token ${__currentToken}`,"session-key":__currentSession?__currentSession.session_key:""}},...()=>n||{}})}function a(n,r,a,s,i,c,u){a||(a=new Object),c||e("#secondLoading").show(),a.hasOwnProperty("success")||(a.success=function(n,o,r){if("object"!=typeof n&&null!=n&&""!=n)try{n=e.parseJSON(n)}catch(e){}c||(e("#mainLoading").hide(),e("#secondLoading").hide());var a=function(e,n,o,r,a){e&&e.hasOwnProperty("hasError")?(o||Promise.all([t.e(2),t.e(18)]).then(function(){var n=[t(685)];(function(n){(new n).show({title:"WARNING!",text:e.error,notifyType:"error"})}).apply(null,n)}).catch(t.oe),void 0!=a&&a(e.error)):void 0!=r&&r(e,n)};n&&n.hasOwnProperty("isCompressed")&&n.hasOwnProperty("obj")?t.e(103).then(function(){var o=[t(859)];(function(t){n=e.parseJSON(t.inflate(atob(n.obj),{to:"string"})),a(n,r,u,s,i)}).apply(null,o)}).catch(t.oe):a(n,r,u,s,i)}),a.hasOwnProperty("type")||(a.type="GET"),r&&(a.data=r),a.error=function(r,s,l){if(c||(e("#mainLoading").hide(),e("#secondLoading").hide()),r){let e="";const s=`[${a.type}] ${n}`;if(r.responseJSON)for(const n in r.responseJSON)e+="non_field_errors"==n?`${r.responseJSON[n]}\n`:`[${n}]: ${r.responseJSON[n]}\n`;else e=`${r.responseText}\n`;let c="info",l=void 0,d=void 0,h="WARNING!";const f=[];switch(r.status){case 401:c="info",d=15e3,l=(()=>{location.reload()}),f.push({css:"warning",code:"401",title:Object(o.translate)("relog")});break;case 403:c="info",d=1e4,h=Object(o.translate)("access_denied")}void 0!=u&&0!=u||Promise.all([t.e(2),t.e(18)]).then(function(){var n=[t(685)];(function(n){(new n).show({title:h,text:e,endpoint:s,notifyType:c,timeOut:d,buttons:f,callback:l})}).apply(null,n)}).catch(t.oe),void 0!=i&&i(e,r)}},e.ajax({url:`${__apiURL}/${n}`,contentType:a.contentType,data:r,dataType:a.dataType?a.dataType:"json",method:a.type,success:a.success,error:a.error})}}.call(this,t(1))}}]);